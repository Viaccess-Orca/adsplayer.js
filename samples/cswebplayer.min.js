/*
 * The copyright in this software module is being made available under the BSD License, included below. This software module may be subject to other third party and/or contributor rights, including patent rights, and no such rights are granted under this license.
 * The whole software resulting from the execution of this software module together with its external dependent software modules from dash.js project may be subject to Orange and/or other third party rights, including patent rights, and no such rights are granted under this license.
 *
 * Copyright (c) 2014, Orange
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
 * •  Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
 * •  Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
 * •  Neither the name of the Orange nor the names of its contributors may be used to endorse or promote products derived from this software module without specific prior written permission.
 *
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/* Last build : 2017-3-30_14:40:25 / git revision : 321abfb */

/* jshint ignore:start */
!function(e,t){"function"==typeof define&&define.amd?define([],function(){return e.MediaPlayer=t()}):"object"==typeof exports?module.exports=t():e.MediaPlayer=t()}(this,function(){function e(e,t,n){n.addEventListener(e,function(){t(arguments[0])},!1)}function t(e){for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),i=0,r=e.length;i<r;i++)n[i]=e.charCodeAt(i);return n}function n(e){var t=new Uint16Array(e.buffer);return String.fromCharCode.apply(null,t)}function r(e){var t=n(e);t=t.substring(1);var i=document.createElement("a");return i.href=t,i.hostname}function o(e,n,i){"string"==typeof n&&(n=t(n));var r=0,o=new ArrayBuffer(e.byteLength+4+n.byteLength+4+i.byteLength),s=new DataView(o),a=new Uint8Array(o,r,e.byteLength);a.set(e),r+=e.byteLength,s.setUint32(r,n.byteLength,!0),r+=4;var l=new Uint16Array(o,r,n.length);l.set(n),r+=l.byteLength,s.setUint32(r,i.byteLength,!0),r+=4;var d=new Uint8Array(o,r,i.byteLength);return d.set(i),new Uint8Array(o,0,o.byteLength)}function l(e){for(var t,n,i,r,o,s,a,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d="",u=0;u<e.length;)t=e[u++],n=u<e.length?e[u++]:Number.NaN,i=u<e.length?e[u++]:Number.NaN,r=t>>2,o=(3&t)<<4|n>>4,s=(15&n)<<2|i>>6,a=63&i,isNaN(n)?s=a=64:isNaN(i)&&(a=64),d+=l.charAt(r)+l.charAt(o)+l.charAt(s)+l.charAt(a);return d}function d(e){for(var t=window.atob(e),n=t.length,i=new Uint8Array(new ArrayBuffer(n)),r=0;r<n;r++)i[r]=t.charCodeAt(r);return i}function u(e){var t=e.target,n=t.session,i=t.responseText.trim();if("<ckc>"===i.substr(0,5)&&"</ckc>"===i.substr(-6)&&(i=i.slice(5,-6)),i.indexOf("<FAIRPLAY_RESPONSE>")>=0){var r=i.search("</LICENSE>");i=i.slice(28,r)}var o=d(i);n.update(o)}function c(e){console.error("[DRM][FPS] licenseRequestFailed target:"+e.target),console.error("[DRM][FPS] licenseRequestFailed message:"+e.message)}function h(e){console.error("[DRM][FPS] onerror message:"+e.message),console.error("[DRM][FPS] onerror message:"+e.message)}function p(e){var t;for(t=[],i=0,len=e.length;i<len;i+=1)e[i].isRoot?t.push("root"):t.push(e[i].name);var n=function(e,t){var n;if(null!==e&&null!==t)for(n in e)e.hasOwnProperty(n)&&(t.hasOwnProperty(n)||(t[n]=e[n]))},r=function(e,t,i){var r,o,s,a,l;if(null!==e&&0!==e.length)for(r=0,o=e.length;r<o;r+=1)s=e[r],t.hasOwnProperty(s.name)&&(i.hasOwnProperty(s.name)?s.merge&&(a=t[s.name],l=i[s.name],"object"==typeof a&&"object"==typeof l?n(a,l):null!=s.mergeFunction?i[s.name]=s.mergeFunction(a,l):i[s.name]=a+l):i[s.name]=t[s.name])},o=function(e,t){var n,i,s,a,l,d,u,c=e;if(null!==c.children&&0!==c.children.length)for(n=0,i=c.children.length;n<i;n+=1)if(d=c.children[n],t.hasOwnProperty(d.name))if(d.isArray)for(l=t[d.name+"_asArray"],s=0,a=l.length;s<a;s+=1)u=l[s],r(c.properties,t,u),o(d,u);else u=t[d.name],r(c.properties,t,u),o(d,u)},s=function(n){var i,r,a,l,d,u,c;if(null===n)return n;if("object"!=typeof n)return n;for(i=0,r=t.length;i<r;i+=1)"root"===t[i]&&(d=e[i],u=n,o(d,u));for(l in n)if(n.hasOwnProperty(l)){if(a=t.indexOf(l),a!==-1)if(d=e[a],d.isArray)for(c=n[l+"_asArray"],i=0,r=c.length;i<r;i+=1)u=c[i],o(d,u);else u=n[l],o(d,u);s(n[l])}return n};return{run:s}}function f(e,t,n){function i(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function r(e){return e.prefix}function o(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):e}function s(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function a(o){if(o.nodeType==b.DOCUMENT_NODE){var l,d,u,c=o.firstChild;for(d=0,u=o.childNodes.length;d<u;d+=1)if(o.childNodes[d].nodeType!==b.COMMENT_NODE){c=o.childNodes[d];break}if(n)l=a(c);else{l={};var h=i(c);l[h]=a(c)}return l}if(o.nodeType==b.ELEMENT_NODE){var l=new Object;l.__cnt=0;for(var p=o.childNodes,f=0;f<p.length;f++){var c=p.item(f),h=i(c);if(l.__cnt++,null==l[h])l[h]=a(c),l[h+"_asArray"]=new Array(1),l[h+"_asArray"][0]=l[h];else{if(null!=l[h]&&!(l[h]instanceof Array)){var m=l[h];l[h]=new Array,l[h][0]=m,l[h+"_asArray"]=l[h]}for(var g=0;null!=l[h][g];)g++;l[h][g]=a(c)}}for(var y=0;y<o.attributes.length;y++){var _=o.attributes.item(y);l.__cnt++;for(var v=_.value,x=0,T=e.length;x<T;x++){var S=e[x];S.test.call(this,_.value)&&(v=S.converter.call(this,_.value))}l[t+_.name]=v}var D=r(o);return null!=D&&""!=D&&(l.__cnt++,l.__prefix=D),1==l.__cnt&&null!=l["#text"]&&(l=l["#text"]),null!=l["#text"]&&(l.__text=l["#text"],E&&(l.__text=s(l.__text)),delete l["#text"],delete l["#text_asArray"]),null!=l["#cdata-section"]&&(l.__cdata=l["#cdata-section"],delete l["#cdata-section"],delete l["#cdata-section_asArray"]),null==l.__text&&null==l.__cdata||(l.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),l}return o.nodeType==b.TEXT_NODE||o.nodeType==b.CDATA_SECTION_NODE?o.nodeValue:o.nodeType==b.COMMENT_NODE?null:void 0}function l(e,t,n,i){var r="<"+(null!=e&&null!=e.__prefix?e.__prefix+":":"")+t;if(null!=n)for(var o=0;o<n.length;o++){var s=n[o],a=e[s];r+=" "+s.substr(1)+"='"+a+"'"}return r+=i?"/>":">"}function d(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function u(e,t){return e.indexOf(t,e.length-t.length)!==-1}function c(e,t){return!!(u(t.toString(),"_asArray")||0==t.toString().indexOf("_")||e[t]instanceof Function)}function h(e){var t=0;if(e instanceof Object)for(var n in e)c(e,n)||t++;return t}function p(e){var t=[];if(e instanceof Object)for(var n in e)n.toString().indexOf("__")==-1&&0==n.toString().indexOf("_")&&t.push(n);return t}function f(e){var t="";return null!=e.__cdata&&(t+="<![CDATA["+e.__cdata+"]]>"),null!=e.__text&&(t+=E?o(e.__text):e.__text),t}function m(e){var t="";return e instanceof Object?t+=f(e):null!=e&&(t+=E?o(e):e),t}function g(e,t,n){var i="";if(0==e.length)i+=l(e,t,n,!0);else for(var r=0;r<e.length;r++)i+=l(e[r],t,p(e[r]),!1),i+=y(e[r]),i+=d(e[r],t);return i}function y(e){var t="",n=h(e);if(n>0)for(var i in e)if(!c(e,i)){var r=e[i],o=p(r);if(null==r||void 0==r)t+=l(r,i,o,!0);else if(r instanceof Object)if(r instanceof Array)t+=g(r,i,o);else{var s=h(r);s>0||null!=r.__text||null!=r.__cdata?(t+=l(r,i,o,!1),t+=y(r),t+=d(r,i)):t+=l(r,i,o,!0)}else t+=l(r,i,o,!1),t+=m(r),t+=d(r,i)}return t+=m(e)}null!==t&&void 0!==t||(t="_"),null!==n&&void 0!==n||(n=!1);var _="1.0.11",E=!1,b={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(e){var t;if(window.DOMParser)try{var n=new window.DOMParser;if(t=n.parseFromString(e,"text/xml"),t.getElementsByTagName("parsererror").length>0)throw new Error("Error parsing XML")}catch(i){return null}return t},this.xml2json=function(e){return a(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null===t?t:this.xml2json(t)},this.json2xml_str=function(e){return y(e)},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return _},this.escapeMode=function(e){E=e}}function m(){"use strict";var e,t,n;try{e=navigator.userAgent.toLowerCase(),/msie (\d+\.\d+);/.test(e)?(n=Number(RegExp.$1),e.indexOf("trident/6")>-1&&(n=10),e.indexOf("trident/5")>-1&&(n=9),e.indexOf("trident/4")>-1&&(n=8),t="Internet Explorer"):e.indexOf("trident/7")>-1?(n=11,t="Internet Explorer"):/edge[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Edge"):/firefox[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Firefox"):/opera[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Opera"):/chrome[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Chrome"):/version[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Safari"):/rv[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Mozilla"):/mozilla[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Mozilla"):/binget[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Library (BinGet)"):/curl[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Library (cURL)"):/java[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Library (Java)"):/libwww-perl[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Library (libwww-perl)"):/microsoft url control -[\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Library (Microsoft URL Control)"):/peach[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Library (Peach)"):/php[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Library (PHP)"):/pxyscand[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Library (pxyscand)"):/pycurl[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Library (PycURL)"):/python-urllib[\/\s](\d+\.\d+)/.test(e)?(n=Number(RegExp.$1),t="Library (Python URLlib)"):/appengine-google/.test(e)?(n=Number(RegExp.$1),t="Cloud (Google AppEngine)"):/trident/.test(e)?(n=Number(RegExp.$1),t="Trident"):/adventurer/.test(e)?(n=Number(RegExp.$1),t="Adventurer"):(n="unknown",t="unknown")}catch(i){t="error",n="error"}return{name:t.replace(/\s+/g,""),version:n}}function g(){"use strict";var e,t,n,i;try{e=navigator.userAgent.toLowerCase(),n=e.indexOf("windows nt 10.0")!==-1?"Windows 10":e.indexOf("windows nt 6.3")!==-1?"Windows 8.1":e.indexOf("windows nt 6.2")!==-1?"Windows 8":e.indexOf("windows nt 6.1")!==-1?"Windows 7":e.indexOf("windows nt 6.0")!==-1?"Windows Vista/Windows Server 2008":e.indexOf("windows nt 5.2")!==-1?"Windows XP x64/Windows Server 2003":e.indexOf("windows nt 5.1")!==-1?"Windows XP":e.indexOf("windows nt 5.01")!==-1?"Windows 2000, Service Pack 1 (SP1)":e.indexOf("windows xp")!==-1?"Windows XP":e.indexOf("windows 2000")!==-1?"Windows 2000":e.indexOf("windows nt 5.0")!==-1?"Windows 2000":e.indexOf("windows nt 4.0")!==-1?"Windows NT 4.0":e.indexOf("windows nt")!==-1?"Windows NT 4.0":e.indexOf("winnt4.0")!==-1?"Windows NT 4.0":e.indexOf("winnt")!==-1?"Windows NT 4.0":e.indexOf("windows me")!==-1?"Windows ME":e.indexOf("win 9x 4.90")!==-1?"Windows ME":e.indexOf("windows 98")!==-1?"Windows 98":e.indexOf("win98")!==-1?"Windows 98":e.indexOf("windows 95")!==-1?"Windows 95":e.indexOf("windows_95")!==-1?"Windows 95":e.indexOf("win95")!==-1?"Windows 95":e.indexOf("ce")!==-1?"Windows CE":e.indexOf("win16")!==-1?"Windows 3.11":e.indexOf("iemobile")!==-1?"Windows Mobile":e.indexOf("wm5 pie")!==-1?"Windows Mobile":e.indexOf("windows phone 10.0")!==-1?"Windows Phone 10":e.indexOf("windows")!==-1?"Windows (Unknown Version)":e.indexOf("openbsd")!==-1?"Open BSD":e.indexOf("sunos")!==-1?"Sun OS":e.indexOf("ubuntu")!==-1?"Ubuntu":e.indexOf("ipad")!==-1?"iOS (iPad)":e.indexOf("ipod")!==-1?"iOS (iTouch)":e.indexOf("iphone")!==-1?"iOS (iPhone)":e.indexOf("mac os x beta")!==-1?"Mac O SX Beta":e.indexOf("mac os x 10")!==-1?/mac os x 10_(\d+)\_(\d+)/.test(e)?"Mac OS X 10."+RegExp.$1:"Mac OS X 10":e.indexOf("mac os x")!==-1?"Mac OS X":e.indexOf("mac_68000")!==-1?"Mac OS Classic (68000)":e.indexOf("68K")!==-1?"Mac OS Classic (68000)":e.indexOf("mac_powerpc")!==-1?"Mac OS Classic (PowerPC)":e.indexOf("ppc mac")!==-1?"Mac OS Classic (PowerPC)":e.indexOf("macintosh")!==-1?"Mac OS Classic":e.indexOf("googletv")!==-1?"Android (GoogleTV)":e.indexOf("xoom")!==-1?"Android (Xoom)":e.indexOf("htc_flyer")!==-1?"Android (HTC Flyer)":e.indexOf("android")!==-1?"Android":e.indexOf("symbian")!==-1?"Symbian":e.indexOf("series60")!==-1?"Symbian (Series 60)":e.indexOf("series70")!==-1?"Symbian (Series 70)":e.indexOf("series80")!==-1?"Symbian (Series 80)":e.indexOf("series90")!==-1?"Symbian (Series 90)":e.indexOf("x11")!==-1?"UNIX":e.indexOf("nix")!==-1?"UNIX":e.indexOf("linux")!==-1?"Linux":e.indexOf("qnx")!==-1?"QNX":e.indexOf("os/2")!==-1?"IBM OS/2":e.indexOf("beos")!==-1?"BeOS":e.indexOf("blackberry95")!==-1?"Blackberry (Storm 1/2)":e.indexOf("blackberry97")!==-1?"Blackberry (Bold)":e.indexOf("blackberry96")!==-1?"Blackberry (Tour)":e.indexOf("blackberry89")!==-1?"Blackberry (Curve 2)":e.indexOf("blackberry98")!==-1?"Blackberry (Torch)":e.indexOf("playbook")!==-1?"Blackberry (Playbook)":e.indexOf("wnd.rim")!==-1?"Blackberry (IE/FF Emulator)":e.indexOf("blackberry")!==-1?"Blackberry":e.indexOf("palm")!==-1?"Palm OS":e.indexOf("webos")!==-1?"WebOS":e.indexOf("hpwos")!==-1?"WebOS (HP)":e.indexOf("blazer")!==-1?"Palm OS (Blazer)":e.indexOf("xiino")!==-1?"Palm OS (Xiino)":e.indexOf("kindle")!==-1?"Kindle":e.indexOf("wii")!==-1?"Nintendo (Wii)":e.indexOf("nintendo ds")!==-1?"Nintendo (DS)":e.indexOf("playstation 3")!==-1?"Sony (Playstation Console)":e.indexOf("playstation portable")!==-1?"Sony (Playstation Portable)":e.indexOf("webtv")!==-1?"MSN TV (WebTV)":e.indexOf("inferno")!==-1?"Inferno":"Unknown",t=navigator.platform.toLowerCase(),i=t.indexOf("x64")!==-1?"64":e.indexOf("x86_64")!==-1?"64":e.indexOf("x86-64")!==-1?"64":e.indexOf("win64")!==-1?"64":e.indexOf("x64;")!==-1?"64":e.indexOf("amd64")!==-1?"64":e.indexOf("wow64")!==-1?"64":e.indexOf("x64_64")!==-1?"64":e.indexOf("ia65")!==-1?"64":e.indexOf("sparc64")!==-1?"64":e.indexOf("ppc64")!==-1?"64":e.indexOf("irix64")!==-1?"64":e.indexOf("irix64")!==-1?"64":"32"}catch(r){n="error",i="error"}return{name:n.replace(/\s+/g,""),bits:"x"+i}}var y,_,E,b={},v={},x={},T={},S=null,D=null;T=function(){var e,t="HasPlayer",n="1.2.0",i="1.8.0",r="cswebplayer-CSWebPlayer-1.1.6",o="cswebplayer-CSWebPlayer-1.1.6",s="321abfb",a="2017-3-30_14:40:25",l=new T.di.Context,d=new E.System,u=!1,c=null,h=null,p=null,f=[],_=[],b=null,v=null,x="und",I="und",L=!1,M={video:-1,audio:-1},R=null,A=!1,P=!1,w=!0,B=null,F=!1,N={},C=function(){if(!u)throw new Error("MediaPlayer not initialized !!!")},O=function(){if(!e.getElement())throw new Error("MediaPlayer.play(): Video element not attached to MediaPlayer")},U=function(){if(!B)throw new Error("MediaPlayer.play(): Source not attached to MediaPlayer")},k=function(){return C(),O(),U(),T.hasMediaSourceExtension()?(P=!0,this.metricsModel.addSession(null,B.url,e.getElement().loop,null,"MediaPlayer.js_"+this.getVersion()),R||(R=d.getObject("streamController"),R.setVideoModel(e),R.setAutoPlay(w)),R.setDefaultAudioLang(x),R.setDefaultSubtitleLang(I),R.enableSubtitles(L),R.load(B),d.mapValue("scheduleWhilePaused",F),void d.mapOutlet("scheduleWhilePaused","stream")):void this.errHandler.sendError(T.dependencies.ErrorHandler.prototype.CAPABILITY_ERR_MEDIASOURCE,"MediaSource extension not supported by the browser")},H=function(){return u&&e.getElement()&&B&&!A},K=function(){H()&&k.call(this)},V=function(t,n){var i=document.createEvent("CustomEvent");i.initCustomEvent(t,!1,!1,{type:n.streamType,bitrate:n.switchedQuality,representationId:n.representationId,time:e.getCurrentTime(),width:n.width,height:n.height}),e.getElement().dispatchEvent(i)},q=function(t){var n;switch(t.data.metric){case"ManifestReady":C(),this.debug.log("[MediaPlayer] ManifestReady"),h=this.metricsExt.getBitratesForType("video"),this.debug.log("[MediaPlayer] video bitrates: "+JSON.stringify(h)),n=document.createEvent("CustomEvent"),n.initCustomEvent("manifest_loaded",!1,!1,{}),e.getElement().dispatchEvent(n);break;case"RepresentationSwitch":C(),"video"==t.data.stream?(h=this.metricsExt.getBitratesForType(t.data.stream),h&&(V("download_bitrate",{streamType:t.data.stream,switchedQuality:h[t.data.value.lto],representationId:t.data.value.to,width:this.metricsExt.getVideoWidthForRepresentation(t.data.value.to),height:this.metricsExt.getVideoHeightForRepresentation(t.data.value.to)}),this.debug.log("[MediaPlayer]["+t.data.stream+"] send download_bitrate - b="+h[t.data.value.lto]))):"audio"==t.data.stream&&(p=this.metricsExt.getBitratesForType(t.data.stream),p&&(V("download_bitrate",{streamType:t.data.stream,switchedQuality:p[t.data.value.to],representationId:t.data.value.to,width:this.metricsExt.getVideoWidthForRepresentation(t.data.value.to),height:this.metricsExt.getVideoHeightForRepresentation(t.data.value.to)}),this.debug.log("[MediaPlayer]["+t.data.stream+"] send download_bitrate - b="+h[t.data.value.lto])));break;case"BufferedSwitch":C(),"video"==t.data.stream?f.push({streamType:t.data.stream,mediaStartTime:t.data.value.mt,switchedQuality:h[t.data.value.lto],representationId:t.data.value.to,width:this.metricsExt.getVideoWidthForRepresentation(t.data.value.to),height:this.metricsExt.getVideoHeightForRepresentation(t.data.value.to)}):"audio"==t.data.stream&&_.push({streamType:t.data.stream,mediaStartTime:t.data.value.mt,switchedQuality:p[t.data.value.lto],representationId:t.data.value.to,width:this.metricsExt.getVideoWidthForRepresentation(t.data.value.to),height:this.metricsExt.getVideoHeightForRepresentation(t.data.value.to)});break;case"BufferLevel":n=document.createEvent("CustomEvent"),n.initCustomEvent("bufferLevel_updated",!1,!1,{type:t.data.stream,level:t.data.value.level}),e.getElement().dispatchEvent(n);break;case"State":n=document.createEvent("CustomEvent"),n.initCustomEvent("state_changed",!1,!1,{type:t.data.stream,state:t.data.value.current}),e.getElement().dispatchEvent(n)}},z=function(e){b=e.data},Y=function(e){v=e.data},j=function(e,t){var n=0;for(n=t.length-1;n>=0;n-=1)e.splice(n,1)},W=function(t){var n=e.getCurrentTime(),i=null,r=[],o=0;for(o=0;o<t.length;o+=1)i=t[o],n>=i.mediaStartTime&&(V("play_bitrate",i),this.debug.log("[MediaPlayer]["+i.streamType+"] send play_bitrate - b="+i.switchedQuality+", t="+i.mediaStartTime+"("+e.getPlaybackRate()+")"),r.push(o));j(t,r)},G=function(){0!==e.getPlaybackRate()&&(W.call(this,f),W.call(this,_))},X=function(){this.addEventListener("metricAdded",q.bind(this)),this.addEventListener("error",z.bind(this)),this.addEventListener("warning",Y.bind(this)),this.addEventListener("timeupdate",G.bind(this))},Q=function(e){if(P&&R){if(!A){A=!0;var t={};t[T.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE]=function(){R=null,P=!1,A=!1,this.debug.log("[MediaPlayer] Player is stopped"),H.call(this)&&K.call(this)}.bind(this),R.subscribe(T.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE,t,void 0,!0),R.reset(e)}}else H.call(this)&&K.call(this)},J=function(e){if(!R)return null;switch(e){case T.TRACKS_TYPE.AUDIO:return R.getAudioTracks();case T.TRACKS_TYPE.TEXT:return R.getSubtitleTracks()}return null},$=function(e){if(!R)return null;switch(e){case T.TRACKS_TYPE.AUDIO:return R.getSelectedAudioTrack();case T.TRACKS_TYPE.TEXT:return R.getSelectedSubtitleTrack()}return null},Z=function(e,t){if(!R)return null;switch(e){case T.TRACKS_TYPE.AUDIO:R.setAudioTrack(t);break;case T.TRACKS_TYPE.TEXT:R.setSubtitleTrack(t)}return null},ee=function(e,t){return e.id===t.id&&e.lang===t.lang&&e.subType===t.subType},te=function(){if(arguments&&arguments.length>0){var e={};return"string"==typeof arguments[0]&&(e.url=arguments[0]),arguments[1]&&(e.protData=arguments[1]),e}},ne=function(){var e=this.metricsModel.getReadOnlyMetricsFor("video"),t=e?this.metricsExt.getCurrentDVRInfo(e):null;return t};return d.mapValue("system",d),d.mapOutlet("system"),d.injectInto(l),{notifier:void 0,debug:void 0,eventBus:void 0,metricsExt:void 0,abrController:void 0,metricsModel:void 0,errHandler:void 0,config:void 0,getVersion:function(){return o+" (from "+t+" "+i+")"},getVersionFull:function(){return s.indexOf("@@")===-1?r+"_"+s:r},getVersionDashJS:function(){return n},getBuildDate:function(){return a.indexOf("@@")===-1?a:"Not a builded version"},init:function(t){if(!t)throw new Error("MediaPlayer.init(): Invalid Argument");u||(d.injectInto(this),u=!0,this.debug.log("[MediaPlayer] Version: "+this.getVersionFull()+" - "+this.getBuildDate()),this.debug.log("[MediaPlayer] user-agent: "+navigator.userAgent)),e=d.getObject("videoModel"),e.setElement(t),X.call(this),c=d.getObject("debugController")},addEventListener:function(t,n,i){C(),"hasplayer"===T.PUBLIC_EVENTS[t]?this.eventBus.addEventListener(t,n,i):e.listen(t,n,i)},removeEventListener:function(t,n){C(),"hasplayer"===T.PUBLIC_EVENTS[t]?this.eventBus.removeEventListener(t,n):e.unlisten(t,n)},getVideoModel:function(){return e},getDebug:function(){return this.debug},getMetricsExt:function(){return this.metricsExt},setConfig:function(e){this.config&&e&&(this.debug.log("[MediaPlayer] set config: "+JSON.stringify(e,null,"\t")),this.config.setParams(e))},setParams:function(e){this.setConfig(e)},setDebug:function(e){if(C(),"boolean"!=typeof e)throw new Error("MediaPlayer.setDebug(): Invalid Arguments");e===!0?this.debug.setLevel(4):this.debug.setLevel(0)},getAutoPlay:function(){return w},setAutoPlay:function(e){w=e},setInitialQualityFor:function(e,t){M[e]=t},getQualityFor:function(e){return C(),this.abrController.getQualityFor(e)},setQualityFor:function(e,t){if(C(),"number"!=typeof t)throw new Error("MediaPlayer.setQualityFor(): Invalid Arguments");this.abrController.setQualityFor(e,t)},getAutoSwitchQuality:function(){return C(),this.abrController.getAutoSwitchBitrate()},setAutoSwitchQuality:function(e){if(C(),"boolean"!=typeof e)throw new Error("MediaPlayer.setAutoSwitchQuality(): Invalid Arguments");this.abrController.setAutoSwitchBitrate(e)},getScheduleWhilePaused:function(){return F},setScheduleWhilePaused:function(e){if("boolean"!=typeof e)throw new Error("MediaPlayer.setScheduleWhilePaused(): Invalid Arguments");F=e},setDefaultAudioLang:function(e){if("string"!=typeof e)throw new Error("MediaPlayer.setDefaultAudioLang(): Invalid Arguments");x=e},getDefaultAudioLang:function(){return x},setDefaultSubtitleLang:function(e){if("string"!=typeof e)throw new Error("MediaPlayer.setDefaultSubtitleLang(): Invalid Arguments");I=e},getDefaultSubtitleLang:function(){return I},setFairPlayCertificatUrl:function(e){if("string"!=typeof e)throw new Error("MediaPlayer.setFairPlayCertificatUrl(): Invalid Arguments");S=e},setFairPlayCertificat:function(e){D=e},load:function(e){var t,n=[],i=[],r={video:{"ABR.keepBandwidthCondition":!0},audio:{"ABR.keepBandwidthCondition":!0}};if(arguments&&arguments.length>0&&"object"!=typeof arguments[0]&&(console.warn('You are using "deprecated" call of the method load, please refer to the documentation to change prameters call'),e=te.apply(null,arguments)),!e||!e.url)throw new Error("MediaPlayer.load(): stream has no url.");f=[],_=[],C(),this.reset(0),M.video>=0&&(this.abrController.setQualityFor("video",M.video),r.video["ABR.keepBandwidthCondition"]=!1,M.video=-1),M.audio>=0&&(this.abrController.setQualityFor("audio",M.audio),r.audio["ABR.keepBandwidthCondition"]=!1,M.audio=-1),this.setConfig(r),b=null,v=null;for(var o in N)n.push(N[o].deferInit.promise);y.all(n).then(function(){for(var n in N)t=N[n],t.deferLoad=y.defer(),i.push(t.deferLoad.promise),t.load(e,function(){this.deferLoad.resolve()}.bind(t));y.all(i).then(function(){B=e,Q.call(this,0)}.bind(this))}.bind(this))},play:function(){C(),e.play()},seek:function(t){var n=null,i=0;if(C(),"number"!=typeof t)throw new Error("MediaPlayer.seek(): Invalid Arguments");if(this.isLive()){if(n=this.getDVRWindowRange(),i=R.getLiveDelay(),null===n)throw new Error("MediaPlayer.seek(): impossible for live stream");if(t<n.start||t>n.end)throw new Error("MediaPlayer.seek(): seek value outside available time range");t>n.end-i&&(t=n.end-i),R.seek(t,!0)}else{if(t<0||t>e.getDuration())throw new Error("MediaPlayer.seek(): seek value outside available time range");e.setCurrentTime(t)}},pause:function(){C(),e.pause()},stop:function(){C(),e.pause(),this.isLive()||e.setCurrentTime(0);for(var t in N)N[t].stop()},reset:function(e){C(),this.setQualityFor("video",0),this.setQualityFor("audio",0),B=null,Q.call(this,e);for(var t in N)N[t].reset()},refreshManifest:function(e){C(),R.refreshManifest(e)},getDuration:function(){return C(),e.getDuration()},isLive:function(){return C(),e.getDuration()===Number.POSITIVE_INFINITY},getPosition:function(){return C(),this.isLive()?void 0:e.getCurrentTime()},getDVRWindowRange:function(){if(C(),!this.isLive())return null;var e=ne.call(this);return e?e.range:null},getDVRWindowSize:function(){return C(),this.isLive(),null},getDVRSeekOffset:function(e){if(C(),!this.isLive())return null;var t=ne.call(this),n=t?t.range.start+e:null;return n&&n>t.range.end&&(n=t.range.end),n},getVideoBitrates:function(){return C(),h?h.slice(0):null},getMetricsFor:function(e){var t=this.metricsModel.getReadOnlyMetricsFor(e);return t},getTrickModeSpeed:function(){return R?R.getTrickModeSpeed():0},setTrickModeSpeed:function(t){C(),R&&(R.getTrickModeSpeed()!==t&&1===t?e.play():R.setTrickModeSpeed(t))},getError:function(){return b},getWarning:function(){return v},getTracks:function(e){if(C(),!e||e!==T.TRACKS_TYPE.AUDIO&&e!==T.TRACKS_TYPE.TEXT)throw new Error('MediaPlayer Invalid Argument - "type" should be defined and shoud be kind of MediaPlayer.TRACKS_TYPE');var t=J(e);if(!t)return[];for(var n=[],i=0;i<t.length;i+=1)n.push({id:t[i].id,lang:t[i].lang,subType:t[i].subType});return n},getSubtitleTracks:function(){return console.warn('You are using a "deprecated" method. Please use getTracks instead.'),this.getTracks(T.TRACKS_TYPE.TEXT)},getAudioTracks:function(){return console.warn('You are using a "deprecated" method. Please use getTracks instead.'),this.getTracks(T.TRACKS_TYPE.AUDIO)},selectTrack:function(e,t){if(C(),!e||e!==T.TRACKS_TYPE.AUDIO&&e!==T.TRACKS_TYPE.TEXT)throw new Error('MediaPlayer Invalid Argument - "type" should be defined and shoud be kind of MediaPlayer.TRACKS_TYPE');if(!t||!(t.id||t.lang||t.subType))throw new Error("MediaPlayer.selectTrack(): track parameter is not in valid");var n=J(e);if(!n)return void this.debug.error("[MediaPlayer] No available track for type "+e);var i=$(e);if(i&&ee(i,t))return void this.debug.log("[MediaPlayer] "+e+" track ["+t.id+" - "+t.lang+"] is already selected");for(var r=0;r<n.length;r+=1)if(ee(n[r],t))return void Z(e,n[r])},setAudioTrack:function(e){return console.warn('You are using a "deprecated" method. Please use selectTrack instead.'),this.selectTrack(T.TRACKS_TYPE.AUDIO,e)},setSubtitleTrack:function(e){return console.warn('You are using a "deprecated" method. Please use selectTrack instead.'),this.selectTrack(T.TRACKS_TYPE.TEXT,e)},getSelectedTrack:function(e){if(C(),!e||e!==T.TRACKS_TYPE.AUDIO&&e!==T.TRACKS_TYPE.TEXT)throw new Error('MediaPlayer Invalid Argument - "type" should be defined and shoud be kind of MediaPlayer.TRACKS_TYPE');var t=$(e);return t?{id:t.id,lang:t.lang,subType:t.subType}:null},getSelectedAudioTrack:function(){return console.warn('You are using a "deprecated" method. Please use getSelectedTrack instead.'),this.getSelectedTrack(T.TRACKS_TYPE.AUDIO)},getSelectedSubtitleTrack:function(){return console.warn('You are using a "deprecated" method. Please use getSelectedTrack instead.'),this.getSelectedTrack(T.TRACKS_TYPE.TEXT)},enableSubtitles:function(e){if(C(),"boolean"!=typeof e)throw new Error("MediaPlayer.enableSubtitles(): Invalid Arguments");L=e,R&&R.enableSubtitles(L)},isSubtitlesEnabled:function(){return C(),L},enableSubtitleExternDisplay:function(e){if("boolean"!=typeof e)throw new Error("MediaPlayer.enableSubtitleExternDisplay(): Invalid Arguments");this.config.setParams({"TextTrackExtensions.displayModeExtern":e})},getTTMLRenderingDiv:function(){return e?e.getTTMLRenderingDiv():null},attachTTMLRenderingDiv:function(t){C(),e.setTTMLRenderingDiv(t)},getMute:function(){return C(),e.getMute()},setMute:function(t){if(C(),"boolean"!=typeof t)throw new Error("MediaPlayer.setMute(): Invalid Arguments");e.setMute(t)},getVolume:function(){return C(),e.getVolume()},setVolume:function(t){if(C(),"number"!=typeof t||t<0||t>1)throw new Error("MediaPlayer.setVolume(): Invalid Arguments");e.setVolume(t)},getTerminalId:function(){var e=m(),t=g();return t.name+"-"+t.bits+"-"+e.name},addPlugin:function(e){if(C(),void 0===e)throw new Error("MediaPlayer.addPlugin(): plugin undefined");if("function"!=typeof e.getName||"function"!=typeof e.getVersion||"function"!=typeof e.init||"function"!=typeof e.load||"function"!=typeof e.stop||"function"!=typeof e.reset)throw new Error("MediaPlayer.addPlugin(): plugin API not compliant");N[e.getName()]&&N[e.getName()].destroy(),this.debug.log("[MediaPlayer] Add plugin '"+e.getName()+"' (v"+e.getVersion()+")"),N[e.getName()]=e,e.deferInit=y.defer(),u&&e.init(this,function(){this.deferInit.resolve()}.bind(e))},removePlugin:function(e){var t;if(void 0===e)throw new Error("MediaPlayer.removePlugin(): plugin undefined");if("string"==typeof e)t=e;else{if("function"!=typeof e.getName)throw new Error("MediaPlayer.removePlugin(): plugin API not compliant");t=e.getName()}N[t]&&(this.debug.log("[MediaPlayer] Remove plugin '"+t),N[t].destroy(),N[t]=null,delete N[t])}}},T.prototype={constructor:T},T.dependencies={},T.dependencies.protection={},T.dependencies.protection.servers={},T.utils={},T.models={},T.modules={},T.vo={},T.vo.metrics={},T.vo.protection={},T.rules={},T.rules.o={},T.di={},T.PUBLIC_EVENTS={error:"hasplayer",warning:"hasplayer",cueEnter:"hasplayer",cueExit:"hasplayer",manifestUrlUpdate:"hasplayer",metricAdded:"hasplayer",metricChanged:"hasplayer",play_bitrate:"video",download_bitrate:"video",bufferLevel_updated:"video",state_changed:"video"},T.TRACKS_TYPE={AUDIO:"audio",TEXT:"text"},T.hasMediaSourceExtension=function(){return(new T.utils.Capabilities).supportsMediaSource()},T.hasMediaKeysExtension=function(){return(new T.utils.Capabilities).supportsMediaKeys()},T.dependencies.AbrController=function(){"use strict";var e=!0,t={},n={},i={},r={},o="",s=function(e){return t.hasOwnProperty(e)||(t[e]=!0),t[e]},a=function(e,n){t[e]=n},l=function(e){var t;return n.hasOwnProperty(e)||(n[e]=0),t=n[e]},d=function(e,t){n[e]=t},u=function(e){var t;return r.hasOwnProperty(e)||(r[e]=0),t=r[e]},c=function(e,t){r[e]=t},h=function(t,n){var r,a,d,c,h,p,f=this,m=s(t),g=l(t),y=u(t),_=T.rules.SwitchRequest.prototype.NO_CHANGE,E=T.rules.SwitchRequest.prototype.NO_CHANGE,b=T.rules.SwitchRequest.prototype.NO_CHANGE,v=[],x={};if(!e||!m)return f.debug.log("[AbrController]["+t+"] ABR disabled"),{quality:g,confidence:y};for(f.debug.log("[AbrController]["+t+"] Check rules...."),d=f.getMetricsFor(n),h=f.abrRulesCollection.getRules(T.rules.BaseRulesCollection.prototype.QUALITY_SWITCH_RULES),r=0,a=h.length;r<a;r+=1)v.push(h[r].checkIndex(g,d,n,o));for(x[T.rules.SwitchRequest.prototype.STRONG]=T.rules.SwitchRequest.prototype.NO_CHANGE,x[T.rules.SwitchRequest.prototype.WEAK]=T.rules.SwitchRequest.prototype.NO_CHANGE,x[T.rules.SwitchRequest.prototype.DEFAULT]=T.rules.SwitchRequest.prototype.NO_CHANGE,r=0,a=v.length;r<a;r+=1)c=v[r],c.quality!==T.rules.SwitchRequest.prototype.NO_CHANGE&&(f.debug.log("[AbrController]["+t+"] Request for quality "+c.quality+", priority = "+c.priority+" ("+h[r].name+")"),x[c.priority]=Math.min(x[c.priority],c.quality)),c.max===!0&&(b=Math.min(b,c.quality));return x[T.rules.SwitchRequest.prototype.WEAK]!==T.rules.SwitchRequest.prototype.NO_CHANGE&&(E=T.rules.SwitchRequest.prototype.WEAK,_=x[T.rules.SwitchRequest.prototype.WEAK]),x[T.rules.SwitchRequest.prototype.DEFAULT]!==T.rules.SwitchRequest.prototype.NO_CHANGE&&(E=T.rules.SwitchRequest.prototype.DEFAULT,_=x[T.rules.SwitchRequest.prototype.DEFAULT]),x[T.rules.SwitchRequest.prototype.STRONG]!==T.rules.SwitchRequest.prototype.NO_CHANGE&&(E=T.rules.SwitchRequest.prototype.STRONG,_=x[T.rules.SwitchRequest.prototype.STRONG]),_!==T.rules.SwitchRequest.prototype.NO_CHANGE&&void 0!==_&&(g=_),E!==T.rules.SwitchRequest.prototype.NO_CHANGE&&void 0!==E&&(y=E),b!==T.rules.SwitchRequest.prototype.NO_CHANGE&&(i[t]=b),p=f.manifestExt.getRepresentationCount(n),g<0&&(g=0),g>=p&&(g=p-1),y!==T.rules.SwitchRequest.prototype.STRONG&&y!==T.rules.SwitchRequest.prototype.WEAK&&(y=T.rules.SwitchRequest.prototype.DEFAULT),f.debug.info("[AbrController]["+t+"] Request quality: "+g),{quality:g,confidence:y}},p=function(e,t){var n,i=this.metricsExt.getBitratesForType(e,t),r=this.config.getParamFor(e,"ABR.minQuality","number",-1),o=this.config.getParamFor(e,"ABR.maxQuality","number",-1),s=this.config.getParamFor(e,"ABR.minBandwidth","number",-1),a=this.config.getParamFor(e,"ABR.maxBandwidth","number",-1),l=i.length;if(s!==-1)for(n=0;n<i.length;n++)if(i[n]>=s){r=r===-1?n:Math.max(n,r);break}if(a!==-1)for(n=i.length-1;n>=0;n--)if(i[n]<=a){o=o===-1?n:Math.min(n,o);break}return r=r>=l?l-1:r,r=r<0?0:r,o=o>=l||o<0?l-1:o,{min:r,max:o}};return{debug:void 0,abrRulesCollection:void 0,
manifestExt:void 0,metricsModel:void 0,metricsExt:void 0,config:void 0,getAutoSwitchBitrate:function(){return e},setAutoSwitchBitrate:function(t){this.debug.log("[AbrController] Set auto switch: "+t),e=t},getMetricsFor:function(e){var t,n;return t=this.manifestExt.getIsVideo(e),t?this.metricsModel.getMetricsFor("video"):(n=this.manifestExt.getIsAudio(e),n?this.metricsModel.getMetricsFor("audio"):this.metricsModel.getMetricsFor("stream"))},getPlaybackQuality:function(e,t){var n,r,o,s=this,a=this.getQualityFor(e),l=-1,u=-1,f=this.config.getParamFor(e,"ABR.switchUpIncrementally","boolean",!1);if(o=h.call(this,e,t),n=o.quality,r=o.confidence,s.getAutoSwitchBitrate()){f&&n>a&&(s.debug.log("[AbrController]["+e+"] Incremental switch => quality: "+n),n=a+1);var m=p.call(s,e,t);l=m.min,u=m.max,n<l&&(n=l,s.debug.log("[AbrController]["+e+"] New quality < min => "+n)),n>u&&(n=u,s.debug.log("[AbrController]["+e+"] New quality > max => "+n)),n>i[e]&&(n=i[e],s.debug.log("[AbrController]["+e+"] Max allowed quality = "+n))}return d.call(s,e,n),c.call(s,e,r),s.debug.info("[AbrController]["+e+"] Set quality: "+n),{quality:n,confidence:r}},getAutoSwitchFor:function(e){return s(e)},setAutoSwitchFor:function(e,t){var n=s(e);t!==n&&(this.debug.log("[AbrController]["+e+"] Set auto switch: "+t),a(e,t))},getQualityFor:function(e){return l(e)},setQualityFor:function(e,t){var n=l(e);t!==n&&(this.debug.log("[AbrController]["+e+"] Set playback quality: "+t),d(e,t))},isMinQuality:function(e,t,n){var i=p.call(this,e,t);return n<=i.min},setPlayerState:function(e){o=e}}},T.dependencies.AbrController.prototype={constructor:T.dependencies.AbrController},T.dependencies.AbrController.BANDWIDTH_SAFETY=.9,T.dependencies.BufferController=function(){"use strict";var e,t,n,i,r,o,s,a,l,d="READY",u=d,c=!1,h=!1,p=!1,f=!0,g=[],_=!1,E=-1,b=!0,v=!1,S=!1,D=-1,I=-1,L=!1,M=!1,R=!1,A=null,w=null,B=0,F=null,N=0,C=!1,O=null,U=!1,k=null,H=null,K=!1,V=0,q=!0,z=!1,Y=null,j=null,W=!0,G=!1,X=-1,Q=0,J=1,$=X,Z=-1,ee=null,te=3,ne=0,ie=null,re=null,oe=-1,se=null,ae=NaN,le="Safari"===m().name,de="Firefox"===m().name,ue=function(){Me.call(this)&&null!==F&&this.fragmentController.onBufferControllerStateChange()},ce=function(e,t){var n=0,i=null;W===!1&&(i=j.start,n=e.getTime()-i.getTime(),j.duration=n,j.stopreason=t,W=!0)},he=function(e){var t=this;"text"!==i&&(t.debug.info("[BufferController]["+i+"] stalled = "+e),L=e,t.videoModel.stallStream(i,L),t.abrController.setPlayerState(L?"buffering":"playing"))},pe=function(){c&&h&&(this.debug.info("[BufferController]["+i+"] startPlayback"),he.call(this,!0),Ve.call(this))},fe=function(){var e,t=this;if(h!==!0){if(_===!1&&(e=new Date,ce(e,T.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),Y=this.metricsModel.addPlayList(i,e,0,T.vo.metrics.PlayList.INITIAL_PLAY_START_REASON)),R){if("application/ttml+xml"===k.mimeType)return;R=!1}h=!0,t.debug.info("[BufferController]["+i+"] START"),p=!0,$=X,Z=-1,ie=null,pe.call(t)}},me=function(e){var t=this,n=new Date;_===!0&&E===e||(this.debug.info("[BufferController]["+i+"] SEEK: "+e),h===!0&&ye.call(t),this.fragmentController.clearExecutedRequests(F),Y=this.metricsModel.addPlayList(i,n,E,T.vo.metrics.PlayList.SEEK_START_REASON),_=!0,E=e,y.when(!ee||ee.promise).then(function(){fe.call(t)}))},ge=function(){this.debug.info("[BufferController]["+i+"] SEEKED"),_=!1,E=-1},ye=function(){h&&(this.debug.info("[BufferController]["+i+"] STOP"),clearTimeout(a),clearTimeout(l),h=!1,p=!1,_=!1,E=-1,clearTimeout(re),re=null,ce(new Date,T.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),this.fragmentController.abortRequestsForModel(F))},_e=function(t){return e[t]},Ee=function(e){this.debug.info("[BufferController]["+i+"] Load request ",null!==e.url?e.url:e.quality)},be=function(e,t){void 0!==e.sequenceNumber&&(oe=e.sequenceNumber),this.fragmentController.isInitializationRequest(e)?ve.call(this,e,t):xe.call(this,e,t)},ve=function(e,t){var n=this,r=t.data,o=e.quality;n.debug.log("[BufferController]["+i+"] Initialization loaded ",o);try{n.fragmentController.process(r).then(function(t){t?(g[o]=t,n.debug.info("[BufferController]["+i+"] Buffer initialization segment ",null!==e.url?e.url:e.quality),Te.call(n,t,e.quality).then(function(){Me()&&Ne.call(n)})):Ne.call(n)},function(e){Re.call(n),e.name?n.errHandler.sendError(e.name,e.message,e.data):n.errHandler.sendError(T.dependencies.ErrorHandler.prototype.INTERNAL_ERROR,"Internal error while processing media segment",e.message)})}catch(s){Re.call(n),s.name?n.errHandler.sendError(s.name,s.message,s.data):n.errHandler.sendError(T.dependencies.ErrorHandler.prototype.INTERNAL_ERROR,"Internal error while processing media segment",s.message)}},xe=function(e,n){var r,o=this,s=this.manifestExt.getEventStreamForAdaptationSet(o.getData()),a=this.manifestExt.getEventStreamForRepresentation(o.getData(),t);if(ae=e.duration,Me()){ne=0,o.debug.log("[BufferController]["+i+"] Media loaded ",e.url),o.chunkAborted===!0&&(o.chunkAborted=!1),1===o.chunkMissingCount&&(o.chunkMissingCount=0);try{o.fragmentController.process(n.data,e,t).then(function(n){n?((s.length>0||a.length>0)&&(r=Ie.call(o,n,e,s,a),o.eventController.addInbandEvents(r)),o.debug.info("[BufferController]["+i+"] Buffer segment from url ",e.url),n=Le.call(o,n),y.when(!S||Pe.call(o)).then(function(){S=!1,de&&(H.timestampOffset=-De(n,e)),Te.call(o,n,e.quality,e).then(function(){D!==e.quality&&(o.debug.log("[BufferController]["+i+"] Buffered quality changed: "+e.quality),o.metricsModel.addBufferedSwitch(i,e.startTime,t.id,e.quality),D=e.quality),Re.call(o),Ve.call(o)})})):(o.debug.error("[BufferController]["+i+"] Error with segment data, no bytes to push"),Re.call(o),Ve.call(o))},function(e){Re.call(o),e.name?o.errHandler.sendError(e.name,e.message,e.data):o.errHandler.sendError(T.dependencies.ErrorHandler.prototype.INTERNAL_ERROR,"Internal error while processing media segment",e.message)})}catch(l){Re.call(o),l.name?o.errHandler.sendError(l.name,l.message,l.data):o.errHandler.sendError(T.dependencies.ErrorHandler.prototype.INTERNAL_ERROR,"Internal error while processing media segment",l.message)}}},Te=function(e,n,r){var o=this,s=y.defer(),a=o.videoModel.getCurrentTime(),l=new Date;if(W===!0&&(W=!1,j=o.metricsModel.appendPlayListTrace(Y,t.id,null,l,a,null,1,null)),Oe())return Ae.call(o).then(function(){Oe()&&(o.debug.log("[BufferController]["+i+"] Buffering segment"),o.sourceBufferExt.append(H,e,r).then(function(){if(o.debug.log("[BufferController]["+i+"] Segment buffered"),C=!1,M&&N>1&&!le)Pe.call(o,-1,ke.call(o)-30).then(function(){Se.call(o),s.resolve()});else if(K){var e=z?-1:ke.call(o)+ae,t=z?ke.call(o)-ae:-1;Pe.call(o,e,t).then(function(){Se.call(o),s.resolve()})}else Se.call(o),s.resolve();o.system.notify("bufferUpdated")},function(t){o.errHandler.sendError(T.dependencies.ErrorHandler.prototype.MEDIA_ERR_APPEND_SOURCEBUFFER,"Failed to append data into "+i+" source buffer",new T.vo.Error(t.err.code,t.err.name,t.err.message)),t.err.code===T.dependencies.ErrorHandler.prototype.DOM_ERR_QUOTA_EXCEEDED&&(O={data:e,quality:n},A=s,C=!0,B=0,ye.call(o))}))}),s.promise},Se=function(){var e,t,n=null;if(this.debug.getLevel()>=this.debug.INFO&&H){if(n=this.sourceBufferExt.getAllRanges(H),null===n||0===n.length)return;for(e=0,t=n.length;e<t;e+=1)this.debug.info("[BufferController]["+i+"] Buffered range ["+e+"]: "+n.start(e)+" - "+n.end(e)+" ("+this.getVideoModel().getCurrentTime()+")")}},De=function(e,t){var n,i,r=P.deserialize(e),o=r.getBoxByType("moov"),s=r.getBoxByType("moof"),a=null===s?null:s.getBoxByType("traf"),l=null===a?null:a.getBoxByType("trun");if(null===l||0===l.samples_table.length)return 0;if(n=l.samples_table[0].sample_composition_time_offset,void 0===n)return 0;if(o){var d=o.getBoxByType("mvhd");i=d.timescale}else i=t.timescale;return n/i},Ie=function(e,t,n,i){var r,o,s,a=[],l=0,d=Math.pow(256,2),u=Math.pow(256,3),c=Math.max(isNaN(t.startTime)?0:t.startTime,0),h=[];G=!1,s=n.concat(i);for(var p=0;p<s.length;p++)h[s[p].schemeIdUri]=s[p];for(;l<e.length&&(r=String.fromCharCode(e[l+4],e[l+5],e[l+6],e[l+7]),o=e[l]*u+e[l+1]*d+256*e[l+2]+1*e[l+3],"moov"!==r&&"moof"!==r);){if("emsg"===r){G=!0;for(var f=["","",0,0,0,0,""],m=0,g=l+12;g<o+l;)0===m||1===m||6===m?(0!==e[g]?f[m]+=String.fromCharCode(e[g]):m+=1,g+=1):(f[m]=e[g]*u+e[g+1]*d+256*e[g+2]+1*e[g+3],g+=4,m+=1);var y=f[0],_=f[1],E=f[2],b=f[3],v=f[4],T=f[5],S=f[6],D=c*E+b;if(h[y]){var I=new x.vo.Event;I.eventStream=h[y],I.eventStream.value=_,I.eventStream.timescale=E,I.duration=v,I.id=T,I.presentationTime=D,I.messageData=S,I.presentationTimeDelta=b,a.push(I)}}l+=o}return a},Le=function(e){if(!G)return e;for(var t,n,i=e.length,r=0,o=0,s=0,a=Math.pow(256,2),l=Math.pow(256,3),d=new Uint8Array(e.length);r<i;){if(t=String.fromCharCode(e[r+4],e[r+5],e[r+6],e[r+7]),n=e[r]*l+e[r+1]*a+256*e[r+2]+1*e[r+3],"emsg"!==t)for(s=r;s<r+n;s++)d[o]=e[s],o+=1;r+=n}return d.subarray(0,o)},Me=function(){var e=this;return!!h||(Re.call(e),!1)},Re=function(){ee&&(ee.resolve(),ee=null)},Ae=function(){var e,t,n=this,i=y.defer(),r=0;return C?(t=function(){var n,o,s=this,a=s.videoModel.getCurrentTime(),l=0;o=s.fragmentController.getExecutedRequestForTime(F,a),n=o&&!isNaN(o.startTime)?o.startTime:Math.floor(a),e=o&&!isNaN(o.duration)?o.duration:1,Pe.call(s,l,n).then(function(n){r+=n,r>=e?i.resolve():setTimeout(t,1e3*e)})},t.call(n),i.promise):y.when(!0)},Pe=function(e,t){var r,o,s=this,a=y.defer();return 0===H.buffered.length?(a.resolve(0),a.promise):(r=void 0!==e&&e!==-1?e:H.buffered.start(0),o=void 0!==t&&t!==-1?t:H.buffered.end(H.buffered.length-1),o<=r?(a.resolve(0),a.promise):(s.debug.info("[BufferController]["+i+"] Remove from "+r+" to "+o+" ("+s.getVideoModel().getCurrentTime()+")"),"text"!==i&&s.sourceBufferExt.abort(n,H),s.sourceBufferExt.remove(H,r,o,w.duration,n).then(function(){s.fragmentController.removeExecutedRequestsBeforeTime(F,o+1),s.fragmentController.cancelPendingRequestsForModel(F),a.resolve(o-r)},function(e){s.errHandler.sendWarning(T.dependencies.ErrorHandler.prototype.MEDIA_ERR_REMOVE_SOURCEBUFFER,"Failed to remove data from "+i+" source buffer",new T.vo.Error(e.code,e.name,e.message)),a.resolve(0)}),a.promise))},we=function(e){if(Me.call(this)){if(Re.call(this),e.aborted)return void ze.call(this);if("text"===i)return void this.errHandler.sendWarning(T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_CONTENT,"Failed to download media segment",{url:e.url,status:e.status});ne+=1,ne===te?this.errHandler.sendError(T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_CONTENT,"Failed to download media segment",{url:e.url,status:e.status}):(this.errHandler.sendWarning(T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_CONTENT,"Failed to download media segment",{url:e.url,status:e.status}),ie=e,$===Q&&Xe.call(this))}},Be=function(){var e=this;e.debug.log("[BufferController]["+i+"] Stream is complete."),R=!0,ce(new Date,T.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON),Re.call(e),ye.call(e),e.system.notify("bufferingCompleted")},Fe=function(t){var n=this;return Me.call(n)?g[t]?(n.debug.info("[BufferController]["+i+"] Buffer initialization segment, quality = ",t),Te.call(this,g[t],t).then(function(){n.debug.log("[BufferController]["+i+"] Initialization segment buffered"),Me()&&Ne.call(n)}),y.when(null)):this.indexHandler.getInitRequest(e[t]):y.when(null)},Ne=function(){var e,n,r=this,o=ke.call(r);Me.call(r)&&(S?n=o:(e=r.sourceBufferExt.getBufferRange(H,o),n=e?e.end:o),oe===-1||_||S?(r.debug.log("[BufferController]["+i+"] loadNextFragment for time: "+n),r.indexHandler.getSegmentRequestForTime(t,n).then(Ce.bind(r),function(){I=-1,Be.call(r)})):(r.debug.log("[BufferController]["+i+"] loadNextFragment for sequence number: "+oe),r.indexHandler.getNextSegmentRequestFromSN(t,oe).then(Ce.bind(r))))},Ce=function(e){var n=this,r=n.manifestModel.getValue();return null!==e&&e.action===e.ACTION_COMPLETE?void Be.call(n):void(null!==e?(K&&(e=n.indexHandler.getIFrameRequest(e)),n.fragmentController.isFragmentLoadedOrPending(n,e)?(n.debug.log("[BufferController]["+i+"] new fragment request => already loaded or pending "+e.url),n.indexHandler.getNextSegmentRequest(t).then(Ce.bind(n))):(n.fragmentController.prepareFragmentForLoading(n,e,Ee,be,we,null),ue.call(n))):(n.debug.log("[BufferController]["+i+"] loadNextFragment failed"),Re.call(n),M?"M3U"===r.name&&qe.call(n):Be.call(n)))},Oe=function(){return!!k&&!!H},Ue=function(){var e=this.videoModel.getCurrentTime();return w.start+w.duration-e},ke=function(){var e=-1,t=this.videoModel.getCurrentTime();return e=_?E:t},He=function(){var e,n=this,r=y.defer(),o=t.segmentAvailabilityRange.end;return n.debug.log("[BufferController]["+i+"] Manifest live edge = "+o),e=Math.max(o-s,t.segmentAvailabilityRange.start),this.indexHandler.getSegmentRequestForTime(t,e).then(function(e){w.liveEdge=e.startTime,n.debug.log("[BufferController]["+i+"] Live edge = "+w.liveEdge),r.resolve(w.liveEdge)}),r.promise},Ke=function(e){if(Oe()){var t=this,n=ke.call(t);N=t.sourceBufferExt.getBufferLength(H,n),t.debug.log("[BufferController]["+i+"] Working time = "+n+", Buffer level = "+N.toFixed(3)),e&&t.metricsModel.addBufferLevel(i,new Date,N),t.updateBufferState()}},Ve=function(){var e,t,n=this;Me.call(n)&&(n.debug.log("[BufferController]["+i+"] Check buffer..."),Ke.call(n,!0),L&&N>o&&he.call(n,!1),e=Ue.call(n),n.debug.log("[BufferController]["+i+"] time to end = "+e),K?N<1&&ze.call(n):v||S||N<r&&(r<e||r>=e&&!R)?ze.call(n):(t=N-r+.5,qe.call(n,t)))},qe=function(e){var t=this;e=e?e:1,this.debug.log("[BufferController]["+i+"] Check buffer in = "+e.toFixed(3)+" ms (bufferLevel = "+N+")"),clearTimeout(a),a=setTimeout(function(){a=null,Ve.call(t)},1e3*e)},ze=function(){var e,n=this,r=new Date,o=n.videoModel.getCurrentTime(),s=n.manifestModel.getValue(),a=!1,l=null;null!==ee&&n.debug.error("[BufferController]["+i+"] deferredFragmentBuffered has not been resolved, create a new one is not correct."),ee=y.defer(),n.debug.log("[BufferController]["+i+"] Start buffering process..."),We.call(n),a=0===g.length&&"M3U"!==s.name,e=n.abrController.getPlaybackQuality(i,k).quality,t=_e.call(n,e),e!==I&&(n.debug.log("[BufferController]["+i+"] currentDownloadQuality changed : "+e),I=e,a=!0,ce(new Date,T.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON),n.debug.log("[BufferController]["+i+"] Send RepresentationSwitch with quality = "+e),n.metricsModel.addRepresentationSwitch(i,r,o,t.id,e),l=Ye.call(n)),y.when(!l||l).then(function(){a===!0?Fe.call(n,e).then(function(e){null!==e&&(n.fragmentController.prepareFragmentForLoading(n,e,Ee,be,we,null),ue.call(n))},function(e){Re.call(n),e.name===T.dependencies.ErrorHandler.prototype.MEDIA_ERR_CODEC_UNSUPPORTED?n.errHandler.sendError(e.name,e.message,e.data):n.errHandler.sendError(T.dependencies.ErrorHandler.prototype.INTERNAL_ERROR,"Internal error while processing initialization segment",e.message)}):Ne.call(n)},function(e){Re(),e&&n.errHandler.sendError(e.name,e.message,e.data)})},Ye=function(){var n,r,o,s=this.manifestModel.getValue(),a=this;return"M3U"!==s.name?y.when(!0):M||"SegmentList"!==t.segmentInfoType?(se&&(clearTimeout(se),se=null),n=y.defer(),o=this.manifestExt.getDataIndex(k,s,w.index),r=s.Period_asArray[w.index].AdaptationSet_asArray[o].Representation_asArray[I],this.debug.log("[BufferController]["+i+"] Update playlist for representation "+r.id),a.parser.hlsParser.updatePlaylist(r,k).then(function(){e=je.call(a,k,w),t=_e.call(a,I),r=s.Period_asArray[w.index].AdaptationSet_asArray[o].Representation_asArray[I];var i=r.SegmentList.SegmentURL_asArray,l=i[i.length-1];se=setTimeout(function(){Ye.call(a)},1e3*(l.duration-1)),n.resolve()},function(e){e&&a.errHandler.sendWarning(e.name,e.message,e.data),n.reject(e)}),n.promise):y.when(!0)},je=function(e,t){var n,i,r=this.manifestModel.getValue();return n=this.manifestExt.getDataIndex(e,r,t.index),i=this.manifestExt.getAdaptationsForPeriod(r,t),this.manifestExt.getRepresentationsForAdaptation(r,i[n])},We=function(){return b!==!1&&(this.debug.log("[BufferController]["+i+"] Data changed"),e=je.call(this,k,w),t=_e.call(this,this.abrController.getPlaybackQuality(i,k).quality),this.bufferExt.updateData(k,i),v&&(g=[],this.fragmentController.clearExecutedRequests(F),S=!0,"text"===i&&(H.UpdateLang(k.id,k.lang),"application/ttml+xml"===k.mimeType&&Pe.call(this))),b=!1,void(v=!1))},Ge=function(e){var t,n,r=this,o=this.abrController.getQualityFor(i);if(!this.abrController.isMinQuality(i,k,o)){n=r.abrRulesCollection.getRules(T.rules.BaseRulesCollection.prototype.ABANDON_FRAGMENT_RULES);var s=function(e){e.quality<o&&(r.fragmentController.abortRequestsForModel(F),r.debug.info("[BufferController]["+i+"] Abandon current segment download"))};for(t=0;t<n.length;t++)n[t].execute(e.data.request,s)}},Xe=function(){null!==ie&&(this.debug.log("[BufferController]["+i+"] Signal segment loading failed"),this.system.notify("segmentLoadingFailed",ie),ie=null)};return{videoModel:void 0,metricsModel:void 0,manifestExt:void 0,manifestModel:void 0,bufferExt:void 0,sourceBufferExt:void 0,abrController:void 0,parser:void 0,fragmentExt:void 0,indexHandler:void 0,debug:void 0,system:void 0,errHandler:void 0,config:void 0,abrRulesCollection:void 0,initialize:function(e,t,n,i,a,l,d){var u=this.manifestModel.getValue();this.debug.log("[BufferController]["+e+"] Initialize"),this[T.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS]=Ge,M=this.manifestExt.getIsDynamic(u),this.setMediaSource(l),this.setType(e),this.setBuffer(i),this.setFragmentController(a),this.setEventController(d),r=this.config.getParamFor(e,"BufferController.minBufferTime","number",-1),o=this.config.getParamFor(e,"BufferController.minBufferTimeForPlaying","number",0),s=this.config.getParamFor(e,"BufferController.liveDelay","number",-1),this.updateData(n,t),this.load(),c=!0},load:function(){var e=this,n=e.manifestModel.getValue();We.call(this),t=_e.call(e,e.abrController.getPlaybackQuality(i,k).quality),I=-1,Pe.call(this).then(function(){t&&(e.indexHandler.setIsDynamic(M),r===-1&&(r=e.bufferExt.decideBufferLength(n.minBufferTime,w.duration,p)),(s===-1||s<r)&&(s=r),n.minBufferTime=r,"video"===i&&(M?e.indexHandler.updateSegmentList(t).then(function(){He.call(e).then(function(t){e.system.notify("startTimeFound",t)})}):e.indexHandler.getCurrentTime(t).then(function(n){n<t.segmentAvailabilityRange.start&&(n=t.segmentAvailabilityRange.start),e.system.notify("startTimeFound",n)})))})},getIndexHandler:function(){return this.indexHandler},getType:function(){return i},setType:function(e){i=e,void 0!==this.indexHandler&&this.indexHandler.setType(e)},getPeriodInfo:function(){return w},getVideoModel:function(){return this.videoModel},setVideoModel:function(e){this.videoModel=e},getFragmentController:function(){return this.fragmentController},setFragmentController:function(e){e&&(this.fragmentController=e,F=this.fragmentController.attachBufferController(this),F.fragmentLoader.subscribe(T.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,this),F.setType(i))},setEventController:function(e){this.eventController=e},getData:function(){return k},updateData:function(e,t){this.debug.log("[BufferController]["+i+"] Update data"),v=null!==k&&(k.id!==e.id||k.lang!==e.lang||k.subType!==e.subType),k=e,w=t,b=!0,v&&(this.debug.log("[BufferController]["+i+"] Track changed"),clearTimeout(a),a=null,R=!1,fe.call(this),null===ee&&Ve.call(this))},getHtmlVideoState:function(){return $},getAvailableRepresentations:function(){return e},getCurrentRepresentation:function(){return t},getBuffer:function(){return H},setBuffer:function(e){H=e},getMinBufferTime:function(){return r},setMinBufferTime:function(e){r=e},getLiveDelay:function(){return s},setMediaSource:function(e){n=e},isReady:function(){return u===d},isBufferingCompleted:function(){return R},clearMetrics:function(){null!==i&&""!==i&&this.metricsModel.clearCurrentMetricsForType(i)},updateManifest:function(){this.system.notify("manifestUpdate")},updateBufferState:function(){var e,t=this,n=this.videoModel.getCurrentTime(),r=Z===-1?n:Z,o=n-r;if(clearTimeout(l),l=null,h!==!1&&"text"!==i&&!K){switch($){case X:$=Q,this.debug.info("[BufferController]["+i+"] BUFFERING - "+n+" - "+N),this.metricsModel.addState(i,"buffering",n);break;case Q:!this.getVideoModel().isPaused()&&o>0&&N>=1?($=J,this.debug.info("[BufferController]["+i+"] PLAYING - "+n),this.metricsModel.addState(i,"playing",n),_=!1,E=-1,ne=0):this.getVideoModel().isStalled()||(e=this.sourceBufferExt.getAllRanges(H));break;case J:if(!this.getVideoModel().isPaused()&&!this.getVideoModel().isSeeking()&&(o<=0&&N<=1||0===N))if($=Q,this.debug.info("[BufferController]["+i+"] BUFFERING - "+n+" - "+N),this.metricsModel.addState(i,"buffering",n),ie)Xe.call(this);else if(!M){e=this.sourceBufferExt.getAllRanges(H);var s;for(s=0;s<e.length&&!(n<e.start(s));s++);s<e.length&&this.videoModel.setCurrentTime(e.start(s))}l=setTimeout(function(){l=null,Ke.call(t,!1)},1e3)}n>0&&(Z=n)}},updateStalledState:function(){L=this.videoModel.isStalled()},reset:function(e){var t=this,r=function(e){e&&(e.reject(),e=null)},o=y.defer();return ye.call(this),this.sourceBufferExt.abort(n,H),se&&(clearTimeout(se),se=null),y.when(!ee||ee.promise).then(function(){r(A),r(ee),F&&(F.fragmentLoader.unsubscribe(T.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,t.abrController),t.fragmentController.abortRequestsForModel(F),t.fragmentController.detachBufferController(F),F=null),t.clearMetrics(),g=[],f=!0,C=!1,O=null,U=!1,K&&(t.abrController.setAutoSwitchFor(i,q),t.abrController.setQualityFor(i,V)),e||t.sourceBufferExt.removeSourceBuffer(n,H),k=null,H=null,o.resolve()},function(){o.reject()}),o.promise},getSegmentDuration:function(){return ae},setTrickMode:function(e,t){var n=y.defer();return this.debug.log("[BufferController]["+i+"] setTrickMode - enabled = "+e),K===e?(n.resolve(),n.promise):(K=e,K?(z=t,V=this.abrController.getQualityFor(i),q=this.abrController.getAutoSwitchFor(i),this.abrController.setAutoSwitchFor(i,!1),this.abrController.setQualityFor(i,0),n.resolve()):(this.abrController.setAutoSwitchFor(i,q),this.abrController.setQualityFor(i,V),Pe.call(this).then(function(){n.resolve()})),n.promise)},start:fe,seek:me,stop:ye,seeked:ge,updateBufferLevel:Ke}},T.dependencies.BufferController.prototype={constructor:T.dependencies.BufferController},T.dependencies.BufferExtensions=function(){"use strict";var e,t,n=0,i=0,r=null,o=null,s=function(e){var t=this.metricsExt.getCurrentHttpRequest(e);return null!==t?(t.tresponse.getTime()-t.trequest.getTime())/1e3:0},a=function(){var e,t,s,a=this;return e=r?a.abrController.getQualityFor("audio"):n,t=o?a.abrController.getQualityFor("video"):i,s=e===n&&t===i};return{system:void 0,videoModel:void 0,metricsExt:void 0,metricsModel:void 0,abrController:void 0,bufferMax:void 0,updateData:function(e,t){if(e){var s=e.Representation_asArray.length-1;"audio"===t?(n=s,r=e):"video"===t&&(i=s,o=e)}},getTopQualityIndex:function(e){var t=null;return"audio"===e?t=n:"video"===e&&(t=i),t},decideBufferLength:function(t,n){return e=isNaN(n)||T.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME<n&&t<n?Math.max(T.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME,t):t>=n?Math.min(n,T.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME):Math.min(n,t)},getLeastBufferLevel:function(){var e=this.metricsModel.getReadOnlyMetricsFor("video"),t=this.metricsExt.getCurrentBufferLevel(e),n=this.metricsModel.getReadOnlyMetricsFor("audio"),i=this.metricsExt.getCurrentBufferLevel(n),r=null;return r=null===t||null===i?null!==i?i.level:null!==t?t.level:null:Math.min(i.level,t.level)},getRequiredBufferLength:function(n,i,r,o){var l,d=this,u=d.metricsModel.getReadOnlyMetricsFor("video"),c=d.metricsModel.getReadOnlyMetricsFor("audio"),h=o>=T.dependencies.BufferExtensions.LONG_FORM_CONTENT_DURATION_THRESHOLD,p=y.defer(),f=!1;return d.bufferMax===T.dependencies.BufferExtensions.BUFFER_SIZE_MIN?(l=e,p.resolve(l)):d.bufferMax===T.dependencies.BufferExtensions.BUFFER_SIZE_INFINITY?(l=o,p.resolve(l)):d.bufferMax===T.dependencies.BufferExtensions.BUFFER_SIZE_REQUIRED?(t=e,r||n||(f=a.call(d)),f&&(t=h?T.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM:T.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY),l=t+i+Math.max(s.call(d,u),s.call(d,c)),p.resolve(l)):p.reject("invalid bufferMax value: "+d.bufferMax),p.promise},getBufferTarget:function(){return void 0===t?e:t}}},T.dependencies.BufferExtensions.BUFFER_SIZE_REQUIRED="required",T.dependencies.BufferExtensions.BUFFER_SIZE_MIN="min",T.dependencies.BufferExtensions.BUFFER_SIZE_INFINITY="infinity",T.dependencies.BufferExtensions.BUFFER_TIME_AT_STARTUP=1,T.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME=16,T.dependencies.BufferExtensions.DEFAULT_LIVE_DELAY=16,T.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY=30,T.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM=300,T.dependencies.BufferExtensions.LONG_FORM_CONTENT_DURATION_THRESHOLD=600,T.dependencies.BufferExtensions.prototype.constructor=T.dependencies.BufferExtensions,T.utils.Capabilities=function(){"use strict"},T.utils.Capabilities.prototype={constructor:T.utils.Capabilities,system:void 0,supportsMediaSource:function(){"use strict";var e="WebKitMediaSource"in window,t="MediaSource"in window;return e||t},supportsMediaKeys:function(){"use strict";var e="WebKitMediaKeys"in window,t="MSMediaKeys"in window,n="MediaKeys"in window;return e||t||n},supportsEncryptedMedia:function(){return this.system.hasMapping("protectionModel")},supportsCodec:function(e,t){"use strict";if(!(e instanceof HTMLMediaElement))throw"element must be of type HTMLMediaElement.";var n=e.canPlayType(t);return"probably"===n||"maybe"===n}},T.utils.Config=function(){"use strict";var e=["video","audio"],t={"BufferController.minBufferTimeForPlaying":-1,"BufferController.minBufferTime":-1,"BufferController.liveDelay":-1,"ABR.minBandwidth":-1,"ABR.maxBandwidth":-1,"ABR.minQuality":-1,"ABR.maxQuality":-1,"ABR.switchUpIncrementally":!1,"ABR.switchUpRatioSafetyFactor":-1,"ABR.latencyInBandwidth":!0,"ABR.switchDownBufferTime":-1,"ABR.switchDownBufferRatio":-1,"ABR.switchLowerBufferTime":-1,"ABR.switchLowerBufferRatio":-1,"ABR.switchUpBufferTime":-1,"ABR.switchUpBufferRatio":-1,"ABR.keepBandwidthCondition":!0,"ABR.droppedFramesMinRatio":-1,"ABR.droppedFramesMaxRatio":-1,"ManifestLoader.RetryAttempts":-1,"ManifestLoader.RetryInterval":-1,"FragmentLoader.RetryAttempts":-1,"FragmentLoader.RetryInterval":-1,"Protection.licensePersistence":-1,video:{},audio:{}},n=function(n){var i,r,o;for(i in n)if(n.hasOwnProperty(i)&&i.indexOf("//")===-1)if(e.indexOf(i)>-1){r=n[i];for(o in r)r.hasOwnProperty(o)&&(t[i][o]=n[i][o])}else t[i]=n[i]},i=function(e,t,n,i){var r=e[t];if(void 0===r||r===-1)return i;if(void 0!==n&&typeof r!==n)switch(n){case"number":r=Number(r);break;case"boolean":r="true"===r||"1"===r||1===r}return r},r=function(e,n,r){return i(t,e,n,r)},o=function(e,n,r,o){var s=t[e];return void 0!==s&&void 0!==s[n]?i(s,n,r,o):i(t,n,r,o)};return{debug:void 0,setup:function(){},setParams:function(e){n(e);var t=this.getParam("Debug.level","number",-1);t!==-1&&this.debug.setLevel(t)},getParam:function(e,t,n){return r(e,t,n)},getParamFor:function(e,t,n,i){return o(e,t,n,i)}}},T.utils.Config.prototype={constructor:T.utils.Config},T.di.Context=function(){"use strict";var e=function(){var e=document.createElement("video"),t=this.system.getObject("debug");T.models.ProtectionModel_21Jan2015.detect(e)?this.system.mapSingleton("protectionModel",T.models.ProtectionModel_21Jan2015):T.models.ProtectionModel_3Feb2014.detect(e)?this.system.mapClass("protectionModel",T.models.ProtectionModel_3Feb2014):T.models.ProtectionModel_FPS.detect(e)?this.system.mapClass("protectionModel",T.models.ProtectionModel_FPS):T.models.ProtectionModel_01b.detect(e)?this.system.mapClass("protectionModel",T.models.ProtectionModel_01b):(t.log("No supported version of EME detected on this user agent!"),t.log("Attempts to play encrypted content will fail!"))};return{system:void 0,setup:function(){this.system.autoMapOutlets=!0,this.system.mapSingleton("capabilities",T.utils.Capabilities),this.system.mapSingleton("config",T.utils.Config),this.system.mapSingleton("debug",T.utils.Debug),this.system.mapSingleton("debugController",T.utils.DebugController),this.system.mapClass("domParser",T.utils.DOMParser),this.system.mapSingleton("eventBus",T.utils.EventBus),this.system.mapSingleton("textTrackExtensions",T.utils.TextTrackExtensions),this.system.mapSingleton("tokenAuthentication",T.utils.TokenAuthentication),this.system.mapSingleton("vttParser",T.utils.VTTParser),this.system.mapSingleton("ttmlParser",T.utils.TTMLParser),this.system.mapSingleton("ttmlRenderer",T.utils.TTMLRenderer),this.system.mapSingleton("manifestModel",T.models.ManifestModel),this.system.mapClass("metrics",T.models.MetricsList),this.system.mapSingleton("metricsModel",T.models.MetricsModel),this.system.mapSingleton("uriQueryFragModel",T.models.URIQueryAndFragmentModel),this.system.mapSingleton("videoModel",T.models.VideoModel),this.system.mapSingleton("abrController",T.dependencies.AbrController),this.system.mapClass("bufferController",T.dependencies.BufferController),this.system.mapSingleton("bufferExt",T.dependencies.BufferExtensions),this.system.mapSingleton("errHandler",T.dependencies.ErrorHandler),this.system.mapClass("eventController",T.dependencies.EventController),this.system.mapClass("fragmentController",T.dependencies.FragmentController),this.system.mapClass("fragmentInfoController",T.dependencies.FragmentInfoController),this.system.mapClass("fragmentLoader",T.dependencies.FragmentLoader),this.system.mapClass("fragmentModel",T.dependencies.FragmentModel),this.system.mapClass("manifestLoader",T.dependencies.ManifestLoader),this.system.mapSingleton("manifestUpdater",T.dependencies.ManifestUpdater),this.system.mapSingleton("mediaSourceExt",T.dependencies.MediaSourceExtensions),this.system.mapSingleton("notifier",T.dependencies.Notifier),this.system.mapSingleton("sourceBufferExt",T.dependencies.SourceBufferExtensions),this.system.mapClass("stream",T.dependencies.Stream),this.system.mapSingleton("streamController",T.dependencies.StreamController),this.system.mapClass("textController",T.dependencies.TextController),this.system.mapSingleton("textSourceBuffer",T.dependencies.TextSourceBuffer),this.system.mapSingleton("textTTMLXMLMP4SourceBuffer",T.dependencies.TextTTMLXMLMP4SourceBuffer),this.system.mapSingleton("videoExt",T.dependencies.VideoModelExtensions),this.system.mapClass("protectionController",T.dependencies.ProtectionController),this.system.mapSingleton("protectionExt",T.dependencies.ProtectionExtensions),this.system.mapSingleton("ksClearKey",T.dependencies.protection.KeySystem_ClearKey),this.system.mapSingleton("ksPlayReady",T.dependencies.protection.KeySystem_PlayReady),this.system.mapSingleton("ksWidevine",T.dependencies.protection.KeySystem_Widevine),this.system.mapSingleton("ksFairPlay",T.dependencies.protection.KeySystem_FairPlay),this.system.mapSingleton("serverClearKey",T.dependencies.protection.servers.ClearKey),this.system.mapSingleton("serverDRMToday",T.dependencies.protection.servers.DRMToday),this.system.mapSingleton("serverPlayReady",T.dependencies.protection.servers.PlayReady),this.system.mapSingleton("serverWidevine",T.dependencies.protection.servers.Widevine),e.call(this),this.system.mapClass("abrRulesCollection",T.rules.BaseRulesCollection),this.system.mapClass("abandonRequestRule",T.rules.AbandonRequestsRule),this.system.mapClass("downloadRatioRule",T.rules.DownloadRatioRule),this.system.mapClass("droppedFramesRule",T.rules.DroppedFramesRule),this.system.mapClass("insufficientBufferRule",T.rules.InsufficientBufferRule),this.system.mapClass("limitSwitchesRule",T.rules.LimitSwitchesRule),this.system.mapClass("baseURLExt",x.dependencies.BaseURLExtensions),this.system.mapClass("fragmentExt",x.dependencies.FragmentExtensions),this.system.mapClass("indexHandler",x.dependencies.DashHandler),this.system.mapSingleton("manifestExt",x.dependencies.DashManifestExtensions),
this.system.mapSingleton("metricsExt",T.dependencies.MetricsExtensions),this.system.mapSingleton("timelineConverter",x.dependencies.TimelineConverter),this.system.mapSingleton("parser",T.dependencies.Parser),this.system.mapClass("dashParser",x.dependencies.DashParser),this.system.mapClass("mssParser",b.dependencies.MssParser),this.system.mapClass("hlsParser",v.dependencies.HlsParser),this.system.mapSingleton("hlsDemux",v.dependencies.HlsDemux),this.system.mapSingleton("contextManager",T.modules.ContextManager),this.system.mapHandler("setContext","contextManager","setContext")}}},T.modules.ContextManager=function(){"use strict";return{system:void 0,debug:void 0,setContext:function(e){this.system.autoMapOutlets=!0,"MSS"===e?(this.system.mapClass("mp4Processor",T.dependencies.Mp4Processor),this.system.mapClass("indexHandler",b.dependencies.MssHandler),this.system.mapClass("fragmentController",b.dependencies.MssFragmentController)):"HLS"===e?(this.system.mapClass("mp4Processor",T.dependencies.Mp4Processor),this.system.mapClass("fragmentController",v.dependencies.HlsFragmentController),this.system.mapClass("indexHandler",v.dependencies.HlsHandler)):(this.system.mapClass("fragmentController",T.dependencies.FragmentController),this.system.mapClass("indexHandler",x.dependencies.DashHandler))}}},T.modules.ContextManager.prototype={constructor:T.modules.ContextManager},T.utils.Debug=function(){"use strict";Date.prototype.HHMMSSmmm=function(){var e=this.getHours().toString(),t=this.getMinutes().toString(),n=this.getSeconds().toString(),i=this.getMilliseconds().toString(),r=e[1]?e:"0"+e[0],o=t[1]?t:"0"+t[0],s=n[1]?n:"0"+n[0],a=i[2]?i:"0"+(i[1]?i:"0"+i[0]);return r+":"+o+":"+s+"."+a},Date.prototype.MMSSmmm=function(){var e=this.getMinutes().toString(),t=this.getSeconds().toString(),n=this.getMilliseconds().toString(),i=e[1]?e:"0"+e[0],r=t[1]?t:"0"+t[0],o=n[2]?n:"0"+(n[1]?n:"0"+n[0]);return i+":"+r+"."+o};var e=function(){this.logArray=[],this.showLevel=!0};e.prototype.error=e.prototype.warn=e.prototype.info=e.prototype.debug=function(e){this.logArray.push(e)},e.prototype.getLogs=function(){return this.logArray};var t=0,n=1,i=2,r=3,o=4,s=4,a=0,l=!0,d=!1,u=new Date,c=console,h=function(e,t){if(e<=m()){var s=p(e,t);switch(e){case n:c.error(s);break;case i:c.warn(s);break;case r:c.info(s);break;case o:c.debug(s)}}},p=function(e,t){var n="",i=null;return l&&(i=new Date,n+="["+i.HHMMSSmmm()+"]"),c&&c.showLevel&&(n+="["+f(e)+"]"),d&&(n+="["+new Date(i-u).MMSSmmm()+"]"),Array.apply(null,t).forEach(function(e){n+=e+" "}),n},f=function(e){switch(e){case n:return"ERROR";case i:return"WARN";case r:return"INFO";case o:return"DEBUG";default:return""}},m=function(){return a},g=function(){return c};return{NONE:t,ERROR:n,WARN:i,INFO:r,DEBUG:o,ALL:s,getLevel:m,getLogger:g,setLevel:function(e){a=e},setLogger:function(t){switch(t){case"log4javascript":var n=new log4javascript.PopUpAppender,i=new log4javascript.PatternLayout("%d{HH:mm:ss.SSS} %-5p - %m%n");n.setLayout(i),c.addAppender(n),c.setLevel(log4javascript.Level.ALL),c.initialized=!0;break;case"memory":c=new e;break;case"console":c=console;break;default:c=null}},error:function(){h.call(this,n,arguments)},warn:function(){h.call(this,i,arguments)},info:function(){h.call(this,r,arguments)},log:function(){h.call(this,o,arguments)}}},T.utils.DebugController=function(){"use strict";var e={isInDebug:!1,level:0,loggerType:"console"},t=function(t){t.altKey!==!0||t.ctrlKey!==!0||t.shiftKey!==!0||68!==t.keyCode&&90!==t.keyCode||(e.isInDebug?(e.isInDebug=!1,console.log("debug mode desactivated"),90===t.keyCode&&n(this.debug.getLogger().getLogs()),this.debug.setLevel(e.level),this.debug.setLogger(e.loggerType)):(e.isInDebug=!0,console.log("debug mode activated"),e.level=this.debug.getLevel(),this.debug.setLevel(68===t.keyCode?4:3),this.debug.setLogger(68===t.keyCode?"console":"memory")))},n=function(e){if(e&&e.length>0){var t="hasplayer_logs.txt",n=JSON.stringify(e,null,"\r\n"),i=new Blob([n],{type:"text/json"});if(navigator.msSaveBlob)navigator.msSaveBlob(i,t);else{var r=document.createEvent("MouseEvents"),o=document.createElement("a");o.download=t,o.href=window.URL.createObjectURL(i),o.dataset.downloadurl=["text/json",o.download,o.href].join(":"),r.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(r)}}};return{debug:void 0,setup:function(){window.addEventListener("keydown",t.bind(this))}}},T.utils.DebugController.prototype={constructor:T.utils.DebugController},T.dependencies.ErrorHandler=function(){"use strict";return{eventBus:void 0,debug:void 0,sendWarning:function(e,t,n){this.eventBus.dispatchEvent({type:"warning",data:{code:e,message:t,data:n}}),this.debug.warn("[Warn] Code: "+e+", Message: "+t+", Data: "+JSON.stringify(n,null,"\t"))},sendError:function(e,t,n){this.eventBus.dispatchEvent({type:"error",data:{code:e,message:t,data:n}}),this.debug.error("[Error] Code: "+e+", Message: "+t+", Data: "+JSON.stringify(n,null,"\t"))}}},T.dependencies.ErrorHandler.prototype={constructor:T.dependencies.ErrorHandler},T.dependencies.ErrorHandler.prototype.INTERNAL_ERROR="INTERNAL_ERROR",T.dependencies.ErrorHandler.prototype.MEDIA_ERR_ABORTED="MEDIA_ERR_ABORTED",T.dependencies.ErrorHandler.prototype.MEDIA_ERR_NETWORK="MEDIA_ERR_NETWORK",T.dependencies.ErrorHandler.prototype.MEDIA_ERR_DECODE="MEDIA_ERR_DECODE",T.dependencies.ErrorHandler.prototype.MEDIA_ERR_SRC_NOT_SUPPORTED="MEDIA_ERR_SRC_NOT_SUPPORTED",T.dependencies.ErrorHandler.prototype.MEDIA_ERR_ENCRYPTED="MEDIA_ERR_ENCRYPTED",T.dependencies.ErrorHandler.prototype.CAPABILITY_ERR_MEDIASOURCE="CAPABILITY_ERR_MEDIASOURCE",T.dependencies.ErrorHandler.prototype.CAPABILITY_ERR_MEDIAKEYS="CAPABILITY_ERR_MEDIAKEYS",T.dependencies.ErrorHandler.prototype.MEDIA_ERR_CREATE_MEDIASOURCE="MEDIA_ERR_CREATE_MEDIASOURCE",T.dependencies.ErrorHandler.prototype.MEDIA_ERR_CODEC_UNSUPPORTED="MEDIA_ERR_CODEC_UNSUPPORTED",T.dependencies.ErrorHandler.prototype.MEDIA_ERR_CREATE_SOURCEBUFFER="MEDIA_ERR_CREATE_SOURCEBUFFER",T.dependencies.ErrorHandler.prototype.MEDIA_ERR_APPEND_SOURCEBUFFER="MEDIA_ERR_APPEND_SOURCEBUFFER",T.dependencies.ErrorHandler.prototype.MEDIA_ERR_REMOVE_SOURCEBUFFER="MEDIA_ERR_REMOVE_SOURCEBUFFER",T.dependencies.ErrorHandler.prototype.MANIFEST_ERR_PARSE="MANIFEST_ERR_PARSE",T.dependencies.ErrorHandler.prototype.MANIFEST_ERR_NO_STREAM="MANIFEST_ERR_NO_STREAM",T.dependencies.ErrorHandler.prototype.MANIFEST_ERR_NO_VIDEO="MANIFEST_ERR_NO_VIDEO",T.dependencies.ErrorHandler.prototype.MANIFEST_ERR_NO_AUDIO="MANIFEST_ERR_NO_AUDIO",T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_MANIFEST="DOWNLOAD_ERR_MANIFEST",T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_SIDX="DOWNLOAD_ERR_SIDX",T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_INIT="DOWNLOAD_ERR_INIT",T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_CONTENT="DOWNLOAD_ERR_CONTENT",T.dependencies.ErrorHandler.prototype.CC_ERR_PARSE="CC_ERR_PARSE",T.dependencies.ErrorHandler.prototype.HLS_DEMUX_ERROR="HLS_DEMUX_ERROR",T.dependencies.ErrorHandler.prototype.FPS_CERTIFICAT_ERROR="FPS_CERTIFICAT_ERROR",T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR="MEDIA_KEYERR",T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_UNKNOWN="MEDIA_KEYERR_UNKNOWN",T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_CLIENT="MEDIA_KEYERR_CLIENT",T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_SERVICE="MEDIA_KEYERR_SERVICE",T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_OUTPUT="MEDIA_KEYERR_OUTPUT",T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_HARDWARECHANGE="MEDIA_KEYERR_HARDWARECHANGE",T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_DOMAIN="MEDIA_KEYERR_DOMAIN",T.dependencies.ErrorHandler.prototype.MEDIA_KEYSYSERR_ACCESS_DENIED="MEDIA_KEYSYSERR_ACCESS_DENIED",T.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_URL_LICENSER_UNKNOWN="MEDIA_KEYMESSERR_URL_LICENSER_UNKNOWN",T.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NO_CHALLENGE="MEDIA_KEYMESSERR_NO_CHALLENGE",T.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_LICENSER_ERROR="MEDIA_KEYMESSERR_LICENSER_ERROR",T.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NO_SESSION="MEDIA_KEYMESSERR_NO_SESSION",T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_SERVER_CERTIFICATE="MEDIA_KEYERR_SERVER_CERTIFICATE",T.dependencies.ErrorHandler.prototype.DOM_ERR_INDEX_SIZE=1,T.dependencies.ErrorHandler.prototype.DOM_ERR_HIERARCHY_REQUEST=3,T.dependencies.ErrorHandler.prototype.DOM_ERR_WRONG_DOCUMENT=4,T.dependencies.ErrorHandler.prototype.DOM_ERR_INVALID_CHARACTER=5,T.dependencies.ErrorHandler.prototype.DOM_ERR_NO_MODIFICATION_ALLOWED=7,T.dependencies.ErrorHandler.prototype.DOM_ERR_NOT_FOUND=8,T.dependencies.ErrorHandler.prototype.DOM_ERR_NOT_SUPPORTED=9,T.dependencies.ErrorHandler.prototype.DOM_ERR_INVALID_STATE=11,T.dependencies.ErrorHandler.prototype.DOM_ERR_SYNTAX=12,T.dependencies.ErrorHandler.prototype.DOM_ERR_INVALID_MODIFICATION=13,T.dependencies.ErrorHandler.prototype.DOM_ERR_NAMESPACE=14,T.dependencies.ErrorHandler.prototype.DOM_ERR_INVALID_ACCESS=15,T.dependencies.ErrorHandler.prototype.DOM_ERR_SECURITY=18,T.dependencies.ErrorHandler.prototype.DOM_ERR_NETWORK=19,T.dependencies.ErrorHandler.prototype.DOM_ERR_ABORT=20,T.dependencies.ErrorHandler.prototype.DOM_ERR_URL_MISMATCH=21,T.dependencies.ErrorHandler.prototype.DOM_ERR_QUOTA_EXCEEDED=22,T.dependencies.ErrorHandler.prototype.DOM_ERR_TIMEOUT=23,T.dependencies.ErrorHandler.prototype.DOM_ERR_INVALID_NODE_TYPE=24,T.dependencies.ErrorHandler.prototype.DOM_ERR_DATA_CLONE=25,T.utils.EventBus=function(){"use strict";var e,t=function(t,n){var i=(n?"1":"0")+t;return i in e||(e[i]=[]),e[i]},n=function(){e={}};return n(),{addEventListener:function(e,n,i){var r=t(e,i),o=r.indexOf(n);o===-1&&r.push(n)},removeEventListener:function(e,n,i){var r=t(e,i),o=r.indexOf(n);o!==-1&&r.splice(o,1)},dispatchEvent:function(e){var n=t(e.type,!1).slice(),i=0;for(i=0;i<n.length;i+=1)n[i].call(this,e);return!e.defaultPrevented}}},T.dependencies.EventController=function(){"use strict";var e=[],t=[],n=[],i=null,r=100,o=r/1e3,s="urn:mpeg:dash:event:2012",a=1,l=function(){null!==i&&(clearInterval(i),i=null),e=null,t=null,n=null},d=function(){null!==i&&(clearInterval(i),i=null)},u=function(){var e=this;e.debug.log("[EventController] Start Event Controller"),isNaN(r)||(i=setInterval(p.bind(this),r))},c=function(t){var n=this;e=[],t&&t.length>0&&(e=t),n.debug.log("[EventController] Added "+t.length+" inline events")},h=function(e){var n,i=this,r=0;for(r=0;r<e.length;r++)n=e[r],t[n.id]=n,i.debug.log("[EventController] Add inband event with id "+n.id)},p=function(){f.call(this,t),f.call(this,e),m.call(this)},f=function(e){var t,i,r=this,l=this.videoModel.getCurrentTime(),d=0;if(e)for(d=0;d<e.length;d++)i=e[d],void 0!==i&&(t=i.presentationTime/i.eventStream.timescale,(0===t||t<=l&&t+o>l)&&(r.debug.log("[EventController] Start Event at "+l),i.duration>0&&n.push(i),i.eventStream.schemeIdUri===s&&i.eventStream.value===a&&g.call(this),e.splice(d,1)))},m=function(){var e,t,i=this,r=0;if(n)for(e=this.videoModel.getCurrentTime(),r=0;r<n.length;r++)t=n[r],null!==t&&(t.duration+t.presentationTime)/t.eventStream.timescale<e&&(i.debug.log("[EventController] Remove Event at time "+e),t=null,n.splice(r,1))},g=function(){var e=this,t=e.manifestModel.getValue(),n=t.mpdUrl;t.hasOwnProperty("Location")&&(n=t.Location),e.debug.log("[EventController] Refresh manifest @ "+n),e.manifestLoader.load(n).then(function(t){e.manifestModel.setValue(t)})};return{manifestModel:void 0,manifestLoader:void 0,debug:void 0,system:void 0,videoModel:void 0,addInlineEvents:c,addInbandEvents:h,reset:l,clear:d,start:u}},T.dependencies.EventController.prototype={constructor:T.dependencies.EventController},T.dependencies.FragmentController=function(){"use strict";var e=[],t=function(t){var n=e.length,i=0;for(i=0;i<n;i+=1)if(e[i].getContext()===t)return e[i];return null},n=function(){var t=!0,n=e.length,i=0;for(i=0;i<n;i+=1)if(!e[i].isReady()){t=!1;break}return t},i=function(){var t=0;for(t=0;t<e.length;t+=1)e[t].executeCurrentRequest()};return{system:void 0,debug:void 0,process:function(e){var t=null;return null!==e&&void 0!==e&&e.byteLength>0&&(t=new Uint8Array(e)),y.when(t)},attachBufferController:function(n){var i;return n?(i=t(n),i||(i=this.system.getObject("fragmentModel"),i.setContext(n),e.push(i)),i):null},detachBufferController:function(t){var n=e.indexOf(t);n>-1&&e.splice(n,1)},onBufferControllerStateChange:function(){n()&&i.call(this)},isFragmentLoadedOrPending:function(e,n){var i,r=t(e);return!!r&&(i=r.isFragmentLoadedOrPending(n))},getPendingRequests:function(e){var n=t(e);return n?n.getPendingRequests():null},getLoadingRequests:function(e){var n=t(e);return n?n.getLoadingRequests():null},isInitializationRequest:function(e){return e&&e.type&&"initialization segment"===e.type.toLowerCase()},getLoadingTime:function(e){var n=t(e);return n?n.getLoadingTime():null},getExecutedRequestForTime:function(e,t){return e?e.getExecutedRequestForTime(t):null},removeExecutedRequest:function(e,t){e&&e.removeExecutedRequest(t)},removeExecutedRequestsBeforeTime:function(e,t){e&&e.removeExecutedRequestsBeforeTime(t)},clearExecutedRequests:function(e){e&&e.clearExecutedRequests()},cancelPendingRequestsForModel:function(e){e&&e.cancelPendingRequests()},abortRequestsForModel:function(e){e&&e.abortRequests()},prepareFragmentForLoading:function(e,n,i,r,o,s){var a=t(e);return a&&n?(a.addRequest(n),a.setCallbacks(i,r,o,s),!0):null}}},T.dependencies.FragmentController.prototype={constructor:T.dependencies.FragmentController},T.dependencies.FragmentLoader=function(){"use strict";var e,t=2,n=500,i=t,r=n,o=0,s=[],a=function(e){var t=new XMLHttpRequest,n=!1;t.open("HEAD",e.url,!0),t.onload=function(){t.status<200||t.status>399||(n=!0,e.deferred.resolve(e))},t.onloadend=t.onerror=function(){n||e.deferred.reject(t)},t.send()},l=function(t){var n=y.defer(),i=new XMLHttpRequest,r=null,o=!0,a=!0,l=null,d=this;return s.push(i),t.requestStartDate=new Date,r=d.metricsModel.addHttpRequest(t.streamType,null,t.type,t.url,null,t.range,t.requestStartDate,null,null,null,null,t.duration,t.startTime,t.quality),d.metricsModel.appendHttpTrace(r,t.requestStartDate,t.requestStartDate.getTime()-t.requestStartDate.getTime(),[0]),l=t.requestStartDate,i.open("GET",d.tokenAuthentication.addTokenAsQueryArg(t.url),!0),i.responseType="arraybuffer",i=d.tokenAuthentication.setTokenInRequestHeader(i),t.range&&i.setRequestHeader("Range","bytes="+t.range),i.onprogress=function(e){var n=new Date;o&&(o=!1,(!e.lengthComputable||e.lengthComputable&&e.total!==e.loaded)&&(t.firstByteDate=n,r.tresponse=n)),e.lengthComputable&&(t.bytesLoaded=e.loaded,t.bytesTotal=e.total),d.metricsModel.appendHttpTrace(r,n,n.getTime()-l.getTime(),[t.bytesLoaded?t.bytesLoaded:0]),l=n,d.notify(T.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,{request:t,httpRequestMetrics:r,lastTraceTime:l})},i.onload=function(){if(!(i.status<200||i.status>399)){a=!1;var o,s,u=new Date,c=i.response,h=c?c.byteLength:0;t.firstByteDate||(t.firstByteDate=t.requestStartDate),t.requestEndDate=u,o=t.firstByteDate.getTime()-t.requestStartDate.getTime(),s=t.requestEndDate.getTime()-t.firstByteDate.getTime(),d.debug.log("[FragmentLoader]["+e+"] Loaded: "+t.url+" ("+i.status+", "+o+"ms, "+s+"ms)"),r.tresponse=t.firstByteDate,r.tfinish=t.requestEndDate,r.responsecode=i.status,r.bytesLength=h,d.metricsModel.appendHttpTrace(r,u,u.getTime()-l.getTime(),[h]),l=u,n.resolve({data:c,request:t})}},i.onabort=function(){var e,n,o=new Date;i.aborted=!0,0!==r.trace.length&&(e=r.trace[r.trace.length-1],n=e.b[0],t.requestEndDate=o,r.tresponse=t.firstByteDate,r.tfinish=t.requestEndDate,r.responsecode=i.status,r.bytesLength=n)},i.onloadend=i.onerror=function(){s.indexOf(i)!==-1&&(s.splice(s.indexOf(i),1),a&&(a=!1,r.responsecode=i.status,n.reject(i)))},d.debug.log("[FragmentLoader]["+e+"] Load: "+t.url),i.send(),n.promise},d=function(e,t){var n=this;l.call(n,e).then(function(e){o=0,t.resolve(e)},function(s){s.aborted?(e.status=0,e.aborted=!0,t.reject(e)):o>=i?(o=0,e.status=s.status,t.reject(e)):setTimeout(function(){o++,d.call(n,e,t)},r)})};return{metricsModel:void 0,debug:void 0,tokenAuthentication:void 0,config:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){i=this.config.getParam("FragmentLoader.RetryAttempts","number",t),r=this.config.getParam("FragmentLoader.RetryInterval","number",n)},setType:function(t){e=t},load:function(e){var t=y.defer();return"Initialization Segment"===e.type&&e.data?t.resolve(e,{data:e.data}):d.call(this,e,t),t.promise},abort:function(){var t=0;for(t=0;t<s.length;t+=1)this.debug.log("[FragmentLoader]["+e+"] Abort XHR "+(s[t].responseURL?s[t].responseURL:"")),s[t].abort()},checkForExistence:function(e){return e?(e.deferred=y.defer(),a.call(this,e),e.deferred.promise):y.when(null)}}},T.dependencies.FragmentLoader.prototype={constructor:T.dependencies.FragmentLoader},T.dependencies.FragmentLoader.eventList={ENAME_LOADING_PROGRESS:"loadingProgress"},T.dependencies.FragmentModel=function(){"use strict";var e,t,n,i,r,o,s=[],a=[],l=[],d=2,u=function(r){var o,a,d=this;t.call(e,r),o=function(t,i){l.splice(l.indexOf(t),1),s.push(t),n.call(e,t,i),t.deferred=null},a=function(t){l.splice(l.indexOf(t),1),i.call(e,t),t.deferred=null},d.fragmentLoader.load(r).then(o.bind(e,r),a.bind(e,r))},c=function(e,t){var n=function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:0};e.sort(n)},h=function(e){var t=s.indexOf(e);t!==-1&&s.splice(t,1)};return{system:void 0,debug:void 0,fragmentLoader:void 0,setContext:function(t){e=t},getContext:function(){return e},setType:function(e){o=e,this.fragmentLoader&&this.fragmentLoader.setType(e)},addRequest:function(e){if(e){if(this.isFragmentLoadedOrPending(e))return;a.push(e),c.call(this,a,"index")}},setCallbacks:function(e,o,s,a){t=e,r=a,i=s,n=o},isFragmentLoadedOrPending:function(e){var t,n=!1,i=s.length,r=0;for(r=0;r<i;r++)if(t=s[r],e.startTime===t.startTime||"complete"===t.action&&e.action===t.action){if(e.url===t.url){n=!0;break}h(e)}if(!n)for(r=0,i=a.length;r<i;r+=1)t=a[r],e.url===t.url&&e.startTime===t.startTime&&(n=!0);if(!n)for(r=0,i=l.length;r<i;r+=1)t=l[r],e.url===t.url&&e.startTime===t.startTime&&(n=!0);return n},isReady:function(){return e.isReady()},getPendingRequests:function(){return a},getLoadingRequests:function(){return l},getLoadingTime:function(){var e,t,n=0;for(t=s.length-1;t>=0;t-=1)if(e=s[t],e.requestEndDate instanceof Date&&e.firstByteDate instanceof Date){n=e.requestEndDate.getTime()-e.firstByteDate.getTime();break}return n},getExecutedRequestForTime:function(e){var t,n=s.length-1,i=NaN,r=NaN,o=null;for(t=n;t>=0;t-=1)if(o=s[t],i=o.startTime,r=i+o.duration,!isNaN(i)&&!isNaN(r)&&e>i&&e<r)return o;return null},getExecutedRequestForQualityAndIndex:function(e,t){var n,i=s.length-1,r=null;for(n=i;n>=0;n-=1)if(r=s[n],r.quality===e&&r.index===t)return r;return null},removeExecutedRequest:function(e){h.call(this,e)},removeExecutedRequestsBeforeTime:function(e){var t,n=s.length-1,i=NaN,r=null;for(t=n;t>=0;t-=1)r=s[t],i=r.startTime,!isNaN(i)&&i<e&&h.call(this,r)},clearExecutedRequests:function(){s=[]},cancelPendingRequests:function(){a=[]},abortRequests:function(){this.fragmentLoader.abort(),l=[]},executeCurrentRequest:function(){var t,n=this;if(0!==a.length&&!(l.length>=d))switch(t=a.shift(),t.action){case"complete":s.push(t),r.call(e,t);break;case"download":l.push(t),u.call(n,t);break;default:this.debug.log("Unknown request action."),t.deferred?(t.deferred.reject(),t.deferred=null):i.call(e,t)}}}},T.dependencies.FragmentModel.prototype={constructor:T.dependencies.FragmentModel},T.dependencies.FragmentInfoController=function(){"use strict";var e,t,n,i,r="READY",o=r,s=!1,a=!1,l=null,d=3,u=!1,c=0,h=null,p=null,f=null,m=0,g=NaN,_=function(){this.debug.info("[FragmentInfoController]["+e+"] sendRequest"),D.call(this)&&null!==l&&this.fragmentController.onBufferControllerStateChange()},E=function(){s&&a&&(p=(new Date).getTime(),f=n,this.debug.info("[FragmentInfoController]["+e+"] startPlayback"),R.call(this))},b=function(){var t,r=this;a!==!0&&(a=!0,r.debug.info("[FragmentInfoController]["+e+"] START"),t=i.getCurrentRepresentation().segments,t?(n=t[t.length-1].presentationStartTime-t[t.length-1].duration,E.call(r)):r.indexHandler.updateSegmentList(i.getCurrentRepresentation()).then(function(e){t=e,n=t[t.length-1].presentationStartTime-t[t.length-1].duration,E.call(r)}))},v=function(){a&&(this.debug.info("[FragmentInfoController]["+e+"] STOP"),clearTimeout(t),a=!1,p=null,f=null,clearTimeout(h),h=null,this.fragmentController.abortRequestsForModel(l))},x=function(t){this.debug.info("[FragmentInfoController]["+e+"] Load request ",null!==t.url?t.url:t.quality)},S=function(t,r){var o,s;g=t.duration,u=!1,c=0,this.debug.log("[FragmentInfoController]["+e+"] FragmentInfo loaded ",t.url);try{this.fragmentController.process(r.data,t,i.getCurrentRepresentation()).then(function(){o=((new Date).getTime()-p)/1e3,s=n+g-f,m=s-o>0?s-o:0,M.call(this,m)})}catch(a){this.errHandler.sendError(T.dependencies.ErrorHandler.prototype.INTERNAL_ERROR,"Internal error while processing fragment info segment",a.message)}},D=function(){return a},I=function(e){if(D.call(this)){if(e.aborted)return void R.call(this);c+=1,c===d?this.errHandler.sendWarning(T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_CONTENT,"Failed to download fragmentInfo segment",{url:e.url,status:e.status}):this.errHandler.sendWarning(T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_CONTENT,"Failed to download fragmentInfo segment",{url:e.url,status:e.status})}},L=function(t){var r=this;if(null!==t&&t.action===t.ACTION_COMPLETE)return void v.call(r);if(null!==t){if(n=t.startTime+t.duration,t=r.indexHandler.getFragmentInfoRequest(t),r.fragmentController.isFragmentLoadedOrPending(r,t))return void r.indexHandler.getNextSegmentRequest(i.getCurrentRepresentation()).then(L.bind(r));r.debug.log("[FragmentInfoController]["+e+"] onFragmentRequest "+t.url),r.fragmentController.prepareFragmentForLoading(r,t,x,S,I,null),_.call(r)}else r.debug.log("[FragmentInfoController]["+e+"] bufferFragmentInfo failed")},M=function(n){var i=this,r=Math.round(Math.min(1e3*n,2e3));i.debug.log("[FragmentInfoController]["+e+"] Check buffer delta = "+r+" ms"),clearTimeout(t),t=setTimeout(function(){t=null,R.call(i)},r)},R=function(){var t,r=this;D.call(r)&&(r.debug.log("[FragmentInfoController]["+e+"] Start buffering process..."),t=n,r.debug.log("[FragmentInfoController]["+e+"] loadNextFragment for time: "+t),this.indexHandler.getSegmentRequestForTime(i.getCurrentRepresentation(),t).then(L.bind(this)))};return{sourceBufferExt:void 0,abrController:void 0,debug:void 0,system:void 0,errHandler:void 0,abrRulesCollection:void 0,indexHandler:void 0,initialize:function(e,t,n){var r=this;r.debug.log("[FragmentInfoController]["+e+"] Initialize"),i=n,r.setType(e),r.setFragmentController(t),s=!0},setType:function(t){e=t,void 0!==this.indexHandler&&(this.indexHandler.setType(t),this.indexHandler.setIsDynamic(!0))},isReady:function(){return o===r},setFragmentController:function(t){t&&(this.fragmentController=t,l=this.fragmentController.attachBufferController(this),l.setType(e))},reset:function(){var e=this;return v.call(e),l&&(e.fragmentController.abortRequestsForModel(l),e.fragmentController.detachBufferController(l),l=null),y.when(null)},start:b,stop:v}},T.dependencies.FragmentInfoController.prototype={constructor:T.dependencies.FragmentInfoController},T.dependencies.ManifestLoader=function(){"use strict";var e=2,t=500,n=e,i=t,r=null,o=function(e){var t,n="",i=0;if(e.length<1)return e;if(15360!==e.charCodeAt(0))return e;for(i=0;i<e.length;i+=1)t=e.charCodeAt(i),n+=String.fromCharCode((255&t)<<8|(65280&t)>>8);return n},s=function(e){var t=null;return e.indexOf("/")!==-1&&(e.indexOf("?")!==-1&&(e=e.substring(0,e.indexOf("?"))),t=e.substring(0,e.lastIndexOf("/")+1)),t},a=function(){null!==r&&r.abort(),this.parser.abort()},l=function(e){var t=s(e),a=y.defer(),l=this;return r=new T.dependencies.XHRLoader,r.initialize(null,n,i),r.load(e).then(function(n){n.responseURL&&(l.debug.log("[ManifestLoader] Redirect URL: "+n.responseURL),t=s(n.responseURL)),l.tokenAuthentication.checkRequestHeaderForToken(n),l.metricsModel.addHttpRequest("stream",null,"MPD",e,null,null,n.startDate,n.endDate,n.status,null,null),l.parser.parse(o(n.responseText),t).then(function(t){t?(t.mpdUrl=e,t.mpdLoadedTime=n.endDate,l.metricsModel.addManifestUpdate("stream",t.type,n.startDate,n.endDate,t.availabilityStartTime),a.resolve(t)):a.reject()},function(t){t&&t.name&&t.message?a.reject(t):(l.debug.error("[ManifestLoader] Manifest parsing error"),a.reject({name:T.dependencies.ErrorHandler.prototype.MANIFEST_ERR_PARSE,message:"Failed to parse manifest",data:{url:e}}))})},function(t){!t||t.aborted?a.reject():(l.metricsModel.addHttpRequest("stream",null,"MPD",e,null,null,t.startDate,t.endDate,t.status,null,null),a.reject({name:T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_MANIFEST,message:"Failed to download manifest",data:{url:e,status:t.status}}))}),a.promise};return{debug:void 0,parser:void 0,config:void 0,metricsModel:void 0,tokenAuthentication:void 0,setup:function(){n=this.config.getParam("ManifestLoader.RetryAttempts","number",e),i=this.config.getParam("ManifestLoader.RetryInterval","number",t)},load:l,abort:a}},T.dependencies.ManifestLoader.prototype={constructor:T.dependencies.ManifestLoader},T.dependencies.ManifestUpdater=function(){"use strict";var e,t=NaN,n=null,i=!1,r=function(){null!==n&&(clearInterval(n),n=null)},o=function(){r.call(this),isNaN(t)||(this.debug.log("Refresh manifest in "+t+" seconds."),n=setTimeout(a.bind(this),Math.min(1e3*t,Math.pow(2,31)-1),this))},s=function(){var e,n,i=this,r=i.manifestModel.getValue();void 0!==r&&null!==r&&(n=i.manifestExt.getRefreshDelay(r),e=((new Date).getTime()-r.mpdLoadedTime.getTime())/1e3,t=Math.max(n-e,0),o.call(i))},a=function(){var t,n,r=this;y.when(!e||e.promise).then(function(){e=y.defer(),t=r.manifestModel.getValue(),n=t.mpdUrl,t.hasOwnProperty("Location")&&(n=t.Location),r.manifestLoader.load(n).then(function(e){r.manifestModel.setValue(e),r.debug.log("Manifest has been refreshed."),i||s.call(r)})})},l=function(){e&&e.resolve()};return{debug:void 0,system:void 0,manifestModel:void 0,manifestExt:void 0,manifestLoader:void 0,setup:function(){s.call(this),this.system.mapHandler("streamsComposed",void 0,l.bind(this))},start:function(){i=!1,s.call(this)},stop:function(){i=!0,r.call(this)}}},T.dependencies.ManifestUpdater.prototype={constructor:T.dependencies.ManifestUpdater},T.models.ManifestModel=function(){"use strict";var e=null;return{system:void 0,eventBus:void 0,getValue:function(){return e},setValue:function(t){e=t,e&&this.system.notify("manifestUpdated"),null!==e&&this.eventBus.dispatchEvent({type:"manifestLoaded",data:t})}}},T.models.ManifestModel.prototype={constructor:T.models.ManifestModel},T.dependencies.MediaSourceExtensions=function(){"use strict"},T.dependencies.MediaSourceExtensions.prototype={constructor:T.dependencies.MediaSourceExtensions,createMediaSource:function(){"use strict";var e="WebKitMediaSource"in window,t="MediaSource"in window;return t?new MediaSource:e?new WebKitMediaSource:null},attachMediaSource:function(e,t){"use strict";return t.setSource(window.URL.createObjectURL(e)),!0},detachMediaSource:function(e){"use strict";return e.setSource(""),!0},setDuration:function(e,t){"use strict";var n,i=!1;if("open"!==e.readyState)return e.duration;for(n=0;n<e.sourceBuffers.length;n++)if(e.sourceBuffers[n].updating){i=!0;break}return i||(e.duration=t),e.duration},signalEndOfStream:function(e){"use strict";var t=e.sourceBuffers,n=t.length,i=0;if("open"===e.readyState){for(i;i<n;i++){if(t[i].updating)return;if(0===t[i].buffered.length)return}return e.endOfStream(),!0}}},T.dependencies.MetricsExtensions=function(){"use strict";var e={42:"Baseline","4D":"Main",58:"Extended",64:"High"},t=function(e,t){var n,i,r,o,s,a,l,d;for(a=0;a<e.length;a+=1)for(n=e[a],r=n.AdaptationSet_asArray,l=0;l<r.length;l+=1)for(i=r[l],s=i.Representation_asArray,d=0;d<s.length;d+=1)if(o=s[d],t===o.id)return o;return null},n=function(e,t){var n=!1;return"video"===t?(this.manifestExt.getIsVideo(e),"video"===e.type&&(n=!0)):"audio"===t?(this.manifestExt.getIsAudio(e),"audio"===e.type&&(n=!0)):"text"===t?(this.manifestExt.getIsText(e),"text"===e.type&&(n=!0)):n=!1,n},i=T.utils.copyMethods(x.dependencies.DashMetricsExtensions);return i.config=void 0,i.getDuration=function(){var e=this,t=e.manifestModel.getValue(),n=t?t.Period.duration:null;return n!==1/0?n:-1},i.getFormatForType=function(e){var t,n=this,i=n.manifestModel.getValue(),r=0;for(r=0;r<i.Period.AdaptationSet.length;r++)if(t=i.Period.AdaptationSet[r],t.type===e)return t.mimeType;return null},i.getCodecForType=function(e){var t,n=this,i=n.manifestModel.getValue(),r=0;for(r=0;r<i.Period.AdaptationSet.length;r++)if(t=i.Period.AdaptationSet[r],t.type===e||t.contentType===e)return t.Representation[0].codecs;return null},i.getVideoWidthForRepresentation=function(e){var n,i,r=this,o=r.manifestModel.getValue();return o?(i=o.Period_asArray,n=t.call(r,i,e),null===n?null:n.width):null},i.getVideoHeightForRepresentation=function(e){var n,i,r=this,o=r.manifestModel.getValue();return o?(i=o.Period_asArray,n=t.call(r,i,e),null===n?null:n.height):null},i.getCodecsForRepresentation=function(e){var n,i=this,r=i.manifestModel.getValue(),o=r.Period_asArray;return n=t.call(i,o,e),null===n?null:n.codecs},i.getH264ProfileLevel=function(t){if(t.indexOf("avc1")<0)return"";var n=e[t.substr(5,2)],i=parseInt(t.substr(9,2),16)/10;return n+"@"+i.toString()},i.getBitratesForType=function(e,t){var i,r,o,s,a,l,d,u,c=this,h=c.manifestModel.getValue(),p=null,f=[];if(!(null!==h&&void 0!==h||null!==t&&void 0!==t))return null;if(t)p=t;else for(i=h.Period_asArray,o=0;o<i.length;o+=1)for(r=i[o],s=r.AdaptationSet_asArray,d=0;d<s.length;d+=1)if(p=s[d],n.call(c,s[d],e)){p=s[d];break}if(null!==p)for(p=c.manifestExt.processAdaptation(p),l=p.Representation_asArray,u=0;u<l.length;u+=1)a=l[u],f.push(a.bandwidth);return f},i.getBitratesWithResolutionForType=function(e){var t,i,r,o,s,a,l,d,u,c=this,h=c.manifestModel.getValue(),p=[];if(null===h||void 0===h)return null;for(t=h.Period_asArray,r=0;r<t.length;r+=1)for(i=t[r],s=i.AdaptationSet_asArray,d=0;d<s.length;d+=1)if(o=s[d],n.call(c,o,e)){for(o=c.manifestExt.processAdaptation(o),l=o.Representation_asArray,u=0;u<l.length;u+=1){a=l[u];var f={bitrate:a.bandwidth,width:a.width,height:a.height};p.push(f)}return p}return p},i},T.dependencies.MetricsExtensions.prototype={constructor:T.dependencies.MetricsExtensions},T.models.MetricsModel=function(){"use strict";return{system:void 0,eventBus:void 0,config:void 0,streamMetrics:{},metricsChanged:function(){this.eventBus.dispatchEvent({type:"metricsChanged",data:{}})},metricChanged:function(e){this.eventBus.dispatchEvent({type:"metricChanged",data:{stream:e}}),this.metricsChanged()},metricUpdated:function(e,t,n){this.eventBus.dispatchEvent({type:"metricUpdated",data:{stream:e,metric:t,value:n}}),this.metricChanged(e)},metricAdded:function(e,t,n){this.eventBus.dispatchEvent({type:"metricAdded",data:{stream:e,metric:t,value:n}}),this.metricChanged(e)},clearCurrentMetricsForType:function(e){var t=this.config.getParamFor(e,"ABR.keepBandwidthCondition","boolean",!0);for(var n in this.streamMetrics[e])!this.streamMetrics[e].hasOwnProperty(n)||"HttpList"===n&&t!==!1||(this.streamMetrics[e][n]=[]);this.metricChanged(e)},clearAllCurrentMetrics:function(){var e=this;for(var t in this.streamMetrics)this.streamMetrics.hasOwnProperty(t)&&"stream"===t&&delete this.streamMetrics[t];this.metricsChanged.call(e)},getReadOnlyMetricsFor:function(e){return this.streamMetrics.hasOwnProperty(e)?this.streamMetrics[e]:null},getMetricsFor:function(e){var t;return this.streamMetrics.hasOwnProperty(e)?t=this.streamMetrics[e]:(t=this.system.getObject("metrics"),this.streamMetrics[e]=t),t},addTcpConnection:function(e,t,n,i,r,o){var s=new T.vo.metrics.TCPConnection;return s.tcpid=t,
s.dest=n,s.topen=i,s.tclose=r,s.tconnect=o,this.getMetricsFor(e).TcpList.push(s),this.metricAdded(e,"TcpConnection",s),s},addHttpRequest:function(e,t,n,i,r,o,s,a,l,d,u,c,h,p){var f=new T.vo.metrics.HTTPRequest,m=this.getMetricsFor(e).HttpList;return f.stream=e,f.tcpid=t,f.type=n,f.url=i,f.actualurl=r,f.range=o,f.trequest=s,f.tresponse=a,f.tfinish=l,f.responsecode=d,f.interval=u,f.mediaduration=c,f.startTime=h,f.quality=p,m.push(f),this.metricAdded(e,"HttpRequest",f),m.length>10&&m.shift(),f},appendHttpTrace:function(e,t,n,i){var r=new T.vo.metrics.HTTPRequest.Trace;return r.s=t,r.d=n,r.b=i,e.trace.push(r),this.metricUpdated(e.stream,"HttpRequestTrace",e),r},addRepresentationSwitch:function(e,t,n,i,r){var o=new T.vo.metrics.RepresentationSwitch;return o.t=t,o.mt=n,o.to=i,o.lto=r,this.getMetricsFor(e).RepSwitchList.push(o),this.metricAdded(e,"RepresentationSwitch",o),o},addBufferedSwitch:function(e,t,n,i){var r=new T.vo.metrics.BufferedSwitch;return r.mt=t,r.to=n,r.lto=i,this.getMetricsFor(e).BufferedSwitchList.push(r),this.metricAdded(e,"BufferedSwitch",r),r},addState:function(e,t,n,i){var r=new T.vo.metrics.State;return r.current=t,r.position=n,r.reason=i,this.metricAdded(e,"State",r),r},addSession:function(e,t,n,i,r){var o=new T.vo.metrics.Session;return o.uri=t,n?o.loopMode=1:o.loopMode=0,o.endTime=i,o.playerType=r,this.metricAdded(e,"Session",o),o},addCondition:function(e,t,n,i,r,o){var s=new T.vo.metrics.Condition;return s.isFullScreen=t,s.windowSize=n+"x"+i,s.fps=o,s.droppedFrames=r,this.metricAdded(e,"Condition",s),s},addMetaData:function(){this.metricAdded(null,"ManifestReady",null)},addBufferLevel:function(e,t,n){var i=new T.vo.metrics.BufferLevel,r=this.getMetricsFor(e).BufferLevel;return i.t=t,i.level=Number(n.toFixed(3)),r.push(i),this.metricAdded(e,"BufferLevel",i),r.length>10&&r.shift(),i},addDVRInfo:function(e,t,n){var i=new T.vo.metrics.DVRInfo,r=this.getMetricsFor(e).DVRInfo;return i.t=t,i.range=n,r.push(i),this.metricAdded(e,"DVRInfo",i),r.length>10&&r.shift(),i},addDroppedFrames:function(e,t){var n=new T.vo.metrics.DroppedFrames,i=this.getMetricsFor(e).DroppedFrames;return n.time=t.creationTime,n.droppedFrames=t.droppedVideoFrames,n.decodedFrameCount=t.totalVideoFrames,i.length>0&&i[i.length-1]===n?i[i.length-1]:(i.push(n),this.metricAdded(e,"DroppedFrames",n),n)},addPlaybackQuality:function(e,t,n,i){var r=new T.vo.metrics.PlaybackQuality,o=this.getMetricsFor(e).PlaybackQuality;return r.t=t,r.mt=i,r.droppedFrames=n.droppedVideoFrames,r.totalVideoFrames=n.totalVideoFrames,o.length>0&&r.droppedFrames===o[o.length-1].droppedFrames&&r.totalVideoFrames===o[o.length-1].totalVideoFrames?o[o.length-1]:(o.push(r),this.metricAdded(e,"PlaybackQuality",r),o.length>10&&o.shift(),r)},addVideoResolution:function(e,t,n,i,r){var o=new T.vo.metrics.VideoResolution,s=this.getMetricsFor(e).VideoResolution;return o.t=t,o.mt=r,o.width=n,o.height=i,s.length>0&&o.width===s[s.length-1].width&&o.height===s[s.length-1].height?s[s.length-1]:(s.push(o),this.metricAdded(e,"VideoResolution",o),o)},addManifestUpdate:function(e,t,n,i,r,o,s,a,l,d){var u=new T.vo.metrics.ManifestUpdate,c=this.getMetricsFor("stream");return u.streamType=e,u.type=t,u.requestTime=n,u.fetchTime=i,u.availabilityStartTime=r,u.presentationStartTime=o,u.clientTimeOffset=s,u.currentTime=a,u.buffered=l,u.latency=d,c.ManifestUpdate.push(u),this.metricAdded(e,"ManifestUpdate",u),u},updateManifestUpdateInfo:function(e,t){if(e&&t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);this.metricUpdated(e.streamType,"ManifestUpdate",e)}},addManifestUpdatePeriodInfo:function(e,t,n,i,r){var o=new T.vo.metrics.ManifestUpdate.PeriodInfo;return o.id=t,o.index=n,o.start=i,o.duration=r,e.periodInfo.push(o),this.metricUpdated(e.streamType,"ManifestUpdatePeriodInfo",e),o},addManifestUpdateRepresentationInfo:function(e,t,n,i,r,o,s,a){var l=new T.vo.metrics.ManifestUpdate.RepresentationInfo;return l.id=t,l.index=n,l.periodIndex=i,l.streamType=r,l.startNumber=s,l.segmentInfoType=a,l.presentationTimeOffset=o,e.representationInfo.push(l),this.metricUpdated(e.streamType,"ManifestUpdateRepresentationInfo",e),l},addPlayList:function(e,t,n,i){var r=new T.vo.metrics.PlayList,o=this.getMetricsFor(e).PlayList;return r.stream=e,r.start=t,r.mstart=n,r.starttype=i,o.push(r),this.metricAdded(e,"PlayList",r),o.length>10&&o.shift(),r},appendPlayListTrace:function(e,t,n,i,r,o,s,a){var l=new T.vo.metrics.PlayList.Trace;return l.representationid=t,l.subreplevel=n,l.start=i,l.mstart=r,l.duration=o,l.playbackspeed=s,l.stopreason=a,e.trace.push(l),this.metricUpdated(e.stream,"PlayListTrace",e),e.trace.length>10&&e.trace.shift(),l}}},T.models.MetricsModel.prototype={constructor:T.models.MetricsModel},T.dependencies.Mp4Processor=function(){"use strict";var e=function(e){var t=new P.boxes.MovieHeaderBox,n=e[e.length-1];return t.version=1,t.creation_time=0,t.modification_time=0,t.timescale=n.timescale,t.duration=Math.round(n.duration*n.timescale),t.rate=65536,t.volume=256,t.reserved=0,t.reserved_2=[0,0],t.matrix=[65536,0,0,0,65536,0,0,0,1073741824],t.pre_defined=[0,0,0,0,0,0],t.next_track_ID=n.trackId+1,t.flags=0,t},t=function(e){var t,n,r;return t=new P.boxes.TrackBox,n=new P.boxes.TrackHeaderBox,n.version=1,n.flags=7,n.creation_time=0,n.modification_time=0,n.track_id=e.trackId,n.reserved=0,n.duration=Math.round(e.duration*e.timescale),n.reserved_2=[0,0],n.layer=0,n.alternate_group=0,n.volume=256,n.reserved_3=0,n.matrix=[65536,0,0,0,65536,0,0,0,1073741824],n.width=e.width<<16,n.height=e.height<<16,t.boxes.push(n),r=new P.boxes.MediaBox,r.boxes.push(i(e)),r.boxes.push(o(e)),r.boxes.push(s(e)),t.boxes.push(r),t},n=function(e){var t,n,i,r=0;return t=e.charCodeAt(0)-96<<10,n=e.charCodeAt(1)-96<<5,i=e.charCodeAt(2)-96,r=t|n|i},i=function(e){var t=new P.boxes.MediaHeaderBox;return t.flags=0,t.version=1,t.creation_time=0,t.modification_time=0,t.timescale=e.timescale,t.duration=Math.round(e.duration*e.timescale),t.pad=0,t.language=n(e.language),t.pre_defined=0,t},r=function(e){var t,n=0;for(t=0;t<e.length;t+=1)n|=e.charCodeAt(t)<<8*(e.length-t-1);return n},o=function(e){var t=new P.boxes.HandlerBox;switch(t.version=0,t.pre_defined=0,e.type){case"video":t.handler_type=r(t.HANDLERTYPEVIDEO),t.name=t.HANDLERVIDEONAME;break;case"audio":t.handler_type=r(t.HANDLERTYPEAUDIO),t.name=t.HANDLERAUDIONAME;break;default:t.handler_type=r(t.HANDLERTYPETEXT),t.name=t.HANDLERTEXTNAME}return t.name+="\0",t.reserved=[0,0,0],t.flags=0,t},s=function(e){var t=new P.boxes.MediaInformationBox;switch(e.type){case"video":t.boxes.push(R(e));break;case"audio":t.boxes.push(A(e))}return t.boxes.push(a(e)),t.boxes.push(M(e)),t},a=function(){var e,t,n;return e=new P.boxes.DataInformationBox,t=new P.boxes.DataReferenceBox,t.version=0,t.entry_count=1,t.flags=0,n=new P.boxes.DataEntryUrlBox,n.location="",n.version=0,n.flags=1,t.boxes.push(n),e.boxes.push(t),e},l=function(){var e=new P.boxes.TimeToSampleBox;return e.version=0,e.entry_count=0,e.flags=0,e.entry=[],e},d=function(){var e=new P.boxes.SampleToChunkBox;return e.flags=0,e.version=0,e.entry_count=0,e.entry=[],e},u=function(){var e=new P.boxes.ChunkOffsetBox;return e.version=0,e.entry_count=0,e.flags=0,e.chunk_offset=[],e},c=function(){var e=new P.boxes.SampleSizeBox;return e.version=0,e.flags=0,e.sample_count=0,e.sample_size=0,e},h=function(e){var t,n=new Uint8Array(e.length/2);for(t=0;t<e.length/2;t+=1)n[t]=parseInt(""+e[2*t]+e[2*t+1],16);return n},p=function(e,t){var n=new Uint8Array(e.length+t.length);return n.set(e,0),n.set(t,e.length),n},f=function(e){var t,n,i,r,o,s,a,l,d,u=new RegExp("^[A-Z0-9]7","gi"),c=new RegExp("^[A-Z0-9]8","gi");for(t=new P.boxes.AVCConfigurationBox,t.configurationVersion=1,t.lengthSizeMinusOne=3,t.reserved=63,t.SPS_NAL=[],t.PPS_NAL=[],n=new Uint8Array(0),i=e.codecPrivateData,r=i.split("00000001"),r.splice(0,1),o=0,s=0,a=0;a<r.length;a+=1)l=h(r[a]),r[a].match(u)&&(t.SPS_NAL[o++]={NAL_length:l.length,NAL:l},t.AVCProfileIndication=parseInt(r[a].substr(2,2),16),t.profile_compatibility=parseInt(r[a].substr(4,2),16),t.AVCLevelIndication=parseInt(r[a].substr(6,2),16)),r[a].match(c)&&(t.PPS_NAL[s++]={NAL_length:l.length,NAL:l}),d=new Uint8Array(l.length+4),d[3]=l.length,d.set(l,4),n=p(n,d);return t.numOfSequenceParameterSets=o,t.numOfPictureParameterSets=s,t},m=function(e){var t=null;return t=void 0!==e.contentProtection?new P.boxes.EncryptedVideoBox:new P.boxes.AVC1VisualSampleEntryBox,t.data_reference_index=1,t.compressorname=[10,65,86,67,32,67,111,100,105,110,103,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t.depth=24,t.reserved=[0,0,0,0,0,0],t.reserved_2=0,t.reserved_3=0,t.pre_defined=0,t.pre_defined_2=[0,0,0],t.pre_defined_3=65535,t.frame_count=1,t.horizresolution=4718592,t.vertresolution=4718592,t.height=e.height,t.width=e.width,t.boxes.push(f(e)),void 0!==e.contentProtection&&t.boxes.push(b(e)),t},g=function(e){var t=new P.boxes.OriginalFormatBox;return t.data_format=r(e.codecs.substring(0,e.codecs.indexOf("."))),t},y=function(){var e=new P.boxes.SchemeTypeBox;return e.flags=0,e.version=0,e.scheme_type=1667591779,e.scheme_version=65536,e},_=function(e){var t=new P.boxes.SchemeInformationBox;return t.boxes.push(E(e)),t},E=function(e){var t=new P.boxes.TrackEncryptionBox;return t.flags=0,t.version=0,t.default_IsEncrypted=1,t.default_IV_size=8,t.default_KID=e.contentProtection&&e.contentProtection.length>0&&e.contentProtection[0]["cenc:default_KID"]?e.contentProtection[0]["cenc:default_KID"]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t},b=function(e){var t=new P.boxes.ProtectionSchemeInformationBox;return t.boxes.push(g(e)),t.boxes.push(y()),t.boxes.push(_(e)),t},v=function(e){var t=e.codecs.substring(0,e.codecs.indexOf("."));switch(t){case"avc1":return m(e);default:throw{name:T.dependencies.ErrorHandler.prototype.MEDIA_ERR_CODEC_UNSUPPORTED,message:"Codec is not supported",data:{codec:t}}}},x=function(e){for(var t=[];e.length>=2;)t.push(parseInt(e.substring(0,2),16)),e=e.substring(2,e.length);return t},S=function(e){var t,n,i,r,o,s,a;return t=x(e.codecPrivateData),n=t.length,i=new Uint8Array(2+n),i[0]=5,i[1]=n,i.set(t,2),r=13+i.length,o=new Uint8Array(2+r),o[0]=4,o[1]=r,o[2]=64,o[3]=20,o[3]|=0,o[3]|=1,o[4]=255,o[5]=255,o[6]=255,o[7]=(4278190080&e.bandwidth)>>24,o[8]=(16711680&e.bandwidth)>>16,o[9]=(65280&e.bandwidth)>>8,o[10]=255&e.bandwidth,o[11]=(4278190080&e.bandwidth)>>24,o[12]|=(16711680&e.bandwidth)>>16,o[13]|=(65280&e.bandwidth)>>8,o[14]|=255&e.bandwidth,o.set(i,15),s=3+o.length,a=new Uint8Array(2+s),a[0]=3,a[1]=s,a[2]=(65280&e.trackId)>>8,a[3]=255&e.trackId,a[4]=0,a.set(o,5),a},D=function(e){var t,n,i=null;return i=void 0!==e.contentProtection?new P.boxes.EncryptedAudioBox:new P.boxes.MP4AudioSampleEntryBox,i.reserved=[0,0,0,0,0,0],i.data_reference_index=1,i.reserved_2=[0,0],i.channelcount=e.channels,i.samplesize=16,i.pre_defined=0,i.reserved_3=0,i.samplerate=e.samplingRate<<16,t=new P.boxes.ESDBox,n=S(e),t.ES_tag=n[0],t.ES_length=n[1],t.ES_data=n.subarray(2,n.length),t.version=0,t.flags=0,i.boxes.push(t),void 0!==e.contentProtection&&i.boxes.push(b(e)),i},I=function(e){var t=e.codecs.substring(0,e.codecs.indexOf("."));switch(t){case"mp4a":return D(e);default:throw{name:T.dependencies.ErrorHandler.prototype.MEDIA_ERR_CODEC_UNSUPPORTED,message:"Codec is not supported",data:{codec:t}}}return null},L=function(e){var t=new P.boxes.SampleDescriptionBox;switch(t.version=0,t.flags=0,e.type){case"video":t.boxes.push(v(e));break;case"audio":t.boxes.push(I(e))}return t},M=function(e){var t=new P.boxes.SampleTableBox;return t.boxes.push(l(e)),t.boxes.push(d(e)),t.boxes.push(u(e)),t.boxes.push(c(e)),t.boxes.push(L(e)),t},R=function(){var e=new P.boxes.VideoMediaHeaderBox;return e.version=0,e.flags=1,e.graphicsmode=0,e.opcolor=[0,0,0],e},A=function(){var e=new P.boxes.SoundMediaHeaderBox;return e.version=0,e.balance=0,e.reserved=0,e.flags=1,e},w=function(){var e=new P.boxes.FileTypeBox;return e.major_brand=1769172790,e.minor_brand=1,e.compatible_brands=[],e.compatible_brands[0]=1769172845,e.compatible_brands[1]=1769172790,e.compatible_brands[2]=1836278888,e},B=function(e){var t,n,i,r=e[e.length-1];for(t=new P.boxes.MovieExtendsBox,i=0;i<e.length;i+=1)r=e[i],n=new P.boxes.TrackExtendsBox,n.version=0,n.flags=0,n.track_ID=r.trackId,n.default_sample_description_index=1,n.default_sample_duration=0,n.default_sample_flags=0,n.default_sample_size=0,t.boxes.push(n);return t},F=function(e){var t,n,i,r=[];for(i=0;i<e.length;i+=1)t=new Uint8Array(e[i].initData),n=new P.boxes.ProtectionSystemSpecificHeaderBox,n.read(t,8,t.length),r.push(n);return r},N=function(n){var i,r,o,s=[];for(i=new P.boxes.MovieBox,i.boxes.push(e(n)),o=0;o<n.length;o+=1)i.boxes.push(t(n[o]));for(i.boxes.push(B(n)),o=0;o<n.length;o++)void 0!==n[o].contentProtection&&(r=this.protectionExt.getSupportedKeySystemsFromContentProtection(n[o].contentProtection),i.boxes.push.apply(i.boxes,F(r)));return s.push(w()),s.push(i),s},C=1,O=function(){var e=new P.boxes.MovieFragmentHeaderBox;return e.version=0,e.flags=0,e.sequence_number=C++,e},U=function(e){var t=new P.boxes.TrackFragmentBox;return t.version=0,t.flags=0,t.boxes.push(k(e)),t.boxes.push(H(e)),t.boxes.push(K(e)),t.boxes.push(V(e)),t},k=function(e){var t=new P.boxes.TrackFragmentHeaderBox;return t.version=0,t.flags=131072,t.track_ID=e.trackId,t},H=function(e){var t=new P.boxes.TrackFragmentBaseMediaDecodeTimeBox;return t.version=1,t.flags=0,t.baseMediaDecodeTime=e.samples.length>0?e.samples[0].dts:0,t},K=function(e){var t,n,i,r,o=new P.boxes.TrackFragmentRunBox;for(n=e.samples[0].cts,i=e.samples[0].duration>0?256:0,o.version=0,o.flags=1|i|512|1024|("video"===e.type?2048:0),o.data_offset=0,o.samples_table=[],o.sample_count=e.samples.length,t=0;t<e.samples.length;t++)r={sample_duration:e.samples[t].duration,sample_size:e.samples[t].size,sample_composition_time_offset:e.samples[t].cts-e.samples[t].dts,sample_flags:e.samples[t].flags},r.sample_composition_time_offset<0&&(o.version=1),o.samples_table.push(r);return o},V=function(e){var t,n=new P.boxes.SampleDependencyTableBox;for(n.version=0,n.flags=0,n.sample_dependency_table=[],t=0;t<e.samples.length;t++)n.sample_dependency_table.push((267386880&e.samples[t].flags)>>20);return n},q=function(e){var t=new P.boxes.MediaDataBox;return t.data=e.data,t},z=function(e){var t,n,i,r,o=[],s=0,a={},l=[],d=0;if(t=new P.boxes.MovieFragmentBox,t.boxes.push(O()),e)for(n=0;n<e.length;n+=1)t.boxes.push(U(e[n]));if(o.push(t),t.computeLength(),i=t.size,r=t.getBoxesByType("traf"),i+=8,e&&e.length&&(l=[e.length]),e)for(n=0;n<e.length;n+=1)r[n].getBoxByType("trun").data_offset=i,i+=e[n].data.length,l[n]=e[n].data,s+=l[n].length;for(a.data=new Uint8Array(s),n=0;n<l.length;n++)a.data.set(l[n],d),d+=l[n].length;return o.push(q(a)),o};return{protectionExt:void 0,generateInitSegment:function(e){var t=new P.boxes.File;return t.boxes=N.call(this,e),P.serialize(t)},generateMediaSegment:function(e){var t=new P.boxes.File;return t.boxes=z.call(this,e),P.serialize(t)},generateInitMediaSegment:function(e){var t=new P.boxes.File;return t.boxes=N.call(this,e),t.boxes=t.boxes.concat(z.call(this,e)),P.serialize(t)}}},T.dependencies.Mp4Processor.prototype={constructor:T.dependencies.Mp4Processor},T.dependencies.Notifier=function(){"use strict";var e,t="observableId",n=0,i=function(){return this[t]||(n+=1,this[t]="_id_"+n),this[t]};return{system:void 0,setup:function(){e=this.system,e.mapValue("notify",this.notify),e.mapValue("subscribe",this.subscribe),e.mapValue("unsubscribe",this.unsubscribe)},notify:function(){var t=arguments[0]+i.call(this),n=new T.vo.Event;n.sender=this,n.type=arguments[0],n.data=arguments[1],n.error=arguments[2],n.timestamp=(new Date).getTime(),e.notify.call(e,t,n)},subscribe:function(t,n,r,o){if(!r&&n[t]&&(r=n[t]=n[t].bind(n)),!n)throw"observer object cannot be null or undefined";if(!r)throw"event handler cannot be null or undefined";t+=i.call(this),e.mapHandler(t,void 0,r,o)},unsubscribe:function(t,n,r){r=r||n[t],t+=i.call(this),e.unmapHandler(t,void 0,r)}}},T.dependencies.Notifier.prototype={constructor:T.dependencies.Notifier},T.dependencies.Parser=function(){"use strict";var e=null,t=function(t,n){if(null===e)if(t.indexOf("SmoothStreamingMedia")>-1&&"undefined"!=typeof this.mssParser)this.system.notify("setContext","MSS"),e=this.mssParser;else if(t.indexOf("#EXTM3U")>-1&&"undefined"!=typeof this.hlsParser)this.system.notify("setContext","HLS"),e=this.hlsParser;else{if(!(t.indexOf("MPD")>-1&&"undefined"!=typeof this.dashParser))return y.reject("manifest cannot be parsed, protocol is unsupported!");this.system.notify("setContext","MPD"),e=this.dashParser}return e.parse(t,n)},n=function(){null!==e&&void 0!==e.abort&&e.abort()},i=function(){e=null};return{debug:void 0,system:void 0,dashParser:void 0,mssParser:void 0,hlsParser:void 0,metricsModel:void 0,parse:t,abort:n,reset:i}},T.dependencies.Parser.prototype={constructor:T.dependencies.Parser},T.dependencies.SourceBufferExtensions=function(){"use strict";this.system=void 0,this.manifestExt=void 0},T.dependencies.SourceBufferExtensions.prototype={constructor:T.dependencies.SourceBufferExtensions,createSourceBuffer:function(e,t){"use strict";var n=null;if(!e)return null;try{n=e.addSourceBuffer(t)}catch(i){if(!this.manifestExt.getIsTextTrack(t))throw i;if("text/vtt"===t||"text/ttml"===t)n=this.system.getObject("textSourceBuffer");else{if("application/ttml+xml+mp4"!==t&&"application/mp4"!==t&&"application/ttml+xml"!==t)throw i;n=this.system.getObject("textTTMLXMLMP4SourceBuffer")}}return n},removeSourceBuffer:function(e,t){"use strict";try{e.removeSourceBuffer(t)}catch(n){}},getBufferRange:function(e,t,n){"use strict";var i,r,o=null,s=0,a=0,l=null,d=null,u=0,c=n||.03;try{o=e.buffered}catch(h){return null}if(o){for(r=0,i=o.length;r<i;r+=1)if(s=o.start(r),a=o.end(r),null===l){if(u=Math.abs(s-t),t>=s&&t<a){l=s,d=a;continue}if(u<=c){l=s,d=a;continue}}else{if(u=s-d,!(u<=c))break;d=a}if(null!==l)return{start:l,end:d}}return null},getAllRanges:function(e){var t=null;try{return t=e.buffered}catch(n){return null}},getBufferLength:function(e,t,n){"use strict";var i,r,o=this;return i=o.getBufferRange(e,t,n),r=null===i?0:i.end-t},waitForUpdateEnd:function(e){"use strict";var t,n=y.defer(),i=50,r=function(){e.updating||(clearInterval(t),n.resolve(!0))},o=function(){e.updating||(e.removeEventListener("updateend",o,!1),n.resolve(!0))};if(!e.updating)return n.resolve(!0),n.promise;if("function"==typeof e.addEventListener)try{e.addEventListener("updateend",o,!1)}catch(s){t=setInterval(r,i)}else t=setInterval(r,i);return n.promise},append:function(e,t,n){var i=y.defer(),r=this;return r.waitForUpdateEnd(e).then(function(){try{"append"in e?e.append(t,n):"appendBuffer"in e&&e.appendBuffer(t),r.waitForUpdateEnd(e,n).then(function(){i.resolve()})}catch(o){i.reject({err:o,data:t})}}),i.promise},remove:function(e,t,n,i,r){var o=y.defer(),s=this;return s.waitForUpdateEnd(e).then(function(){try{t>=0&&t<i&&n>t&&"ended"!==r.readyState&&e.remove(t,n),isNaN(n)&&"ended"!==r.readyState&&e.remove(t),s.waitForUpdateEnd(e).then(function(){o.resolve()})}catch(a){o.reject(a)}}),o.promise},abort:function(e,t){"use strict";try{"open"===e.readyState&&t.abort()}catch(n){}}},Math.sign||(Math.sign=function(e){"use strict";return e<0?-1:0===e?0:1}),T.dependencies.Stream=function(){"use strict";var e,t,n,i,r,o,s,a,l,d,u,c,h,p,f,_,E,b,v,x,S,D,I,L,M,R,A,P,w=null,B=null,F=-1,N=null,C=-1,O=null,U=!1,k=!1,H=null,K=null,V=null,q=-1,z=!0,Y=!1,j=!1,W="und",G="und",X=null,Q=-1,J=-1,$="Stopped",Z=1,ee=!1,te=!1,ne=null,ie=!0,re=null,oe=!1,se=-1,ae=-1,le=function(e){this.errHandler.sendError(e.data.code,e.data.message,e.data.data)},de=function(){Y&&(this.debug.info("[Stream] Play."),this.videoModel.play())},ue=function(){this.debug.info("[Stream] Pause."),this.videoModel.pause()},ce=function(t,n){Y&&(this.debug.info("[Stream] Seek: "+t),this.manifestExt.getIsDynamic(e)&&!oe&&0!==this.videoModel.getCurrentTime()&&_e.call(this),n===!0?(E=t,this.system.unmapHandler("bufferUpdated"),this.system.mapHandler("bufferUpdated",void 0,Ye.bind(this)),Ce.call(this,E)):this.videoModel.setCurrentTime(t))},he=function(e){var t=y.defer(),n=this,i=function(){e.removeEventListener("sourceopen",i),e.removeEventListener("webkitsourceopen",i),t.resolve(e)};return e.addEventListener("sourceopen",i,!1),e.addEventListener("webkitsourceopen",i,!1),n.mediaSourceExt.attachMediaSource(e,n.videoModel),t.promise},pe=function(){var n=this,i=[],r=y.defer(),o=function(){B&&i.push(B.reset(j)),H&&i.push(H.reset(j)),N&&i.push(N.reset(j)),K&&i.push(K.reset(j)),O&&i.push(O.reset(j)),V&&i.push(V.reset(j)),y.all(i).then(function(){ne&&(ne.reset(),ne=void 0),t&&n.mediaSourceExt.detachMediaSource(n.videoModel),Y=!1,w=null,B=null,N=null,O=null,t=null,e=null,r.resolve()})};return y.when(ie).then(function(){o()}),r.promise},fe=function(e,n){var i=null,r=null;if(("video"===e.type||"audio"===e.type)&&!this.capabilities.supportsCodec(this.videoModel.getElement(),n))return this.errHandler.sendError(T.dependencies.ErrorHandler.prototype.MEDIA_ERR_CODEC_UNSUPPORTED,e.type+" codec is not supported",{codec:n}),null;try{r=this.sourceBufferExt.createSourceBuffer(t,n)}catch(o){return this.errHandler.sendError(T.dependencies.ErrorHandler.prototype.MEDIA_ERR_CREATE_SOURCEBUFFER,"Failed to create "+e.type+" source buffer",new T.vo.Error(o.code,o.name,o.message)),null}return i=this.system.getObject("bufferController"),i.initialize(e.type,X,e,r,this.fragmentController,t,ne),"text"===e.type&&r.hasOwnProperty("initialize")&&r.initialize(n,i,e),i},me=function(e,t){var n=null;return e&&t&&t.type&&(n=this.system.getObject("fragmentInfoController"),n.initialize(t.type,this.fragmentController,e)),n},ge=function(){var t,n,i,r;if(ie=!1,ne=this.system.getObject("eventController"),t=this.manifestExt.getVideoData(e,X.index),null===t?this.errHandler.sendError(T.dependencies.ErrorHandler.prototype.MANIFEST_ERR_NO_VIDEO,"No Video data in manifest"):(F=this.manifestExt.getDataIndex(t,e,X.index),n=this.manifestExt.getCodec(t),w=this.manifestExt.getContentProtectionData(t),null===n?this.errHandler.sendError(T.dependencies.ErrorHandler.prototype.MANIFEST_ERR_NO_VIDEO,"Video codec information not available"):(B=fe.call(this,t,n),this.manifestExt.getIsDynamic(e)&&(H=me.call(this,B,t)))),null===B)return void(ie=!0);if(t=this.manifestExt.getSpecificAudioData(e,X.index,W),null===t)this.errHandler.sendWarning(T.dependencies.ErrorHandler.prototype.MANIFEST_ERR_NO_AUDIO,"No audio data in manifest");else if(C=this.manifestExt.getDataIndex(t,e,X.index),i=this.manifestExt.getCodec(t),null===i)this.errHandler.sendWarning(T.dependencies.ErrorHandler.prototype.MANIFEST_ERR_NO_AUDIO,"Audio codec information not available");else{if(N=fe.call(this,t,i),null===N)return void(ie=!0);this.manifestExt.getIsDynamic(e)&&(K=me.call(this,N,t))}t=this.manifestExt.getSpecificTextData(e,X.index,G),null!==t&&(q=this.manifestExt.getDataIndex(t,e,X.index),r=this.manifestExt.getMimeType(t),null===r?this.errHandler.sendWarning(T.dependencies.ErrorHandler.prototype.MANIFEST_ERR_NO_TEXT,"Text codec information not available"):(O=fe.call(this,t,r),this.manifestExt.getIsDynamic(e)&&(V=me.call(this,O,t)))),ne&&ne.addInlineEvents(this.manifestExt.getEventsForPeriod(e,X)),A?A.init(w,i,n):w&&!this.capabilities.supportsEncryptedMedia()&&this.errHandler.sendError(T.dependencies.ErrorHandler.prototype.CAPABILITY_ERR_MEDIAKEYS,"EME is not supported/enabled",null),ie=!0},ye=function(){this.debug.log("[Stream] Setting duration: "+X.duration),this.mediaSourceExt.setDuration(t,X.duration),Y=!0},_e=function(){"MSS"===e.name&&this.manifestExt.getIsDynamic(e)&&(H&&k===!1&&(k=!0,H.start()),K&&K.start(),V&&U&&V.start())},Ee=function(){H&&(k=!1,H.stop()),K&&K.stop(),V&&V.stop()},be=function(){this.debug.info("[Stream] <video> loadedmetadata event")},ve=function(){this.debug.info("[Stream] <video> canplay event")},xe=function(){this.debug.info("[Stream] <video> playing event"),se=(new Date).getTime()/1e3,ae=this.getVideoModel().getCurrentTime()},Te=function(){this.debug.info("[Stream] <video> loadstart event")},Se=function(){this.debug.info("[Stream] <video> play event"),1!==Z?this.setTrickModeSpeed(1):J>=0?(Ve.call(this,J),J=-1):Ce.call(this),this.metricsModel.addPlayList("video",(new Date).getTime(),this.videoModel.getCurrentTime(),"play")},De=function(){this.debug.info("[Stream] <video> ended event"),this.metricsModel.addState("video","stopped",this.videoModel.getCurrentTime(),1)},Ie=function(){this.debug.info("[Stream] <video> pause event"),se=-1,ae=-1,this.metricsModel.addPlayList("video",(new Date).getTime(),this.videoModel.getCurrentTime(),"pause"),ke.call(this),"MSS"===e.name&&this.manifestExt.getIsDynamic(e)&&_e.call(this)},Le=function(e){var t,n=e.target.error,i="[Stream] <video> error: ";if(n.code!==-1){switch(n.code){case 1:t=T.dependencies.ErrorHandler.prototype.MEDIA_ERR_ABORTED,i+="fetching process aborted";break;case 2:t=T.dependencies.ErrorHandler.prototype.MEDIA_ERR_NETWORK,i+="network error";break;case 3:t=T.dependencies.ErrorHandler.prototype.MEDIA_ERR_DECODE,i+="media decoding error";break;case 4:t=T.dependencies.ErrorHandler.prototype.MEDIA_ERR_SRC_NOT_SUPPORTED,i+="media format not supported";break;case 5:t=T.dependencies.ErrorHandler.prototype.MEDIA_ERR_ENCRYPTED,i+="media is encrypted"}j=!0,this.errHandler.sendError(t,i)}},Me=function(){var e=this.videoModel.getCurrentTime();return this.debug.info("[Stream] <video> seeking event: "+e),1!==Z&&e.toFixed(3)!==R.toFixed(3)?void this.setTrickModeSpeed(1):(e=e<this.getStartTime()?this.getStartTime():e,void Ce.call(this,e))},Re=function(){var e,t,n,i,r,o,s,l,d,u=this,c=.9,h=function(e,t){return u.videoModel.getCurrentTime()===u.getStartTime()||ee?(u.debug.log("[Stream] Trick mode (x"+Z+"): stop"),void(ee&&(l=document.createEvent("Event"),l.initEvent("ended",!0,!0),u.videoModel.getElement().dispatchEvent(l)))):(t<u.getStartTime()?t=u.getStartTime():t>=u.videoModel.getDuration()&&(t=u.videoModel.getDuration()-D,ee=!0),e>0&&u.debug.log("[Stream] Trick mode (x"+Z+"): wait "+e.toFixed(3)+" s"),void(M=setTimeout(function(){L=(new Date).getTime()/1e3,u.debug.log("[Stream] Trick mode (x"+Z+"): seek time = "+t.toFixed(3)),R=t,u.videoModel.setCurrentTime(t)},e>0?1e3*e:0)))};if(this.debug.info("[Stream] <video> seeked event"),Ue.call(this),1!==Z){if(e=(new Date).getTime()/1e3,t=u.videoModel.getCurrentTime(),n=e-x,i=e-L,r=Math.abs(t-S),o=r/n,u.debug.log("[Stream] Trick mode (x"+Z+"): elapsed time = "+n.toFixed(3)+", elapsed video time = "+r.toFixed(3)+", speed = "+o.toFixed(3)),"Changed"===$)clearTimeout(M),$="Running",x=(new Date).getTime()/1e3,S=t,u.debug.info("[Stream] Trick mode (x"+Z+"): videoTime = "+S),I=Math.abs(v/Z)>1?I/Math.abs(v/Z):I,s=t+I*Math.sign(Z),d=0;else if(o<Math.abs(Z)*c){var p=Math.abs(Z/o);I*=Math.round(p)+Math.round(p%D),u.debug.info("[Stream] Trick mode (x"+Z+"): seek step = "+I),s=t+I*Math.sign(Z),d=0}else s=t+I*Math.sign(Z),d=Math.abs(s-S)/Math.abs(Z)-n-i;h.call(u,d,s)}this.videoModel.listen("seeking",a),oe=!1,se=-1,ae=-1},Ae=function(){Ne.call(this)},Pe=function(){Ne.call(this)},we=function(){var e=this.videoModel.getDuration(),n=Number(X.duration.toFixed(3));this.debug.info("[Stream] <video> durationchange event: "+e),!isNaN(e)&&e!==1/0&&e>n&&(this.debug.log("[Stream] Setting duration: "+n),this.mediaSourceExt.setDuration(t,n))},Be=function(){this.debug.info("[Stream] <video> ratechange event: "+this.videoModel.getPlaybackRate()),B&&B.updateStalledState(),N&&N.updateStalledState(),O&&O.updateStalledState()},Fe=function(){ue.call(this),oe=!0,this.system.notify("manifestUpdate",!0)},Ne=function(){B&&B.updateBufferLevel(!0),N&&N.updateBufferLevel(!0),O&&O.updateBufferLevel(!0)},Ce=function(e){this.debug.log("[Stream] startBuffering"+(void 0===e?"":" at time "+e)),B&&(void 0===e?B.start():B.seek(e)),N&&(void 0===e?N.start():N.seek(e)),O&&U&&1===Z&&(void 0===e?O.start():O.seek(e))},Oe=function(){this.debug.log("[Stream] stopBuffering"),B&&B.stop(),N&&N.stop(),O&&O.stop()},Ue=function(){B&&B.seeked(),N&&N.seeked(),O&&O.seeked()},ke=function(){this.scheduleWhilePaused&&!this.manifestExt.getIsDynamic(e)||Oe.call(this),clearInterval(b)},He=function(e){var t=e.target,n=null;if(C===-1){for(var i=0;i<t.length;i++)if(t[i].enabled===!0){n=t[i];break}if("und"!==W&&t.length>1)for(i=0;i<t.length;i++)if(t[i].language===W){n.enabled=!1,t[i].enabled=!0,C=t[i].id;break}}},Ke=function(n){var i=this;e=n;var r="Safari"===m().name,o=g().name.indexOf("Mac")!==-1;if(r===!0&&o===!0&&"M3U"===e.name)console.log("HLS on SAFARI - Stream::doLoad() call this.videoModel.setSource()"),this.videoModel.setSource(e.mpdUrl),z===!0&&this.videoModel.play(),this.videoModel.getElement().audioTracks.addEventListener("addtrack",He,!1);else{i.debug.log("[Stream] Create MediaSource");try{t=i.mediaSourceExt.createMediaSource()}catch(s){i.errHandler.sendError(T.dependencies.ErrorHandler.prototype.MEDIA_ERR_CREATE_MEDIASOURCE,"Failed to create MediaSource",{name:s.name,message:s.message})}if(null===t)return;i.debug.log("[Stream] Setup MediaSource"),he.call(i,t).then(function(e){t=e,i.debug.log("[Stream] Initialize MediaSource"),ge.call(i),i.debug.log("[Stream] Initialize playback"),ye.call(i),i.debug.log("[Stream] Playback initialized")})}},Ve=function(e){this.debug.log("[Stream] Set video model current time: "+e),this.videoModel.unlisten("seeking",a),this.videoModel.setCurrentTime(e)},qe=function(){B&&!B.isBufferingCompleted()||N&&!N.isBufferingCompleted()||t&&(this.debug.info("[Stream] Signal end of stream"),this.mediaSourceExt.signalEndOfStream(t))},ze=function(t){this.debug.info("[Stream] Start time = "+t),Q!==-1&&!this.manifestExt.getIsDynamic(e)&&Q<X.duration&&(this.debug.info("[Stream] Initial start time = "+Q),t=Q),ce.call(this,t,0===X.index&&z)},Ye=function(){var e,t,n;if(this.debug.info("[Stream] Check start time"),e=this.sourceBufferExt.getBufferRange(B.getBuffer(),E,B.getSegmentDuration()),null!==e){if(n=Math.max(E,e.start),N){if(t=this.sourceBufferExt.getBufferRange(N.getBuffer(),E,N.getSegmentDuration()),null===t)return;if(this.debug.info("[Stream] Check start time: A["+t.start+"-"+t.end+"], V["+e.start+"-"+e.end+"]"),t.end<n)return;n=Math.max(n,t.start)}this.debug.info("[Stream] Check start time: OK => "+n),this.system.unmapHandler("bufferUpdated"),this.videoModel.isPaused()?J=n:Ve.call(this,n),de.call(this)}},je=function(t,n,i){var r=-1;return t?i===-1?i:(r=this.manifestExt.getDataIndex(n,e,X.index),r!==i&&("MSS"===e.name&&this.manifestExt.getIsDynamic(e)?this.system.notify("manifestUpdate"):t.updateData(n,X)),r):i},We=function(t){var n,i;if(e=this.manifestModel.getValue(),X=t,this.debug.log("[Stream] Manifest updated ... set new data on buffers."),B&&(n=B.getData(),i=n&&n.hasOwnProperty("id")?this.manifestExt.getDataForId(n.id,e,X.index):this.manifestExt.getDataForIndex(F,e,X.index),B.updateData(i,X)),N&&(i=this.manifestExt.getDataForIndex(C,e,X.index),N.updateData(i,X)),O&&(i=this.manifestExt.getDataForIndex(q,e,X.index),O.updateData(i,X)),ne){var r=this.manifestExt.getEventsForPeriod(e,X);ne.addInlineEvents(r)}oe&&B&&(this.system.unmapHandler("bufferUpdated"),this.system.mapHandler("bufferUpdated",void 0,Ye.bind(this)),B.load()),k&&_e.call(this)},Ge=function(){var e=this.videoModel.getCurrentTime();O.seek(e),O.seeked()},Xe=function(t){var n=this;if(this.debug.log("[Stream] Segment loading failed: start time = "+t.startTime+", duration = "+t.duration),this.manifestExt.getIsDynamic(e)&&null===re){oe=!0;var i=t.duration;this.debug.info("[Stream] Reload session in "+i+" s."),re=setTimeout(function(){re=null,n.system.notify("manifestUpdate",!0),Ee.call(n)},1e3*i)}else ce.call(this,t.startTime+t.duration)},Qe=function(){if(document.hidden!==!0&&se!==-1){var e=(new Date).getTime()/1e3,t=this.getVideoModel().getCurrentTime(),n=e-se,i=t-ae;this.debug.log("[Stream] VisibilityChange: elapsedClockTime = "+n+", elapsedStreamTime = "+i+" ("+(n-i)+")"),n-i>1&&Fe.call(this)}};return{system:void 0,videoModel:void 0,manifestLoader:void 0,manifestModel:void 0,mediaSourceExt:void 0,sourceBufferExt:void 0,manifestExt:void 0,
fragmentController:void 0,fragmentExt:void 0,protectionExt:void 0,capabilities:void 0,debug:void 0,metricsExt:void 0,errHandler:void 0,timelineConverter:void 0,scheduleWhilePaused:void 0,textTrackExtensions:void 0,metricsModel:void 0,eventBus:void 0,notify:void 0,setup:function(){this.system.mapHandler("startTimeFound",void 0,ze.bind(this)),this.system.mapHandler("segmentLoadingFailed",void 0,Xe.bind(this)),this.system.mapHandler("bufferingCompleted",void 0,qe.bind(this)),this[T.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR]=le.bind(this),r=Se.bind(this),o=Ie.bind(this),s=Le.bind(this),a=Me.bind(this),l=Re.bind(this),c=Ae.bind(this),h=Be.bind(this),d=Pe.bind(this),u=we.bind(this),i=be.bind(this),p=ve.bind(this),f=xe.bind(this),_=Te.bind(this),n=De.bind(this),P=Qe.bind(this)},load:function(e,t){X=t,Ke.call(this,e)},setVideoModel:function(e){this.videoModel=e,this.videoModel.listen("play",r),this.videoModel.listen("pause",o),this.videoModel.listen("error",s),this.videoModel.listen("seeking",a),this.videoModel.listen("seeked",l),this.videoModel.listen("timeupdate",d),this.videoModel.listen("durationchange",u),this.videoModel.listen("progress",c),this.videoModel.listen("ratechange",h),this.videoModel.listen("loadedmetadata",i),this.videoModel.listen("ended",n),this.videoModel.listen("canplay",p),this.videoModel.listen("playing",f),this.videoModel.listen("loadstart",_)},setInitialStartTime:function(e){var t=parseFloat(e);isNaN(t)||(Q=t)},setAudioTrack:function(e){if(K&&K.stop(),N)C=je.call(this,N,e,C);else{var t=this.videoModel.getElement().audioTracks,n=t.getTrackById(e.id);if(n){for(var i=0;i<t.length;i++)if(t[i].enabled===!0){t[i].enabled=!1;break}n.enabled=!0,console.info("[Stream] setAudioTrack : "+t[i].id+" ("+t[i].language+") --> "+n.id+" ("+n.language+")")}}},getSelectedAudioTrack:function(){if(N)return this.manifestExt.getDataForIndex(C,e,X.index);for(var t=this.videoModel.getElement().audioTracks,n=0;n<t.length;n++)if(t[n].enabled===!0){var i={};return i.id=t[n].id,i.lang=t[n].language,i.subType=t[n].kind,i}},getAvailableAudioTracks:function(){if(N)return this.manifestExt.getAudioDatas(e,X.index);for(var t=this.videoModel.getElement().audioTracks,n=[],i=0;i<t.length;i+=1)n.push({id:t[i].id,lang:t[i].language,subType:t[i].kind});return n},setSubtitleTrack:function(e){if(V&&V.stop(),O)q=je.call(this,O,e,q);else{for(var t=this.videoModel.getElement().textTracks,n=e.id.substring(0,e.id.indexOf(".",0)),i=e.id.substring(1+e.id.indexOf(".",0)),r=null,o=0;o<t.length;o++)if("metadata"!==t[o].kind&&t[o].id===n&&t[o].label===i){r=t[o];break}if(r){for(o=0;o<t.length;o++)if("showing"===t[o].mode){t[o].mode="disabled",console.info("[Stream] setSubtitleTrack disable : "+t[o].label+"("+t[o].language+")");break}r.mode="showing",console.info("[Stream] setSubtitleTrack showing : "+r.label+" ("+r.language+")")}}},getSelectedSubtitleTrack:function(){if(U){if(O)return this.manifestExt.getDataForIndex(q,e,X.index);for(var t=this.videoModel.getElement().textTracks,n=0;n<t.length;n++)if("showing"===t[n].mode){var i={};return i.id=t[n].id+"."+t[n].label,i.lang=t[n].language,i.subType=t[n].kind,i}}},getAvailableSubtitleTracks:function(){if(O)return this.manifestExt.getTextDatas(e,X.index);for(var t=this.videoModel.getElement().textTracks,n=[],i=0;i<t.length;i+=1)n.push({id:t[i].id+"."+t[i].label,lang:t[i].language,subType:t[i].kind});return n},initProtection:function(e){A=e,A&&A.subscribe(T.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,this)},getVideoModel:function(){return this.videoModel},getManifestExt:function(){var e=this;return e.manifestExt},setAutoPlay:function(e){z=e},setDefaultAudioLang:function(e){W=e},setDefaultSubtitleLang:function(e){G=e},getAutoPlay:function(){return z},reset:function(){var e=y.defer(),t=this;return this.debug.info("[Stream] Reset"),Oe.call(this),Ee.call(this),ue.call(this),clearTimeout(M),clearTimeout(re),1!==Z&&this.videoModel.setMute(te),this.videoModel.unlisten("play",r),this.videoModel.unlisten("pause",o),this.videoModel.unlisten("error",s),this.videoModel.unlisten("seeking",a),this.videoModel.unlisten("seeked",l),this.videoModel.unlisten("timeupdate",d),this.videoModel.unlisten("durationchange",u),this.videoModel.unlisten("progress",c),this.videoModel.unlisten("ratechange",h),this.videoModel.unlisten("loadedmetadata",i),this.videoModel.unlisten("ended",n),this.videoModel.unlisten("canplay",p),this.videoModel.unlisten("playing",f),this.videoModel.unlisten("loadstart",_),this.system.unmapHandler("streamsComposed",void 0,Ge),this.system.unmapHandler("bufferUpdated"),this.system.unmapHandler("startTimeFound"),this.system.unmapHandler("segmentLoadingFailed"),this.system.unmapHandler("bufferingCompleted"),pe.call(this).then(function(){A&&A.unsubscribe(T.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,t),A=void 0,t.fragmentController=void 0,e.resolve()}),e.promise},getDuration:function(){return X.duration},getStartTime:function(){return X.start},getPeriodIndex:function(){return X.index},getId:function(){return X.id},getPeriodInfo:function(){return X},getMinbufferTime:function(){return B?B.getMinbufferTime():T.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME},getLiveDelay:function(){return B?B.getLiveDelay():T.dependencies.BufferExtensions.DEFAULT_LIVE_DELAY},startEventController:function(){ne.start()},resetEventController:function(){ne.reset()},enableSubtitles:function(t){var n;if(t!==U)if(U=t,n=this.textTrackExtensions.getCurrentTextTrack(this.videoModel.getElement()),this.textTrackExtensions.cleanSubtitles(),O)t?("MSS"===e.name&&this.manifestExt.getIsDynamic(e)?(this.system.mapHandler("streamsComposed",void 0,Ge.bind(this),!0),this.system.notify("manifestUpdate")):Ge.call(this),n&&"metadata"!==n.kind&&"showing"!==n.mode?n.mode="showing":n&&(n.mode="hidden")):(V&&V.stop(),n&&(n.mode="disabled"),O.stop());else{var i=this.videoModel.getElement().textTracks;if(!i)return;var r=0,o=!1;if(t){if("und"!==W)for(r=0;r<i.length;r++)if(i[r].language===G){i[r].mode="showing",o=!0;break}if(!o)for(r=0;r<i.length;r++)if("forced"===i[r].kind){i[r].mode="showing",o=!0;break}o||(i[0].mode="showing")}else for(r=0;r<i.length;r++)i[r].mode="disabled"}},setTrickModeSpeed:function(e){var t,n,i=[],r=this,o=1!==e,s=function(){r.videoModel.getCurrentTime()>t+1&&(r.videoModel.unlisten("timeupdate",s),r.debug.info("[Stream] Set mute: "+te+", the mute state before using trick mode."),r.videoModel.setMute(te))};e!==Z&&B&&(r.debug.info("[Stream] Trick mode: speed = "+e),o&&"Stopped"===$?(r.debug.info("[Stream] Set mute: true"),te=r.videoModel.getMute(),te||r.videoModel.setMute(!0),r.videoModel.pause()):o||(Z=1,clearTimeout(M),this.videoModel.pause(),Oe.call(r)),i.push(B.setTrickMode(o,e>1)),N&&i.push(N.setTrickMode(o,e>1)),y.all(i).then(function(){v=Z,Z=e,t=r.videoModel.getCurrentTime(),o?"Running"===$?$="Changed":"Stopped"===$&&(ee=!1,$="Running",I=D=B.getSegmentDuration(),x=L=(new Date).getTime()/1e3,S=t,r.debug.info("[Stream] Trick mode (x"+Z+"): videoTime = "+S),n=t+I*Math.sign(Z),n=Math.round(1e3*(n-n%D))/1e3,r.debug.info("[Stream] Trick mode (x"+Z+"): seek step = "+I),R=n,ce.call(r,n)):(r.debug.info("[Stream] Trick mode: Stopped, current time = "+t),$="Stopped",r.videoModel.listen("timeupdate",s),t=ee?r.getStartTime():t,ce.call(r,t,!0))}))},getTrickModeSpeed:function(){return Z},updateData:We,play:de,seek:ce,pause:ue}},T.dependencies.Stream.prototype={constructor:T.dependencies.Stream},T.dependencies.StreamController=function(){"use strict";var e,t,n,i,r,o,s,a,l,d,u,c=!1,h=[],p=!1,f=6,m=.2,g=!0,_=!1,E="und",b="und",v=!1,x=!1,S=null,D=function(e,t){var n=e.getElement(),i=t.getElement();return i.parentNode||n.parentNode.insertBefore(i,n),n.style.width="0px",i.style.width="100%",M(n,i),L.call(this,e),I.call(this,t),!0},I=function(e){e.listen("seeking",r),e.listen("progress",o),e.listen("timeupdate",i),e.listen("pause",s),e.listen("play",a)},L=function(e){e.unlisten("seeking",r),e.unlisten("progress",o),e.unlisten("timeupdate",i),e.unlisten("pause",s),e.unlisten("play",a)},M=function(e,t){["controls","loop","muted","playbackRate","volume"].forEach(function(n){t[n]=e[n]})},R=function(){var e=t.getVideoModel().getElement().buffered;if(e.length){var n=e.length-1,i=e.end(n),r=t.getStartTime()+t.getDuration()-i;r<f&&(t.getVideoModel().unlisten("progress",o),N())}},A=function(e,n,i){!_&&e&&n&&e!==n&&(_=!0,e.pause(),t=n,D.call(this,e.getVideoModel(),n.getVideoModel()),i?this.seek(e.getVideoModel().getCurrentTime()):this.seek(n.getStartTime()),this.play(),e.resetEventController(),t.startEventController(),_=!1)},P=function(){var e=this,n=new Date,i=t.getStartTime()+t.getDuration(),r=t.getVideoModel().getElement(),o=r.currentTime,s=e.videoExt.getPlaybackQuality(r);e.metricsModel.addPlaybackQuality("video",n,s,o),e.metricsModel.addVideoResolution("video",n,r.videoWidth,r.videoHeight,o),C()&&(t.getVideoModel().getElement().seeking||i-o<m&&A.call(this,t,C()))},w=function(){var e=t.getVideoModel().getCurrentTime(),n=O(e);this.metricsModel.addState("video","seeking",t.getVideoModel().getCurrentTime()),n&&n!==t&&A.call(this,t,n,e)},B=function(){this.manifestUpdater.stop(),this.metricsModel.addState("video","paused",t.getVideoModel().getCurrentTime())},F=function(){this.manifestUpdater.start()},N=function(){var e=C();e&&e.seek(e.getStartTime())},C=function(){var e=t.getPeriodIndex()+1;return e<h.length?h[e]:null},O=function(e){var t=0,n=null,i=h.length,r=0;for(i>0&&(t+=h[0].getStartTime()),r=0;r<i;r+=1)if(n=h[r],t+=n.getDuration(),e<t)return n},U=function(){var e=this.system.getObject("videoModel"),t=document.createElement("video");return e.setElement(t),e},k=function(e){e.parentNode&&e.parentNode.removeChild(e)},H=function(){var i,r,o,s,a,l,d,c,f,m=this,y=m.manifestModel.getValue(),_=m.metricsModel.getMetricsFor("stream"),x=m.metricsExt.getCurrentManifestUpdate(_);if(!y)return!1;if(this.debug.info("[StreamController] composeStreams"),m.capabilities.supportsEncryptedMedia()&&(n||(n=m.system.getObject("protectionController"),p=!0),n.setMediaElement(m.videoModel.getElement()),u&&n.setProtectionData(u)),c=m.manifestExt.getMpd(y),t&&(i=t.getPeriodInfo(),c.isClientServerTimeSyncCompleted=i.mpd.isClientServerTimeSyncCompleted,c.clientServerTimeShift=i.mpd.clientServerTimeShift),r=m.manifestExt.getRegularPeriods(y,c),0===r.length)return!1;for(a=0,o=r.length;a<o;a+=1){for(d=r[a],l=0,s=h.length;l<s;l+=1)h[l].getId()===d.id&&(f=h[l],this.debug.info("[StreamController] update stream data"),f.updateData(d));f||(this.debug.info("[StreamController] Create stream"),f=m.system.getObject("stream"),f.setVideoModel(0===a?m.videoModel:U.call(m)),f.initProtection(n),f.setAutoPlay(g),f.setDefaultAudioLang(E),f.setDefaultSubtitleLang(b),f.enableSubtitles(v),f.setInitialStartTime(e.startTime),f.load(y,d),h.push(f)),m.metricsModel.addManifestUpdatePeriodInfo(x,d.id,d.index,d.start,d.duration),f=null}return t||(t=h[0],I.call(m,t.getVideoModel())),m.metricsModel.updateManifestUpdateInfo(x,{currentTime:m.videoModel.getCurrentTime(),buffered:m.videoModel.getElement().buffered,presentationStartTime:r[0].start,clientTimeOffset:c.clientServerTimeShift}),S&&(S.resolve(),S=null),!0},K=function(){t&&(l=this.manifestExt.getAudioDatas(this.manifestModel.getValue(),t.getPeriodIndex()),this.system.notify("audioTracksUpdated"))},V=function(){t&&(d=this.manifestExt.getTextDatas(this.manifestModel.getValue(),t.getPeriodIndex()),this.system.notify("subtitleTracksUpdated"))},q=function(e){e===!0&&(x=!0),this.refreshManifest()},z=function(){if(!c)return void(S&&(S.resolve(),S=null));this.debug.info("[StreamController] Manifest updated");var e=H.call(this);e?(K.call(this),V.call(this),this.system.notify("streamsComposed")):this.errHandler.sendError(T.dependencies.ErrorHandler.prototype.MANIFEST_ERR_NO_STREAM,"No stream/period is provided in the manifest"),S&&(S.resolve(),S=null)};return{system:void 0,videoModel:void 0,parser:void 0,manifestLoader:void 0,manifestUpdater:void 0,manifestModel:void 0,manifestExt:void 0,fragmentExt:void 0,capabilities:void 0,debug:void 0,metricsModel:void 0,metricsExt:void 0,videoExt:void 0,errHandler:void 0,eventBus:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.system.mapHandler("manifestUpdate",void 0,q.bind(this)),this.system.mapHandler("manifestUpdated",void 0,z.bind(this)),i=P.bind(this),o=R.bind(this),r=w.bind(this),s=B.bind(this),a=F.bind(this)},getManifestExt:function(){return t.getManifestExt()},setAutoPlay:function(e){g=e},getAutoPlay:function(){return g},getVideoModel:function(){return this.videoModel},setVideoModel:function(e){this.videoModel=e},getAudioTracks:function(){return t&&(l=t.getAvailableAudioTracks()),l},getSelectedAudioTrack:function(){if(t)return t.getSelectedAudioTrack()},setAudioTrack:function(e){t&&t.setAudioTrack(e)},getSubtitleTracks:function(){return t&&(d=t.getAvailableSubtitleTracks()),d},setSubtitleTrack:function(e){t&&t.setSubtitleTrack(e)},getSelectedSubtitleTrack:function(){if(t)return t.getSelectedSubtitleTrack()},getMinbufferTime:function(){return t?t.getMinbufferTime():T.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME},getLiveDelay:function(){return t?t.getLiveDelay():T.dependencies.BufferExtensions.DEFAULT_LIVE_DELAY},load:function(t){var n=this;c=!0,e=t,e.protData&&(u=e.protData),x=!1,S=y.defer(),n.debug.info("[StreamController] load url: "+e.url),n.manifestLoader.load(e.url).then(function(e){n.manifestModel.setValue(e),n.metricsModel.addMetaData(),n.debug.info("[StreamController] Manifest has loaded."),n.manifestUpdater.start()},function(e){S.resolve(),S=null,e&&n.errHandler.sendError(e.name,e.message,e.data)})},refreshManifest:function(e){var t=this.manifestModel.getValue(),n=e?e:t.hasOwnProperty("Location")?t.Location:t.mpdUrl;this.debug.log("[StreamController] Refresh manifest: "+n);var i=this;this.manifestLoader.abort(),this.manifestLoader.load(n,!0).then(function(e){i.manifestModel.setValue(e),i.debug.log("[StreamController] Manifest has been refreshed"),x=!1},function(t){void 0!==t&&(e?x&&i.errHandler.sendError(t.name,t.message,t.data):(i.errHandler.sendWarning(t.name,t.message,t.data),i.eventBus.dispatchEvent({type:"manifestUrlUpdate",data:{url:n}})))})},reset:function(e){var i={},r=[],o=this;this.debug.info("[StreamController] Reset"),t&&L.call(this,t.getVideoModel()),c=!1,o.manifestLoader.abort(),o.manifestUpdater.stop(),o.parser.reset(),y.when(!S||S.promise).then(function(){o.pause(),o.metricsModel.clearAllCurrentMetrics(),_=!1,i[T.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE]=function(){var i,s,a=0;for(p=!1,n=null,u=null,a=0,i=h.length;a<i;a+=1)s=h[a],r.push(s.reset()),s!==t&&k(s.getVideoModel().getElement());o.videoModel.reset(),y.all(r).then(function(){h=[],t=null,o.metricsModel.addState("video","stopped",o.videoModel.getCurrentTime(),e),o.notify(T.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE)}),o.manifestModel.setValue(null)},n?p?(n.protectionModel.subscribe(T.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE,i,void 0,!0),n.teardown()):(n.setMediaElement(null),i[T.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE]()):i[T.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE]()})},setDefaultAudioLang:function(e){E=e},setDefaultSubtitleLang:function(e){b=e},enableSubtitles:function(e){v=e,t&&t.enableSubtitles(e)},setTrickModeSpeed:function(e){t&&t.setTrickModeSpeed(e)},getTrickModeSpeed:function(){return t?t.getTrickModeSpeed():0},play:function(){t.play()},pause:function(){t&&t.pause()},seek:function(e,n){t&&t.seek(e,n)}}},T.dependencies.StreamController.prototype={constructor:T.dependencies.StreamController},T.dependencies.StreamController.eventList={ENAME_STREAMS_COMPOSED:"streamsComposed",ENAME_TEARDOWN_COMPLETE:"streamTeardownComplete"},T.utils.TokenAuthentication=function(){"use strict";var e={type:T.utils.TokenAuthentication.TYPE_QUERY};return{debug:void 0,getTokenAuthentication:function(){return e},setTokenAuthentication:function(t){e=t},checkRequestHeaderForToken:function(t){void 0!==e.name&&null!==t.getResponseHeader(e.name)&&(e.token=t.getResponseHeader(e.name),this.debug.log(e.name+" received: "+e.token))},addTokenAsQueryArg:function(t){if(void 0!==e.name&&void 0!==e.token&&e.type===T.utils.TokenAuthentication.TYPE_QUERY){var n=t.indexOf("?")===-1?"?":"&";t+=n+e.name+"="+e.token,this.debug.log(e.name+" is being appended on the request url with a value of : "+e.token)}return t},setTokenInRequestHeader:function(t){return e.type===T.utils.TokenAuthentication.TYPE_HEADER&&(t.setRequestHeader(e.name,e.token),this.debug.log(e.name+" is being set in the request header with a value of : "+e.token)),t}}},T.utils.TokenAuthentication.TYPE_QUERY="query",T.utils.TokenAuthentication.TYPE_HEADER="header",T.models.URIQueryAndFragmentModel=function(){"use strict";var e=new T.vo.URIFragmentData,t=[],n=function(){e=new T.vo.URIFragmentData,t=[]},i=function(n){function i(e,t,n,i){var r=i[0].split(/[=]/);return i.push({key:r[0],value:r[1]}),i.shift(),i}function r(e,n,i){return n>0&&(d&&0===t.length?t=i[n].split(/[&]/):u&&(s=i[n].split(/[&]/))),i}var o,s=[],a=new RegExp(/[?]/),l=new RegExp(/[#]/),d=a.test(n),u=l.test(n);return o=n.split(/[?#]/).map(r),t.length>0&&(t=t.reduce(i,null)),s.length>0&&(s=s.reduce(i,null),s.forEach(function(t){e[t.key]=t.value})),n};return{parseURI:i,reset:n,getURIFragmentData:function(){return e},getURIQueryData:t}},T.models.URIQueryAndFragmentModel.prototype={constructor:T.models.URIQueryAndFragmentModel},T.models.VideoModel=function(){"use strict";var e,t={},n=null,i=function(){for(var e in t)if(t[e]===!0)return!0;return!1},r=function(n,r){t[n]=r,i()?(this.debug.info("<video> setPlaybackRate(0)"),e.playbackRate=0):(this.debug.info("<video> setPlaybackRate(1)"),e.playbackRate=1)};return{system:void 0,debug:void 0,setup:function(){},reset:function(){t=[]},play:function(){this.debug.info("<video> play()"),e.play()},pause:function(){this.debug.info("<video> pause()"),e.pause()},isPaused:function(){return e.paused},isSeeking:function(){return e.seeking},getDuration:function(){return e.duration},getPlaybackRate:function(){return e.playbackRate},setPlaybackRate:function(t){this.debug.info("<video> setPlaybackRate("+t+")"),e.playbackRate=t},getMute:function(){return e.muted},setMute:function(t){e.muted=t},getVolume:function(){return e.volume},setVolume:function(t){e.volume=t},getCurrentTime:function(){return e.currentTime},setCurrentTime:function(t){this.debug.info("<video> setCurrentTime ("+t+")"),e.currentTime=t},listen:function(t,n){e.addEventListener(t,n,!1)},unlisten:function(t,n){e.removeEventListener(t,n,!1)},listenOnParent:function(t,n){e.parentElement.addEventListener(t,n,!1)},unlistenOnParent:function(t,n){e.parentElement.removeEventListener(t,n,!1)},getElement:function(){return e},setElement:function(t){e=t},setSource:function(t){e.src=t},isStalled:function(){return 0===e.playbackRate},getTTMLRenderingDiv:function(){return n},setTTMLRenderingDiv:function(e){n=e,n.style.position="absolute",n.style.display="flex",n.style.overflow="hidden",n.style.pointerEvents="none",n.style.top=0,n.style.left=0},stallStream:r}},T.models.VideoModel.prototype={constructor:T.models.VideoModel},T.dependencies.VideoModelExtensions=function(){"use strict";return{getPlaybackQuality:function(e){var t="webkitDroppedFrameCount"in e,n="getVideoPlaybackQuality"in e,i=null;return n?i=e.getVideoPlaybackQuality():t&&(i={droppedVideoFrames:e.webkitDroppedFrameCount,creationTime:new Date,totalVideoFrames:e.webkitDecodedFrameCount}),i}}},T.dependencies.VideoModelExtensions.prototype={constructor:T.dependencies.VideoModelExtensions},T.dependencies.XHRLoader=function(){"use strict";var e=null,t=null,n=null,i=null,r=null,o=0,s=0,a=0,l=null,d=null,u=function(){null!==e&&e.readyState>0&&e.readyState<4?e.abort():l&&(clearTimeout(l),l=null,d.reject())},c=function(){var u=!0,h=function(t){r&&r(e,t)},p=function(){e.aborted=!0},f=function(){e.status<200||e.status>299||200===e.status&&4===e.readyState&&(u=!1,e.endDate=new Date,d.resolve(e))},m=function(){u&&(u=!1,e.endDate=new Date,a++,!e.aborted&&o>0&&a<=o?l=setTimeout(function(){c()},s):d.reject(e))};try{e=new XMLHttpRequest,n&&(e.responseType=n),i&&e.setRequestHeader("Range","bytes="+i),e.onprogress=h,e.onabort=p,e.onload=f,e.onloadend=m,e.onerror=m,e.startDate=new Date,e.open("GET",t,!0),e.send()}catch(g){e.onerror()}};return{initialize:function(e,t,i,a){n=e,o=t,s=i,r=a},load:function(e,n){return t=e,i=n,a=0,d=y.defer(),c(),d.promise},abort:u}},T.dependencies.XHRLoader.prototype={constructor:T.dependencies.XHRLoader},T.utils.TTMLParser=function(){"use strict";var e=3600,t=60,n="http://www.w3.org/2006/10/ttaf1",i="http://www.w3.org/2006/10/ttaf1#parameter",r="http://www.w3.org/2006/10/ttaf1#styling",o="http://www.w3.org/ns/ttml",s="http://www.w3.org/ns/ttml#parameter",a="http://www.w3.org/ns/ttml#styling",l="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",d=[o,n],u=[a,r],c=[s,i],h=[l],p=/^(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])((\.[0-9][0-9][0-9])|(:[0-9][0-9]))$/,f=/^\d+(\.\d+|)(h|m|s|ms|f)$/,m=null,g=null,_=null,E=null,b=null,v=null,x=null,T=[],S=[],D=[],I=function(n){var i,r,o;if(p.test(n))return i=n.split(":"),r=parseFloat(i[0])*e+parseFloat(i[1])*t+parseFloat(i[2]),i[3]&&x&&!isNaN(x)&&(r+=parseFloat(i[3])/x),r;if(f.test(n)){switch("ms"==n.substr(n.length-2)?(r=parseFloat(n.substr(0,n.length-3)),o=n.substr(n.length-2)):(r=parseFloat(n.substr(0,n.length-2)),o=n.substr(n.length-1)),o){case"h":r=60*r*60;break;case"m":r=60*r;break;case"s":break;case"ms":r=.01*r;break;case"f":if(!x||isNaN(x))return NaN;r/=x}return r}return NaN},L=function(){var e=!1;return g=m?this.domParser.getChildNode(m,"tt"):null,_=g?this.domParser.getChildNode(g,"head"):null,E=_?this.domParser.getChildNode(_,"layout"):null,b=_?this.domParser.getChildNode(_,"styling"):null,v=g?this.domParser.getChildNode(g,"body"):null,g&&_&&v&&(e=!0),e},M=function(e,t,n){var i,r,o=null,s=0;for(s=0;s<e.length;s+=1){if(o=A.call(this,[e[s]],u,t))return o;if(i=A.call(this,[e[s]],d,"style")){if(o=R.call(this,T,i,t))return o;for(i=R.call(this,T,i,"style");i;){if(o=R.call(this,T,i,t))return o;i=R.call(this,T,i,"style")}}if(r=A.call(this,[e[s]],d,"region")){if(o=R.call(this,S,r,t))return o;if(i=R.call(this,S,r,"style")){if(o=R.call(this,T,i,t))return o;for(i=R.call(this,T,i,"style");i;){if(o=R.call(this,T,i,t))return o;i=R.call(this,T,i,"style")}}}}return void 0!==n?n:null},R=function(e,t,n){var i=0,r=null,o=0;for(i=0;i<e[t].length;i+=1){for(o=0;o<u.length;o+=1)if(r=e[t].getNamedItem(n),r||(r=e[t].getNamedItemNS(u[o],n)),r)return r.nodeValue;for(o=0;o<d.length;o+=1)if(r=e[t].getNamedItem(n),r||(r=e[t].getNamedItemNS(d[o],n)),r)return r.nodeValue}return null},A=function(e,t,n){var i=null,r=0,o=0;for(r=0;r<e.length;r+=1)for(o=0;o<t.length;o+=1)if(i=this.domParser.getAttributeValue(e[r],n,t[o]))return i;return i},P=function(e){e||(e="32 15");var t=e,n=0;for(t=t.split(" "),n=0;n<t.length;n+=1)t[n]=parseFloat(t[n]);return t},w=function(e,t){var n={backgroundColor:null,color:null,fontSize:null,fontFamily:null,fontStyle:null,textOutline:{color:null,"with":null},textAlign:null,displayAlign:null,origin:null,extent:null,cellResolution:null,rootExtent:t,showBackground:null};return n.backgroundColor=M.call(this,e,"backgroundColor","transparent"),n.color=M.call(this,e,"color"),n.fontSize=M.call(this,e,"fontSize"),n.fontFamily=M.call(this,e,"fontFamily"),n.fontStyle=M.call(this,e,"fontStyle","normal"),n.textOutline=M.call(this,e,"textOutline"),n.extent=M.call(this,e,"extent"),n.origin=M.call(this,e,"origin"),n.textAlign=M.call(this,e,"textAlign","start"),n.displayAlign=M.call(this,e,"displayAlign","before"),n.showBackground=M.call(this,e,"showBackground"),n.cellResolution=A.call(this,e,c,"cellResolution"),n.cellResolution=P(n.cellResolution),n},B=function(e){var t,n,i,r,o,s,a,l,u,p,f,_,E,b,R,P=[],B=null,F=null,N=null,C="",O="";try{if(null!==this.videoModel.getTTMLRenderingDiv()&&(O="html"),m=this.domParser.createXmlTree(e),!L.call(this))return t="TTML document has incorrect structure",y.reject(t);for(l=0;l<c.length;l+=1)x=this.domParser.getAttributeValue(g,"frameRate",c[l])?parseInt(x,10):null;if(a=this.domParser.getChildNodes(v,"div"),!a||0===a.length)return t="TTML body document does not contain any div",y.reject(t);for(T=this.domParser.getAllSpecificNodes(g,"style"),S=this.domParser.getAllSpecificNodes(g,"region"),D=this.domParser.getAllSpecificNodes(g,"image"),_=M.call(this,[g],"extent"),f=0;f<a.length;f+=1)if(b=A.call(this,[a[f]],h,"backgroundImage"),b&&void 0!==D[b.substring(1)]&&(r=I(A.call(this,[a[f]],d,"begin")),o=I(A.call(this,[a[f]],d,"end")),N=w.call(this,[a[f],g],_),s={start:r,end:o,data:"data:image/"+D[b.substring(1)].imagetype.nodeValue+";base64, "+this.domParser.getChildNode(D[b.substring(1)],"#text").nodeValue,type:"image",line:80,style:N},P.push(s)),n=this.domParser.getChildNodes(a[f],"p"),n&&0!==n.length)for(l=0;l<n.length;l+=1)if(s=null,N=null,i=n[l],r=I(A.call(this,[i],d,"begin")),o=I(A.call(this,[i],d,"end")),isNaN(r)||isNaN(o)||o<r)t="TTML document has incorrect timing value";else if(b=A.call(this,[i],h,"backgroundImage"),b&&void 0!==D[b.substring(1)]&&(N=w.call(this,[i,a[f],g],_),s={start:r,end:o,data:"data:image/"+D[b.substring(1)].imagetype.nodeValue+";base64, "+this.domParser.getChildNode(D[b.substring(1)],"#text").nodeValue,type:"image",line:80,style:N}),u=this.domParser.getChildNodes(i,"span"),u.length>0){for(p=0;p<u.length;p++){p>0&&(C+="\n"),0===p&&(N=w.call(this,[u[p],i,v,g,a[f]],_)),E=this.domParser.getTextNodesIn(u[p]);for(var U=0;U<E.length;U+=1)U>0&&(C+="\n"),C+=E[U].textContent}s={start:r,end:o,data:C,type:"text",line:80,style:N},C="",P.push(s)}else{if(N=w.call(this,[i,v,g],_),l>0&&(B=I(A.call(this,[n[l-1]],d,"begin")),F=I(A.call(this,[n[l-1]],d,"end"))),r===B&&o===F||r>=B&&o<=F)""!==i.textContent&&("html"===O?s={start:r,end:o,data:i.textContent,type:"text",line:80,style:N}:(r>=B&&o<=F?(R=P[P.length-1],R.end=r):R=P.pop(),s={start:r,end:o,data:R.data+"\n"+i.textContent,type:"text",line:80,style:N}));else{for(E=this.domParser.getTextNodesIn(i),p=0;p<E.length;p+=1)p>0&&(C+="\n"),C+=E[p].textContent;""!==C&&(s={start:r,end:o,data:C,type:"text",line:80,style:N},C="")}null!==s&&P.push(s)}else t="TTML document does not contain any cues";return P.length>0?y.when(P):y.reject(t)}catch(k){return t=k.message,y.reject(t)}};return{domParser:void 0,videoModel:void 0,parse:B}},T.utils.TTMLRenderer=function(){"use strict";var e,t=[],n=function(){var n=0;for(n=0;n<t.length;n++)u(t[n],t[n].ttmlStyle,e)},i=function(){this.cleanSubtitles()},r=function(){var t=document.createElement("div");return t.style.position="absolute",t.style.display="flex",t.style.flexDirection="row",t.style.overflow="initial",t.style.pointerEvents="none",e.appendChild(t),t},o=function(t){e.hasChildNodes()&&e.removeChild(t)},s=function(e,t){var n,i;if(e&&"%"===e[e.length-1])n=parseFloat(e.substr(0,e.length-1))/100*t[1]+"px";else if(e&&"x"===e[e.length-1])n=e;else if(e&&"c"===e[e.length-1]){var r=e.replace(/\s/g,"").split("c");for(i=0;i<r.length;i+=1)r[i]=parseFloat(r[i]);n=isNaN(r[1])?r[0]*t[1]+"px":r[1]*t[1]+"px"}else n=t[1]+"px";return n},a=function(e,t,n){var i,r={color:n,width:null},o=0;if(e&&(e=e.split(" "),e[0]&&isNaN(e[0][0])?(r.color=e[0],o=1):r.color=n,r.color&&"#"===r.color[0]&&(r.color=l(r.color)),e[o]))switch(i=e[o][e[o].length-1]){case"c":e[o]=e[o].split("c"),e[o][0]&&(r.width=e[o][0]*t[1]+"px");break;case"x":r.width=e[o]}return r},l=function(e){e=e.replace("#","");var t=parseInt(e.substring(0,2),16),n=parseInt(e.substring(2,4),16),i=parseInt(e.substring(4,6),16),r=e.length>6?parseInt(e.substring(6,8),16):255,o="rgba("+t+","+n+","+i+","+r+")";return o},d=function(e){var t,n,i=e;return t=e.replace(/^(rgb|rgba)\(/,"").replace(/\)$/,"").replace(/\s/g,"").split(","),t[t.length-1]>1&&(n=parseInt(t[t.length-1],10)/255,i="rgba("+t[0]+","+t[1]+","+t[2]+","+n+")"),i},u=function(e,t,n){var i,r,o,u,c=[n.clientWidth/t.cellResolution[0],n.clientHeight/t.cellResolution[1]];if(e){if(t.backgroundColor&&"#"===t.backgroundColor[0]?t.backgroundColor=l(t.backgroundColor):t.backgroundColor&&"a"===t.backgroundColor[3]&&(t.backgroundColor=d(t.backgroundColor)),t.color&&"#"===t.color[0]?t.color=l(t.color):t.color&&"a"===t.color[3]&&(t.color=d(t.color)),t.origin&&"%"===t.origin[t.origin.length-1])i=t.origin.split("%"),e.style.left=parseInt(i[0],10)+"%",e.style.top=parseInt(i[1],10)+"%",t.extent&&"%"===t.extent[t.extent.length-1]&&(r=t.extent.split("%"),e.style.width=parseInt(r[0],10)+"%",e.style.height=parseInt(r[1],10)+"%");else if(t.origin&&"x"===t.origin[t.origin.length-1])if(i=t.origin.split("px"),t.rootExtent&&"x"===t.rootExtent[t.rootExtent.length-1]){u=t.rootExtent.split("px");var h=i[0]/u[0]*n.clientWidth;e.style.left=h/n.clientWidth*100+"%",h=i[1]/u[1]*n.clientHeight,e.style.top=h/n.clientHeight*100+"%",t.extent&&"x"===t.extent[t.extent.length-1]&&(r=t.extent.split("px"),h=r[0]/u[0]*n.clientWidth,e.style.width=h/n.clientWidth*100+"%",h=r[1]/u[1]*n.clientHeight,e.style.height=h/n.clientHeight*100+"%")}else e.style.left=i[0]+"px",e.style.top=i[1]+"px";else t.origin&&"c"===t.origin[t.origin.length-1]&&(i=t.origin.split("c"),e.style.left=i[0]*c[0]+"px",e.style.top=i[1]*c[1]+"px",t.extent&&"c"===t.extent[t.extent.length-1]&&(r=t.extent.split("c"),e.style.width=r[0]*c[0]+"px",e.style.height=r[1]*c[1]+"px"));switch(o=a(t.textOutline,c,t.color),e.style.webkitTextStrokeWidth=o.width,e.style.webkitTextStroke=o.color,t.textAlign){case"start":e.style.justifyContent="flex-start";break;case"end":e.style.justifyContent="flex-end";break;case"center":e.style.justifyContent="center";break;case"right":e.style.justifyContent="flex-end";break;case"left":e.style.justifyContent="flex-start";break;default:e.style.justifyContent="flex-start"}switch(t.displayAlign){case"before":e.style.alignItems="flex-start";break;case"center":e.style.alignItems=t.displayAlign;break;case"after":e.style.alignItems="flex-end";break;default:e.style.alignItems="flex-start"}e.style.fontStyle=t.fontStyle,t.showBackground&&"whenActive"===t.showBackground?e.style.backgroundColor="transparent":e.style.backgroundColor=t.backgroundColor,e.style.color=t.color,e.style.fontSize=s(t.fontSize,c),e.style.fontFamily=t.fontFamily}};return{videoModel:void 0,initialize:function(t){e=t,document.addEventListener("webkitfullscreenchange",n.bind(this)),document.addEventListener("mozfullscreenchange",n.bind(this)),document.addEventListener("fullscreenchange",n.bind(this)),this.videoModel.listen("seeking",i.bind(this))},cleanSubtitles:function(){var e=0;for(e=0;e<t.length;e++)o(t[e]);t=[]},onCueEnter:function(n){var i=r();if(n.currentTarget.style&&(u(i,n.currentTarget.style,e),i.ttmlStyle=n.currentTarget.style),"image"!==n.currentTarget.type){var o=document.createElement("p");i.appendChild(o),o.innerText=n.currentTarget.text,o.style.marginTop="auto",i.ttmlStyle&&i.ttmlStyle.showBackground&&"whenActive"===i.ttmlStyle.showBackground&&(o.style.backgroundColor=n.currentTarget.style.backgroundColor)}else{var s=new Image;s.style.height="auto",s.style.width="auto",s.src=n.currentTarget.text,i.appendChild(s)}i.data=n.currentTarget.text,t.push(i)},onCueExit:function(e){var n=0;for(n=0;n<t.length&&(e.currentTarget.text!==t[n].data||t[n].ttmlStyle!==e.currentTarget.style);n++);o(t[n]),t.splice(n,1)}}},T.dependencies.TextController=function(){var e,t,n,i,r="LOADING",o="READY",s=!1,a=null,l=o,d=function(e){this.debug.log("TextController setState to:"+e),l=e},u=function(){if(s&&l===o){var e=this;e.indexHandler.getInitRequest(i[0]).then(function(t){e.fragmentLoader.load(t).then(p.bind(e,t),f.bind(e,t)),d.call(e,r)})}},c=function(){u.call(this)},h=function(e,t){var n,i,r=this.manifestModel.getValue();return i=this.manifestExt.getDataIndex(e,r,t.index),n=this.manifestExt.getAdaptationsForPeriod(r,t),this.manifestExt.getRepresentationsForAdaptation(r,n[i])},p=function(e,t){var i=this;i.fragmentController.process(t.data,e).then(function(e){null!==e&&i.sourceBufferExt.append(n,e,i.videoModel);
})},f=function(){};return{videoModel:void 0,fragmentLoader:void 0,fragmentController:void 0,indexHandler:void 0,sourceBufferExt:void 0,manifestModel:void 0,manifestExt:void 0,debug:void 0,initialize:function(e,t,n,i,r){var o=this;o.setVideoModel(i),o.setBuffer(n),o.setMediaSource(r),o.updateData(t,e),s=!0,u.call(o)},setPeriodInfo:function(e){a=e},getPeriodIndex:function(){return a.index},getVideoModel:function(){return this.videoModel},setVideoModel:function(e){this.videoModel=e},getData:function(){return t},setData:function(e){t=e},getBuffer:function(){return n},setBuffer:function(e){n=e},setMediaSource:function(t){e=t},updateData:function(e,n){t=e,a=n,i=h.call(this,t,a),d.call(this,o),u.call(this)},reset:function(t){t||(this.sourceBufferExt.abort(e,n),this.sourceBufferExt.removeSourceBuffer(e,n))},start:c}},T.dependencies.TextController.prototype={constructor:T.dependencies.TextController},T.dependencies.TextSourceBuffer=function(){var e,t,n,i=function(e){var t="",n=0,i=0,r=0,o=0,s=new Uint8Array(e);for(s.length>=3&&239===s[0]&&187===s[1]&&191===s[2]&&(n=3);n<s.length;)if(i=s[n],i<128)t+=String.fromCharCode(i),n++;else if(i>191&&i<224){if(n+1>=s.length)throw"UTF-8 Decode failed. Two byte character was truncated.";r=s[n+1],t+=String.fromCharCode((31&i)<<6|63&r),n+=2}else{if(n+2>=s.length)throw"UTF-8 Decode failed. Multi byte character was truncated.";r=s[n+1],o=s[n+2],t+=String.fromCharCode((15&i)<<12|(63&r)<<6|63&o),n+=3}return t},r={length:0,ranges:[],start:function(e){return this.ranges[e].start},end:function(e){return this.ranges[e].end},addRange:function(e,t){var n=0,i=!1,r=.01;for(n=0;n<this.ranges.length;n++)this.ranges[n].end<=e+r&&this.ranges[n].end>=e-r&&(i=!0,this.ranges[n].end=t),this.ranges[n].start<=t+r&&this.ranges[n].start>=t-r&&(i=!0,this.ranges[n].start=e);i||(this.ranges.push({start:e,end:t}),this.length=this.length+1,this.ranges.sort(function(e,t){return e.start-t.start}))},removeRange:function(e,t){var n=0;for(n=this.ranges.length-1;n>=0;n-=1)(void 0===t||t===-1||this.ranges[n].end<=t)&&(void 0===e||e===-1||this.ranges[n].start>=e)&&this.ranges.splice(n,1);this.length=this.ranges.length},reset:function(){this.length=0,this.ranges=[]}};return{system:void 0,eventBus:void 0,errHandler:void 0,textTrackExtensions:void 0,buffered:r,initialize:function(i,o){n=i,e=o.getVideoModel().getElement(),t=o.getData(),r.reset()},remove:function(t,n){if(t<0||t>=n)throw"INVALID_ACCESS_ERR";this.textTrackExtensions.deleteCues(e,!1,t,n),this.buffered.removeRange(t,n)},append:function(n,r){var o=this,s=i(n),a=o.getParser().parse(s,r);0===e.textTracks.length&&o.textTrackExtensions.addTextTrack(e,[],t.Representation_asArray[0].id,t.lang,!0),0!==e.textTracks.length&&(o.textTrackExtensions.addCues(e.textTracks[0],a),r&&o.buffered.addRange(r.startTime,r.startTime+r.duration))},abort:function(){this.textTrackExtensions.deleteCues(e),this.buffered.reset()},getParser:function(){var e;return"text/vtt"===n&&(e=this.system.getObject("vttParser")),e},addEventListener:function(e,t,n){this.eventBus.addEventListener(e,t,n)},removeEventListener:function(e,t,n){this.eventBus.removeEventListener(e,t,n)}}},T.dependencies.TextSourceBuffer.prototype={constructor:T.dependencies.TextSourceBuffer},T.dependencies.TextTTMLXMLMP4SourceBuffer=function(){var e,t,n,i,r={length:0,ranges:[],start:function(e){return this.ranges[e].start},end:function(e){return this.ranges[e].end},addRange:function(e,t){var n=0,i=!1,r=.01;for(n=0;n<this.ranges.length;n++)this.ranges[n].end<=e+r&&this.ranges[n].end>=e-r&&(i=!0,this.ranges[n].end=t),this.ranges[n].start<=t+r&&this.ranges[n].start>=t-r&&(i=!0,this.ranges[n].start=e);i||(this.ranges.push({start:e,end:t}),this.length=this.length+1,this.ranges.sort(function(e,t){return e.start-t.start}))},removeRange:function(e,t){var n=0;for(n=this.ranges.length-1;n>=0;n-=1)(void 0===t||t===-1||this.ranges[n].end<=t)&&(void 0===e||e===-1||this.ranges[n].start>=e)&&this.ranges.splice(n,1);this.length=this.ranges.length},reset:function(){this.length=0,this.ranges=[]}};return{updating:!1,system:void 0,eventBus:void 0,buffered:r,textTrackExtensions:void 0,ttmlParser:void 0,debug:void 0,manifestModel:void 0,initialize:function(o,s,a){t=o,e=s.getVideoModel().getElement(),r.reset(),n=a.lang,i=a.id},remove:function(t,n){if(t<0||t>=n)throw"INVALID_ACCESS_ERR";this.getTextTrackExtensions().deleteCues(e,!1,t,n),this.buffered.removeRange(t,n)},append:function(r){var o,s,a,l,d,u,c,h,p=this,f=P.deserialize(r),m=f.getBoxByType("moov"),g=0,y="utf-8";return"application/ttml+xml"===t?(this.track=this.textTrackExtensions.addTextTrack(e,[],i,n,!0),p.isUTF16(r)&&(y="utf-16"),void this.convertUTFToString(r,y).then(function(t){p.ttmlParser.parse(t).then(function(t){t&&(p.textTrackExtensions.addCues(p.track,t),p.buffered.addRange(0,e.duration),p.eventBus.dispatchEvent({type:"updateend"}))},function(){})})):m?(o=m.getBoxByType("mvhd"),p.timescale=o.timescale,this.track=this.textTrackExtensions.addTextTrack(e,[],i,n,!0),void this.eventBus.dispatchEvent({type:"updateend"})):(s=f.getBoxByType("moof"),void(s&&(a=f.getBoxByType("mdat"),l=s.getBoxByType("traf"),d=l.getBoxByType("tfhd"),u=l.getBoxByType("tfdt"),c=l.getBoxByType("trun"),h=u.baseMediaDecodeTime/p.timescale,g=0,g=256&c.flags?c.samples_table[0].sample_duration/p.timescale:d.default_sample_duration/p.timescale,p.buffered.addRange(h,h+g),p.isUTF16(a.data)&&(y="utf-16"),p.convertUTFToString(a.data,y).then(function(e){p.ttmlParser.parse(e).then(function(e){var t,n=p.manifestModel.getValue();if(e){if("MSS"===n.name)for(t=0;t<e.length;t+=1)e[t].start=e[t].start+h,e[t].end=e[t].end+h;p.textTrackExtensions.addCues(p.track,e),p.eventBus.dispatchEvent({type:"updateend"})}},function(){})}))))},convertUTFToString:function(e,t){var n=y.defer(),i=new Blob([e],{type:"text/xml"}),r=new FileReader;return r.onload=function(e){n.resolve(e.target.result)},r.readAsText(i,t),n.promise},isUTF16:function(e){var t,n,i,r,o=0,s=e&&e.length,a=null;if(s<2){if(e[0]>255)return!1}else{if(t=e[0],n=e[1],255===t&&254===n)return!0;if(254===t&&255===n)return!0;for(;o<s;o++){if(0===e[o]){a=o;break}if(e[o]>255)return!1}if(null===a)return!1;if(i=e[a+1],void 0!==i&&i>0&&i<128)return!0;if(r=e[a-1],void 0!==r&&r>0&&r<128)return!0}return!1},UpdateLang:function(e,t){i=e,n=t},abort:function(){this.getTextTrackExtensions().deleteCues(e,!0)},getTextTrackExtensions:function(){return this.textTrackExtensions},addEventListener:function(e,t,n){this.eventBus.addEventListener(e,t,n),this.updating||this.eventBus.dispatchEvent({type:"updateend"})},removeEventListener:function(e,t,n){this.eventBus.removeEventListener(e,t,n)}}},T.dependencies.TextTTMLXMLMP4SourceBuffer.prototype={constructor:T.dependencies.TextTTMLXMLMP4SourceBuffer},T.utils.TextTrackExtensions=function(){"use strict";var e,t="",n=null;return{system:void 0,eventBus:void 0,videoModel:void 0,debug:void 0,config:void 0,setup:function(){e=window.VTTCue||window.TextTrackCue},cueEnter:function(e,t,n){this.eventBus.dispatchEvent({type:"cueEnter",data:{text:t,style:e,type:n}})},cueExit:function(e,t,n){this.eventBus.dispatchEvent({type:"cueExit",data:{text:t,style:e,type:n}})},getCurrentTextTrack:function(e){for(var t=0;t<e.textTracks.length;t++)if("hascaption"===e.textTracks[t].label)return e.textTracks[t];return null},addTextTrack:function(i,r,o,s,a){var l,d=null,u=null,c="subtitles",h=this.videoModel.getTTMLRenderingDiv();for(d=this.getCurrentTextTrack(i),d?(this.cleanSubtitles(),d["default"]=a,"showing"!==d.mode&&"metadata"!==d.kind&&(d.mode="showing"),t=s):(h&&(n=this.system.getObject("ttmlRenderer"),n.initialize(h)),c=null!==h?"metadata":"subtitles","subtitles"===c&&(c=this.config.getParam("TextTrackExtensions.displayModeExtern","boolean")===!0?"metadata":"subtitles"),d=i.addTextTrack(c,"hascaption",s),t=s,d["default"]=a,"metadata"!==c?d.mode="showing":d.mode="hidden"),l=0;l<r.length;l+=1)u=r[l],d.addCue(new e(u.start,u.end,u.data));return d},onCueEnter:function(e){var t=this.videoModel.getTTMLRenderingDiv();"image"===e.currentTarget.type&&null===t&&this.debug.warn("[TextTrackExtensions] Rendering image subtitles without div is impossible"),t&&n.onCueEnter(e),this.cueEnter(e.currentTarget.style,e.currentTarget.text,e.currentTarget.type)},onCueExit:function(e){var t=this.videoModel.getTTMLRenderingDiv();t&&n.onCueExit(e),this.cueExit(e.currentTarget.style,e.currentTarget.text)},addCues:function(n,i){var r=0,o=null,s=null;for(r=0;r<i.length;r+=1)o=i[r],o.start<o.end&&(s=new e(o.start,o.end,o.data),s.id=t,s.type=o.type,s.onenter=this.onCueEnter.bind(this),s.onexit=this.onCueExit.bind(this),s.snapToLines=!1,s.line=o.line,o.style&&(s.style=o.style),n.addCue(s))},deleteCues:function(e,t,n,i){var r,o=null,s=null,a=null,l=0;if(e&&(o=e.textTracks[0])){if(r=o.mode,"disabled"===r&&(o.mode="hidden"),s=o.cues)for(a=s.length-1,l=a;l>=0;l-=1)(void 0===i||i===-1||s[l].endTime<=i)&&(void 0===n||n===-1||s[l].startTime>=n)&&o.removeCue(s[l]);o.mode=r}},cleanSubtitles:function(){var e=this.videoModel.getTTMLRenderingDiv();e&&n&&n.cleanSubtitles()}}},T.utils.VTTParser=function(){"use strict";var e=/X-TIMESTAMP-MAP=(.+)/,t=/\s*(.+?)\s*:((?:\".*?\")|.*?)(?:,|$)/g,n=/(\S*)[\s]*-->[\s]*(\S*)(.*)/g,i=/(?:\r\n|\r|\n)/gm,r=function(e){for(var t=e.split(":"),n=t.length,i=0,r=0;r<n;r++)i+=parseFloat(t[r],10)*Math.pow(60,n-r-1);return i},o=function(n){var i,o,s,a,l=null,d=null;if(i=e.exec(n)){for(o=i[1];null!==(i=t.exec(o));)switch(s=i[1],a=i[2],s){case"MPEGTS":d=parseInt(a,10);break;case"LOCAL":l=r(a)}return null===l||null===d?-1:{local:l,mpegts:d}}},s=function(e,t){if(e===-1)return 0;var n=this.manifestModel.getValue().timestampMap;if(!n)return e.local-t.startTime;var i=(e.mpegts-n.mpegts)/9e4;return e.local-n.local-i};return{manifestModel:void 0,parse:function(e,t){var a,l,d,u=[],c=null,h=s.call(this,o(e),t),p=e.split(i);for(d=0;d<p.length;d++)a=p[d].trim(),0!==a.length&&(p[d].match(n)?(null!==c&&u.push(c),l=p[d].split(n),c={type:"text",line:80,start:r(l[1])-h,end:r(l[2])-h,data:""},console.log("[text] Buffered range",c)):null!==c&&(c.data+=(0===c.data.length?"":"\n")+p[d]));return null!==c&&u.push(c),u}}},T.rules.AbandonRequestsRule=function(){"use strict";var e=.5,t=2;return{debug:void 0,metricsExt:void 0,name:"AbandonRequestRule",execute:function(n,i){var r,o,s,a=(new Date).getTime(),l=n.streamType,d=new T.rules.SwitchRequest(T.rules.SwitchRequest.prototype.NO_CHANGE,T.rules.SwitchRequest.prototype.WEAK);return null===n.firstByteDate||n.aborted?(this.debug.log("[AbandonRequestsRule]["+l+"] Request has already been aborted."),void i(d)):(r=(a-n.firstByteDate.getTime())/1e3,n.bytesLoaded<n.bytesTotal&&r>=n.duration*e&&(o=n.bytesLoaded/r,s=n.bytesTotal/o,s>n.duration*t&&(d=new T.rules.SwitchRequest(0,T.rules.SwitchRequest.prototype.STRONG),this.debug.info("[AbandonRequestsRule]["+l+"] BW = "+(8*o/1e3).toFixed(3)+" kb/s => switch to lowest quality"))),void i(d))}}},T.rules.AbandonRequestsRule.prototype={constructor:T.rules.AbandonRequestsRule},T.rules.BaseRulesCollection=function(){"use strict";var e=[],t=[];return{downloadRatioRule:void 0,insufficientBufferRule:void 0,droppedFramesRule:void 0,abandonRequestRule:void 0,getRules:function(n){switch(n){case T.rules.BaseRulesCollection.prototype.QUALITY_SWITCH_RULES:return e;case T.rules.BaseRulesCollection.prototype.ABANDON_FRAGMENT_RULES:return t;default:return null}},setup:function(){e.push(this.downloadRatioRule),e.push(this.insufficientBufferRule),e.push(this.droppedFramesRule),t.push(this.abandonRequestRule)}}},T.rules.BaseRulesCollection.prototype={constructor:T.rules.BaseRulesCollection,QUALITY_SWITCH_RULES:"qualitySwitchRules",ABANDON_FRAGMENT_RULES:"abandonFragmentRules"},T.rules.DownloadRatioRule=function(){"use strict";return{debug:void 0,manifestExt:void 0,metricsExt:void 0,manifestModel:void 0,config:void 0,name:"DownloadRatioRule",checkIndex:function(e,t,n){var i,r,o,s,a,l,d,u,c,h=this,p=h.metricsExt.getHttpRequests(t),f=null,m=[],g=T.rules.SwitchRequest.prototype.NO_CHANGE,y=0,_=T.rules.SwitchRequest.prototype.DEFAULT;if(n&&n.hasOwnProperty("type")){if(a=h.config.getParamFor(n.type,"ABR.latencyInBandwidth","boolean",!0),l=h.config.getParamFor(n.type,"ABR.switchUpRatioSafetyFactor","number",1.5),h.debug.log("[DownloadRatioRule]["+n.type+"] Checking download ratio rule... (current = "+e+")"),!t)return h.debug.log("[DownloadRatioRule]["+n.type+"] No metrics, bailing."),new T.rules.SwitchRequest;for(c=p.length-1;c>=0&&null===f;)p[c].tfinish&&p[c].trequest&&p[c].tresponse&&p[c].bytesLength>0&&(f=p[c]),c--;if(null===f)return h.debug.log("[DownloadRatioRule]["+n.type+"] No valid requests made for this stream yet, bailing."),new T.rules.SwitchRequest;if(r=(f.tfinish.getTime()-f.trequest.getTime())/1e3,i=(f.tfinish.getTime()-f.tresponse.getTime())/1e3,r<=0)return h.debug.log("[DownloadRatioRule]["+n.type+"] Don't know how long the download of the last fragment took, bailing."),new T.rules.SwitchRequest;if(null===f.mediaduration||void 0===f.mediaduration||f.mediaduration<=0||isNaN(f.mediaduration))return h.debug.log("[DownloadRatioRule]["+n.type+"] Don't know the duration of the last media fragment, bailing."),new T.rules.SwitchRequest;for(h.debug.log("[DownloadRatioRule]["+n.type+"] DL: "+Number(i.toFixed(3))+"s, Total: "+Number(r.toFixed(3))+"s"),y=f.bytesLength,u=1,c=p.length-2;c>=0&&u<3;)p[c].tfinish&&p[c].trequest&&p[c].tresponse&&p[c].bytesLength>0&&(h.debug.log("[DownloadRatioRule]["+n.type+"] length: "+p[c].bytesLength+", time: "+(p[c].tfinish.getTime()-p[c].trequest.getTime())/1e3),y+=p[c].bytesLength,r+=(p[c].tfinish.getTime()-p[c].trequest.getTime())/1e3,i+=(p[c].tfinish.getTime()-p[c].tresponse.getTime())/1e3,u+=1),c--;if(y*=8,o=a?y/r:y/i,h.debug.log("[DownloadRatioRule]["+n.type+"] BW = "+Math.round(o/1e3)+" kb/s"),isNaN(o))return new T.rules.SwitchRequest;for(u=h.manifestExt.getRepresentationCount(n),d=h.manifestExt.getRepresentationFor(e,n),s=h.manifestExt.getBandwidth(d),c=0;c<u;c+=1)m.push(h.manifestExt.getRepresentationBandwidth(n,c));if(o<=s){for(c=e-1;c>0&&!(m[c]<=o);c-=1);return g=c,_=T.rules.SwitchRequest.prototype.WEAK,h.debug.info("[DownloadRatioRule]["+n.type+"] SwitchRequest: q="+g+"/"+(u-1)+" ("+m[g]+"), p="+_),new T.rules.SwitchRequest(g,_)}for(c=u-1;c>e&&!(o>m[c]*l);c-=1);return g=c,_=T.rules.SwitchRequest.prototype.STRONG,h.debug.info("[DownloadRatioRule]["+n.type+"] SwitchRequest: q="+g+"/"+(u-1)+" ("+m[g]+"), p="+_),new T.rules.SwitchRequest(g,_)}return new T.rules.SwitchRequest}}},T.rules.DownloadRatioRule.prototype={constructor:T.rules.DownloadRatioRule},T.rules.DroppedFramesRule=function(){"use strict";var e=1,t=null,n=-1,i=-1,r=function(r){var o;return null===t?void(t=r):(o=r.mt-t.mt,void(o<e||(n=r.droppedFrames-t.droppedFrames,i=r.totalVideoFrames-t.totalVideoFrames,t=r)))};return{debug:void 0,metricsExt:void 0,manifestModel:void 0,config:void 0,name:"DroppedFramesRule",checkIndex:function(e,o,s,a){var l,d=this.config.getParamFor(s.type,"ABR.droppedFramesMaxRatio","number",.3),u=this.config.getParamFor(s.type,"ABR.droppedFramesMinRatio","number",.1),c=this.metricsExt.getCurrentPlaybackQuality(o),h=T.rules.SwitchRequest.prototype.NO_CHANGE,p=T.rules.SwitchRequest.prototype.DEFAULT;return null===s?new T.rules.SwitchRequest:"video"!==s.type?new T.rules.SwitchRequest:null===c?(t=null,n=i=-1,new T.rules.SwitchRequest):"buffering"===a?(t=null,n=i=-1,new T.rules.SwitchRequest):(r(c),n===-1?new T.rules.SwitchRequest:(l=n/i,this.debug.info("[DroppedFramesRule]["+s.type+"] DroppedFrames:"+n+", totalVideoFrames:"+i+" => ratio = "+l),l>d&&e>0?(h=e-1,p=T.rules.SwitchRequest.prototype.STRONG):l>u&&(h=e,p=T.rules.SwitchRequest.prototype.STRONG),this.debug.info("[DroppedFramesRule]["+s.type+"] SwitchRequest: q="+h+", p="+p),new T.rules.SwitchRequest(h,p)))}}},T.rules.DroppedFramesRule.prototype={constructor:T.rules.DroppedFramesRule},T.rules.InsufficientBufferRule=function(){"use strict";return{debug:void 0,manifestExt:void 0,metricsExt:void 0,manifestModel:void 0,config:void 0,isStartBuffering:{},name:"InsufficientBufferRule",checkIndex:function(e,t,n,i){var r,o,s,a,l,d,u,c,h=this,p=h.metricsExt.getCurrentBufferLevel(t),f=e,m=T.rules.SwitchRequest.prototype.DEFAULT;if(null===n)return new T.rules.SwitchRequest;if("buffering"===i&&(h.isStartBuffering[n.type]=!0),null===p)return new T.rules.SwitchRequest;if(h.debug.info("[InsufficientBufferRule]["+n.type+"] Checking buffer level ... (current = "+e+", buffer level = "+Math.round(100*p.level)/100+", buffering = "+h.isStartBuffering[n.type]+")"),c=h.manifestExt.getMpd(h.manifestModel.getValue())){if(r=h.config.getParamFor(n.type,"BufferController.minBufferTime","number",c.manifest.minBufferTime),o=h.config.getParamFor(n.type,"ABR.switchLowerBufferRatio","number",.25),s=h.config.getParamFor(n.type,"ABR.switchLowerBufferTime","number",o*r),a=h.config.getParamFor(n.type,"ABR.switchDownBufferRatio","number",.5),l=h.config.getParamFor(n.type,"ABR.switchDownBufferTime","number",a*r),d=h.config.getParamFor(n.type,"ABR.switchUpBufferRatio","number",.75),u=h.config.getParamFor(n.type,"ABR.switchUpBufferTime","number",d*r),p.level<l&&h.isStartBuffering[n.type])return new T.rules.SwitchRequest;p.level>=l&&(h.isStartBuffering[n.type]=!1);var g=h.manifestExt.getRepresentationCount(n);return g-=1,p.level<=s?(f=0,m=T.rules.SwitchRequest.prototype.STRONG):p.level<=l&&(f=e>0?e-1:0,m=T.rules.SwitchRequest.prototype.DEFAULT),h.debug.info("[InsufficientBufferRule]["+n.type+"] SwitchRequest: q="+f+", p="+m),new T.rules.SwitchRequest(f,m)}return h.debug.log("[InsufficientBufferRule]["+n.type+"] Manifest not present yet"),new T.rules.SwitchRequest}}},T.rules.InsufficientBufferRule.prototype={constructor:T.rules.OInsufficientBufferRule},T.rules.LimitSwitchesRule=function(){"use strict";var e=10,t=2e4,n=5,i=0;return{debug:void 0,name:"LimitSwitchesRule",checkIndex:function(r,o){if(i>0)return i-=1,new T.rules.SwitchRequest(r,T.rules.SwitchRequest.prototype.STRONG);var s,a,l,d=this,u=!1,c=(new Date).getTime(),h=o.RepSwitchList.length;for(l=h-1;l>=0;l-=1){if(s=o.RepSwitchList[l],a=c-s.t.getTime(),a>=t){d.debug.log("Reached time limit, bailing.");break}if(l>=e){d.debug.log("Found too many switches within validation time, force the stream to not change."),u=!0;break}}return u?(d.debug.log("Wait some time before allowing another switch."),i=n,new T.rules.SwitchRequest(r,T.rules.SwitchRequest.prototype.STRONG)):new T.rules.SwitchRequest(T.rules.SwitchRequest.prototype.NO_CHANGE,T.rules.SwitchRequest.prototype.STRONG)}}},T.rules.LimitSwitchesRule.prototype={constructor:T.rules.LimitSwitchesRule},T.rules.SwitchRequest=function(e,t){"use strict";this.quality=e,this.priority=t,void 0===this.quality&&(this.quality=999),void 0===this.priority&&(this.priority=.5)},T.rules.SwitchRequest.prototype={constructor:T.rules.SwitchRequest,NO_CHANGE:999,DEFAULT:.5,STRONG:1,WEAK:0},T.vo.Error=function(e,t,n){"use strict";this.code=e||null,this.message=t||null,this.data=n||null},T.vo.Error.prototype={constructor:T.vo.Error},T.vo.Event=function(){"use strict";this.type=null,this.sender=null,this.data=null,this.error=null,this.timestamp=NaN},T.vo.Event.prototype={constructor:T.vo.Event},T.models.MetricsList=function(){"use strict";return{TcpList:[],HttpList:[],RepSwitchList:[],BufferedSwitchList:[],BufferLevel:[],PlayList:[],DroppedFrames:[],PlaybackQuality:[],VideoResolution:[],DVRInfo:[],ManifestUpdate:[]}},T.models.MetricsList.prototype={constructor:T.models.MetricsList},T.vo.Mp4Track=function(){"use strict";this.type="und",this.trackId=0,this.timescale=0,this.duration=0,this.codecs="",this.codecPrivateData="",this.bandwidth="",this.width=0,this.height=0,this.language="und",this.channels=0,this.samplingRate=0,this.contentProtection=void 0,this.samples=[],this.data=null},T.vo.Mp4Track.prototype={constructor:T.vo.Mp4Track},T.vo.Mp4Track.Sample=function(){"use strict";this.dts=0,this.cts=0,this.duration=0,this.flags=0,this.data=null,this.size=0},T.vo.Mp4Track.Sample.prototype={constructor:T.vo.Mp4Track.Sample},T.vo.SegmentRequest=function(){"use strict";this.action="download",this.startTime=NaN,this.streamType=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.deferred=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null},T.vo.SegmentRequest.prototype={constructor:T.vo.SegmentRequest,ACTION_DOWNLOAD:"download",ACTION_COMPLETE:"complete"},T.vo.URIFragmentData=function(){"use strict";this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null},T.vo.URIFragmentData.prototype={constructor:T.vo.URIFragmentData},T.vo.metrics.BufferLevel=function(){"use strict";this.t=null,this.level=null},T.vo.metrics.BufferLevel.prototype={constructor:T.vo.metrics.BufferLevel},T.vo.metrics.BufferedSwitch=function(){"use strict";this.mt=null,this.to=null,this.lto=null},T.vo.metrics.BufferedSwitch.prototype={constructor:T.vo.metrics.BufferedSwitch},T.vo.metrics.Condition=function(){"use strict";this.isFullScreen=null,this.windowSize=null,this.droppedFrames=null,this.fps=null,this.bandwidth=null},T.vo.metrics.Condition.prototype={constructor:T.vo.metrics.Condition},T.vo.metrics.DVRInfo=function(){"use strict";this.time=null,this.range=null},T.vo.metrics.DVRInfo.prototype={constructor:T.vo.metrics.DVRInfo},T.vo.metrics.DroppedFrames=function(){"use strict";this.time=null,this.droppedFrames=null},T.vo.metrics.DroppedFrames.prototype={constructor:T.vo.metrics.DroppedFrames},T.vo.metrics.HTTPRequest=function(){"use strict";this.stream=null,this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.tfinish=null,this.responsecode=null,this.interval=null,this.mediaduration=null,this.trace=[],this.startTime=null,this.quality=null,this.bytesLength=null},T.vo.metrics.HTTPRequest.prototype={constructor:T.vo.metrics.HTTPRequest},T.vo.metrics.HTTPRequest.Trace=function(){"use strict";this.s=null,this.d=null,this.b=[]},T.vo.metrics.HTTPRequest.Trace.prototype={constructor:T.vo.metrics.HTTPRequest.Trace},T.vo.metrics.ManifestUpdate=function(){"use strict";this.streamType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.periodInfo=[],this.representationInfo=[]},T.vo.metrics.ManifestUpdate.PeriodInfo=function(){"use strict";this.id=null,this.index=null,this.start=null,this.duration=null},T.vo.metrics.ManifestUpdate.RepresentationInfo=function(){"use strict";this.id=null,this.index=null,this.streamType=null,this.periodIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.segmentInfoType=null},T.vo.metrics.ManifestUpdate.prototype={constructor:T.vo.metrics.ManifestUpdate},T.vo.metrics.ManifestUpdate.PeriodInfo.prototype={constructor:T.vo.metrics.ManifestUpdate.PeriodInfo},T.vo.metrics.ManifestUpdate.RepresentationInfo.prototype={constructor:T.vo.metrics.ManifestUpdate.RepresentationInfo},T.vo.metrics.PlayList=function(){"use strict";this.stream=null,this.start=null,this.mstart=null,this.starttype=null,this.trace=[]},T.vo.metrics.PlayList.Trace=function(){"use strict";this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null},T.vo.metrics.PlayList.prototype={constructor:T.vo.metrics.PlayList},T.vo.metrics.PlayList.INITIAL_PLAY_START_REASON="initial_start",T.vo.metrics.PlayList.SEEK_START_REASON="seek",T.vo.metrics.PlayList.Trace.prototype={constructor:T.vo.metrics.PlayList.Trace()},T.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON="user_request",T.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",T.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON="end_of_content",T.vo.metrics.PlayList.Trace.REBUFFERING_REASON="rebuffering",T.vo.metrics.PlaybackQuality=function(){"use strict";this.t=null,this.mt=null,this.droppedFrames=null,this.totalVideoFrames=null},T.vo.metrics.PlaybackQuality.prototype={constructor:T.vo.metrics.PlaybackQuality},T.vo.metrics.RepresentationSwitch=function(){"use strict";this.t=null,this.mt=null,this.to=null,this.lto=null},T.vo.metrics.RepresentationSwitch.prototype={constructor:T.vo.metrics.RepresentationSwitch},T.vo.metrics.Session=function(){"use strict";this.uri=null,this.loopMode=null,this.endTime=null,this.playerType=null},T.vo.metrics.Session.prototype={constructor:T.vo.metrics.Session},T.vo.metrics.State=function(){"use strict";this.t=null,this.current=null,this.position=null,this.reason=null},T.vo.metrics.State.prototype={constructor:T.vo.metrics.State},T.vo.metrics.TCPConnection=function(){"use strict";this.tcpid=null,this.dest=null,this.topen=null,this.tclose=null,this.tconnect=null},T.vo.metrics.TCPConnection.prototype={constructor:T.vo.metrics.TCPConnection},T.vo.metrics.VideoResolution=function(){"use strict";this.t=null,this.mt=null,this.width=null,this.height=null},T.vo.metrics.VideoResolution.prototype={constructor:T.vo.metrics.VideoResolution},x=function(){"use strict";return{modules:{},dependencies:{},vo:{},di:{}}}(),x.dependencies.BaseURLExtensions=function(){"use strict";var e=function(e,t){for(var n,i,r,o,s,a,l,d,u,c,h=new DataView(e),p={},f=0;"sidx"!==d&&f<h.byteLength;){for(u=h.getUint32(f),f+=4,d="",o=0;o<4;o+=1)c=h.getInt8(f),d+=String.fromCharCode(c),f+=1;"moof"!==d&&"traf"!==d&&"sidx"!==d?f+=u-8:"sidx"===d&&(f-=8)}if(r=h.getUint32(f,!1)+f,r>e.byteLength)throw"sidx terminates after array buffer";for(p.version=h.getUint8(f+8),f+=12,p.timescale=h.getUint32(f+4,!1),f+=8,0===p.version?(p.earliest_presentation_time=h.getUint32(f,!1),p.first_offset=h.getUint32(f+4,!1),f+=8):(p.earliest_presentation_time=A.Math.to64BitNumber(h.getUint32(f+4,!1),h.getUint32(f,!1)),p.first_offset=(h.getUint32(f+8,!1)<<32)+h.getUint32(f+12,!1),f+=16),p.first_offset+=r+(t||0),p.reference_count=h.getUint16(f+2,!1),f+=4,p.references=[],n=p.first_offset,i=p.earliest_presentation_time,o=0;o<p.reference_count;o+=1)a=h.getUint32(f,!1),s=a>>>31,a=2147483647&a,l=h.getUint32(f+4,!1),f+=12,a>0&&p.references.push({size:a,type:s,offset:n,duration:l,time:i,timescale:p.timescale}),n+=a,i+=l;if(f!==r)throw"Error: final pos "+f+" differs from SIDX end "+r;return p},t=function(t,n,i){var r,o,s,a,l,d,u,c;for(r=e.call(this,t,i),o=r.references,s=[],l=0,d=o.length;l<d;l+=1)a=new x.vo.Segment,a.duration=o[l].duration,a.media=n,a.startTime=o[l].time,a.timescale=o[l].timescale,u=o[l].offset,c=o[l].offset+o[l].size-1,a.mediaRange=u+"-"+c,s.push(a);return this.debug.log("Parsed SIDX box: "+s.length+" segments."),s},n=function(e,t){var i,r,o,s,a,l,d,u,c,h=y.defer(),p=new DataView(e),f=0,m="",g=0,_=!1,E=this;for(E.debug.log("Searching for initialization.");"moov"!==m&&f<p.byteLength;){for(g=p.getUint32(f),f+=4,m="",l=0;l<4;l+=1)d=p.getInt8(f),m+=String.fromCharCode(d),f+=1;"ftyp"===m&&(i=f-8),"moov"===m&&(r=f-8),"moov"!==m&&(f+=g-8)}return a=p.byteLength-f,"moov"!==m?(E.debug.log("Loading more bytes to find initialization."),t.range.start=0,t.range.end=t.bytesLoaded+t.bytesToLoad,u=new XMLHttpRequest,u.onloadend=function(){_||h.reject("Error loading initialization.")},u.onload=function(){_=!0,t.bytesLoaded=t.range.end,n.call(E,u.response).then(function(e){h.resolve(e)})},u.onerror=function(){h.reject("Error loading initialization.")},u.open("GET",E.tokenAuthentication.addTokenAsQueryArg(t.url)),u.responseType="arraybuffer",u.setRequestHeader("Range","bytes="+t.range.start+"-"+t.range.end),u=E.tokenAuthentication.setTokenInRequestHeader(u),u.send(null)):(o=void 0===i?r:i,s=r+g-1,c=o+"-"+s,E.debug.log("Found the initialization.  Range: "+c),h.resolve(c)),h.promise},i=function(e){var t=y.defer(),i=new XMLHttpRequest,r=!0,o=this,s={url:e,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:i};return o.debug.log("Start searching for initialization."),s.range.start=0,s.range.end=s.bytesToLoad,i.onload=function(){i.status<200||i.status>299||(r=!1,s.bytesLoaded=s.range.end,n.call(o,i.response,s).then(function(e){t.resolve(e)},function(){t.reject()}))},i.onloadend=i.onerror=function(){if(r){r=!1;var e={};e.url=s.url,e.request=i,o.errHandler.sendError(T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_INIT,null,e),t.reject(i)}},i.open("GET",o.tokenAuthentication.addTokenAsQueryArg(s.url)),i.responseType="arraybuffer",i.setRequestHeader("Range","bytes="+s.range.start+"-"+s.range.end),i=o.tokenAuthentication.setTokenInRequestHeader(i),i.send(null),o.debug.log("Perform init search: "+s.url),t.promise},r=function(e,n){var i,o,s,a,l,d,u,c,h=y.defer(),p=new DataView(e),f=new XMLHttpRequest,m=0,g="",_=0,E=!0,b=!1,v=this;for(v.debug.log("Searching for SIDX box."),v.debug.log(n.bytesLoaded+" bytes loaded.");"sidx"!==g&&m<p.byteLength;){for(_=p.getUint32(m),m+=4,g="",l=0;l<4;l+=1)d=p.getInt8(m),g+=String.fromCharCode(d),m+=1;"sidx"!==g&&(m+=_-8)}if(i=p.byteLength-m,"sidx"!==g)h.reject();else if(i<_-8)v.debug.log("Found SIDX but we don't have all of it."),n.range.start=0,n.range.end=n.bytesLoaded+(_-i),f.onload=function(){f.status<200||f.status>299||(E=!1,n.bytesLoaded=n.range.end,r.call(v,f.response,n).then(function(e){h.resolve(e)}))},f.onloadend=f.onerror=function(){if(E){E=!1;var e={};e.url=n.url,e.request=f,v.errHandler.sendError(T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_SIDX,null,e),h.reject(f)}},f.open("GET",v.tokenAuthentication.addTokenAsQueryArg(n.url)),f.responseType="arraybuffer",f.setRequestHeader("Range","bytes="+n.range.start+"-"+n.range.end),f=v.tokenAuthentication.setTokenInRequestHeader(f),f.send(null);else if(n.range.start=m-8,n.range.end=n.range.start+_,v.debug.log("Found the SIDX box.  Start: "+n.range.start+" | End: "+n.range.end),o=new ArrayBuffer(n.range.end-n.range.start),a=new Uint8Array(o),s=new Uint8Array(e,n.range.start,n.range.end-n.range.start),a.set(s),u=this.parseSIDX.call(this,o,n.range.start),c=u.references,null!==c&&void 0!==c&&c.length>0&&(b=1===c[0].type),b){v.debug.log("Initiate multiple SIDX load.");var x,S,D,I,L,M,R=[];for(x=0,S=c.length;x<S;x+=1)D=c[x].offset,I=c[x].offset+c[x].size-1,L=D+"-"+I,R.push(this.loadSegments.call(v,n.url,L));y.all(R).then(function(e){for(M=[],x=0,S=e.length;x<S;x+=1)M=M.concat(e[x]);h.resolve(M)},function(e){h.reject(e)})}else v.debug.log("Parsing segments from SIDX."),h.resolve(t.call(v,o,n.url,n.range.start));return h.promise},o=function(e,n){var i,o=y.defer(),s=new XMLHttpRequest,a=!0,l=this,d={url:e,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:s};return null===n?(l.debug.log("No known range for SIDX request."),d.searching=!0,d.range.start=0,d.range.end=d.bytesToLoad):(i=n.split("-"),d.range.start=parseFloat(i[0]),d.range.end=parseFloat(i[1])),s.onload=function(){s.status<200||s.status>299||(a=!1,d.searching?(d.bytesLoaded=d.range.end,r.call(l,s.response,d).then(function(e){o.resolve(e)},function(){o.reject()})):o.resolve(t.call(l,s.response,d.url,d.range.start)))},s.onloadend=s.onerror=function(){if(a){a=!1;var e={};e.url=d.url,e.request=s,l.errHandler.sendError(T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_SIDX,null,e),o.reject(s)}},s.open("GET",l.tokenAuthentication.addTokenAsQueryArg(d.url)),s.responseType="arraybuffer",s.setRequestHeader("Range","bytes="+d.range.start+"-"+d.range.end),s=l.tokenAuthentication.setTokenInRequestHeader(s),s.send(null),l.debug.log("Perform SIDX load: "+d.url),o.promise};return{debug:void 0,errHandler:void 0,tokenAuthentication:void 0,loadSegments:o,loadInitialization:i,parseSegments:t,parseSIDX:e,findSIDX:r}},x.dependencies.BaseURLExtensions.prototype={constructor:x.dependencies.BaseURLExtensions},x.di.DashContext=function(){"use strict";return{system:void 0,setup:function(){x.di.DashContext.prototype.setup.call(this),this.system.mapClass("parser",x.dependencies.DashParser),this.system.mapClass("indexHandler",x.dependencies.DashHandler),this.system.mapClass("baseURLExt",x.dependencies.BaseURLExtensions),
this.system.mapClass("fragmentExt",x.dependencies.FragmentExtensions),this.system.mapSingleton("manifestExt",x.dependencies.DashManifestExtensions),this.system.mapSingleton("metricsExt",x.dependencies.DashMetricsExtensions),this.system.mapSingleton("timelineConverter",x.dependencies.TimelineConverter)}}},x.di.DashContext.prototype=new T.di.Context,x.di.DashContext.prototype.constructor=x.di.DashContext,x.dependencies.DashHandler=function(){"use strict";var e,t,n=-1,i=null,r=function(e,t){for(;e.length<t;)e="0"+e;return e},o=function(e,t,n){for(var i,o,s,a,l=0,d=0,u=t.length,c="%0",h=c.length;;){if(l=e.indexOf("$"+t),l<0)return e;if(d=e.indexOf("$",l+u),d<0)return e;if(i=e.indexOf(c,l+u),i>l&&i<d)switch(o=e.charAt(d-1),s=parseInt(e.substring(i+h,d-1),10),o){case"d":case"i":case"u":a=r(n.toString(),s);break;case"x":a=r(n.toString(16),s);break;case"X":a=r(n.toString(16),s).toUpperCase();break;case"o":a=r(n.toString(8),s);break;default:return this.debug.log("Unsupported/invalid IEEE 1003.1 format identifier string in URL"),e}else a=n;e=e.substring(0,l)+a+e.substring(d+1)}},s=function(e){return e.split("$$").join("$")},a=function(e,t){if(null===t||e.indexOf("$RepresentationID$")===-1)return e;var n=t.toString();return e.split("$RepresentationID$").join(n)},l=function(e,t){return e.representation.startNumber+t},d=function(e,t){var n,i=t.adaptation.period.mpd.manifest.Period_asArray[t.adaptation.period.index].AdaptationSet_asArray[t.adaptation.index].Representation_asArray[t.index].BaseURL;return n=e===i?e:e.indexOf("http://")!==-1||e.indexOf("https://")!==-1?e:i+e},u=function(t,n){var i,r,o=this,s=new T.vo.SegmentRequest;return i=t.adaptation.period,s.streamType=n,s.type="Initialization Segment",s.url=d(t.initialization,t),s.range=t.range,r=i.start,s.availabilityStartTime=o.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(r,t.adaptation.period.mpd,e),s.availabilityEndTime=o.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(r+i.duration,i.mpd,e),s.quality=t.index,s},c=function(e){var n=y.defer(),i=null,r=null,o=this;return e?(e.initialization?(i=u.call(o,e,t),n.resolve(i)):(r=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].BaseURL,o.baseURLExt.loadInitialization(r).then(function(s){e.range=s,e.initialization=r,i=u.call(o,e,t),n.resolve(i)},function(e){n.reject(e)})),n.promise):y.reject("no represenation")},h=function(t){var i,r,o,s=t.adaptation.period,a=!1;return e?a=!1:n<0?a=!1:n<t.availableSegmentsNumber+t.segmentStartIndex?(r=M(n,t),r&&(o=r.presentationStartTime-s.start,i=t.adaptation.period.duration,a=o>=i)):a=!0,a},p=function(t,n){var i,r,o,s,a=this;return r=t.segmentDuration,o=t.adaptation.period.start+n*r,s=o+r,i=new x.vo.Segment,i.representation=t,i.duration=r,i.presentationStartTime=o,i.mediaStartTime=a.timelineConverter.calcMediaTimeFromPresentationTime(i.presentationStartTime,t),i.availabilityStartTime=a.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(i.presentationStartTime,t.adaptation.period.mpd,e),i.availabilityEndTime=a.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(s,t.adaptation.period.mpd,e),i.wallStartTime=a.timelineConverter.calcWallTimeForSegment(i,e),i.replacementNumber=l(i,n),i.availabilityIdx=n,i},f=function(e){var t,n,r,o,s,a,l,d,u,c,h,p,f,m=this,g=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate,E=g.SegmentTimeline,v=e.availableSegmentsNumber>0,x=10,T=[],S=0,D=-1,I=!1,L=function(t){return b.call(m,e,S,t.d,f,g.media,t.mediaRange,D,t.tManifest)};for(f=e.timescale,t=E.S_asArray,u=_.call(m,e),u?(h=u.start,p=u.end):c=m.timelineConverter.calcMediaTimeFromPresentationTime(i||0,e),r=0,o=t.length;r<o;r+=1)if(n=t[r],a=0,n.hasOwnProperty("r")&&(a=n.r),n.hasOwnProperty("t")&&(S=n.t),a<0&&(d=t[r+1],l=d&&d.hasOwnProperty("t")?d.t/f:e.adaptation.period.duration,a=Math.ceil((l-S/f)/(n.d/f))-1),I){if(v)break;D+=a+1}else for(s=0;s<=a;s+=1){if(D+=1,u){if(D>p){if(I=!0,v)break;continue}D>=h&&T.push(L.call(m,n))}else{if(T.length>x){if(I=!0,v)break;continue}S/f>=c-n.d/f&&T.push(L.call(m,n))}S+=n.d}if(!v){var M,R,A=t[0];M=void 0===A.t?0:m.timelineConverter.calcPresentationTimeFromMediaTime(A.t/f,e),R=m.timelineConverter.calcPresentationTimeFromMediaTime((S-n.d)/f,e),e.segmentAvailabilityRange={start:M,end:R},e.availableSegmentsNumber=D+1,e.segmentStartIndex=0}return y.when(T)},m=function(t){var n,i,r,s,a=[],l=this,d=y.defer(),u=t.adaptation.period.mpd.manifest.Period_asArray[t.adaptation.period.index].AdaptationSet_asArray[t.adaptation.index].Representation_asArray[t.index].SegmentTemplate,c=t.segmentDuration,h=null,f=Math.floor(t.adaptation.period.start/c),m=null,_=null;return s=t.startNumber,E.call(l,t).then(function(y){for(t.segmentAvailabilityRange=y,h=g.call(l,t),i=h.start,r=h.end,n=i;n<=r;n+=1)m=p.call(l,t,n-(e?f:0)),m.replacementTime=(s+n-1)*t.segmentDuration,_=u.media,_=o(_,"Number",m.replacementNumber),_=o(_,"Time",m.replacementTime),m.media=_,a.push(m),m=null;t.availableSegmentsNumber=f+Math.ceil((y.end-y.start)/c),t.segmentStartIndex=i,d.resolve(a)}),d.promise},g=function(t){var r,o,s,a=this,l=t.adaptation.period.start,d=t.segmentDuration,u=t.adaptation.period.mpd.manifest.minBufferTime,c=t.segmentAvailabilityRange,h=NaN,p=null,f=t.segments,m=2*d,g=Math.max(2*u,10*d);return c||(c=a.timelineConverter.calcSegmentAvailabilityRange(t,e)),e&&!t.adaptation.period.mpd.isClientServerTimeSyncCompleted?(r=Math.floor(c.start/d),o=Math.floor(c.end/d),s={start:r,end:o}):(f?(p=M(n,t),h=p?p.presentationStartTime-l:n>0?n*d:i-l||f[0].presentationStartTime-l):h=n>0?n*d:e?c.end:c.start,r=Math.floor(Math.max(h-m,c.start)/d),o=Math.floor(Math.min(r+g/d,c.end/d)),s={start:r,end:o})},_=function(t){var r,o,s,a=NaN,l=t.segments,d=2,u=10,c=0,h=Number.POSITIVE_INFINITY;if(e&&!t.adaptation.period.mpd.isClientServerTimeSyncCompleted)return s={start:c,end:h};if(!e&&null!==i)return null;if(l){if(n<0)return null;a=n}else a=n>0?n:e?h:c;return r=Math.max(a-d,c),o=Math.min(a+u,h),s={start:r,end:o}},E=function(t){var n,i,r=this,o=y.defer(),s=function(){n=r.timelineConverter.calcSegmentAvailabilityRange(t,e),n.end>0?o.resolve(n):(i=1e3*Math.abs(n.end),setTimeout(s,i))};return s(),o.promise},b=function(t,n,i,r,s,a,d,u){var c,h,p,f=this,m=n/r,g=Math.min(i/r,t.adaptation.period.mpd.maxSegmentDuration);return c=f.timelineConverter.calcPresentationTimeFromMediaTime(m,t),c=m,h=c+g,p=new x.vo.Segment,p.representation=t,p.duration=g,p.mediaStartTime=m,p.presentationStartTime=c,p.availabilityStartTime=t.adaptation.period.mpd.manifest.mpdLoadedTime,p.availabilityEndTime=f.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(h,t.adaptation.period.mpd,e),p.wallStartTime=f.timelineConverter.calcWallTimeForSegment(p,e),p.replacementTime=u?u:n,p.replacementNumber=l(p,d),s=o(s,"Number",p.replacementNumber),s=o(s,"Time",p.replacementTime),p.media=s,p.mediaRange=a,p.availabilityIdx=d,p},v=function(t){var n,i,r,o,s,a=this,l=[],d=y.defer(),u=t.adaptation.period.mpd.manifest.Period_asArray[t.adaptation.period.index].AdaptationSet_asArray[t.adaptation.index].Representation_asArray[t.index].SegmentList,c=u.SegmentURL_asArray.length,h=0,f=u.SegmentURL_asArray.length;return s=t.startNumber,E.call(a,t).then(function(m){for(e||(o=g.call(a,t),h=o.start,f=o.end),n=h;n<f;n+=1)r=u.SegmentURL_asArray[n],i=p.call(a,t,n),i.replacementTime=(s+n-1)*t.segmentDuration,i.media=r.media,i.mediaRange=r.mediaRange,i.index=r.index,i.indexRange=r.indexRange,r.duration&&(i.duration=r.duration,i.presentationStartTime=i.mediaStartTime=r.time),void 0!==r.sequenceNumber&&(i.sequenceNumber=r.sequenceNumber),void 0!==r.decryptionInfo&&(i.decryptionInfo=r.decryptionInfo),l.push(i),i=null;t.segmentAvailabilityRange=m,t.availableSegmentsNumber=c,t.segmentStartIndex=h,d.resolve(l)}),d.promise},S=function(e){var t,n,i,r,o=this,s=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].BaseURL,a=y.defer(),l=[],d=0,u=null;return e.indexRange&&(u=e.indexRange),this.baseURLExt.loadSegments(s,u).then(function(s){for(n=0,i=s.length;n<i;n+=1)t=s[n],r=b.call(o,e,t.startTime,t.duration,t.timescale,t.media,t.mediaRange,d),l.push(r),r=null,d+=1;e.segmentAvailabilityRange={start:l[0].presentationStartTime,end:l[i-1].presentationStartTime},e.availableSegmentsNumber=i,e.segmentStartIndex=0,a.resolve(l)},function(){a.reject()}),a.promise},D=function(t){var n,i,r=y.defer(),o=this;return A.call(o,t)?(n="SegmentTimeline"===t.segmentInfoType?f.call(o,t):"SegmentTemplate"===t.segmentInfoType?m.call(o,t):"SegmentList"===t.segmentInfoType?v.call(o,t):S.call(o,t),y.when(n).then(function(n){if(t.segments=n,i=n.length-1,e&&isNaN(t.adaptation.period.liveEdge)){var s=o.metricsModel.getMetricsFor("stream"),a=n[i].presentationStartTime;t.adaptation.period.liveEdge=a,o.metricsModel.updateManifestUpdateInfo(o.metricsExt.getCurrentManifestUpdate(s),{presentationStartTime:a})}r.resolve(n)},function(){r.reject()}),r.promise):y.when(t.segments)},I=function(e){var n=this,i=y.defer();return e.segments=null,n.debug.log("[DashHandler]["+t+"] updateSegmentList for representation ",e.id),D.call(n,e).then(function(t){e.segments=t,i.resolve(t)}),i.promise},L=function(e,n){var i,r,o,s,a=null===n?null:n.segments,l=null===a?0:a.length-1,d=-1,u=this;if(u.debug.log("[DashHandler]["+t+"] getIndexForSegments for time ",e),a&&a.length>0)for(s=l;s>=0;s--){if(i=a[s],r=i.presentationStartTime,o=i.duration,e+x.dependencies.DashHandler.EPSILON>=r&&e-x.dependencies.DashHandler.EPSILON<=r+o){d=i.availabilityIdx,u.debug.log("[DashHandler]["+t+"] getIndexForSegments, idx =  ",d);break}if(d===-1&&e-x.dependencies.DashHandler.EPSILON>r+o){u.debug.log("[DashHandler]["+t+"] getIndexForSegments, (past the end) idx =  ",d),d=isNaN(n.segmentDuration)?i.availabilityIdx+1:Math.floor((e-n.adaptation.period.start)/n.segmentDuration);break}}return d===-1&&(isNaN(n.segmentDuration)?u.debug.log("[DashHandler]["+t+"] Couldn't figure out segment for time: "+e):(u.debug.log("[DashHandler]["+t+"] getIndexForSegments, (segment duration) idx =  ",d),d=Math.floor((e-n.adaptation.period.start)/n.segmentDuration))),y.when(d)},M=function(e,t){if(!t||!t.segments)return null;var n,i,r=t.segments.length;for(i=0;i<r;i+=1)if(n=t.segments[i],n.availabilityIdx===e)return n;return null},R=function(e,t){if(!t||!t.segments)return null;var n,i,r=t.segments.length;for(i=0;i<r;i+=1)if(n=t.segments[i],void 0!==n.sequenceNumber&&n.sequenceNumber===e)return i<r-1?t.segments[i+1]:null;return null},A=function(e){var t,r,o,s,a=!1,l=e.segments;return l&&0!==l.length?null!==i?(s=l[0].presentationStartTime,o=l[l.length-1].presentationStartTime,a=i<s||i>o):(r=l[0].availabilityIdx,t=l[l.length-1].availabilityIdx,a=n<r||n>t):a=!0,a},P=function(e){if(null===e||void 0===e)return null;var n,i=new T.vo.SegmentRequest,r=e.representation,l=r.adaptation.period.mpd.manifest.Period_asArray[r.adaptation.period.index].AdaptationSet_asArray[r.adaptation.index].Representation_asArray[r.index].bandwidth;return n=d(e.media,r),n=o(n,"Number",e.replacementNumber),n=o(n,"Time",e.replacementTime),n=o(n,"Bandwidth",l),n=a(n,r.id),n=s(n),i.streamType=t,i.type="Media Segment",i.url=n,i.range=e.mediaRange,i.startTime=e.presentationStartTime,i.duration=e.duration,i.timescale=r.timescale,i.availabilityStartTime=e.availabilityStartTime,i.availabilityEndTime=e.availabilityEndTime,i.wallStartTime=e.wallStartTime,i.quality=r.index,i.index=e.availabilityIdx,void 0!==e.sequenceNumber&&(i.sequenceNumber=e.sequenceNumber),void 0!==e.decryptionInfo&&(i.decryptionInfo=e.decryptionInfo),i},w=function(e,r){var o,s,a,l=this;return e?(i=r,n=-1,l.debug.log("[DashHandler]["+t+"] Getting the request for time: "+r),o=y.defer(),D.call(l,e).then(function(){var t;return t=L.call(l,r,e)},function(){o.reject()}).then(function(i){return l.debug.log("[DashHandler]["+t+"] Index for time "+r+" is "+i),n=i,y.when(h.call(l,e))}).then(function(i){var r=null;return i?(s=new T.vo.SegmentRequest,s.action=s.ACTION_COMPLETE,s.index=n,l.debug.log("[DashHandler]["+t+"] Signal complete."),l.debug.log(s),o.resolve(s)):(a=M(n,e),r=P.call(l,a)),y.when(r)}).then(function(e){o.resolve(e)}),o.promise):y.reject("no representation")},B=function(e){var r,o,s,a,l=this;if(!e)return y.reject("no represenation");if(n===-1)throw"You must call getSegmentRequestForTime first.";return i=null,n+=1,r=y.defer(),l.debug.log("[DashHandler]["+t+"] Getting the next request => index = "+n),a=h.call(l,e),a?(o=new T.vo.SegmentRequest,o.action=o.ACTION_COMPLETE,o.index=n,l.debug.log("[DashHandler]["+t+"] Signal complete."),r.resolve(o)):D.call(l,e).then(function(){var t;return s=M(n,e),t=P.call(l,s),y.when(t)}).then(function(e){r.resolve(e)}),r.promise},F=function(e,r){var o,s,a,l,d=this;if(!e)return y.reject("no represenation");if(n===-1)throw"You must call getSegmentRequestForTime first.";return i=null,n+=1,o=y.defer(),d.debug.log("[DashHandler]["+t+"] Getting the next request => sn = "+r),D.call(d,e).then(function(){if(l=h.call(d,e))s=new T.vo.SegmentRequest,s.action=s.ACTION_COMPLETE,s.index=n,d.debug.log("[DashHandler]["+t+"] Signal complete."),o.resolve(s);else if(a=R(r,e),null===a)o.resolve(null);else{n=a.availabilityIdx;var i=P.call(d,a);o.resolve(i)}}),o.promise},N=function(e,n,i){var r,o=this,s=Math.max(n-i,0),a=y.defer(),l=0;return e?(o.debug.log("[DashHandler]["+t+"] getSegmentCountForDuration"),D.call(o,e).then(function(e){r=e[0].duration,l=Math.ceil(s/r),a.resolve(l)},function(){a.resolve(0)}),a.promise):y.reject("no represenation")},C=function(e){var i,r,o=this,s=y.defer();return e?(r=n,D.call(o,e).then(function(n){r<0?i=o.timelineConverter.calcPresentationStartTime(e.adaptation.period):(r=r<n[0].availabilityIdx?n[0].availabilityIdx:Math.min(n[n.length-1].availabilityIdx,r),i=M(r,e).presentationStartTime,o.debug.log("[DashHandler]["+t+"] getSegmentByIndex, index = "+r+" => time = "+i)),o.debug.log("[DashHandler]["+t+"] getCurrentTime => ",i),s.resolve(i)},function(){s.reject()}),s.promise):y.reject("no represenation")},O=function(){},U=function(){};return{debug:void 0,baseURLExt:void 0,metricsModel:void 0,metricsExt:void 0,manifestModel:void 0,manifestExt:void 0,timelineConverter:void 0,capabilities:void 0,videoModel:void 0,getType:function(){return t},setType:function(e){t=e},getIsDynamic:function(){return e},setIsDynamic:function(t){e=t},getInitRequest:c,getSegmentRequestForTime:w,getNextSegmentRequest:B,getNextSegmentRequestFromSN:F,getCurrentTime:C,getSegmentCountForDuration:N,updateSegmentList:I,getIFrameRequest:O,getFragmentInfoRequest:U}},x.dependencies.DashHandler.EPSILON=.003,x.dependencies.DashHandler.prototype={constructor:x.dependencies.DashHandler},x.dependencies.DashManifestExtensions=function(){"use strict";this.timelineConverter=void 0},x.dependencies.DashManifestExtensions.prototype={constructor:x.dependencies.DashManifestExtensions,getIsType:function(e,t,n){"use strict";var i,r,o,s,a=!1;if(!e)return!1;if(void 0===e.type&&(e.type=null),o=e.ContentComponent_asArray)for(i=0;i<e.ContentComponent_asArray.length&&!a;i++)e.ContentComponent_asArray[i].contentType===t&&(e.type=t,a=!0);if(!a&&e.mimeType)for(i=0;i<n.length&&!a;i++)e.mimeType.indexOf(n[i])!==-1&&(e.type=t,a=!0);if(!a)for(i=0;i<e.Representation_asArray.length&&!a;i++)for(s=e.Representation_asArray[i],r=0;r<n.length&&!a;r++)s.mimeType.indexOf(n[r])!==-1&&(e.type=t,a=!0);return a},getIsVideo:function(e){return this.getIsType(e,"video",["video"])},getIsAudio:function(e){return this.getIsType(e,"audio",["audio"])},getIsText:function(e){return this.getIsType(e,"text",["vtt","ttml","application/mp4"])},getIsTextTrack:function(e){return"text/vtt"===e||"application/ttml+xml"===e||"application/ttml+xml+mp4"===e||"application/mp4"===e},getIsMain:function(){"use strict";return!1},processAdaptation:function(e){"use strict";return void 0!==e.Representation_asArray&&null!==e.Representation_asArray&&e.Representation_asArray.sort(function(e,t){return e.bandwidth-t.bandwidth}),e},getDataForId:function(e,t,n){"use strict";var i,r,o=t.Period_asArray[n].AdaptationSet_asArray;for(i=0,r=o.length;i<r;i+=1)if(o[i].hasOwnProperty("id")&&o[i].id===e)return o[i];return null},getDataForIndex:function(e,t,n){"use strict";var i;return t&&n>=0&&(i=t.Period_asArray[n].AdaptationSet_asArray,i&&i.length>0&&!isNaN(e))?i[e]:[]},getIndex:function(e,t){var n,i,r,o=t.Period_asArray;for(i=0;i<o.length;i+=1)for(n=o[i].AdaptationSet_asArray,r=0;r<n.length;r+=1)if(n[r]===e)return r;return-1},getDataIndex:function(e,t,n){"use strict";var i,r,o;if(t&&n>=0)if(i=t.Period_asArray[n].AdaptationSet_asArray,e.id){for(r=0,o=i.length;r<o;r+=1)if(i[r].id&&i[r].id===e.id)return r}else{var s,a=JSON.stringify(e);for(r=0,o=i.length;r<o;r+=1)if(s=JSON.stringify(i[r]),s===a)return r}return-1},getVideoData:function(e,t){"use strict";var n,i;if(!e||t<0)return null;if(n=e.Period_asArray[t].AdaptationSet_asArray,0===n.length)return null;for(i=0;i<n.length;i+=1)if(this.getIsVideo(n[i]))return n[i];return null},getTextDatas:function(e,t){"use strict";var n,i,r=[];if(!e||t<0)return r;if(n=e.Period_asArray[t].AdaptationSet_asArray,0===n.length)return r;for(i=0;i<n.length;i+=1)this.getIsText(n[i])&&r.push(n[i]);return r},getAudioDatas:function(e,t){"use strict";var n,i,r=[];if(!e||t<0)return r;if(n=e.Period_asArray[t].AdaptationSet_asArray,0===n.length)return r;for(i=0;i<n.length;i+=1)this.getIsAudio(n[i])&&r.push(n[i]);return r},getSpecificAudioData:function(e,t,n){"use strict";var i,r;if(!e||t<0)return null;if(r=this.getAudioDatas(e,t),0===r.length)return null;for(i=0;i<r.length;i+=1)if(r[i].lang===n)return this.processAdaptation(r[i]);return this.processAdaptation(r[0])},getSpecificTextData:function(e,t,n){"use strict";var i,r;if(!e||t<0)return null;if(r=this.getTextDatas(e,t),0===r.length)return null;for(i=0;i<r.length;i+=1)if(r[i].lang===n)return this.processAdaptation(r[i]);return this.processAdaptation(r[0])},getCodec:function(e){"use strict";for(var t,n=0,i=null;null===i&&n<e.Representation_asArray.length;)t=e.Representation_asArray[n],null!==t.codecs&&""!==t.codecs&&(i=t.mimeType+';codecs="'+t.codecs+'"'),n++;return i},getMimeType:function(e){"use strict";return e.Representation_asArray[0].mimeType},getKID:function(e){"use strict";return e&&e.hasOwnProperty("cenc:default_KID")?e["cenc:default_KID"]:null},getContentProtectionData:function(e){"use strict";return e&&e.hasOwnProperty("ContentProtection_asArray")&&0!==e.ContentProtection_asArray.length?e.ContentProtection_asArray:null},getIsDynamic:function(e){"use strict";var t=!1,n="dynamic";return e&&e.hasOwnProperty("type")&&(t=e.type===n),t},getIsDVR:function(e){"use strict";var t,n,i=this.getIsDynamic(e);return t=!isNaN(e.timeShiftBufferDepth),n=i&&t},getIsOnDemand:function(e){"use strict";var t=!1;return e.profiles&&e.profiles.length>0&&(t=e.profiles.indexOf("urn:mpeg:dash:profile:isoff-on-demand:2011")!==-1),t},getDuration:function(e){var t;return t=e&&e.hasOwnProperty("mediaPresentationDuration")?e.mediaPresentationDuration:Number.POSITIVE_INFINITY},getBandwidth:function(e){"use strict";return e.bandwidth},getRefreshDelay:function(e){"use strict";var t=NaN,n=2;return e.hasOwnProperty("minimumUpdatePeriod")&&(t=Math.max(parseFloat(e.minimumUpdatePeriod),n)),t},getRepresentationCount:function(e){"use strict";return e?e.Representation_asArray.length:null},getRepresentationFor:function(e,t){"use strict";return t.Representation_asArray[e]},getRepresentationsForAdaptation:function(e,t){var n,i,r,o,s,a=[];if(e&&t){n=this.processAdaptation(e.Period_asArray[t.period.index].AdaptationSet_asArray[t.index]);for(var l=0;l<n.Representation_asArray.length;l+=1)s=n.Representation_asArray[l],i=new x.vo.Representation,i.index=l,i.adaptation=t,s.hasOwnProperty("id")&&(i.id=s.id),s.hasOwnProperty("SegmentBase")?(o=s.SegmentBase,i.segmentInfoType="SegmentBase"):s.hasOwnProperty("SegmentList")?(o=s.SegmentList,i.segmentInfoType="SegmentList",i.useCalculatedLiveEdgeTime=!0):s.hasOwnProperty("SegmentTemplate")?(o=s.SegmentTemplate,o.hasOwnProperty("SegmentTimeline")?i.segmentInfoType="SegmentTimeline":i.segmentInfoType="SegmentTemplate",o.hasOwnProperty("initialization")&&(i.initialization=o.initialization.split("$Bandwidth$").join(s.bandwidth).split("$RepresentationID$").join(s.id))):(o=s.BaseURL,i.segmentInfoType="BaseURL"),o.hasOwnProperty("Initialization")?(r=o.Initialization,r.hasOwnProperty("sourceURL")?i.initialization=r.sourceURL:r.hasOwnProperty("range")&&(i.initialization=s.BaseURL,i.range=r.range)):s.hasOwnProperty("mimeType")&&this.getIsTextTrack(s.mimeType)&&(i.initialization=s.BaseURL,i.range=0),o.hasOwnProperty("timescale")&&(i.timescale=o.timescale),o.hasOwnProperty("duration")&&(i.segmentDuration=o.duration/i.timescale),o.hasOwnProperty("startNumber")&&(i.startNumber=o.startNumber),o.hasOwnProperty("indexRange")&&(i.indexRange=o.indexRange),o.hasOwnProperty("presentationTimeOffset")&&(i.presentationTimeOffset=o.presentationTimeOffset/i.timescale),i.MSETimeOffset=this.timelineConverter.calcMSETimeOffset(i),a.push(i)}return a},getAdaptationsForPeriod:function(e,t){var n,i=null===e?null:e.Period_asArray[t.index],r=[];if(i)for(var o=0;o<i.AdaptationSet_asArray.length;o+=1)n=new x.vo.AdaptationSet,n.index=o,n.period=t,r.push(n);return r},getRegularPeriods:function(e,t){var n,i,r=[],o=this.getIsDynamic(e),s=null,a=null,l=null,d=null;for(n=0,i=e.Period_asArray.length;n<i;n+=1)a=e.Period_asArray[n],a.hasOwnProperty("start")?(d=new x.vo.Period,d.start=a.start):null!==s&&a.hasOwnProperty("duration")?(d=new x.vo.Period,d.start=l.start+l.duration,d.duration=a.duration):0!==n||o||(d=new x.vo.Period,d.start=0),null!==l&&isNaN(l.duration)&&(l.duration=d.start-l.start),null!==d&&a.hasOwnProperty("id")&&(d.id=a.id),null!==d&&a.hasOwnProperty("duration")&&(d.duration=a.duration),null!==d&&(d.index=n,d.mpd=t,r.push(d)),s=a,a=null,l=d,d=null;return 0===r.length?r:(t.checkTime=this.getCheckTime(e,r[0]),null!==l&&isNaN(l.duration)&&(l.duration=this.getEndTimeForLastPeriod(t)-l.start),r)},getMpd:function(e){var t=new x.vo.Mpd;return e?(t.manifest=e,e.hasOwnProperty("availabilityStartTime")?t.availabilityStartTime=new Date(e.availabilityStartTime.getTime()):t.availabilityStartTime=new Date(e.mpdLoadedTime.getTime()),e.hasOwnProperty("availabilityEndTime")&&(t.availabilityEndTime=new Date(e.availabilityEndTime.getTime())),e.hasOwnProperty("suggestedPresentationDelay")&&(t.suggestedPresentationDelay=e.suggestedPresentationDelay),e.hasOwnProperty("timeShiftBufferDepth")&&(t.timeShiftBufferDepth=e.timeShiftBufferDepth),e.hasOwnProperty("maxSegmentDuration")&&(t.maxSegmentDuration=e.maxSegmentDuration),t):null},getFetchTime:function(e,t){var n=this.timelineConverter.calcPresentationTimeFromWallTime(e.mpdLoadedTime,t);return n},getCheckTime:function(e,t){var n=NaN;return e.hasOwnProperty("minimumUpdatePeriod")&&(n=this.getFetchTime(e,t)+e.minimumUpdatePeriod),n},getEndTimeForLastPeriod:function(e){var t;if(e.manifest.mediaPresentationDuration)t=e.manifest.mediaPresentationDuration;else{if(isNaN(e.checkTime))return new Error("Must have @mediaPresentationDuration or @minimumUpdatePeriod on MPD or an explicit @duration on the last period.");t=e.checkTime}return t},getEventsForPeriod:function(e,t){var n=null===e?null:e.Period_asArray,i=null===n?null:n[t.index].EventStream_asArray,r=[];if(i)for(var o=0;o<i.length;o+=1){var s=new x.vo.EventStream;if(s.period=t,s.timescale=1,!i[o].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";s.schemeIdUri=i[o].schemeIdUri,i[o].hasOwnProperty("timescale")&&(s.timescale=i[o].timescale),i[o].hasOwnProperty("value")&&(s.value=i[o].value);for(var a=0;a<i[o].Event_asArray.length;a+=1){var l=new x.vo.Event;l.presentationTime=0,l.eventStream=s,i[o].Event_asArray[a].hasOwnProperty("presentationTime")&&(l.presentationTime=i[o].Event_asArray[a].presentationTime),i[o].Event_asArray[a].hasOwnProperty("duration")&&(l.duration=i[o].Event_asArray[a].duration),i[o].Event_asArray[a].hasOwnProperty("id")&&(l.id=i[o].Event_asArray[a].id),r.push(l)}}return r},getEventStreamForAdaptationSet:function(e){var t,n=[];if(e&&(t=e.InbandEventStream_asArray))for(var i=0;i<t.length;i+=1){var r=new x.vo.EventStream;if(r.timescale=1,!t[i].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";r.schemeIdUri=t[i].schemeIdUri,t[i].hasOwnProperty("timescale")&&(r.timescale=t[i].timescale),t[i].hasOwnProperty("value")&&(r.value=t[i].value),n.push(r)}return n},getEventStreamForRepresentation:function(e,t){var n,i=[];if(e&&t&&(n=e.Representation_asArray[t.index].InbandEventStream_asArray))for(var r=0;r<n.length;r++){var o=new x.vo.EventStream;if(o.timescale=1,o.representation=t,!n[r].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";o.schemeIdUri=n[r].schemeIdUri,n[r].hasOwnProperty("timescale")&&(o.timescale=n[r].timescale),n[r].hasOwnProperty("value")&&(o.value=n[r].value),i.push(o)}return i},getRepresentationBandwidth:function(e,t){return this.getBandwidth(this.getRepresentationFor(t,e))}},x.dependencies.DashMetricsExtensions=function(){"use strict";var e=function(e,t){var n,i,r,o,s,a,l,d;for(a=0;a<e.length;a+=1)for(n=e[a],r=n.AdaptationSet_asArray,l=0;l<r.length;l+=1)for(i=r[l],s=i.Representation_asArray,d=0;d<s.length;d+=1)if(o=s[d],t===o.id)return d;return-1},t=function(e,t){var n,i,r,o,s,a,l,d;for(a=0;a<e.length;a+=1)for(n=e[a],r=n.AdaptationSet_asArray,l=0;l<r.length;l+=1)for(i=r[l],s=i.Representation_asArray,d=0;d<s.length;d+=1)if(o=s[d],t===o.id)return o;return null},n=function(e,t){var n=!1;return"video"===t?(this.manifestExt.getIsVideo(e),"video"===e.type&&(n=!0)):"audio"===t?(this.manifestExt.getIsAudio(e),"audio"===e.type&&(n=!0)):n=!1,n},i=function(e,t){var i,r,o,s,a,l;for(a=0;a<e.length;a+=1)for(i=e[a],o=i.AdaptationSet_asArray,l=0;l<o.length;l+=1)if(r=o[l],s=r.Representation_asArray,n.call(this,r,t))return s.length;return-1},r=function(e){var n,i=this,r=i.manifestModel.getValue(),o=null===r?null:r.Period_asArray;return o?(n=t.call(i,o,e),null===n?null:n.bandwidth):null},o=function(t){var n,i=this,r=i.manifestModel.getValue(),o=null===r?null:r.Period_asArray;return o?n=e.call(i,o,t):null},s=function(e){var t,n=this,r=n.manifestModel.getValue(),o=null===r?null:r.Period_asArray;return o?t=i.call(this,o,e):null},a=function(e){if(null===e)return null;var t,n,i,r=e.RepSwitchList;return null===r||r.length<=0?null:(t=r.length,n=t-1,i=r[n])},l=function(e){if(null===e)return null;var t,n,i,r=e.BufferLevel;return null===r||r.length<=0?null:(t=r.length,n=t-1,i=r[n])},d=function(e){if(null===e)return null;var t,n,i=e.HttpList,r=null;if(null===i||i.length<=0)return null;for(t=i.length,n=t-1;n>=0;){if(null!==i[n].responsecode){r=i[n];break}n-=1}return r},u=function(e){return null===e?[]:e.HttpList?e.HttpList:[]},c=function(e){if(null===e)return null;var t,n,i,r=e.DroppedFrames;return null===r||r.length<=0?null:(t=r.length,n=t-1,i=r[n])},h=function(e){if(null===e)return null;var t=e.PlaybackQuality;return null===t||t.length<=0?null:t[t.length-1]},p=function(e){if(null===e)return null;var t,n=e.DVRInfo,i=null;return null===n||n.length<=0?null:(t=n.length-1,i=n[t])},f=function(e){if(null===e)return null;var t,n,i,r=e.ManifestUpdate;return null===r||r.length<=0?null:(t=r.length,n=t-1,i=r[n])};return{manifestModel:void 0,manifestExt:void 0,getBandwidthForRepresentation:r,getIndexForRepresentation:o,getMaxIndexForBufferType:s,getCurrentRepresentationSwitch:a,getCurrentBufferLevel:l,getCurrentHttpRequest:d,getHttpRequests:u,getCurrentDroppedFrames:c,getCurrentPlaybackQuality:h,getCurrentDVRInfo:p,getCurrentManifestUpdate:f}},x.dependencies.DashMetricsExtensions.prototype={constructor:x.dependencies.DashMetricsExtensions},x.dependencies.DashParser=function(){"use strict";var e=31536e3,t=2592e3,n=86400,i=3600,r=60,o=60,s=1e3,a=/^P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,l=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,d=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,u=[{type:"duration",test:function(e){return a.test(e)},converter:function(o){var s=a.exec(o);return parseFloat(s[2]||0)*e+parseFloat(s[4]||0)*t+parseFloat(s[6]||0)*n+parseFloat(s[8]||0)*i+parseFloat(s[10]||0)*r+parseFloat(s[12]||0)}},{type:"datetime",test:function(e){return l.test(e)},converter:function(e){var t,n=l.exec(e);if(t=Date.UTC(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10),parseInt(n[4],10),parseInt(n[5],10),n[6]&&parseInt(n[6],10)||0,n[7]&&parseFloat(n[7])*s||0),n[9]&&n[10]){var i=parseInt(n[9],10)*o+parseInt(n[10],10);t+=("+"===n[8]?-1:1)*i*r*s}return new Date(t)}},{type:"numeric",test:function(e){return d.test(e)},converter:function(e){return parseFloat(e)}}],c=function(){var e,t,n,i;return i=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}],e={},e.name="AdaptationSet",e.isRoot=!1,e.isArray=!0,e.parent=null,e.children=[],e.properties=i,t={},t.name="Representation",t.isRoot=!1,t.isArray=!0,t.parent=e,t.children=[],t.properties=i,e.children.push(t),n={},n.name="SubRepresentation",n.isRoot=!1,n.isArray=!0,n.parent=t,n.children=[],n.properties=i,t.children.push(n),e},h=function(){var e,t,n,i;return i=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}],e={},e.name="Period",e.isRoot=!1,e.isArray=!0,e.parent=null,e.children=[],e.properties=i,t={},t.name="AdaptationSet",t.isRoot=!1,t.isArray=!0,t.parent=e,t.children=[],t.properties=i,e.children.push(t),n={},n.name="Representation",n.isRoot=!1,n.isArray=!0,n.parent=t,n.children=[],n.properties=i,t.children.push(n),e},m=function(){var e,t,n,i,r;return r=[{name:"BaseURL",merge:!0,mergeFunction:function(e,t){var n;return n=0===t.indexOf("http://")?t:e+t}}],e={},e.name="mpd",e.isRoot=!0,e.isArray=!0,e.parent=null,e.children=[],e.properties=r,t={},t.name="Period",t.isRoot=!1,t.isArray=!0,t.parent=null,t.children=[],t.properties=r,e.children.push(t),n={},n.name="AdaptationSet",n.isRoot=!1,n.isArray=!0,n.parent=t,n.children=[],n.properties=r,t.children.push(n),i={},i.name="Representation",i.isRoot=!1,i.isArray=!0,i.parent=n,i.children=[],i.properties=r,n.children.push(i),e},g=function(){var e=[];return e.push(c()),e.push(h()),e.push(m()),e},_=function(e,t){var n,i=new f(u,"",(!0)),r=new p(g()),o=new Date,s=null,a=null;try{n=i.xml_str2json(e),s=new Date,n.hasOwnProperty("BaseURL")?(n.BaseURL=n.BaseURL_asArray[0],0!==n.BaseURL.toString().indexOf("http")&&(n.BaseURL=t+n.BaseURL)):n.BaseURL=t,r.run(n),a=new Date,this.debug.log("Parsing complete: ( xml2json: "+(s.getTime()-o.getTime())+"ms, objectiron: "+(a.getTime()-s.getTime())+"ms, total: "+(a.getTime()-o.getTime())/1e3+"s)")}catch(l){return y.reject(null)}return y.when(n)};return{debug:void 0,parse:_}},x.dependencies.DashParser.prototype={constructor:x.dependencies.DashParser},x.dependencies.FragmentExtensions=function(){"use strict";var e=function(e){for(var t,n,i,r,o,s,a=new DataView(e),l=0;"tfdt"!==r&&l<a.byteLength;){for(i=a.getUint32(l),l+=4,r="",o=0;o<4;o+=1)s=a.getInt8(l),r+=String.fromCharCode(s),l+=1;"moof"!==r&&"traf"!==r&&"tfdt"!==r&&(l+=i-8)}if(l===a.byteLength)throw"Error finding live offset.";return n=a.getUint8(l),this.debug.log("position: "+l),0===n?(l+=4,t=a.getUint32(l,!1)):(l+=i-16,t=A.Math.to64BitNumber(a.getUint32(l+4,!1),a.getUint32(l,!1))),{version:n,base_media_decode_time:t
}},t=function(e){for(var t,n,i,r,o,s,a,l=new DataView(e),d=0;"sidx"!==o&&d<l.byteLength;){for(s=l.getUint32(d),d+=4,o="",r=0;r<4;r+=1)a=l.getInt8(d),o+=String.fromCharCode(a),d+=1;"moof"!==o&&"traf"!==o&&"sidx"!==o?d+=s-8:"sidx"===o&&(d-=8)}return t=l.getUint8(d+8),d+=12,n=l.getUint32(d+4,!1),d+=8,i=0===t?l.getUint32(d,!1):A.Math.to64BitNumber(l.getUint32(d+4,!1),l.getUint32(d,!1)),y.when({earliestPresentationTime:i,timescale:n})},n=function(t){var n,i,r,o=y.defer(),s=new XMLHttpRequest,a=!1;return n=t,s.onloadend=function(){a||(i="Error loading fragment: "+n,o.reject(i))},s.onload=function(){a=!0,r=e(s.response),o.resolve(r)},s.onerror=function(){i="Error loading fragment: "+n,o.reject(i)},s.responseType="arraybuffer",s.open("GET",n),s.send(null),o.promise};return{debug:void 0,loadFragment:n,parseTFDT:e,parseSIDX:t}},x.dependencies.FragmentExtensions.prototype={constructor:x.dependencies.FragmentExtensions},x.dependencies.TimelineConverter=function(){"use strict";var e=0,t=function(e,t,n,i){var r=NaN;return r=i?n&&t.timeShiftBufferDepth!==Number.POSITIVE_INFINITY?new Date(t.availabilityStartTime.getTime()+1e3*(e+t.timeShiftBufferDepth)):t.availabilityEndTime:n?new Date(t.availabilityStartTime.getTime()+1e3*e):t.availabilityStartTime},n=function(e,n,i){return t.call(this,e,n,i)},i=function(e,n,i){return t.call(this,e,n,i,!0)},r=function(e){var t,n="dynamic"===e.mpd.manifest.type,i=parseInt(this.uriQueryFragModel.getURIFragmentData().s,10);return n?(!isNaN(i)&&i>1262304e3&&(t=i-e.mpd.availabilityStartTime.getTime()/1e3,(t>e.liveEdge||t<e.liveEdge-e.mpd.timeShiftBufferDepth)&&(t=null)),t=t||e.liveEdge):t=!isNaN(i)&&i<e.duration&&i>=0?i:e.start,t},o=function(e,t){return(e.getTime()-t.mpd.availabilityStartTime.getTime())/1e3},s=function(e,t){var n=t.presentationTimeOffset;return e-n},a=function(e,t){var n=t.presentationTimeOffset;return n+e},l=function(e,t){var n,i,r;return t&&(n=e.representation.adaptation.period.mpd.suggestedPresentationDelay,i=e.presentationStartTime+n,r=new Date(e.availabilityStartTime.getTime()+1e3*i)),r},d=function(e,t,n){var i,r=this,o=r.calcSegmentAvailabilityRange(e,n);return t>=o.start&&t<=o.end?t:i=Math.max(o.end-2*e.adaptation.period.mpd.manifest.minBufferTime,o.start)},u=function(t,n){var i,r,s=t.segmentDuration,a=0,l=t.adaptation.period.duration,d={start:a,end:l};return n?t.adaptation.period.mpd.isClientServerTimeSyncCompleted&&!isNaN(s)||!t.segmentAvailabilityRange?(i=t.adaptation.period.mpd.checkTime,r=o(new Date((new Date).getTime()+e),t.adaptation.period),a=Math.max(r-t.adaptation.period.mpd.timeShiftBufferDepth,0),i+=e/1e3,l=isNaN(i)?r:Math.min(i,r),d={start:a,end:l}):t.segmentAvailabilityRange:d},c=function(e){var t=e.presentationTimeOffset;return-t};return{system:void 0,debug:void 0,uriQueryFragModel:void 0,setup:function(){},calcAvailabilityStartTimeFromPresentationTime:n,calcAvailabilityEndTimeFromPresentationTime:i,calcPresentationTimeFromWallTime:o,calcPresentationTimeFromMediaTime:s,calcPresentationStartTime:r,calcActualPresentationTime:d,calcMediaTimeFromPresentationTime:a,calcSegmentAvailabilityRange:u,calcWallTimeForSegment:l,calcMSETimeOffset:c}},x.dependencies.TimelineConverter.prototype={constructor:x.dependencies.TimelineConverter},x.vo.AdaptationSet=function(){"use strict";this.period=null,this.index=-1},x.vo.AdaptationSet.prototype={constructor:x.vo.AdaptationSet},x.vo.Event=function(){"use strict";this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN},x.vo.Event.prototype={constructor:x.vo.Event},x.vo.EventStream=function(){"use strict";this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri=""},x.vo.EventStream.prototype={constructor:x.vo.EventStream},x.vo.Mpd=function(){"use strict";this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.checkTime=NaN,this.clientServerTimeShift=0,this.isClientServerTimeSyncCompleted=!1},x.vo.Mpd.prototype={constructor:x.vo.Mpd},x.vo.Period=function(){"use strict";this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null,this.liveEdge=NaN},x.vo.Period.prototype={constructor:x.vo.Period},x.vo.Representation=function(){"use strict";this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0},x.vo.Representation.prototype={constructor:x.vo.Representation},x.vo.Segment=function(){"use strict";this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.availabilityIdx=NaN,this.wallStartTime=NaN,this.representation=null},x.vo.Segment.prototype={constructor:x.vo.Segment},T.models.ProtectionModel=function(){},T.models.ProtectionModel.eventList={ENAME_NEED_KEY:"needkey",ENAME_KEY_SYSTEM_ACCESS_COMPLETE:"keySystemAccessComplete",ENAME_KEY_SYSTEM_SELECTED:"keySystemSelected",ENAME_VIDEO_ELEMENT_SELECTED:"videoElementSelected",ENAME_SERVER_CERTIFICATE_UPDATED:"serverCertificateUpdated",ENAME_KEY_MESSAGE:"keyMessage",ENAME_KEY_ADDED:"keyAdded",ENAME_KEY_ERROR:"keyError",ENAME_KEY_SESSION_CREATED:"keySessionCreated",ENAME_KEY_SESSION_REMOVED:"keySessionRemoved",ENAME_KEY_SESSION_CLOSED:"keySessionClosed",ENAME_KEY_STATUSES_CHANGED:"keyStatusesChanged",ENAME_TEARDOWN_COMPLETE:"protectionTeardownComplete"},T.utils.copyMethods=function(e){var t=new e;t.parent={};for(var n in t)t.parent[n]=t[n];return t.setup=function(){for(var e in this.parent)void 0===this.parent[e]&&(this.parent[e]=this[e])},t},T.utils.DOMParser=function(){"use strict";var e=null,t=null;return{getAllSpecificNodes:function(e,t){var n,i,r=0,o=[];if(e&&(i=e.querySelectorAll(t)))for(r=0;r<i.length;r++)n=this.getAttributeValue(i[r],"xml:id"),n&&(o[n]=i[r].attributes,i[r].childNodes.length>0&&(o[n].childNodes=i[r].childNodes));return o},getAttributeName:function(e,t){var n=[],i=null,r=0,o=null;if(e&&e.attributes&&(o=e.attributes))for(r=0;r<o.length;r++)i=o[r],i.value===t&&n.push(i.name);return n},getTextNodesIn:function(e){var t=[],n=0,i=null,r=null,o=null;if(e)for(i=e.childNodes,n=0;n<i.length;n++)r=i[n],o=r.nodeType,3==o?t.push(r):1!=o&&9!=o&&11!=o||(t=t.concat(this.getTextNodesIn(r)));return t},getAttributeValue:function(e,t,n){var i=null;return e&&"function"==typeof e.getAttribute&&(i=e.getAttribute(t),null===i&&n&&(i=e.getAttributeNS(n,t))),i},getChildNode:function(e,t){var n,i=0;if(e&&e.childNodes)for(i=0;i<e.childNodes.length;i++){if(n=e.childNodes[i],n.nodeName===t)return n;n=void 0}return n},getChildNodes:function(e,t){var n=0,i=[];if(e&&e.childNodes)for(n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeName===t&&i.push(e.childNodes[n]);return i},createXmlTree:function(n){if(window.DOMParser)try{if(e||(e=new window.DOMParser),t=e.parseFromString(n,"text/xml"),t.getElementsByTagName("parsererror").length>0)throw new Error("Error parsing XML")}catch(i){t=null}return t}}},T.utils.ObjectIron=function(e){var t;t=[];for(var n=0,i=e.length;n<i;n+=1)e[n].isRoot?t.push("root"):t.push(e[n].name);var r=function(e,t){var n;if(null!==e&&null!==t)for(n in e)e.hasOwnProperty(n)&&(t.hasOwnProperty(n)||(t[n]=e[n]))},o=function(e,t,n){var i,o,s,a,l;if(null!==e&&0!==e.length)for(i=0,o=e.length;i<o;i+=1)s=e[i],t.hasOwnProperty(s.name)&&(n.hasOwnProperty(s.name)?s.merge&&(a=t[s.name],l=n[s.name],"object"==typeof a&&"object"==typeof l?r(a,l):null!==s.mergeFunction?n[s.name]=s.mergeFunction(a,l):n[s.name]=a+l):n[s.name]=t[s.name])},s=function(e,t){var n,i,r,a,l,d,u,c=e;if(e.transformFunc&&(t=e.transformFunc(t)),null===c.children||0===c.children.length)return t;for(n=0,i=c.children.length;n<i;n+=1){d=c.children[n];var h=null;if(t.hasOwnProperty(d.name))if(d.isArray)for(l=t[d.name+"_asArray"],r=0,a=l.length;r<a;r+=1)u=l[r],o(c.properties,t,u),h=s(d,u),t[d.name+"_asArray"][r]=h,t[d.name][r]=h;else u=t[d.name],o(c.properties,t,u),h=s(d,u),t[d.name]=h,t[d.name+"_asArray"]=[h]}return t},a=function(n){var i,r,o,l,d,u,c;if(null===n)return n;if("object"!=typeof n)return n;for(i=0,r=t.length;i<r;i+=1)"root"===t[i]&&(d=e[i],u=n,n=s(d,u));for(l in n)if(n.hasOwnProperty(l)){if(o=t.indexOf(l),o!==-1)if(d=e[o],d.isArray)for(c=n[l+"_asArray"],i=0,r=c.length;i<r;i+=1)u=c[i],n[l][i]=s(d,u),n[l+"_asArray"][i]=s(d,u);else u=n[l],n[l]=s(d,u),n[l+"_asArray"]=[s(d,u)];n[l]=a(n[l])}return n};return{run:a}},T.dependencies.protection.CommonEncryption={findCencContentProtection:function(e){var t,n=null,i=0;for(i=0;i<e.length;++i)t=e[i],"urn:mpeg:dash:mp4protection:2011"===t.schemeIdUri.toLowerCase()&&"cenc"===t.value.toLowerCase()&&(n=t);return n},getPSSHData:function(e){var t=8,n=new DataView(e),i=n.getUint8(t);return t+=20,i>0&&(t+=4+16*n.getUint32(t)),t+=4,e.slice(t)},getPSSHForKeySystem:function(e,t){var n=T.dependencies.protection.CommonEncryption.parsePSSHList(t);return n.hasOwnProperty(e.uuid.toLowerCase())?n[e.uuid.toLowerCase()]:null},parseInitDataFromContentProtection:function(e){return e&&"pssh"in e?L.decodeArray(e.pssh.__text).buffer:null},readBytes:function(e,t,n){var i=0,r=0;for(r=0;r<n;r++)i<<=8,i+=e[t],t++;return i},parsePSSHList:function(e){if(null===e)return[];var t,n,i,r,o,s,a,l,d=e,u=!1,c={},h=0;for(e.buffer||(d=new Uint8Array(e));!(u||(s=h,h>=d.byteLength));)if(t=this.readBytes(d,h,4),n=h+t,h+=4,1886614376===this.readBytes(d,h,4))if(h+=4,i=this.readBytes(d,h,1),0===i||1===i){for(h+=1,h+=3,r="",a=0;a<4;a++)l=this.readBytes(d,h+a,1).toString(16),r+=1===l.length?"0"+l:l;for(h+=4,r+="-",a=0;a<2;a++)l=this.readBytes(d,h+a,1).toString(16),r+=1===l.length?"0"+l:l;for(h+=2,r+="-",a=0;a<2;a++)l=this.readBytes(d,h+a,1).toString(16),r+=1===l.length?"0"+l:l;for(h+=2,r+="-",a=0;a<2;a++)l=this.readBytes(d,h+a,1).toString(16),r+=1===l.length?"0"+l:l;for(h+=2,r+="-",a=0;a<6;a++)l=this.readBytes(d,h+a,1).toString(16),r+=1===l.length?"0"+l:l;h+=6,r=r.toLowerCase(),o=this.readBytes(d,h,4),h+=4,c[r]=d.subarray(s,n).buffer,h=n}else h=n;else h=n;return c},getKeySystemConfigurations:function(e,t,n){var i=[],r=[];return e&&r.push(new T.vo.protection.MediaCapability(e)),t&&i.push(new T.vo.protection.MediaCapability(t)),[new T.vo.protection.KeySystemConfiguration(i,r,"optional","temporary"===n?"optional":"required",[n])]}},ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return e instanceof ArrayBuffer}),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){var n,i,r,o=this.byteLength;return e=0|e||0,t=void 0===t?o:0|t,e<0&&(e=Math.max(e+o,0)),t<0&&(t=Math.max(t+o,0)),0===o||e>=o||e>=t?new ArrayBuffer(0):(n=Math.min(o-e,t-e),i=new ArrayBuffer(n),r=new Uint8Array(i),r.set(new Uint8Array(this,e,n)),i)}),T.dependencies.ProtectionController=function(){"use strict";var e,t,n,i=null,r=[],o=null,s=!1,a=function(e){var t=null,i=e.systemString;return n&&(t=i in n?n[i]:null),t},l=function(n,i){var o,s,a,l,d,u=this,c=[],h=[],p=0;if(u.debug.log("[DRM] Select key system"),this.keySystem){for(s=0;s<n.length;s++)if(this.keySystem===n[s].ks){o=n[s].ks.sessionType,c.push({ks:n[s].ks,configs:n[s].ks.getKeySystemConfigurations(t,e,o)}),h.push({schemeIdURI:n[s].ks.schemeIdURI,systemString:n[s].ks.systemString}),a={},a[T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE]=function(e){e.error?u.eventBus.dispatchEvent({type:T.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,error:"[DRM] KeySystem Access Denied! -- "+e.error}):(u.debug.log("[DRM] KeySystem Access Granted"),u.eventBus.dispatchEvent({type:T.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,data:e.data}),u.createKeySession(n[s].initData,n[s].cdmData))},this.protectionModel.subscribe(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,a,void 0,!0),this.protectionModel.requestKeySystemAccess(c);break}}else if(void 0===this.keySystem){for(this.keySystem=null,r.push(n),p=0;p<n.length;p++)o=n[p].ks.sessionType,c.push({ks:n[p].ks,configs:n[p].ks.getKeySystemConfigurations(t,e,o)}),h.push({schemeIdURI:n[p].ks.schemeIdURI,systemString:n[p].ks.systemString});l={},l[T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE]=function(e){e.error?(u.debug.log("[DRM] KeySystem Access Denied!"),u.keySystem=void 0,u.protectionModel.unsubscribe(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,l),i||u.eventBus.dispatchEvent({type:T.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,error:"[DRM] KeySystem Access Denied! -- "+e.error}),u.notify(T.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new T.vo.Error(T.dependencies.ErrorHandler.prototype.MEDIA_KEYSYSERR_ACCESS_DENIED,"No KeySystem/CDM available",{keySystems:h}))):(d=e.data,u.debug.log("[DRM] KeySystem Access ("+d.keySystem.systemString+") Granted!  Selecting key system..."),u.protectionModel.selectKeySystem(d))},l[T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED]=function(e){if(e.error)u.keySystem=void 0,i||u.eventBus.dispatchEvent({type:T.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,error:"[DRM] Error selecting key system! -- "+e.error}),u.notify(T.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new T.vo.Error(T.dependencies.ErrorHandler.prototype.MEDIA_KEYSYSERR_ACCESS_DENIED,"No KeySystem/CDM available",{keySystems:h}));else for(u.debug.log("[DRM] KeySystem selected => create key session"),u.keySystem=u.protectionModel.keySystem,u.eventBus.dispatchEvent({type:T.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,data:d}),p=0;p<r.length;p++)for(s=0;s<r[p].length;s++)if(u.keySystem===r[p][s].ks){u.createKeySession(r[p][s].initData,r[p][s].cdmData);break}},this.protectionModel.subscribe(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,l,void 0,!0),this.protectionModel.subscribe(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,l,void 0,!0),this.protectionModel.requestKeySystemAccess(c)}else r.push(n)},d=function(e){var t,n,i=this,r=null;t=e.data,n=t.messageType?t.messageType:"license-request",this.debug.log("[DRM] Key message: type = "+n),this.eventBus.dispatchEvent({type:T.dependencies.ProtectionController.events.KEY_MESSAGE,data:t});var s=t.message,l=t.sessionToken,d=a(this.keySystem),u=this.keySystem.systemString,c=this.protectionExt.getLicenseServer(this.keySystem,d,n),h=!0;if(!s||0===s.byteLength)return void this.notify(T.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new T.vo.Error(T.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NO_CHALLENGE,"Empty key message from CDM"));if(!c)return void this.debug.log("[DRM] License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+l.getSessionID());if(this.protectionExt.isClearKey(this.keySystem)){var p=this.protectionExt.processClearKeyLicenseRequest(d,s);if(p)return this.debug.log("[DRM] ClearKey license request handled by application!"),void this.protectionModel.updateKeySession(l,p)}o=new XMLHttpRequest;var f=null;if(d)if(d.serverURL){var m=d.serverURL;"string"==typeof m&&""!==m?f=m:"object"==typeof m&&m.hasOwnProperty(n)&&(f=m[n])}else d.laURL&&""!==d.laURL&&(f=d.laURL);if(null===f&&(f=this.keySystem.getLicenseServerURLFromInitData(T.dependencies.protection.CommonEncryption.getPSSHData(l.initData)),f||(f=e.data.defaultURL)),f=c.getServerURLFromMessage(f,s,n),this.debug.log("[DRM] Licenser server url: "+f),!f)return void this.notify(T.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new T.vo.Error(T.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_URL_LICENSER_UNKNOWN,"No license server URL specified"));o.open(c.getHTTPMethod(n),f,!0),o.responseType=c.getResponseType(u,n),o.onload=function(){this.status<200||this.status>299||200===this.status&&4===this.readyState&&(i.debug.log("[DRM] Received license response"),h=!1,r=c.getLicenseMessage(this.response,u,n),null!==r?(h=!1,i.protectionModel.updateKeySession(l,r)):h=!0)},o.onerror=o.onloadend=function(){return h?(h=!1,this.aborted||i.notify(T.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new T.vo.Error(T.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_LICENSER_ERROR,"License request failed",{url:f,status:this.status,error:this.response&&null!==this.response?c.getErrorResponse(this.response):""})),void(o=null)):void(o=null)};var g=function(e){var t;if(e)for(t in e)"authorization"===t.toLowerCase()&&(o.withCredentials=!0),o.setRequestHeader(t,e[t])};d&&g(d.httpRequestHeaders),g(this.keySystem.getRequestHeadersFromMessage(s)),d&&d.withCredentials&&(o.withCredentials=!0),this.debug.log("[DRM] Send license request");var y=this.keySystem.getLicenseRequestFromMessage(s);null===y&&this.notify(T.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new T.vo.Error(T.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NO_CHALLENGE,"No license challenge from CDM key message")),o.send(y)},u=function(e){var t,n,i=this;return i.debug.log("[DRM] onNeedKey, initDataType = "+e.data.initDataType),"cenc"!==e.data.initDataType?void i.debug.log("[DRM] Only 'cenc' initData is supported!  Ignoring initData of type: "+e.data.initDataType):(t=e.data.initData,ArrayBuffer.isView(t)&&(t=t.buffer),n=this.protectionExt.getSupportedKeySystems(t),0===n.length?void i.debug.log("[DRM] Received needkey event with initData, but we don't support any of the key systems!"):void l.call(this,n,!1))},c=function(e){e.error?(this.debug.error("[DRM] Failed to set license server certificate"),this.notify(T.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new T.vo.Error(T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_SERVER_CERTIFICATE,"Failed to set server certificate",e.error))):this.debug.log("[DRM] License server certificate successfully updated")},h=function(e){e.error?(this.debug.error("[DRM] Failed to create key session"),this.notify(T.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new T.vo.Error(T.dependencies.ErrorHandler.prototype.MEDIA_KEYMESSERR_NO_SESSION,"Failed to create key session",e.error))):this.debug.log("[DRM] Session created.  SessionID = "+e.data.getSessionID())},p=function(){this.debug.log("[DRM] Key added")},f=function(e){this.notify(T.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new T.vo.Error(e.data.code,e.data.message,e.data.data))},m=function(e){e.error?this.debug.warn("[DRM] Failed to close session"):this.debug.log("[DRM] Session closed.  SessionID = "+e.data)},g=function(e){e.error?this.debug.warn("[DRM] Failed to remove session"):this.debug.log("[DRM] Session removed.  SessionID = "+e.data)},y=function(e){e.error?this.notify(T.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new T.vo.Error(e.error.code,e.error.message,e.error.data)):this.debug.log("[DRM] Key statuses changed. statuses = "+e.data)};return{system:void 0,debug:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:void 0,setup:function(){this[T.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE]=d.bind(this),this[T.models.ProtectionModel.eventList.ENAME_NEED_KEY]=u.bind(this),this[T.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED]=c.bind(this),this[T.models.ProtectionModel.eventList.ENAME_KEY_ADDED]=p.bind(this),this[T.models.ProtectionModel.eventList.ENAME_KEY_ERROR]=f.bind(this),this[T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED]=h.bind(this),this[T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED]=m.bind(this),this[T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED]=g.bind(this),this[T.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED]=y.bind(this),i=this.protectionExt.getKeySystems(),this.protectionModel=this.system.getObject("protectionModel"),this.protectionModel.init(),this.eventBus=this.system.getObject("eventBus"),this.protectionModel.subscribe(T.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,this),this.protectionModel.subscribe(T.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this),this.protectionModel.subscribe(T.models.ProtectionModel.eventList.ENAME_KEY_ERROR,this),this.protectionModel.subscribe(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,this),this.protectionModel.subscribe(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this),this.protectionModel.subscribe(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,this),this.protectionModel.subscribe(T.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.protectionModel.subscribe(T.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this)},init:function(n,i,r){var o;s||(this.debug.log("[DRM] Initialize ProtectionController ("+r+", "+i+")"),e=i,t=r,o=this.protectionExt.getSupportedKeySystemsFromContentProtection(n),o&&o.length>0&&l.call(this,o,!0),s=!0)},addEventListener:function(e,t){this.eventBus.addEventListener(e,t)},removeEventListener:function(e,t){this.eventBus.removeEventListener(e,t)},teardown:function(){o&&(o.aborted=!0,o.abort()),this.protectionModel.unsubscribe(T.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.protectionModel.unsubscribe(T.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,this),this.protectionModel.unsubscribe(T.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this),this.protectionModel.unsubscribe(T.models.ProtectionModel.eventList.ENAME_KEY_ERROR,this),this.protectionModel.unsubscribe(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,this),this.protectionModel.unsubscribe(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this),this.protectionModel.unsubscribe(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,this),this.protectionModel.unsubscribe(T.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.protectionModel.unsubscribe(T.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this),this.keySystem=void 0,this.protectionModel.teardown(),this.setMediaElement(null),this.protectionModel=void 0},createKeySession:function(e,t){this.debug.log("[DRM] Create key session");var n,i=T.dependencies.protection.CommonEncryption.getPSSHForKeySystem(this.keySystem,e),r=0;if(i){for(n=this.protectionModel.getAllInitData(),r=0;r<n.length;r++)if(this.protectionExt.initDataEquals(i,n[r]))return void this.debug.log("[DRM] Ignoring initData because we have already seen it!");try{this.protectionModel.createKeySession(i,this.keySystem.sessionType,t)}catch(o){this.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,{reason:"Create key session raised en exception",error:new T.vo.Error(o.code,o.name,o.message)})}}else this.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,{reason:"needkey/encrypted event contains no initData corresponding to that key system "+this.keySystem.systemString,error:null})},loadKeySession:function(e){this.protectionModel.loadKeySession(e)},removeKeySession:function(e){this.protectionModel.removeKeySession(e)},closeKeySession:function(e){this.protectionModel.closeKeySession(e)},setServerCertificate:function(e){this.protectionModel.setServerCertificate(e)},setMediaElement:function(e){e?(this.protectionModel.setMediaElement(e),this.protectionModel.subscribe(T.models.ProtectionModel.eventList.ENAME_NEED_KEY,this)):null===e&&(this.protectionModel.setMediaElement(e),this.protectionModel.unsubscribe(T.models.ProtectionModel.eventList.ENAME_NEED_KEY,this))},setSessionType:function(e){this.keysystem&&(this.keySystem.sessionType=e)},setProtectionData:function(e){n=e,this.protectionExt.init(e)}}},T.dependencies.ProtectionController.events={KEY_SYSTEM_SELECTED:"keySystemSelected",SERVER_CERTIFICATE_UPDATED:"serverCertificateUpdated",KEY_ADDED:"keyAdded",KEY_SESSION_CREATED:"keySessionCreated",KEY_SESSION_REMOVED:"keySessionRemoved",KEY_SESSION_CLOSED:"keySessionClosed",KEY_STATUSES_CHANGED:"keyStatusesChanged",KEY_MESSAGE:"keyMessage",LICENSE_REQUEST_COMPLETE:"licenseRequestComplete"},T.dependencies.ProtectionController.eventList={ENAME_PROTECTION_ERROR:"protectionError"},T.dependencies.ProtectionController.prototype={constructor:T.dependencies.ProtectionController},T.dependencies.ProtectionExtensions=function(){"use strict";this.system=void 0,this.debug=void 0,this.keySystems=[],this.clearkeyKeySystem=void 0},T.dependencies.ProtectionExtensions.prototype={constructor:T.dependencies.ProtectionExtensions,setup:function(){var e;e=this.system.getObject("ksPlayReady"),this.keySystems.push(e),e=this.system.getObject("ksWidevine"),this.keySystems.push(e),e=this.system.getObject("ksFairPlay"),this.keySystems.push(e),e=this.system.getObject("ksClearKey"),this.keySystems.push(e),this.clearkeyKeySystem=e},init:function(e){for(var t=(function(t){var n=null;return e&&(n=t in e?e[t]:null),n}),n=0;n<this.keySystems.length;n++){var i=this.keySystems[n];i.init(t(i.systemString))}},getKeySystems:function(){return this.keySystems},getKeySystemBySystemString:function(e){for(var t=0;t<this.keySystems.length;t++)if(this.keySystems[t].systemString===e)return this.keySystems[t];return null},isClearKey:function(e){return e===this.clearkeyKeySystem},initDataEquals:function(e,t){if(e.byteLength===t.byteLength){for(var n=new Uint8Array(e),i=new Uint8Array(t),r=0;r<n.length;r++)if(n[r]!==i[r])return!1;return!0}return!1},getSupportedKeySystemsFromContentProtection:function(e){var t,n,i,r,o=[];if(this.debug.log("[DRM] Get supported key systems from content protection"),e)for(i=0;i<this.keySystems.length;++i)for(n=this.keySystems[i],r=0;r<e.length;++r)if(t=e[r],t.schemeIdUri.toLowerCase()===n.schemeIdURI){var s=n.getInitData(t);s&&o.push({ks:this.keySystems[i],initData:s,cdmData:n.getCDMData()})}return o},getSupportedKeySystems:function(e){var t,n=[],i=T.dependencies.protection.CommonEncryption.parsePSSHList(e);for(this.debug.log("[DRM] Get supported key systems from init data"),t=0;t<this.keySystems.length;++t)this.keySystems[t].uuid in i&&n.push({ks:this.keySystems[t],initData:i[this.keySystems[t].uuid],cdmData:this.keySystems[t].getCDMData()});return n},getLicenseServer:function(e,t,n){if("license-release"===n||"individualization-request"==n)return null;var i=null;return t&&t.hasOwnProperty("drmtoday")?i=this.system.getObject("serverDRMToday"):"com.widevine.alpha"===e.systemString?i=this.system.getObject("serverWidevine"):"com.microsoft.playready"===e.systemString?i=this.system.getObject("serverPlayReady"):"org.w3.clearkey"===e.systemString&&(i=this.system.getObject("serverClearKey")),i},processClearKeyLicenseRequest:function(e,t){try{return T.dependencies.protection.KeySystem_ClearKey.getClearKeysFromProtectionData(e,t)}catch(n){return this.log("Failed to retrieve clearkeys from ProtectionData"),null}},autoSelectKeySystem:function(e,t,n,i){if(this.debug.log("[DRM] Auto select key system: "),this.debug.log("[DRM] ---- video codec = "+n),this.debug.log("[DRM] ---- audio codec = "+i),0===e.length)throw new Error("DRM system for this content not supported by the player!");var r=[],o=[];n&&o.push(new T.vo.protection.MediaCapability(n)),i&&r.push(new T.vo.protection.MediaCapability(i));for(var s=new T.vo.protection.KeySystemConfiguration(r,o),a=[],l=0;l<e.length;l++)a.push({ks:e[l].ks,configs:[s]});var d=this;!function(e){var t={};t[T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE]=function(t){if(e.protectionModel.unsubscribe(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,this),t.error)d.debug.log(t.error),e.notify(T.dependencies.ProtectionController.eventList.ENAME_PROTECTION_ERROR,new T.vo.Error(T.dependencies.ErrorHandler.prototype.MEDIA_KEYSYSERR_ACCESS_DENIED,"[DRM] KeySystem Access Denied! -- "+t.error,null));else{var n=t.data;d.debug.log("[DRM] KeySystem Access Granted ("+n.keySystem.systemString+")!"),e.selectKeySystem(n)}},e.protectionModel.subscribe(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,t),e.requestKeySystemAccess(a)}(t)}},T.models.ProtectionModel_01b=function(){var e,t=null,n=null,i=[],r=[],o=function(){var t=this;return{handleEvent:function(o){var s=null;switch(o.type){case n.needkey:var l=ArrayBuffer.isView(o.initData)?o.initData.buffer:o.initData;t.notify(T.models.ProtectionModel.eventList.ENAME_NEED_KEY,new T.vo.protection.NeedKey(l,"cenc"));break;case n.keyerror:if(s=a(r,o.sessionId),s||(s=a(i,o.sessionId)),s){var d=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR,u="MediakeyError";switch(o.errorCode.code){case 1:d=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_UNKNOWN,u+="An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:d=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_CLIENT,u+="The Key System could not be installed or updated.";break;case 3:d=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_SERVICE,u+="The message passed into update indicated an error from the license service.";break;case 4:d=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_OUTPUT,u+="There is no available output device with the required characteristics for the content protection system.";break;case 5:d=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_HARDWARECHANGE,u+="A hardware configuration change caused a content protection error.";break;case 6:d=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_DOMAIN,u+="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}o.systemCode&&(u+="  (System Code = "+o.systemCode+")"),t.notify(T.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new T.vo.protection.KeyError(d,u))}else t.log("No session token found for key error");break;case n.keyadded:s=a(r,o.sessionId),s||(s=a(i,o.sessionId)),s?t.notify(T.models.ProtectionModel.eventList.ENAME_KEY_ADDED,s):t.log("No session token found for key added");break;case n.keymessage:if(e=null!==o.sessionId&&void 0!==o.sessionId,e?(s=a(r,o.sessionId),!s&&i.length>0&&(s=i.shift(),r.push(s),s.sessionID=o.sessionId)):i.length>0&&(s=i.shift(),r.push(s),0!==i.length&&t.errHandler.mediaKeyMessageError("Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!")),s){var c=ArrayBuffer.isView(o.message)?o.message.buffer:o.message;s.keyMessage=c,t.notify(T.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new T.vo.protection.KeyMessage(s,c,o.defaultURL))}else t.log("No session token found for key message")}}}},s=null,a=function(e,t){if(t&&e){for(var n=e.length,i=0;i<n;i++)if(e[i].sessionID===t)return e[i];return null}return null},l=function(){t.removeEventListener(n.keyerror,s),t.removeEventListener(n.needkey,s),t.removeEventListener(n.keymessage,s),t.removeEventListener(n.keyadded,s)};return{system:void 0,log:void 0,errHandler:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){s=o.call(this)},init:function(){var e=document.createElement("video");n=T.models.ProtectionModel_01b.detect(e)},teardown:function(){t&&l();for(var e=0;e<r.length;e++)this.closeKeySession(r[e]);this.notify(T.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)},getAllInitData:function(){var e,t=[];for(e=0;e<i.length;e++)t.push(i[e].initData);for(e=0;e<r.length;e++)t.push(r[e].initData);return t},requestKeySystemAccess:function(e){var n=t;n||(n=document.createElement("video"));for(var i=!1,r=0;r<e.length;r++)for(var o=e[r].ks.systemString,s=e[r].configs,a=null,l=null,d=0;d<s.length;d++){var u=s[d].videoCapabilities;if(u&&0!==u.length){l=[];for(var c=0;c<u.length;c++)""!==n.canPlayType(u[c].contentType,o)&&l.push(u[c])}if(!(!a&&!l||a&&0===a.length||l&&0===l.length)){i=!0;var h=new T.vo.protection.KeySystemConfiguration(a,l),p=this.protectionExt.getKeySystemBySystemString(o),f=new T.vo.protection.KeySystemAccess(p,h);
this.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,f);break}}i||this.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied! -- No valid audio/video content configurations detected!")},selectKeySystem:function(e){this.keySystem=e.keySystem,this.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)},setMediaElement:function(e){t!==e&&(t&&l(),t=e,t&&(t.addEventListener(n.keyerror,s),t.addEventListener(n.needkey,s),t.addEventListener(n.keymessage,s),t.addEventListener(n.keyadded,s),this.notify(T.models.ProtectionModel.eventList.ENAME_VIDEO_ELEMENT_SELECTED)))},createKeySession:function(o){if(!this.keySystem)throw new Error("Can not create sessions until you have selected a key system");if(e||0===r.length){var s={sessionID:null,initData:o,getSessionID:function(){return this.sessionID},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return i.push(s),t[n.generateKeyRequest](this.keySystem.systemString,new Uint8Array(o)),s}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(e,i){var r=e.sessionID;if(this.protectionExt.isClearKey(this.keySystem))for(var o=0;o<i.keyPairs.length;o++)t[n.addKey](this.keySystem.systemString,i.keyPairs[o].key,i.keyPairs[o].keyID,r);else t[n.addKey](this.keySystem.systemString,new Uint8Array(i),e.initData,r)},closeKeySession:function(e){t[n.cancelKeyRequest](this.keySystem.systemString,e.sessionID)},setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},checkIfEncrypted:function(){}}},T.models.ProtectionModel_01b.prototype={constructor:T.models.ProtectionModel_01b},T.models.ProtectionModel_01b.APIs=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],T.models.ProtectionModel_01b.detect=function(e){for(var t=T.models.ProtectionModel_01b.APIs,n=0;n<t.length;n++){var i=t[n];if("function"==typeof e[i.generateKeyRequest]&&"function"==typeof e[i.addKey]&&"function"==typeof e[i.cancelKeyRequest])return i}return null};var S,D;T.models.ProtectionModel_FPS=function(){var t=null,n="com.apple.fps.1_0",i="",s=null,a=function(e){var t=e,n=new XMLHttpRequest;n.responseType="arraybuffer",n.addEventListener("load",d,!1),n.open("GET",t,!0),n.setRequestHeader("Pragma","Cache-Control: no-cache"),n.setRequestHeader("Cache-Control","max-age=0"),n.send()},d=function(e){var t=e.target;200===t.status&&(i=new Uint8Array(t.response))},p=function(t){var s=t.target,a=t.initData,l=r(a);if(i.byteLength){if(a=o(a,l,i),s.webkitKeys||s.webkitSetMediaKeys(new WebKitMediaKeys(n)),!s.webkitKeys)throw"Could not create MediaKeys";var d=s.webkitKeys.createSession("video/mp4",a);if(!d)throw"Could not create key session";d.contentId=l,e("webkitkeymessage",g,d),e("webkitkeyadded",m,d),e("webkitkeyerror",f,d)}else this.errHandler.sendError(T.dependencies.ErrorHandler.prototype.FPS_CERTIFICAT_ERROR,"No certificate available")},f=function(e){console.error("onkeyerror : "+e.type)},m=function(){},g=function(e){var t=e.target,n=e.message,i=t.contentId,r=new XMLHttpRequest;r.responseType="text",r.session=t,r.addEventListener("load",u,!1),r.addEventListener("error",c,!1);var o=l(n),a=s.getKeySystemBySystemString(t.keySystem),d=a.getLicenseServerURLFromInitData()+"&fairplay="+i;r.open("POST",d,!0),r.send(o)},y=function(e){e.removeEventListener("error",h),e.removeEventListener("webkitneedkey",p)};return{system:void 0,log:void 0,errHandler:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:void 0,debug:null,setup:function(){s=this.protectionExt,null!==D?(this.debug.log("[DRM][FPS] setup with _global_fairPlayCertificat"),i=new Uint8Array(D)):null!==S&&(this.debug.log("[DRM][FPS] setup with _global_fairPlayCertificatUrl"),a.call(this,S))},init:function(){this.debug.log("[DRM][FPS] init")},teardown:function(){this.debug.log("[DRM][FPS] Teardown"),this.notify(T.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)},getAllInitData:function(){this.debug.log("[DRM][FPS] getAllInitData")},requestKeySystemAccess:function(){this.debug.log("[DRM][FPS] requestKeySystemAccess")},selectKeySystem:function(e){this.debug.log("[DRM][FPS] selectKeySystem"),this.keySystem=e.keySystem,this.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)},setMediaElement:function(e){this.debug.log("[DRM][FPS] setMediaElement"),t!==e&&(t&&y(t),t=e,t&&(t.addEventListener("webkitneedkey",p.bind(this),!1),t.addEventListener("error",h,!1),this.notify(T.models.ProtectionModel.eventList.ENAME_VIDEO_ELEMENT_SELECTED)))},checkIfEncrypted:function(){}}},T.models.ProtectionModel_FPS.detect=function(){return!!WebKitMediaKeys.isTypeSupported("com.apple.fps.1_0","video/mp4")},T.models.ProtectionModel_FPS.prototype={constructor:T.models.ProtectionModel_FPS},T.models.ProtectionModel_3Feb2014=function(){var e=null,t=null,n=null,i=null,r=null,o=[],s=function(){var e=this;return{handleEvent:function(t){switch(t.type){case r.needkey:if(t.initData){var n=ArrayBuffer.isView(t.initData)?t.initData.buffer:t.initData;e.notify(T.models.ProtectionModel.eventList.ENAME_NEED_KEY,new T.vo.protection.NeedKey(n,"cenc"))}}}}},a=null,l=function(){var n=function(){e.removeEventListener("loadedmetadata",i),e[r.setMediaKeys](t),this.notify(T.models.ProtectionModel.eventList.ENAME_VIDEO_ELEMENT_SELECTED)};e.readyState>=1?n.call(this):(i=n.bind(this),e.addEventListener("loadedmetadata",i))},d=function(e){var t=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR,n="MediakeyError";if(e.errorCode)switch(e.errorCode.code){case 1:t=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_UNKNOWN,n="An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:t=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_CLIENT,n="The Key System could not be installed or updated.";break;case 3:t=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_SERVICE,n="The message passed into update indicated an error from the license service.";break;case 4:t=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_OUTPUT,n="There is no available output device with the required characteristics for the content protection system.";break;case 5:t=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_HARDWARECHANGE,n+="A hardware configuration change caused a content protection error.";break;case 6:t=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_DOMAIN,n="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.";break;default:t=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_UNKNOWN,n="An unspecified error occurred. This value is used for errors that don't match any of the other codes."}else t=T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_UNKNOWN,n="An unspecified error occurred. This value is used for errors that don't match any of the other codes.";return e.systemCode&&(n+="  (System Code = "+e.systemCode+")"),new T.vo.protection.KeyError(t,n)},u=function(e,t){var n=this;return{session:e,initData:t,handleEvent:function(e){switch(e.type){case r.error:n.notify(T.models.ProtectionModel.eventList.ENAME_KEY_ERROR,d(e));break;case r.message:var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;n.notify(T.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new T.vo.protection.KeyMessage(this,t,e.destinationURL));break;case r.ready:n.notify(T.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this);break;case r.close:n.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this.getSessionID())}},getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}}};return{system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,debug:void 0,keySystem:null,setup:function(){a=s.call(this)},init:function(){var e=document.createElement("video");r=T.models.ProtectionModel_3Feb2014.detect(e)},teardown:function(){try{for(var t=0;t<o.length;t++)this.closeKeySession(o[t]);e&&e.removeEventListener(r.needkey,a),this.notify(T.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)}catch(n){this.notify(T.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE,null,"Error tearing down key sessions and MediaKeys! -- "+n.message)}},getAllInitData:function(){for(var e=[],t=0;t<o.length;t++)e.push(o[t].initData);return e},requestKeySystemAccess:function(e){for(var t=!1,n=0;n<e.length;n++){var i=e[n].ks.systemString,o=e[n].configs,s=null,a=null;this.debug.log("[DRM][3Feb2014] Request access for key system "+i);for(var l=0;l<o.length;l++){var d=o[l].audioCapabilities,u=o[l].videoCapabilities;if(d&&0!==d.length){s=[];for(var c=0;c<d.length;c++)window[r.MediaKeys].isTypeSupported(i,d[c].contentType)&&s.push(d[c])}if(u&&0!==u.length){a=[];for(var h=0;h<u.length;h++)window[r.MediaKeys].isTypeSupported(i,u[h].contentType)&&a.push(u[h])}if(!(!s&&!a||s&&0===s.length||a&&0===a.length)){t=!0;var p=new T.vo.protection.KeySystemConfiguration(s,a),f=this.protectionExt.getKeySystemBySystemString(i),m=new T.vo.protection.KeySystemAccess(f,p);this.debug.log("[DRM][3Feb2014] configuration supported = audio:"+JSON.stringify(s)+", video:"+JSON.stringify(a)),this.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,m);break}}}t||this.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"[DRM][3Feb2014] Key system access denied! -- No valid audio/video content configurations detected!")},selectKeySystem:function(i){this.debug.log("[DRM][3Feb2014] Select key system "+i.keySystem.systemString);try{t=i.mediaKeys=new window[r.MediaKeys](i.keySystem.systemString),this.keySystem=i.keySystem,n=i,e&&l.call(this),this.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)}catch(o){this.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,null,"Error selecting keys system ("+this.keySystem.systemString+")! Could not create MediaKeys -- TODO")}},setMediaElement:function(n){e!==n&&(e&&(e.removeEventListener(r.needkey,a),e.removeEventListener("loadedmetadata",i)),e=n,e&&t&&l.call(this))},createKeySession:function(e,i,s){if(!this.keySystem||!t||!n)throw new Error("Can not create sessions until you have selected a key system");this.debug.log("[DRM][3Feb2014] Create key session");var a=n.ksConfiguration.videoCapabilities[0].contentType,l=t.createSession(a,new Uint8Array(e),s?new Uint8Array(s):null),d=u.call(this,l,e);l.addEventListener(r.error,d),l.addEventListener(r.message,d),l.addEventListener(r.ready,d),l.addEventListener(r.close,d),o.push(d),this.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,d)},updateKeySession:function(e,t){var n=e.session;this.debug.log("[DRM][3Feb2014] Update key session"),this.protectionExt.isClearKey(this.keySystem)?n.update(new Uint8Array(t.toJWK())):n.update(new Uint8Array(t))},closeKeySession:function(e){this.debug.log("[DRM][3Feb2014] Close key session, token = "+e.session.sessionId);var t=e.session;t.removeEventListener(r.error,e),t.removeEventListener(r.message,e),t.removeEventListener(r.ready,e),t.removeEventListener(r.close,e);for(var n=0;n<o.length;n++)if(o[n]===e){o.splice(n,1);break}t[r.release]()},setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},checkIfEncrypted:function(){}}},T.models.ProtectionModel_3Feb2014.APIs=[{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"},{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"}],T.models.ProtectionModel_3Feb2014.detect=function(e){for(var t=T.models.ProtectionModel_3Feb2014.APIs,n=0;n<t.length;n++){var i=t[n];if("function"==typeof e[i.setMediaKeys]&&"function"==typeof window[i.MediaKeys])return i}return null},T.models.ProtectionModel_3Feb2014.prototype={constructor:T.models.ProtectionModel_3Feb2014},T.models.ProtectionModel_21Jan2015=function(){var e=null,t=null,n=null,i=[],r=function(e){var t,n="[";for(t=0;t<e.length;t++)n+="0x"+e[t].toString(16),t<e.length-1&&(n+=",");return n+="]"},o=function(e,t){var n=this;!function(t){var i=e[t].ks,r=e[t].configs;n.debug.log("[DRM][PM_21Jan2015] requestMediaKeySystemAccess: "+i.systemString),navigator.requestMediaKeySystemAccess(i.systemString,r).then(function(e){var t="function"==typeof e.getConfiguration?e.getConfiguration():null,r=new T.vo.protection.KeySystemAccess(i,t);r.mksa=e,n.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,r)})["catch"](function(){++t<e.length?o.call(n,e,t):n.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied!")})}(t)},s=function(e){var t=e.session;return t.removeEventListener("keystatuseschange",e),t.removeEventListener("message",e),t.close()},a=function(){var t=this;return{session:null,handleEvent:function(i){switch(i.type){case"encrypted":t.debug.log("[DRM][PM_21Jan2015] 'encrypted' event");break;case"waitingforkey":t.debug.log("[DRM][PM_21Jan2015] 'waitingforkey' event"),null!==this.session&&this.session.licenseStored===!0&&(this.session.licenseStored=!1,this.session=null,e.removeEventListener("waitingforkey",n),t.notify(T.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new T.vo.protection.KeyError(T.dependencies.ErrorHandler.prototype.MEDIA_ERR_ENCRYPTED,"Media is encrypted and no valid key is available")))}}}},l=function(e){for(var t=0;t<i.length;t++)if(i[t]===e){i.splice(t,1);break}},d=function(e,t,n){var o=this,s=function(e,t){for(var n=0;n<i.length;n++)if(i[n].session===e){i[n].usable=t;break}},a={session:e,initData:t,licenseStored:!1,usable:!1,handleEvent:function(e){switch(e.type){case"keystatuseschange":o.notify(T.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this),e.target.keyStatuses.forEach(function(){var t,n;switch(arguments&&arguments.length>0&&(arguments[0]&&("string"==typeof arguments[0]?t=arguments[0]:n=arguments[0]),arguments[1]&&("string"==typeof arguments[1]?t=arguments[1]:n=arguments[1])),o.debug.log("[DRM][PM_21Jan2015] status = "+t+" for KID "+r(new Uint8Array(n))),t){case"expired":s(e.target,!1),o.notify(T.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,null,new T.vo.Error(T.dependencies.ErrorHandler.prototype.MEDIA_ERR_ENCRYPTED,"License has expired",null));break;case"output-restricted":s(e.target,!1),o.notify(T.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,null,new T.vo.Error(T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR_OUTPUT,"There is no available output device with the required characteristics for the content protection system",null));break;case"usable":s(e.target,!0);break;default:o.notify(T.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,{status:t,keyId:n})}});break;case"message":o.debug.log("[DRM][PM_21Jan2015] 'message' event: ",e);var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;o.notify(T.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new T.vo.protection.KeyMessage(this,t,(void 0),e.messageType))}},getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return this.session.expiration},getKeyStatuses:function(){return this.session.keyStatuses},getSessionType:function(){return n}};return e.addEventListener("keystatuseschange",a),e.addEventListener("message",a),e.closed.then(function(){l(a),o.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,a.getSessionID())}),i.push(a),a};return{system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,config:null,debug:null,setup:function(){n=a.call(this)},init:function(){n.session=null},teardown:function(){var t,r;if(this.debug.log("[DRM][PM_21Jan2015] Teardown"),this.config.getParam("Protection.licensePersistence","boolean",!1))for(r=0;r<i.length;r++)t=i[r],t.licenseStored||(i.splice(r,1),r--);else i=[];e.removeEventListener("waitingforkey",n),this.notify(T.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)},getAllInitData:function(){for(var e=[],t=0;t<i.length;t++)i[t].usable?e.push(i[t].initData):(i.splice(t,1),t--);return e},requestKeySystemAccess:function(e){o.call(this,e,0)},selectKeySystem:function(n){var i=this;return i.debug.log("[DRM][PM_21Jan2015] Select key system, create new MediaKeys"),null!==t?(i.debug.log("[DRM][PM_21Jan2015] MediaKeys already created"),void i.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)):void n.mksa.createMediaKeys().then(function(r){i.keySystem=n.keySystem,t=r,e&&e.setMediaKeys(t),i.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)})["catch"](function(){i.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,null,"Error selecting keys system ("+n.keySystem.systemString+")! Could not create MediaKeys -- TODO")})},setMediaElement:function(i){e!==i&&null!==i&&(e&&(e.removeEventListener("encrypted",n),e.removeEventListener("waitingforkey",n),e.setMediaKeys(null)),e=i,e&&(e.addEventListener("encrypted",n),t&&e.setMediaKeys(t)))},setServerCertificate:function(e){if(!this.keySystem||!t)throw new Error("Can not set server certificate until you have selected a key system");var n=this;t.setServerCertificate(e).then(function(){n.notify(T.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED)})["catch"](function(e){n.notify(T.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,null,"Error updating server certificate -- "+e.name)})},createKeySession:function(e,n){if(!this.keySystem||!t)throw new Error("Can not create sessions until you have selected a key system");this.debug.log("[DRM][PM_21Jan2015] Create key session, type = "+n);var i=t.createSession(n),r=d.call(this,i,e,n),o=this;i.generateRequest("cenc",e).then(function(){o.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,r)})["catch"](function(e){l(r),o.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,{reason:"Failed to generate key request",error:new T.vo.Error(e.code,e.name,e.message)})})},updateKeySession:function(t,i){var r=t.session,o=this;o.debug.log("[DRM][PM_21Jan2015] Update key session "+r.sessionId),this.protectionExt.isClearKey(this.keySystem)&&(i=i.toJWK()),r.update(i).then(function(){t.licenseStored=!0,n.session=t,e.addEventListener("waitingforkey",n)})["catch"](function(e){o.notify(T.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new T.vo.protection.KeyError(T.dependencies.ErrorHandler.prototype.MEDIA_KEYERR,"Error while providing license to the CDM",e))})},loadKeySession:function(e){if(!this.keySystem||!t)throw new Error("Can not load sessions until you have selected a key system");this.debug.log("[DRM][PM_21Jan2015] Load key session, id = "+e);var n=t.createSession(),i=this;n.load(e).then(function(t){if(t){var r=d.call(this,n);i.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,r)}else i.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,{reason:"Failed to load session "+e,error:null})})["catch"](function(t){i.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,{reason:"Failed to load session "+e,error:new T.vo.Error(t.code,t.name,t.message)})})},removeKeySession:function(e){var t=e.session;this.debug.log("[DRM][PM_21Jan2015] Remove key session");var n=this;t.remove().then(function(){n.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,e.getSessionID())},function(t){n.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,null,"Error removing session ("+e.getSessionID()+"). "+t.name)})},closeKeySession:function(e){this.debug.log("[DRM][PM_21Jan2015] Close key session");var t=this;s(e)["catch"](function(n){l(e),t.notify(T.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,null,"Error closing session ("+e.getSessionID()+") "+n.name)})},checkIfEncrypted:function(){e.addEventListener("waitingforkey",n)}}},T.models.ProtectionModel_21Jan2015.detect=function(e){return void 0!==e.onencrypted&&void 0!==e.mediaKeys&&(void 0!==navigator.requestMediaKeySystemAccess&&"function"==typeof navigator.requestMediaKeySystemAccess&&!window.MSMediaKeys)},T.models.ProtectionModel_21Jan2015.prototype={constructor:T.models.ProtectionModel_21Jan2015},T.dependencies.protection.KeySystem=function(){},T.dependencies.protection.KeySystem_Access=function(){"use strict"},T.dependencies.protection.KeySystem_Access.prototype={constructor:T.dependencies.protection.KeySystem_Access},T.dependencies.protection.KeySystem_ClearKey=function(){"use strict";var e,t="org.w3.clearkey",n="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b";return{system:void 0,schemeIdURI:"urn:uuid:"+n,systemString:t,uuid:n,sessionType:"temporary",init:function(t){e=t},getInitData:T.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection,getKeySystemConfigurations:T.dependencies.protection.CommonEncryption.getKeySystemConfigurations,getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null}}},T.dependencies.protection.KeySystem_ClearKey.prototype={constructor:T.dependencies.protection.KeySystem_ClearKey},T.dependencies.protection.KeySystem_ClearKey.getClearKeysFromProtectionData=function(e,t){var n=null;if(e){for(var i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),r=[],o=0;o<i.kids.length;o++){var s=i.kids[o],a=e.clearkeys.hasOwnProperty(s)?e.clearkeys[s]:null;if(!a)throw new Error("[DRM] ClearKey keyID ("+s+") is not known!");r.push(new T.vo.protection.KeyPair(s,a))}n=new T.vo.protection.ClearKeyKeySet(r)}return n},T.dependencies.protection.KeySystem_FairPlay=function(){"use strict";var e="com.apple.fps.1_0",t=null;return{systemString:e,sessionType:"temporary",debug:null,init:function(e){e&&(t=e,t.sessionType&&(this.debug.log("[DRM] KeySystem_FairPlay:init() sessionType:"+t.sessionType),this.sessionType=t.sessionType))},getInitData:function(){return this.debug.log("[DRM] KeySystem_FairPlay:getInitData()"),t},getKeySystemConfigurations:function(){return this.debug.log("[DRM] KeySystem_FairPlay:getKeySystemConfigurations()"),null},getRequestHeadersFromMessage:function(){return this.debug.log("[DRM] KeySystem_FairPlay:getRequestHeadersFromMessage()"),null},getLicenseRequestFromMessage:function(e){return this.debug.log("[DRM] KeySystem_FairPlay:getLicenseRequestFromMessage()"),new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return t.laURL},getCDMData:function(){return this.debug.log("[DRM] KeySystem_FairPlay:getCDMData()"),null}}},T.dependencies.protection.KeySystem_FairPlay.prototype={constructor:T.dependencies.protection.KeySystem_FairPlay},T.dependencies.protection.KeySystem_PlayReady=function(){"use strict";var e,t="com.microsoft.playready",n="9a04f079-9840-4286-ab92-e65be0885f95",i="utf16",r='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>',o=function(e){var t,n,r,o,s={},a=e instanceof ArrayBuffer?e:e.buffer,l="utf16"===i?new Uint16Array(a):new Uint8Array(a),d=0;for(t=String.fromCharCode.apply(null,l),n=this.domParser.createXmlTree(t),r=n.getElementsByTagName("name"),o=n.getElementsByTagName("value"),d=0;d<r.length;d+=1)s[r[d].childNodes[0].nodeValue]=o[d].childNodes[0].nodeValue;return s.hasOwnProperty("Content")&&(s["Content-Type"]=s.Content,delete s.Content),s.hasOwnProperty("Content-Type")||(s["Content-Type"]="text/xml; charset=utf-8"),s},s=function(e){var t,n,r,o=null,s=e instanceof ArrayBuffer?e:e.buffer,a="utf16"===i?new Uint16Array(s):new Uint8Array(s);return t=String.fromCharCode.apply(null,a),n=this.domParser.createXmlTree(t),n.getElementsByTagName("Challenge")[0]?(r=n.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue,r&&(o=L.decode(r))):o=t,o},a=function(e){if(e){var t,n,i,r,o,s,a,l=new DataView(e),d=l.getUint16(4,!0),u=6,c=0;for(c=0;c<d;c++)if(t=l.getUint16(u,!0),u+=2,n=l.getUint16(u,!0),u+=2,1===t){if(i=e.slice(u,u+n),r=String.fromCharCode.apply(null,new Uint16Array(i)),o=this.domParser.createXmlTree(r),o.getElementsByTagName("LA_URL")[0]&&(s=o.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue))return s;if(o.getElementsByTagName("LUI_URL")[0]&&(a=o.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue))return a}else u+=n}return null},l=function(e){var t,n,i,r,o,s=0,a=new Uint8Array([112,115,115,104,0,0,0,0]),l=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),d=null;if("pssh"in e)return T.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection(e);if("pro"in e)d=L.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;d=L.decodeArray(e.prheader.__text)}return t=d.length,n=4+a.length+l.length+4+t,i=new ArrayBuffer(n),r=new Uint8Array(i),o=new DataView(i),o.setUint32(s,n),s+=4,r.set(a,s),s+=a.length,r.set(l,s),s+=l.length,o.setUint32(s,t),s+=4,r.set(d,s),s+=t,r.buffer},d=function(){var t,n,i,o;if(e&&e.cdmData){for(t=[],o=0;o<e.cdmData.length;++o)t.push(e.cdmData.charCodeAt(o)),t.push(0);for(t=String.fromCharCode.apply(null,t),t=L.encode(t),n=r.replace("%CUSTOMDATA%",t),i=[],o=0;o<n.length;++o)i.push(n.charCodeAt(o)),i.push(0);return new Uint8Array(i).buffer}return null};return{schemeIdURI:"urn:uuid:"+n,systemString:t,uuid:n,notify:void 0,subscribe:void 0,unsubscribe:void 0,domParser:void 0,sessionType:"temporary",init:function(t){t&&(e=t,e.sessionType&&(this.sessionType=e.sessionType))},getInitData:l,getKeySystemConfigurations:T.dependencies.protection.CommonEncryption.getKeySystemConfigurations,getRequestHeadersFromMessage:o,getLicenseRequestFromMessage:s,getLicenseServerURLFromInitData:a,getCDMData:d,setPlayReadyMessageFormat:function(e){if("utf8"!==e&&"utf16"!==e)throw new Error("Illegal PlayReady message format! -- "+e);i=e}}},T.dependencies.protection.KeySystem_PlayReady.prototype={constructor:T.dependencies.protection.KeySystem_PlayReady},T.dependencies.protection.KeySystem_Widevine=function(){"use strict";var e="com.widevine.alpha",t="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",n=null,i=function(e){return n&&n.pssh?L.decodeArray(n.pssh).buffer:T.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection(e)};return{schemeIdURI:"urn:uuid:"+t,systemString:e,uuid:t,sessionType:"temporary",init:function(e){e&&(n=e,n.sessionType&&(this.sessionType=n.sessionType))},getInitData:i,getKeySystemConfigurations:T.dependencies.protection.CommonEncryption.getKeySystemConfigurations,getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null}}},T.dependencies.protection.KeySystem_Widevine.prototype={constructor:T.dependencies.protection.KeySystem_Widevine},T.dependencies.protection.servers.ClearKey=function(){"use strict";return{getServerURLFromMessage:function(e,t){var n=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),i=0;for(e+="/?",i=0;i<n.kids.length;i++)e+=n.kids[i]+"&";return e=e.substring(0,e.length-1)},getHTTPMethod:function(){return"GET"},getResponseType:function(){return"json"},getLicenseMessage:function(e){var t,n,i,r,o=[];if(!e.hasOwnProperty("keys"))return null;for(t=0;t<e.keys.length;t++)n=e.keys[t],i=n.kid.replace(/=/g,""),r=n.k.replace(/=/g,""),o.push(new T.vo.protection.KeyPair(i,r));return new T.vo.protection.ClearKeyKeySet(o)},getErrorResponse:function(e){return{code:0,name:"UnknownError",message:String.fromCharCode.apply(null,new Uint8Array(e))}}}},T.dependencies.protection.servers.ClearKey.prototype={constructor:T.dependencies.protection.servers.ClearKey},T.dependencies.protection.servers.DRMToday=function(){"use strict";var e={"com.widevine.alpha":{responseType:"json",getLicenseMessage:function(e){return L.decodeArray(e.license)},getErrorResponse:function(e){return e}},"com.microsoft.playready":{responseType:"arraybuffer",getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}};return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(t){return e[t].responseType},getLicenseMessage:function(t,n){return e[n].getLicenseMessage(t)},getErrorResponse:function(t,n){return{code:0,name:"UnknownError",message:e[n].getErrorResponse(t)}}}},T.dependencies.protection.servers.DRMToday.prototype={constructor:T.dependencies.protection.servers.DRMToday},T.dependencies.protection.servers.LicenseServer=function(){},T.dependencies.protection.servers.PlayReady=function(){"use strict";var e=function(e){var t="",n=0,i=0,r=0,o=0,s=new Uint8Array(e);for(s.length>=3&&239===s[0]&&187===s[1]&&191===s[2]&&(n=3);n<s.length;)if(i=s[n],i<128)t+=String.fromCharCode(i),n++;else if(i>191&&i<224){if(n+1>=s.length)throw"UTF-8 Decode failed. Two byte character was truncated.";r=s[n+1],t+=String.fromCharCode((31&i)<<6|63&r),n+=2}else{if(n+2>=s.length)throw"UTF-8 Decode failed. Multi byte character was truncated.";r=s[n+1],o=s[n+2],t+=String.fromCharCode((15&i)<<12|(63&r)<<6|63&o),n+=3}return t},t=function(t){var n=e(t),i=this.domParser.createXmlTree(n),r=i?this.domParser.getChildNode(i,"soap:Envelope"):null,o=r?this.domParser.getChildNode(r,"soap:Body"):null,s=o?this.domParser.getChildNode(o,"soap:Fault"):null;return s?null:t},n=function(t){var n=e(t),i=this.domParser.createXmlTree(n),r=i?this.domParser.getChildNode(i,"soap:Envelope"):null,o=r?this.domParser.getChildNode(r,"soap:Body"):null,s=o?this.domParser.getChildNode(o,"soap:Fault"):null,a=s?this.domParser.getChildNode(s,"detail"):null,l=a?this.domParser.getChildNode(a,"Exception"):null,d=null,u="",c="",h="",p=-1,f=-1;return null===s?{code:0,name:"UnknownError",message:String.fromCharCode.apply(null,new Uint8Array(t))}:(d=this.domParser.getChildNode(s,"faultstring").firstChild,u=d?d.nodeValue:null,null!==l&&(d=this.domParser.getChildNode(l,"StatusCode"),c=d?d.firstChild.nodeValue:null,d=this.domParser.getChildNode(l,"Message"),h=d?d.firstChild.nodeValue:null,p=h?h.lastIndexOf("[")+1:-1,f=h?h.indexOf("]"):-1),{code:c,name:u,message:h?h.substring(p,f):""})};return{domParser:void 0,getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return t.call(this,e)},getErrorResponse:function(e){return n.call(this,e)}}},T.dependencies.protection.servers.PlayReady.prototype={constructor:T.dependencies.protection.servers.PlayReady},T.dependencies.protection.servers.Widevine=function(){"use strict";return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return e},getErrorResponse:function(e){return{code:0,name:"UnknownError",message:String.fromCharCode.apply(null,new Uint8Array(e))}}}},T.dependencies.protection.servers.Widevine.prototype={constructor:T.dependencies.protection.servers.Widevine},T.vo.protection.ClearKeyKeySet=function(e,t){if(t&&"persistent"!==t&&"temporary"!==t)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=e,this.type=t,this.toJWK=function(){var e,t=this.keyPairs.length,n={};for(n.keys=[],e=0;e<t;e++){var i={kty:"oct",alg:"A128KW",kid:this.keyPairs[e].keyID,k:this.keyPairs[e].key};n.keys.push(i)}this.type&&(n.type=this.type);var r=JSON.stringify(n),o=r.length,s=new ArrayBuffer(o),a=new Uint8Array(s);
for(e=0;e<o;e++)a[e]=r.charCodeAt(e);return s}},T.vo.protection.ClearKeyKeySet.prototype={constructor:T.vo.protection.ClearKeyKeySet},T.vo.protection.KeyError=function(e,t,n){"use strict";this.code=e,this.message=t,this.data=n},T.vo.protection.KeyError.prototype={constructor:T.vo.protection.KeyError},T.vo.protection.KeyMessage=function(e,t,n,i){"use strict";this.sessionToken=e,this.message=t,this.defaultURL=n,this.messageType=i},T.vo.protection.KeyMessage.prototype={constructor:T.vo.protection.KeyMessage},T.vo.protection.KeyPair=function(e,t){"use strict";this.keyID=e,this.key=t},T.vo.protection.KeyPair.prototype={constructor:T.vo.protection.KeyPair},T.vo.protection.KeySystemAccess=function(e,t){this.keySystem=e,this.ksConfiguration=t},T.vo.protection.KeySystemAccess.prototype={constructor:T.vo.protection.KeySystemAccess},T.vo.protection.KeySystemConfiguration=function(e,t,n,i,r){this.initDataTypes=["cenc"],this.audioCapabilities=e,this.videoCapabilities=t,this.distinctiveIdentifier=n,this.persistentState=i,this.sessionTypes=r},T.vo.protection.KeySystemConfiguration.prototype={constructor:T.vo.protection.KeySystemConfiguration},T.vo.protection.LicenseRequestComplete=function(e,t){"use strict";this.message=e,this.requestData=t},T.vo.protection.LicenseRequestComplete.prototype={constructor:T.vo.protection.LicenseRequestComplete},T.vo.protection.MediaCapability=function(e,t){this.contentType=e,this.robustness=t},T.vo.protection.MediaCapability.prototype={constructor:T.vo.protection.MediaCapability},T.vo.protection.NeedKey=function(e,t){this.initData=e,this.initDataType=t},T.vo.protection.NeedKey.prototype={constructor:T.vo.protection.NeedKey},T.vo.protection.ProtectionData=function(e,t,n,i){this.laURL=e,this.httpRequestHeaders=t,this.bearerToken=n,this.clearkeys=i},T.vo.protection.ProtectionData.prototype={constructor:T.vo.protection.ProtectionData},T.models.SessionToken=function(){"use strict"},T.models.SessionToken.prototype={initData:null,getSessionID:function(){return""},getExpirationTime:function(){return NaN},getKeyStatuses:function(){return null}},v=function(){"use strict";return{dependencies:{}}}(),v.dependencies.AES=function(){this.init=function(e){this._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],this._precompute.call(this);var t,n,i,r,o,s=this._tables[0][4],a=this._tables[1],l=e.length,d=1;if(4!==l&&6!==l&&8!==l)throw new Error("Invalid aes key size="+l);for(r=e.slice(0),o=[],this._key=[r,o],t=l;t<4*l+28;t++)i=r[t-1],(t%l===0||8===l&&t%l===4)&&(i=s[i>>>24]<<24^s[i>>16&255]<<16^s[i>>8&255]<<8^s[255&i],t%l===0&&(i=i<<8^i>>>24^d<<24,d=d<<1^283*(d>>7))),r[t]=r[t-l]^i;for(n=0;t;n++,t--)i=r[3&n?t:t-4],t<=4||n<4?o[n]=i:o[n]=a[0][s[i>>>24]]^a[1][s[i>>16&255]]^a[2][s[i>>8&255]]^a[3][s[255&i]]},this._precompute=function(){var e,t,n,i,r,o,s,a,l,d=this._tables[0],u=this._tables[1],c=d[4],h=u[4],p=[],f=[];for(e=0;e<256;e++)f[(p[e]=e<<1^283*(e>>7))^e]=e;for(t=n=0;!c[t];t^=i||1,n=f[n]||1)for(s=n^n<<1^n<<2^n<<3^n<<4,s=s>>8^255&s^99,c[t]=s,h[s]=t,o=p[r=p[i=p[t]]],l=16843009*o^65537*r^257*i^16843008*t,a=257*p[s]^16843008*s,e=0;e<4;e++)d[e][t]=a=a<<24^a>>>8,u[e][s]=l=l<<24^l>>>8;for(e=0;e<5;e++)d[e]=d[e].slice(0),u[e]=u[e].slice(0)},this.decrypt=function(e,t,n,i,r,o){var s,a,l,d,u=this._key[1],c=e^u[0],h=i^u[1],p=n^u[2],f=t^u[3],m=u.length/4-2,g=4,y=this._tables[1],_=y[0],E=y[1],b=y[2],v=y[3],x=y[4];for(d=0;d<m;d++)s=_[c>>>24]^E[h>>16&255]^b[p>>8&255]^v[255&f]^u[g],a=_[h>>>24]^E[p>>16&255]^b[f>>8&255]^v[255&c]^u[g+1],l=_[p>>>24]^E[f>>16&255]^b[c>>8&255]^v[255&h]^u[g+2],f=_[f>>>24]^E[c>>16&255]^b[h>>8&255]^v[255&p]^u[g+3],g+=4,c=s,h=a,p=l;for(d=0;d<4;d++)r[(3&-d)+o]=x[c>>>24]<<24^x[h>>16&255]<<16^x[p>>8&255]<<8^x[255&f]^u[g++],s=c,c=h,h=p,p=f,f=s}},v.dependencies.AES.prototype={constructor:v.dependencies.AES},v.dependencies.AES128Decrypter=function(e,t){"use strict";this.key=e,this.iv=t,this.ntoh=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},this.doDecrypt=function(e,t,n){var i,r,o,s,a,l,d,u,c,h=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),p=new v.dependencies.AES,f=new Uint8Array(e.byteLength),m=new Int32Array(f.buffer);for(p.init(Array.prototype.slice.call(t)),i=~~n[0],r=~~n[1],o=~~n[2],s=~~n[3],c=0;c<h.length;c+=4)a=~~this.ntoh(h[c]),l=~~this.ntoh(h[c+1]),d=~~this.ntoh(h[c+2]),u=~~this.ntoh(h[c+3]),p.decrypt(a,l,d,u,m,c),m[c]=this.ntoh(m[c]^i),m[c+1]=this.ntoh(m[c+1]^r),m[c+2]=this.ntoh(m[c+2]^o),m[c+3]=this.ntoh(m[c+3]^s),i=a,r=l,o=d,s=u;return f},this.localDecrypt=function(e,t,n,i){var r=this.doDecrypt(e,t,n);i.set(r,e.byteOffset)},this.decrypt=function(e){var t=32e3,n=new Int32Array(e),i=new Uint8Array(e.byteLength),r=0,o=this.key,s=this.iv;for(this.localDecrypt(n.subarray(r,r+t),o,s,i),r=t;r<n.length;r+=t)s=new Uint32Array([this.ntoh(n[r-4]),this.ntoh(n[r-3]),this.ntoh(n[r-2]),this.ntoh(n[r-1])]),this.localDecrypt(n.subarray(r,r+t),o,s,i);return i}},v.dependencies.AES128Decrypter.prototype={constructor:v.dependencies.AES128Decrypter},v.dependencies.HlsDemux=function(){"use strict";var e=function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(e,0),n.set(t,e.byteLength),n},t=1,n=[],i=[],r=-1,o=-1,s=function(e,t,n,i){for(var r,o=t;o<e.length;){if(r=new w.ts.TsPacket,r.parse(e.subarray(o,o+w.ts.TsPacket.prototype.TS_PACKET_SIZE)),r.getPid()===n&&(void 0===i||r.getPusi()===i))return{offset:o,packet:r};o+=w.ts.TsPacket.prototype.TS_PACKET_SIZE}return null},a=function(e){var t=s.call(this,e,0,w.ts.TsPacket.prototype.PAT_PID);if(null===t)return null;var n=new w.si.PAT;return n.parse(t.packet.getPayload()),n},l=function(e,t){var n=s.call(this,e,0,t);if(null===n)return null;var i=new w.si.PMT;return i.parse(n.packet.getPayload()),i},d=function(e){var t,i,s,a,l=null,d=null;if(t=new w.ts.TsPacket,t.parse(e),!t.hasAdaptationFieldOnly()&&(i=t.getPid(),s=n[i]))if(t.getPusi())if(a=new w.pes.PesPacket,a.parse(t.getPayload()),l=new T.vo.Mp4Track.Sample,l.cts=a.getPts().getValue(),l.dts=null!==a.getDts()?a.getDts().getValue():l.cts,l.size=0,l.duration=0,l.subSamples=[],r===-1&&(r=l.dts),l.mpegTimestamp=l.cts,l.dts-=r,l.cts-=r,l.dts+=o,l.cts+=o,d=a.getPayload(),"audio"===s.type&&(l.flags=16777216),"video"===s.type&&s.streamType.search("H.264")!==-1&&(l.flags=w.h264.isIDR(d)?33554432:16842752),l.subSamples.push(d),l.dts>=0)s.samples.push(l);else{var u=Math.abs(l.dts)/9e4;if(u>10)throw{name:T.dependencies.ErrorHandler.prototype.HLS_DEMUX_ERROR,message:"A/V desynchronization ("+Math.round(u)+" s.)"}}else s.samples.length>0&&(l=s.samples[s.samples.length-1],l.subSamples.push(t.getPayload()))},u=function(e){var t,n,i,r,o=0,s=0;if(0!==e.samples.length){for(i=0;i<e.samples.length;i++){for(n=0,t=e.samples[i],r=0;r<t.subSamples.length;r++)n+=t.subSamples[r].length;i>0&&(e.samples[i-1].duration=e.samples[i].dts-e.samples[i-1].dts),t.size=n,o+=n}for(e.samples[e.samples.length-1].duration=e.samples[e.samples.length-2].duration,e.data=new Uint8Array(o),e.dataCTS=[],i=0;i<e.samples.length;i++)for(t=e.samples[i],e.streamType.search("ADTS")!==-1&&(e.dataCTS[s]=t.cts),r=0;r<t.subSamples.length;r++)e.data.set(t.subSamples[r],s),s+=t.subSamples[r].length;if(e.streamType.search("H.264")!==-1&&w.h264.bytestreamToMp4(e.data),e.streamType.search("ADTS")!==-1&&c.call(this,e),e.previousCts&&e.previousDuration){t=e.samples[0];var a=t.cts-(e.previousCts+e.previousDuration);a>0&&a<e.timescale&&(t.cts-=a,t.dts-=a,t.duration+=a,this.debug.log("[HlsDemux]["+e.type+"] Patch sample duration, cts = "+(t.cts/9e4).toFixed(3)+", duration = "+(t.duration/9e4).toFixed(3)))}}},c=function(e){var t,n,i,r,o,s,a,l,d=[];for(t=w.aac.parseADTS(e.data,e.dataCTS),n=0,l=0;l<t.length;l++)n+=t[l].length;for(r=new Uint8Array(n),s=e.samples[0].cts,a=1024*e.timescale/e.samplingRate,i=0,l=0;l<t.length;l++)o=new T.vo.Mp4Track.Sample,o.cts=o.dts=t[l].cts?t[l].cts:s,o.size=t[l].length,o.duration=a,o.flags=16777216,0===d.length&&(o.mpegTimestamp=e.samples[0].mpegTimestamp),d.push(o),s=o.cts+a,l>0&&(d[l-1].duration=d[l].cts-d[l-1].cts,d[l-1].duration>a&&this.debug.log("[HlsDemux]["+e.type+"] Patch sample duration, cts = "+(d[l-1].cts/9e4).toFixed(3)+", duration = "+(d[l-1].duration/9e4).toFixed(3))),r.set(e.data.subarray(t[l].offset,t[l].offset+t[l].length),i),i+=t[l].length;e.data=r,e.samples=d},h=function(e){var t="",n=0,i=0;for(n=0;n<e.length;n++)i=e[n].toString(16),i.length<2&&(i="0"+i),t+=i;return t},p=function(){this.debug.log("[HlsDemux] Reset"),t=1,n=[],i=[],r=-1,o=-1},f=function(t,n){var i,r,o,a,l,d,u,c;if(i=s.call(this,t,0,n.pid,!0),null===i)throw{name:T.dependencies.ErrorHandler.prototype.HLS_DEMUX_ERROR,message:"No packets for track "+n.type};if(r=new w.pes.PesPacket,r.parse(i.packet.getPayload()),o=r.getPayload(),n.streamType.search("H.264")!==-1){for(a=w.h264.getSequenceHeader(o);null===a;)i=s.call(this,t,i.offset+w.ts.TsPacket.prototype.TS_PACKET_SIZE,n.pid,!1),o=e(o,i.packet.getPayload()),a=w.h264.getSequenceHeader(o);n.codecPrivateData=h(a.bytes),n.codecs="avc1.",l=/00000001[0-9]7/.exec(n.codecPrivateData),l&&l[0]&&(n.codecs+=n.codecPrivateData.substr(n.codecPrivateData.indexOf(l[0])+10,6)),n.width=a.width,n.height=a.height,this.debug.log("[HlsDemux] width  = "+n.width),this.debug.log("[HlsDemux] height = "+n.height)}n.streamType.search("AAC")!==-1&&(d=w.aac.getAudioSpecificConfig(o),u=(248&d[0])>>3,n.codecPrivateData=h(d),n.codecs="mp4a.40."+u,c=(7&d[0])<<1|(128&d[1])>>7,n.samplingRate=w.aac.SAMPLING_FREQUENCY[c],n.channels=(120&d[1])>>3,n.bandwidth=0),this.debug.log("[HlsDemux] codecs = "+n.codecs),this.debug.log("[HlsDemux] codecPrivateData = "+n.codecPrivateData)},m=function(e){var r,o,s,d,u,c,h=0;if(r=a.call(this,e),null===r)throw{name:T.dependencies.ErrorHandler.prototype.HLS_DEMUX_ERROR,message:"Failed to demux, missing signalization (PAT)"};if(o=l.call(this,e,r.getPmtPid()),null===o)throw{name:T.dependencies.ErrorHandler.prototype.HLS_DEMUX_ERROR,message:"Failed to demux, missing signalization (PMT)"};for(h=0;h<o.m_listOfComponents.length;h++){if(s=o.m_listOfComponents[h],d=s.m_elementary_PID,u=n[d],!u){if(u=new T.vo.Mp4Track,u.timescale=w.Pts.prototype.SYSTEM_CLOCK_FREQUENCY,u.pid=d,c=o.gStreamTypes[s.m_stream_type],null===c){this.debug.log("[HlsDemux] Stream Type "+s.m_stream_type+" unknown!");continue}switch(u.streamType=c.name,c.value){case 224:u.type="video";break;case 192:u.type="audio";break;case 252:u.type="data";break;default:u.type="und"}}if(f.call(this,e,u),""===u.codecs)throw{name:T.dependencies.ErrorHandler.prototype.HLS_DEMUX_ERROR,message:"Failed to get codec information for track "+u.type};n[d]||(u.trackId=t,t++,this.debug.log("[HlsDemux] Add track: type = "+u.type+", PID = "+u.pid+", trackId = "+u.trackId),i.push(u),n[d]=u)}return i},g=function(e,t){var n,r,s=0,a=-1;for(o===-1&&(o=9e4*t.startTime,this.debug.log("[HlsDemux] Media start time = "+o+" ("+t.startTime+")")),this.debug.log("[HlsDemux] Demux chunk, size = "+e.length+", nb packets = "+Math.round(e.length/w.ts.TsPacket.prototype.TS_PACKET_SIZE)),m.call(this,e),s=0;s<i.length;s++)n=i[s],n.samples.length>0&&(n.previousCts=n.samples[n.samples.length-1].cts,n.previousDuration=n.samples[n.samples.length-1].duration),i[s].samples=[],i[s].data=null;for(s=0;s<e.length;){if(s+w.ts.TsPacket.prototype.TS_PACKET_SIZE>e.length){this.debug.log("[HlsDemux] Demux chunk, residual bytes = "+(e.length-s));break}d.call(this,e.subarray(s,s+w.ts.TsPacket.prototype.TS_PACKET_SIZE)),s+=w.ts.TsPacket.prototype.TS_PACKET_SIZE}for(s=0;s<i.length;s++)if(n=i[s],0!==n.samples.length&&(u.call(this,n),this.debug.log("[HlsDemux]["+n.type+"] Demux: 1st PTS = "+n.samples[0].dts+" ("+n.samples[0].dts/9e4+")"),a=Math.max(a,n.samples[0].dts),r=Math.abs(n.samples[0].dts-a)/9e4,r>10))throw{name:T.dependencies.ErrorHandler.prototype.HLS_DEMUX_ERROR,message:"A/V desynchronization ("+Math.round(r)+" s.)"};var l=[];for(s=0;s<i.length;s++)i[s].samples.length>0&&l.push(i[s]);return l};return{debug:void 0,reset:p,getTracks:m,demux:g}},v.dependencies.HlsDemux.prototype={constructor:v.dependencies.HlsDemux},v.dependencies.HlsFragmentController=function(){"use strict";var e={},t=function(e,t){var n=0,i=s.hlsDemux.demux(new Uint8Array(e),t);for(n=0;n<i.length;n+=1)!s.manifestModel.getValue().timestampMap&&i[n].samples[0].mpegTimestamp&&(s.manifestModel.getValue().timestampMap={local:i[n].samples[0].cts/9e4,mpegts:i[n].samples[0].mpegTimestamp}),"video"===i[n].type&&(t.startTime=i[n].samples[0].dts/i[n].timescale);return s.mp4Processor.generateInitMediaSegment(i)},n=function(e){var t=new Uint8Array(16),n=0;for(n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t},i=function(e,t){var i=new Date,r=new DataView(t.key.buffer),o=new Uint32Array([r.getUint32(0),r.getUint32(4),r.getUint32(8),r.getUint32(12)]);r=new DataView(n(t.iv).buffer);var a=new Uint32Array([r.getUint32(0),r.getUint32(4),r.getUint32(8),r.getUint32(12)]),l=new v.dependencies.AES128Decrypter(o,a);return s.debug.log("[HlsFragmentController] decrypted chunk ("+(((new Date).getTime()-i.getTime())/1e3).toFixed(3)+"s.)"),l.decrypt(e)},r=function(e){var t=y.defer();this.debug.log("[HlsFragmentController]","Load decryption key: "+e.uri);var n=new T.dependencies.XHRLoader;return n.initialize("arraybuffer",0,0),n.load(e.uri).then(function(n){e.key=new Uint8Array(n.response),t.resolve()},function(n){!n||n.aborted?t.reject():t.reject({name:T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_MANIFEST,message:"Failed to download HLS decryption key",data:{url:e.uri,status:n.status}})}),t.promise},o=function(t,n){var o,s=y.defer(),a=this;return n.decryptionInfo&&"NONE"!==n.decryptionInfo.method?(o=e[n.decryptionInfo.uri],o?s.resolve(i.call(this,t,o)):(o=n.decryptionInfo,r.call(this,o).then(function(){e[o.uri]=o,s.resolve(i.call(a,t,o))},function(e){s.reject(e)})),s.promise):(s.resolve(t),s.promise)},s=T.utils.copyMethods(T.dependencies.FragmentController);return s.manifestModel=void 0,s.hlsDemux=void 0,s.mp4Processor=void 0,s.process=function(e,n){var i=y.defer(),r=null;return null===e||void 0===e||0===e.byteLength?(i.resolve(null),i.promise):n&&"Media Segment"===n.type?"text"===n.streamType?(i.resolve(e),i.promise):(o.call(s,e,n).then(function(e){try{r=t(e,n),s.sequenceNumber++,i.resolve(r)}catch(o){i.reject(o)}},function(e){i.reject(e)}),i.promise):(i.resolve(null),i.promise)},s},v.dependencies.HlsFragmentController.prototype={constructor:v.dependencies.HlsFragmentController},v.dependencies.HlsHandler=function(){"use strict";var e=function(e){var n,i,r,o=null,s=this,a=null,l=y.defer();return o=e.adaptation.period,a=o.start,n=t.manifestModel.getValue(),i=t.manifestExt.getIsDynamic(n),r=new T.vo.SegmentRequest,r.streamType=t.getType(),r.type="Initialization Segment",r.url=null,r.data=1,r.range=e.range,r.availabilityStartTime=s.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(a,e.adaptation.period.mpd,i),r.availabilityEndTime=s.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(a+o.duration,o.mpd,i),r.quality=e.index,l.resolve(r),l.promise},t=T.utils.copyMethods(x.dependencies.DashHandler);return t.getInitRequest=e,t},v.dependencies.HlsHandler.prototype={constructor:v.dependencies.HlsHandler},v.dependencies.HlsParser=function(){var e,t=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,n=/#EXT-X-MEDIA:(.*)/g,i="(?:#(EXT-X-MEDIA-SEQUENCE):*(\\d+))",r="(?:#(EXT-X-TARGETDURATION):*(\\d+))",o="(?:#(EXT-X-PROGRAM-DATE-TIME):*(.+))",s="(?:#(EXT-X-KEY):(.+))",a="(?:#(EXTINF):*(\\d+(?:\\.\\d+)?)(?:,(.*))?[\r\n]*(.*))",l="(?:#(EXT-X-ENDLIST))",d=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,u=new RegExp("(?:"+i+"|"+r+"|"+o+"|"+s+"|"+a+"|"+l+")","g"),c=2,h=500,p=c,f=h,m=function(e){for(var t,n,i,r={};null!==(t=d.exec(e));)n=t[1],i=t[2].replace(/"/g,""),r[n]=i;return r},g=function(e,t){return 0===e.indexOf("http://")||0===e.indexOf("https://")?e:t+e},_=function(e){for(var n,i,r,o,s,a,l,d,u,c,h=[];null!==(i=t.exec(e));){for(r=m(i[1]),o=r.CODECS||"",o=o.split(","),s=a="",c=0;c<o.length;c++)o[c].indexOf("avc1")!==-1?a=o[c]:s=o[c];l=r.RESOLUTION||"0x0",l=l.split("x"),d=parseInt(l[0],10),u=parseInt(l[1],10),n={programId:r["PROGRAM-ID"]||"",bandwidth:parseInt(r.BANDWIDTH||"0",10),audioCodec:s,videoCodec:a,width:d,height:u,audioId:r.AUDIO||"",subtitlesId:r.SUBTITLES||"",uri:i[2]},h.push(n)}return h},E=function(e){for(var t,i,r,o,s=[];null!==(t=n.exec(e))&&(i=m(t[1]),r=(i.TYPE||"").toLowerCase(),0!==r.length);)o={type:r,groupId:i["GROUP-ID"]||"",name:r+(i.NAME?"_"+i.NAME:""),language:i.LANGUAGE||"",autoSelect:"YES"===i["AUTO-SELECT"],"default":"YES"===i.SUTITLES,uri:i.URI||""},s.push(o);return s},b=function(e,t){for(var n=0;n<e.length&&e[n].sequenceNumber<t;n++)e.shift(),n--},v=function(e,t,n){var i,r,o,s,a,l=null,d=0,c=0,h=null;if(!e||e&&e.length<0)return!1;if(this.debug.log(e),0!==e.indexOf("#EXTM3U"))return!1;i=t.SegmentList,i||(i={name:"SegmentList",isRoot:!1,isArray:!1,duration:0,startNumber:0,timescale:1,BaseURL:t.BaseURL,SegmentURL_asArray:[]},t.SegmentList=i),r=i.SegmentURL_asArray,t.duration=1/0;for(var p,f,y;null!==(p=u.exec(e));)switch(p=p.filter(function(e){return void 0!==e}),f=p[1]){case"EXT-X-MEDIA-SEQUENCE":c=parseInt(p[2]),i.startNumber=c;break;case"EXT-X-TARGETDURATION":i.duration=parseInt(p[2]);break;case"EXT-X-KEY":y=m(p[2]),l={method:y.METHOD||"NONE",uri:g(y.URI,i.BaseURL),iv:y.IV};break;case"EXTINF":o={name:"SegmentURL",isRoot:!1,isArray:!0,media:g(p[4],i.BaseURL),sequenceNumber:c,time:0===r.length?0:r[r.length-1].time+r[r.length-1].duration,duration:parseFloat(p[2]),decryptionInfo:l},o.decryptionInfo&&!o.decryptionInfo.iv&&(o.decryptionInfo.iv=o.sequenceNumber),(0===r.length||o.sequenceNumber>r[r.length-1].sequenceNumber)&&r.push(o),c++,d+=o.duration,h&&(o.programDateTime=h,h+=1e3*o.duration);break;case"EXT-X-ENDLIST":t.duration=d;break;case"EXT-X-PROGRAM-DATE-TIME":h=Date.parse(p[2])}if(b(r,i.startNumber),n.segments&&(b(r,n.segments[0].sequenceNumber),b(n.segments,r[0].sequenceNumber),r[0].time!==n.segments[0].time))for(r[0].time=n.segments[0].time,a=1;a<r.length;a++)r[a].time=r[a-1].time+r[a-1].duration;n.segments=r;var _={start:r[0].time,end:r[r.length-1].time+r[r.length-1].duration};return h&&(_.programStart=r[0].programDateTime,_.programEnd=r[r.length-1].programDateTime+r[r.length-1].duration),"video"===n.contentType&&this.metricsModel.addDVRInfo("video",new Date,_),s={name:"Initialization",sourceURL:t.SegmentList.SegmentURL_asArray[0].media},t.SegmentList.Initialization=s,!0},x=function(e,t){var n,i,r=y.defer(),o=e.Period_asArray[0],s=o.AdaptationSet_asArray[0],a=s.Representation_asArray[t],l=new T.vo.SegmentRequest,d=this;o.start=0,s.duration=a.duration,o.duration=a.duration,a.duration!==1/0&&(e.mediaPresentationDuration=a.duration),e.type=a.duration===1/0?"dynamic":"static",n=a.SegmentList.duration*a.SegmentList.SegmentURL_asArray.length,"dynamic"===e.type&&(i=new Date,e.availabilityStartTime=new Date(i.getTime()-1e3*n),e.timeShiftBufferDepth=n),e.minBufferTime=3*a.SegmentList.duration,a=s.Representation_asArray[t],l.type="Initialization Segment",l.url=a.SegmentList.Initialization.sourceURL;var u=function(e,t){var n=this.hlsDemux.getTracks(new Uint8Array(t.data)),i=0;for(e.codecs="",i=0;i<n.length;i++)e.codecs+=n[i].codecs,i<n.length-1&&(e.codecs+=",");r.resolve()},c=function(){r.resolve()};return""===a.codecs?(d.debug.log("[HlsParser]","Load initialization segment: "+l.url),d.fragmentLoader.load(l).then(u.bind(d,a),c.bind(d))):r.resolve(),r.promise},S=function(e){var t=null;return e.indexOf("/")!==-1&&(e.indexOf("?")!==-1&&(e=e.substring(0,e.indexOf("?"))),t=e.substring(0,e.lastIndexOf("/")+1)),t},D=function(t,n){var i=y.defer(),r=this;return this.debug.log("[HlsParser]","Load playlist manifest: "+t.url),e=new T.dependencies.XHRLoader,e.initialize("text",p,f),e.load(t.url).then(function(e){v.call(r,e.response,t,n)?i.resolve():i.reject({name:T.dependencies.ErrorHandler.prototype.MANIFEST_ERR_PARSE,message:"Failed to parse variant stream playlist",data:{url:t.url}})},function(e){!e||e.aborted?i.reject():i.reject({name:T.dependencies.ErrorHandler.prototype.DOWNLOAD_ERR_MANIFEST,message:"Failed to download variant stream playlist",data:{url:t.url,status:e.status}})}),i.promise},I=function(e,t){var n,i,r,o,s,a,l,d,u=y.defer(),c=[],h=0,p=[],f=[],m=[],b=this,v=0;if(0!==e.indexOf("#EXTM3U"))return this.debug.error("[HlsParser] no stream in HLS manifest"),u.reject(),u.promise;if(n={},n.name="M3U",n.isRoot=!0,n.isArray=!0,n.parent=null,n.BaseURL=t,n.profiles="urn:mpeg:dash:profile:isoff-live:2011",n.type="static",i={},i.name="Period",i.isRoot=!1,i.isArray=!1,i.parent=n,i.duration=0,i.BaseURL=n.BaseURL,n.Period=i,n.Period_asArray=[i],c=[],i.AdaptationSet=c,i.AdaptationSet_asArray=c,p=_(e),0===p.length)return this.debug.error("[HlsParser] No stream in HLS manifest"),u.reject(),u.promise;for(p.sort(function(e,t){return e.bandwidth-t.bandwidth}),r={name:"AdaptationSet",isRoot:!1,isArray:!0,id:"video",lang:"",contentType:"video",mimeType:"video/mp4",maxWidth:0,maxHeight:0,BaseURL:i.BaseURL},o=[],v=0;v<p.length&&(a=p[v],!(a.bandwidth<=64e3));v++)s={name:"Representation",isRoot:!1,isArray:!0,id:h.toString(),mimeType:"video/mp4",codecs:a.videoCodec.length>0?a.audioId.length>0?a.videoCodec:a.videoCodec+","+a.audioCodec:"",bandwidth:a.bandwidth,width:a.width,height:a.height,url:g(a.uri,r.BaseURL)},s.BaseURL=S(s.url),o.push(s),h++;for(r.Representation=o.length>1?o:o[0],r.Representation_asArray=o,c.push(r),d=this.abrController.getPlaybackQuality("video",c[0]).quality,s=c[0].Representation_asArray[d],m.push(D.call(this,s,r)),f=E(e),v=0;v<f.length;v++)l=f[v],r={name:"AdaptationSet",isRoot:!1,isArray:!0,id:l.name,lang:l.language,contentType:l.type,mimeType:"audio"===l.type?"audio/mp4":"text/vtt",maxWidth:0,maxHeight:0,BaseURL:i.BaseURL},s={name:"Representation",isRoot:!1,isArray:!0,id:"",mimeType:"audio"===l.type?"audio/mp4":"text/vtt",codecs:"audio"===l.type?p[0].audioCodec:"WebVTT",bandwidth:0,width:0,height:0,url:g(l.uri,r.BaseURL)},s.BaseURL=S(s.url),r.Representation=s,r.Representation_asArray=[s],c.push(r),m.push(D.call(this,s,r));return y.all(m).then(function(){x.call(b,n,d).then(function(){u.resolve(n)})},function(e){e?u.reject(e):u.resolve(null)}),u.promise},L=function(e,t){return this.hlsDemux.reset(),this.debug.log("[HlsParser]","Doing parse."),this.debug.log("[HlsParser]",e),I.call(this,e,t)},M=function(){null!==e&&e.abort()};return{debug:void 0,config:void 0,manifestModel:void 0,fragmentLoader:void 0,abrController:void 0,hlsDemux:void 0,metricsModel:void 0,setup:function(){p=this.config.getParam("ManifestLoader.RetryAttempts","number",c),f=this.config.getParam("ManifestLoader.RetryInterval","number",h)},parse:L,updatePlaylist:D,abort:M}},v.dependencies.HlsParser.prototype={constructor:v.dependencies.HlsParser},b=function(){"use strict";return{dependencies:{}}}(),b.dependencies.MssParser=function(){"use strict";var e=1e7,t=["AAC","AACL","AVC1","H264","TTML","DFXP"],n={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},i={video:"video/mp4",audio:"audio/mp4",text:"application/ttml+xml+mp4"},r=null,o=null,s=function(){var e,t,n={},i=[],s=this.domParser.getChildNode(r,"SmoothStreamingMedia");for(n.BaseURL=o,t=0;t<s.childNodes.length;t++)"StreamIndex"===s.childNodes[t].nodeName&&(e=a.call(this,s.childNodes[t]),null!==e&&i.push(e));return i.length>0&&(n.AdaptationSet=i.length>1?i:i[0]),n.AdaptationSet_asArray=i,n},a=function(e){var t,n,r,s,a={},d=[],u={},h=null;for(a.id=this.domParser.getAttributeValue(e,"Name"),a.lang=this.domParser.getAttributeValue(e,"Language"),a.contentType=this.domParser.getAttributeValue(e,"Type"),a.mimeType=i[a.contentType],a.subType=this.domParser.getAttributeValue(e,"Subtype"),a.maxWidth=this.domParser.getAttributeValue(e,"MaxWidth"),a.maxHeight=this.domParser.getAttributeValue(e,"MaxHeight"),a.BaseURL=o,u=c.call(this,e),h=this.domParser.getChildNodes(e,"QualityLevel"),s=0;s<h.length;s++)h[s].BaseURL=a.BaseURL,h[s].mimeType=a.mimeType,h[s].Id=a.id+"_"+this.domParser.getAttributeValue(h[s],"Index"),t=l.call(this,h[s],e),null!==t&&(t.SegmentTemplate=u,d.push(t));return 0===d.length?null:(a.Representation=d.length>1?d:d[0],a.Representation_asArray=d,a.SegmentTemplate=u,n=u.SegmentTimeline.S_asArray,r={start:n[0].t/u.timescale,end:(n[n.length-1].t+n[n.length-1].d)/u.timescale},this.metricsModel.addDVRInfo(a.contentType,new Date,r),a)},l=function(e,n){var i={},r=null;return i.id=e.Id,i.bandwidth=parseInt(this.domParser.getAttributeValue(e,"Bitrate"),10),i.mimeType=e.mimeType,i.width=parseInt(this.domParser.getAttributeValue(e,"MaxWidth"),10),i.height=parseInt(this.domParser.getAttributeValue(e,"MaxHeight"),10),r=this.domParser.getAttributeValue(e,"FourCC"),null!==r&&""!==r||(r=this.domParser.getAttributeValue(n,"FourCC")),null!==r&&""!==r||(r="AAC"),t.indexOf(r.toUpperCase())===-1?(this.debug.warn("[MssParser] Codec not supported: "+r),null):("H264"===r||"AVC1"===r?i.codecs=d.call(this,e):r.indexOf("AAC")>=0&&(i.codecs=u.call(this,e,r),i.audioSamplingRate=parseInt(this.domParser.getAttributeValue(e,"SamplingRate"),10),i.audioChannels=parseInt(this.domParser.getAttributeValue(e,"Channels"),10)),i.codecPrivateData=""+this.domParser.getAttributeValue(e,"CodecPrivateData"),i.BaseURL=e.BaseURL,i)},d=function(e){var t,n,i=this.domParser.getAttributeValue(e,"CodecPrivateData").toString();return t=/00000001[0-9]7/.exec(i),n=t&&t[0]?i.substr(i.indexOf(t[0])+10,6):void 0,"avc1."+n},u=function(e,t){var i,r,o,s,a=0,l=this.domParser.getAttributeValue(e,"CodecPrivateData").toString(),d=parseInt(this.domParser.getAttributeValue(e,"SamplingRate"),10);return"AACH"===t&&(a=5),void 0===l||""===l?(a=2,o=n[d],"AACH"===t?(a=5,l=new Uint8Array(4),s=n[2*d],l[0]=a<<3|o>>1,l[1]=o<<7|e.Channels<<3|s>>1,l[2]=s<<7|8,l[3]=0,r=new Uint16Array(2),r[0]=(l[0]<<8)+l[1],r[1]=(l[2]<<8)+l[3],i=r[0].toString(16),i=r[0].toString(16)+r[1].toString(16)):(l=new Uint8Array(2),l[0]=a<<3|o>>1,l[1]=o<<7|parseInt(this.domParser.getAttributeValue(e,"Channels"),10)<<3,r=new Uint16Array(1),r[0]=(l[0]<<8)+l[1],i=r[0].toString(16)),l=""+i,l=l.toUpperCase(),e.setAttribute("CodecPrivateData",l)):0===a&&(a=(248&parseInt(l.substr(0,2),16))>>3),"mp4a.40."+a},c=function(t){var n,i={};return n=this.domParser.getAttributeValue(t,"Url").replace("{bitrate}","$Bandwidth$"),n=n.replace("{start time}","$Time$"),i.media=n,i.timescale=e,i.SegmentTimeline=h.call(this,t),i},h=function(e){var t,n,i,r={},o=this.domParser.getChildNodes(e,"c"),s=[];for(t=0;t<o.length;t++)n=parseFloat(this.domParser.getAttributeValue(o[t],"t")),i=parseFloat(this.domParser.getAttributeValue(o[t],"d")),0!==t||n||(n=0),t>0&&(s[s.length-1].d||(s[s.length-1].d=n-s[s.length-1].t),n||(n=s[s.length-1].t+s[s.length-1].d)),s.push({d:i,t:n});return r.S=s,r.S_asArray=s,r},p=function(e){var t,n,i,r;return t=L.decodeArray(e.firstChild.data),n=f(t),n=new Uint16Array(n.buffer),n=String.fromCharCode.apply(null,n),i=(new DOMParser).parseFromString(n,"application/xml"),r=i.querySelector("KID").textContent,r=L.decodeArray(r),m(r),r},f=function(e){var t,n,i,r,o,s=0;for(t=(e[s+3]<<24)+(e[s+2]<<16)+(e[s+1]<<8)+e[s],s+=4,n=(e[s+1]<<8)+e[s],s+=2;s<e.length;)if(i=(e[s+1]<<8)+e[s],s+=2,1===i)return r=(e[s+1]<<8)+e[s],s+=2,o=new Uint8Array(r),o.set(e.subarray(s,s+r)),o;return null},m=function(e){g(e,0,3),g(e,1,2),g(e,4,5),g(e,6,7)},g=function(e,t,n){var i=e[t];e[t]=e[n],e[n]=i},_=function(e){var t,n={},i=this.system.getObject("ksPlayReady");return t={__text:e.firstChild.data,__prefix:"mspr"},n.schemeIdUri=i.schemeIdURI,n.value=i.systemString,n.pro=t,n.pro_asArray=t,n},E=function(){var e={},t=this.system.getObject("ksWidevine");return e.schemeIdUri=t.schemeIdURI,e.value=t.systemString,e},v=function(t){var n,i,a,l,d,u,c,h,f={},m=[],g=this.domParser.getChildNode(r,"SmoothStreamingMedia"),y=this.domParser.getChildNode(g,"Protection"),v=null;f.name="MSS",f.profiles="urn:mpeg:dash:profile:isoff-live:2011";var x=this.domParser.getAttributeValue(g,"IsLive");f.type=null!==x&&"true"===x.toLowerCase()?"dynamic":"static",f.timeShiftBufferDepth=parseFloat(this.domParser.getAttributeValue(g,"DVRWindowLength"))/e;var S=parseFloat(this.domParser.getAttributeValue(g,"Duration"));for(f.mediaPresentationDuration=0===S?1/0:S/e,f.BaseURL=o,f.minBufferTime=T.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME,"dynamic"===f.type&&(f.availabilityStartTime=new Date(t.getTime()-1e3*f.timeShiftBufferDepth)),f.Period=s.call(this),f.Period_asArray=[f.Period],n=f.Period,n.start=0,void 0!==y&&(v=this.domParser.getChildNode(y,"ProtectionHeader"),v.firstChild.data=v.firstChild.data.replace(/\n|\r/g,""),l=p(v),a=_.call(this,v),a["cenc:default_KID"]=l,m.push(a),a=E.call(this,v),a["cenc:default_KID"]=l,m.push(a),f.ContentProtection=m.length>1?m:m[0],f.ContentProtection_asArray=m,(navigator.userAgent.indexOf("Chrome")>=0||navigator.userAgent.indexOf("Firefox")>=0)&&(m[m.length-1].pssh={__text:b.dependencies.createVOWidevinePssh(p(v),this.debug)})),i=n.AdaptationSet_asArray,c=0;c<i.length;c+=1)void 0!==f.ContentProtection&&(i[c].ContentProtection=f.ContentProtection,i[c].ContentProtection_asArray=f.ContentProtection_asArray);if(delete f.ContentProtection,delete f.ContentProtection_asArray,"static"===f.type){for(c=0;c<i.length;c++){for(u=i[c].SegmentTemplate.SegmentTimeline.S_asArray,d=u[0].t,h=0;h<u.length;h++)u[h].tManifest=u[h].t,u[h].t-=d;"audio"!==i[c].contentType&&"video"!==i[c].contentType||(n.start=Math.max(u[0].t,n.start))}n.start=parseFloat(n.start)/e}return f},x=function(e,t){this.debug.info("[MssParser]","Doing parse.");var n=new Date,i=null,s=null,a=null;return r=this.domParser.createXmlTree(e),i=new Date,null===r?y.reject(null):(o=t,s=v.call(this,n),a=new Date,this.debug.info("[MssParser]","Parsing complete (xmlParser: "+(i.getTime()-n.getTime())+"ms, mss2dash: "+(a.getTime()-i.getTime())+"ms, total: "+((new Date).getTime()-n.getTime())/1e3+"s)"),y.when(s))};return{debug:void 0,system:void 0,errHandler:void 0,domParser:void 0,metricsModel:void 0,parse:x}},b.dependencies.MssParser.prototype={constructor:b.dependencies.MssParser},b.dependencies.MssHandler=function(){"use strict";var e=function(e,t){var n=1;return e.audioChannels?n=e.audioChannels:t.audioChannels&&(n=t.audioChannels),n},t=function(e,t){var n=1;return n=e.audioSamplingRate?e.audioSamplingRate:t.audioSamplingRate},n=function(n){var r,o,s,a,l,d=i.manifestModel.getValue();if(n.initData)return n.initData;if(r=n.adaptation,o=d.Period_asArray[r.period.index].AdaptationSet_asArray[r.index],s=o.Representation_asArray[n.index],a=new T.vo.Mp4Track,a.type=i.getType()||"und",a.trackId=r.index+1,a.timescale=n.timescale,a.duration=n.adaptation.period.duration,a.codecs=s.codecs,a.codecPrivateData=s.codecPrivateData,a.bandwidth=s.bandwidth,"text"!==a.type&&(l=s.mimeType+';codecs="'+s.codecs+'"',!this.capabilities.supportsCodec(this.videoModel.getElement(),l)))throw{name:T.dependencies.ErrorHandler.prototype.MEDIA_ERR_CODEC_UNSUPPORTED,message:"Codec is not supported",data:{codec:l}};return o.ContentProtection_asArray&&o.ContentProtection_asArray.length>0&&(a.contentProtection=o.ContentProtection_asArray),a.width=s.width||o.maxWidth,a.height=s.height||o.maxHeight,a.language=o.lang?o.lang:"und",a.channels=e(o,s),a.samplingRate=t(o,s),n.initData=i.mp4Processor.generateInitSegment([a]),n.initData},i=T.utils.copyMethods(x.dependencies.DashHandler);return i.mp4Processor=void 0,i.getInitRequest=function(e){var t=null,r=this,o=null,s=null,a=y.defer();if(!e)throw new Error("MssHandler.getInitRequest(): representation is undefined");t=e.adaptation.period,o=t.start,s=new T.vo.SegmentRequest,s.streamType=i.getType(),s.type="Initialization Segment",s.url=null;try{s.data=n.call(this,e)}catch(l){return a.reject(l),a.promise}return s.range=e.range,s.availabilityStartTime=r.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(o,e.adaptation.period.mpd,i.getIsDynamic()),s.availabilityEndTime=r.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(o+t.duration,t.mpd,i.getIsDynamic()),s.quality=e.index,a.resolve(s),a.promise},i.getIFrameRequest=function(e){return e&&e.url&&("video"===e.streamType||"audio"===e.streamType)&&(e.url=e.url.replace("Fragments","KeyFrames")),
e},i.getFragmentInfoRequest=function(e){return e&&e.url&&(e.url=e.url.replace("Fragments","FragmentInfo"),e.type="FragmentInfo Segment"),e},i},b.dependencies.MssHandler.prototype={constructor:b.dependencies.MssHandler},b.dependencies.MssFragmentController=function(){"use strict";var e=function(e,t,n,i){var r,o=this.manifestModel.getValue(),s=!1,a=i.SegmentTemplate.SegmentTimeline.S,l=t.entry,d=0,u=0,c=null,h=0,p=0,f=0,m=-1,g=null;if("dynamic"===o.type){for(;p<l.length;)d=l[p].fragment_absolute_time,u=l[p].fragment_duration,c=a[a.length-1],h=c.t,d>h&&(this.debug.log("[MssFragmentController] Add new segment - t = "+d/1e7),a.push({t:d,d:u}),s=!0),p+=1;for(f=a.length-1;f>=0;f-=1)if(a[f].t===n.baseMediaDecodeTime){m=f;break}if(m>=0)for(p=0;p<l.length;p+=1)m+p<a.length&&(h=a[m+p].t,h+a[m+p].d!==l[p].fragment_absolute_time&&(a[m+p].t=l[p].fragment_absolute_time,a[m+p].d=l[p].fragment_duration,this.debug.log("[MssFragmentController] Correct tfrf time  = "+l[p].fragment_absolute_time+"and duration = "+l[p].fragment_duration+"! ********"),s=!0));if(o.timeShiftBufferDepth&&o.timeShiftBufferDepth>0){if(s)for(c=a[a.length-1],h=c.t,g=h-1e7*o.timeShiftBufferDepth,c=a[0];c.t<g;)this.debug.log("[MssFragmentController] Remove segment  - t = "+c.t/1e7),a.splice(0,1),c=a[0];r={start:a[0].t/i.SegmentTemplate.timescale,end:n.baseMediaDecodeTime/i.SegmentTemplate.timescale+e.duration};var y=this.metricsModel.getMetricsFor(i.type).DVRInfo;y&&y.length>0&&r.end>y[y.length-1].range.end&&this.metricsModel.addDVRInfo(i.type,new Date,r)}return s}},t=function(t,n,i){var r,o=null,s=null,a=null,l=null,d=null,u=0;if(o=P.deserialize(t),s=o.getBoxByType("moof"),a=s.getBoxByType("traf"),l=a.getBoxByType("tfdt"),null===l&&(l=new P.boxes.TrackFragmentBaseMediaDecodeTimeBox,l.version=1,l.flags=0,l.baseMediaDecodeTime=Math.floor(n.startTime*n.timescale),r=a.getBoxIndexByType("tfhd"),a.boxes.splice(r+1,0,l)),d=a.getBoxesByType("tfrf"),0!==d.length)for(u=0;u<d.length;u+=1)e.call(this,n,d[u],l,i)},n=function(e,t){var n,i,r,o,s,a=null,l=null,d=null,u=null,c=null,h=null;for(a=e.getBoxByType("moof"),l=e.getBoxByType("mdat"),d=a.getBoxByType("traf"),u=d.getBoxByType("trun"),n=d.getBoxByType("tfhd"),void 0===u.samples_table[0].sample_duration&&(u.samples_table[0].sample_duration=n.default_sample_duration),r=Math.floor(t/u.samples_table[0].sample_duration),i=0;i<r-1;i++)u.samples_table.push(u.samples_table[0]);if(o=r*u.samples_table[0].sample_duration,o<t&&(u.samples_table[u.samples_table.length-1].sample_duration+=t-o),u.sample_count=u.samples_table.length,c=d.getBoxByType("sepiff"),null!==c){for(c.sample_count>1&&(c.entry=c.entry.slice(0,1)),i=0;i<r-1;i+=1)c.entry.push(c.entry[0]);c.sample_count=c.entry.length}if(h=d.getBoxByType("saiz"),null!==h){if(0===h.default_sample_info_size)for(h.sample_count>1&&(h.sample_info_size=h.sample_info_size.slice(0,1)),i=0;i<r-1;i+=1)h.sample_info_size.push(h.sample_info_size[0]);h.sample_count=c.entry.length}for(s=l.data,l.data=new Uint8Array(s.length*u.sample_count),i=0;i<u.sample_count;i+=1)l.data.set(s,s.length*i)},i=function(t,i,r){var o,s,a=0,l=this.manifestModel.getValue(),d=l?this.manifestExt.getIndex(r,l)+1:-1,u=P.deserialize(t),c=null,h=null,p=null,f=null,m=null,g=null,y=null,_=null,E=null,b=null,v=-1,x=0,T=0,S=0,D=0,I=null;if(!u)return null;if(c=u.getBoxByType("moof"),h=u.getBoxByType("mdat"),p=c.getBoxByType("traf"),f=p.getBoxByType("trun"),m=p.getBoxByType("tfhd"),s=void 0!==f.samples_table[0].sample_duration?f.samples_table[0].sample_duration:m.default_sample_duration,o=i.duration*i.timescale,1===f.samples_table.length&&s<o&&n(u,o),m.track_ID=d,p.removeBoxByType("tfxd"),E=p.getBoxByType("tfdt"),null===E&&(E=new P.boxes.TrackFragmentBaseMediaDecodeTimeBox,E.version=1,E.flags=0,E.baseMediaDecodeTime=Math.floor(i.startTime*i.timescale),v=p.getBoxIndexByType("tfhd"),p.boxes.splice(v+1,0,E)),b=p.getBoxesByType("tfrf"),0!==b.length)for(a=0;a<b.length;a+=1)e.call(this,i,b[a],E,r),p.removeBoxByType("tfrf");if(y=p.getBoxByType("sepiff"),null!==y&&(y.boxtype="senc",y.extended_type=void 0,g=p.getBoxByType("saio"),null===g)){if(g=new P.boxes.SampleAuxiliaryInformationOffsetsBox,g.version=0,g.flags=0,g.entry_count=1,g.offset=[],_=new P.boxes.SampleAuxiliaryInformationSizesBox,_.version=0,_.flags=0,_.sample_count=y.sample_count,_.default_sample_info_size=0,_.sample_info_size=[],2&y.flags)for(a=0;a<y.sample_count;a+=1)_.sample_info_size[a]=10+6*y.entry[a].NumberOfEntries;else _.default_sample_info_size=8;p.boxes.push(_),p.boxes.push(g)}return m.flags&=16777214,m.flags|=131072,f.flags|=1,f.data_offset=0,x=u.getLength(),f.data_offset=x-h.size+8,g=p.getBoxByType("saio"),null!==g&&(T=u.getBoxOffsetByType("moof"),S=c.getBoxOffsetByType("traf"),D=p.getBoxOffsetByType("senc"),g.offset[0]=T+S+D+16),I=P.serialize(u)},r=T.utils.copyMethods(T.dependencies.FragmentController);return r.manifestModel=void 0,r.manifestExt=void 0,r.metricsModel=void 0,r.process=function(e,n,r){var o=y.defer(),s=null,a=this.manifestModel.getValue(),l=null;if(!(null!==e&&void 0!==e&&e.byteLength>0))return o.resolve(null),o.promise;if(s=new Uint8Array(e),a&&r)try{l=a.Period_asArray[r.adaptation.period.index].AdaptationSet_asArray[r.adaptation.index],n&&("Media Segment"===n.type?(s=i.call(this,s,n,l),o.resolve(s?s:null)):"FragmentInfo Segment"===n.type?(t.call(this,s,n,l),o.resolve(s)):o.resolve(s))}catch(d){o.reject(d)}else o.resolve(s);return o.promise},r},b.dependencies.MssFragmentController.prototype={constructor:b.dependencies.MssFragmentController},b.dependencies.createVOWidevinePssh=function(e,t){var n=new Uint8Array([255,255,255,255,112,115,115,104,0,0,0,0,237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237,255,255,255,255,8,1,18,16,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,26,12,118,105,97,99,99,101,115,115,111,114,99,97,42,2,83,68]),i=n.length,r=i-32,o="",s=0;if(n[0]=(4278190080&i)>>32,n[1]=(16711680&i)>>16,n[2]=(65280&i)>>8,n[3]=255&i,n[28]=(4278190080&r)>>32,n[29]=(16711680&r)>>16,n[30]=(65280&r)>>8,n[31]=255&r,n.set(e,36),t){for(o="",s=0;s<n.length;s++)o+="\\0x"+n[s].toString(16);t.log("[VoWvPssh] "+o)}return n=String.fromCharCode.apply(null,n),t&&t.log("[VoWvPssh] "+n),n=L.encodeASCII(n),t&&t.log("[VoWvPssh] "+n),n};var I={};I.encode=function(e){for(var t=[],n=0;n<e.length;++n){var i=e.charCodeAt(n);i<128?t.push(i):i<2048?(t.push(192|i>>6),t.push(128|63&i)):i<65536?(t.push(224|i>>12),t.push(128|63&i>>6),t.push(128|63&i)):(t.push(240|i>>18),t.push(128|63&i>>12),t.push(128|63&i>>6),t.push(128|63&i))}return t},I.decode=function(e){for(var t=[],n=0;n<e.length;){var i=e[n++];i<128||(i<224?(i=(31&i)<<6,i|=63&e[n++]):i<240?(i=(15&i)<<12,i|=(63&e[n++])<<6,i|=63&e[n++]):(i=(7&i)<<18,i|=(63&e[n++])<<12,i|=(63&e[n++])<<6,i|=63&e[n++])),t.push(String.fromCharCode(i))}return t.join("")};var L={};if(function(e){var t=function(t){for(var n=0,i=[],r=0|t.length/3;0<r--;){var o=(t[n]<<16)+(t[n+1]<<8)+t[n+2];n+=3,i.push(e.charAt(63&o>>18)),i.push(e.charAt(63&o>>12)),i.push(e.charAt(63&o>>6)),i.push(e.charAt(63&o))}if(2==t.length-n){var o=(t[n]<<16)+(t[n+1]<<8);i.push(e.charAt(63&o>>18)),i.push(e.charAt(63&o>>12)),i.push(e.charAt(63&o>>6)),i.push("=")}else if(1==t.length-n){var o=t[n]<<16;i.push(e.charAt(63&o>>18)),i.push(e.charAt(63&o>>12)),i.push("==")}return i.join("")},n=function(){for(var t=[],n=0;n<e.length;++n)t[e.charCodeAt(n)]=n;return t["=".charCodeAt(0)]=0,t}(),i=function(e){for(var t=0,i=[],r=0|e.length/4;0<r--;){var o=(n[e.charCodeAt(t)]<<18)+(n[e.charCodeAt(t+1)]<<12)+(n[e.charCodeAt(t+2)]<<6)+n[e.charCodeAt(t+3)];i.push(255&o>>16),i.push(255&o>>8),i.push(255&o),t+=4}return i&&("="==e.charAt(t-2)?(i.pop(),i.pop()):"="==e.charAt(t-1)&&i.pop()),i},r={};r.encode=function(e){for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t},r.decode=function(e){for(var t=0;t<s.length;++t)a[t]=String.fromCharCode(a[t]);return a.join("")},L.decodeArray=function(e){var t=i(e);return new Uint8Array(t)},L.encodeASCII=function(e){var n=r.encode(e);return t(n)},L.decodeASCII=function(e){var t=i(e);return r.decode(t)},L.encode=function(e){var n=I.encode(e);return t(n)},L.decode=function(e){var t=i(e);return I.decode(t)}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),void 0===M)var M=L.encode;if(void 0===R)var R=L.decode;if(function(e){"use strict";var t={VERSION:"0.5.3"};t.System=function(){this._mappings={},this._outlets={},this._handlers={},this.strictInjections=!0,this.autoMapOutlets=!1,this.postInjectionHook="setup"},t.System.prototype={_createAndSetupInstance:function(e,t){var n=new t;return this.injectInto(n,e),n},_retrieveFromCacheOrCreate:function(e,t){"undefined"==typeof t&&(t=!1);var n;if(!this._mappings.hasOwnProperty(e))throw new Error(1e3);var i=this._mappings[e];return!t&&i.isSingleton?(null==i.object&&(i.object=this._createAndSetupInstance(e,i.clazz)),n=i.object):n=i.clazz?this._createAndSetupInstance(e,i.clazz):i.object,n},mapOutlet:function(e,t,n){if("undefined"==typeof e)throw new Error(1010);return t=t||"global",n=n||e,this._outlets.hasOwnProperty(t)||(this._outlets[t]={}),this._outlets[t][n]=e,this},getObject:function(e){if("undefined"==typeof e)throw new Error(1020);return this._retrieveFromCacheOrCreate(e)},mapValue:function(e,t){if("undefined"==typeof e)throw new Error(1030);return this._mappings[e]={clazz:null,object:t,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(e),this.hasMapping(e)&&this.injectInto(t,e),this},hasMapping:function(e){if("undefined"==typeof e)throw new Error(1040);return this._mappings.hasOwnProperty(e)},mapClass:function(e,t){if("undefined"==typeof e)throw new Error(1050);if("undefined"==typeof t)throw new Error(1051);return this._mappings[e]={clazz:t,object:null,isSingleton:!1},this.autoMapOutlets&&this.mapOutlet(e),this},mapSingleton:function(e,t){if("undefined"==typeof e)throw new Error(1060);if("undefined"==typeof t)throw new Error(1061);return this._mappings[e]={clazz:t,object:null,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(e),this},instantiate:function(e){if("undefined"==typeof e)throw new Error(1070);return this._retrieveFromCacheOrCreate(e,!0)},injectInto:function(e,t){if("undefined"==typeof e)throw new Error(1080);if("object"==typeof e){var n=[];this._outlets.hasOwnProperty("global")&&n.push(this._outlets.global),"undefined"!=typeof t&&this._outlets.hasOwnProperty(t)&&n.push(this._outlets[t]);for(var i in n){var r=n[i];for(var o in r){var s=r[o];(!this.strictInjections||o in e)&&(e[o]=this.getObject(s))}}"setup"in e&&e.setup.call(e)}return this},unmap:function(e){if("undefined"==typeof e)throw new Error(1090);return delete this._mappings[e],this},unmapOutlet:function(e,t){if("undefined"==typeof e)throw new Error(1100);if("undefined"==typeof t)throw new Error(1101);return delete this._outlets[e][t],this},mapHandler:function(e,t,n,i,r){if("undefined"==typeof e)throw new Error(1110);return t=t||"global",n=n||e,"undefined"==typeof i&&(i=!1),"undefined"==typeof r&&(r=!1),this._handlers.hasOwnProperty(e)||(this._handlers[e]={}),this._handlers[e].hasOwnProperty(t)||(this._handlers[e][t]=[]),this._handlers[e][t].push({handler:n,oneShot:i,passEvent:r}),this},unmapHandler:function(e,t,n){if("undefined"==typeof e)throw new Error(1120);if(t=t||"global",this._handlers.hasOwnProperty(e)&&this._handlers[e].hasOwnProperty(t)){var i=this._handlers[e][t];for(var r in i){var o=i[r];if(!n||o.handler===n){i.splice(r,1);break}}}return this},notify:function(e){if("undefined"==typeof e)throw new Error(1130);var t=Array.prototype.slice.call(arguments),n=t.slice(1);if(this._handlers.hasOwnProperty(e)){var i=this._handlers[e];for(var r in i){var o,s=i[r];"global"!==r&&(o=this.getObject(r));var a,l,d=[];for(a=0,l=s.length;a<l;a++){var u,c=s[a];u=o&&"string"==typeof c.handler?o[c.handler]:c.handler,c.oneShot&&d.unshift(a),c.passEvent?u.apply(o,t):u.apply(o,n)}for(a=0,l=d.length;a<l;a++)s.splice(d[a],1)}}return this}},e.dijon=t}(this),_={},_.math={},_.math.Long=function(e,t){this.low_=0|e,this.high_=0|t},_.math.Long.IntCache_={},_.math.Long.fromInt=function(e){if(-128<=e&&e<128){var t=_.math.Long.IntCache_[e];if(t)return t}var n=new _.math.Long(0|e,e<0?-1:0);return-128<=e&&e<128&&(_.math.Long.IntCache_[e]=n),n},_.math.Long.fromNumber=function(e){return isNaN(e)||!isFinite(e)?_.math.Long.ZERO:e<=-_.math.Long.TWO_PWR_63_DBL_?_.math.Long.MIN_VALUE:e+1>=_.math.Long.TWO_PWR_63_DBL_?_.math.Long.MAX_VALUE:e<0?_.math.Long.fromNumber(-e).negate():new _.math.Long(e%_.math.Long.TWO_PWR_32_DBL_|0,e/_.math.Long.TWO_PWR_32_DBL_|0)},_.math.Long.fromBits=function(e,t){return new _.math.Long(e,t)},_.math.Long.fromString=function(e,t){if(0==e.length)throw Error("number format error: empty string");var n=t||10;if(n<2||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return _.math.Long.fromString(e.substring(1),n).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);for(var i=_.math.Long.fromNumber(Math.pow(n,8)),r=_.math.Long.ZERO,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),a=parseInt(e.substring(o,o+s),n);if(s<8){var l=_.math.Long.fromNumber(Math.pow(n,s));r=r.multiply(l).add(_.math.Long.fromNumber(a))}else r=r.multiply(i),r=r.add(_.math.Long.fromNumber(a))}return r},_.math.Long.TWO_PWR_16_DBL_=65536,_.math.Long.TWO_PWR_24_DBL_=1<<24,_.math.Long.TWO_PWR_32_DBL_=_.math.Long.TWO_PWR_16_DBL_*_.math.Long.TWO_PWR_16_DBL_,_.math.Long.TWO_PWR_31_DBL_=_.math.Long.TWO_PWR_32_DBL_/2,_.math.Long.TWO_PWR_48_DBL_=_.math.Long.TWO_PWR_32_DBL_*_.math.Long.TWO_PWR_16_DBL_,_.math.Long.TWO_PWR_64_DBL_=_.math.Long.TWO_PWR_32_DBL_*_.math.Long.TWO_PWR_32_DBL_,_.math.Long.TWO_PWR_63_DBL_=_.math.Long.TWO_PWR_64_DBL_/2,_.math.Long.ZERO=_.math.Long.fromInt(0),_.math.Long.ONE=_.math.Long.fromInt(1),_.math.Long.NEG_ONE=_.math.Long.fromInt(-1),_.math.Long.MAX_VALUE=_.math.Long.fromBits(-1,2147483647),_.math.Long.MIN_VALUE=_.math.Long.fromBits(0,-2147483648),_.math.Long.TWO_PWR_24_=_.math.Long.fromInt(1<<24),_.math.Long.prototype.toInt=function(){return this.low_},_.math.Long.prototype.toNumber=function(){return this.high_*_.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},_.math.Long.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(_.math.Long.MIN_VALUE)){var n=_.math.Long.fromNumber(t),i=this.div(n),r=i.multiply(n).subtract(this);return i.toString(t)+r.toInt().toString(t)}return"-"+this.negate().toString(t)}for(var o=_.math.Long.fromNumber(Math.pow(t,6)),r=this,s="";;){var a=r.div(o),l=r.subtract(a.multiply(o)).toInt(),d=l.toString(t);if(r=a,r.isZero())return d+s;for(;d.length<6;)d="0"+d;s=""+d+s}},_.math.Long.prototype.getHighBits=function(){return this.high_},_.math.Long.prototype.getLowBits=function(){return this.low_},_.math.Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:_.math.Long.TWO_PWR_32_DBL_+this.low_},_.math.Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(_.math.Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!=this.high_?this.high_:this.low_,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high_?t+33:t+1},_.math.Long.prototype.isZero=function(){return 0==this.high_&&0==this.low_},_.math.Long.prototype.isNegative=function(){return this.high_<0},_.math.Long.prototype.isOdd=function(){return 1==(1&this.low_)},_.math.Long.prototype.equals=function(e){return this.high_==e.high_&&this.low_==e.low_},_.math.Long.prototype.notEquals=function(e){return this.high_!=e.high_||this.low_!=e.low_},_.math.Long.prototype.lessThan=function(e){return this.compare(e)<0},_.math.Long.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},_.math.Long.prototype.greaterThan=function(e){return this.compare(e)>0},_.math.Long.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},_.math.Long.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.subtract(e).isNegative()?-1:1},_.math.Long.prototype.negate=function(){return this.equals(_.math.Long.MIN_VALUE)?_.math.Long.MIN_VALUE:this.not().add(_.math.Long.ONE)},_.math.Long.prototype.add=function(e){var t=this.high_>>>16,n=65535&this.high_,i=this.low_>>>16,r=65535&this.low_,o=e.high_>>>16,s=65535&e.high_,a=e.low_>>>16,l=65535&e.low_,d=0,u=0,c=0,h=0;return h+=r+l,c+=h>>>16,h&=65535,c+=i+a,u+=c>>>16,c&=65535,u+=n+s,d+=u>>>16,u&=65535,d+=t+o,d&=65535,_.math.Long.fromBits(c<<16|h,d<<16|u)},_.math.Long.prototype.subtract=function(e){return this.add(e.negate())},_.math.Long.prototype.multiply=function(e){if(this.isZero())return _.math.Long.ZERO;if(e.isZero())return _.math.Long.ZERO;if(this.equals(_.math.Long.MIN_VALUE))return e.isOdd()?_.math.Long.MIN_VALUE:_.math.Long.ZERO;if(e.equals(_.math.Long.MIN_VALUE))return this.isOdd()?_.math.Long.MIN_VALUE:_.math.Long.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(_.math.Long.TWO_PWR_24_)&&e.lessThan(_.math.Long.TWO_PWR_24_))return _.math.Long.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,n=65535&this.high_,i=this.low_>>>16,r=65535&this.low_,o=e.high_>>>16,s=65535&e.high_,a=e.low_>>>16,l=65535&e.low_,d=0,u=0,c=0,h=0;return h+=r*l,c+=h>>>16,h&=65535,c+=i*l,u+=c>>>16,c&=65535,c+=r*a,u+=c>>>16,c&=65535,u+=n*l,d+=u>>>16,u&=65535,u+=i*a,d+=u>>>16,u&=65535,u+=r*s,d+=u>>>16,u&=65535,d+=t*l+n*a+i*s+r*o,d&=65535,_.math.Long.fromBits(c<<16|h,d<<16|u)},_.math.Long.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return _.math.Long.ZERO;if(this.equals(_.math.Long.MIN_VALUE)){if(e.equals(_.math.Long.ONE)||e.equals(_.math.Long.NEG_ONE))return _.math.Long.MIN_VALUE;if(e.equals(_.math.Long.MIN_VALUE))return _.math.Long.ONE;var t=this.shiftRight(1),n=t.div(e).shiftLeft(1);if(n.equals(_.math.Long.ZERO))return e.isNegative()?_.math.Long.ONE:_.math.Long.NEG_ONE;var i=this.subtract(e.multiply(n)),r=n.add(i.div(e));return r}if(e.equals(_.math.Long.MIN_VALUE))return _.math.Long.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();for(var o=_.math.Long.ZERO,i=this;i.greaterThanOrEqual(e);){for(var n=Math.max(1,Math.floor(i.toNumber()/e.toNumber())),s=Math.ceil(Math.log(n)/Math.LN2),a=s<=48?1:Math.pow(2,s-48),l=_.math.Long.fromNumber(n),d=l.multiply(e);d.isNegative()||d.greaterThan(i);)n-=a,l=_.math.Long.fromNumber(n),d=l.multiply(e);l.isZero()&&(l=_.math.Long.ONE),o=o.add(l),i=i.subtract(d)}return o},_.math.Long.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},_.math.Long.prototype.not=function(){return _.math.Long.fromBits(~this.low_,~this.high_)},_.math.Long.prototype.and=function(e){return _.math.Long.fromBits(this.low_&e.low_,this.high_&e.high_)},_.math.Long.prototype.or=function(e){return _.math.Long.fromBits(this.low_|e.low_,this.high_|e.high_)},_.math.Long.prototype.xor=function(e){return _.math.Long.fromBits(this.low_^e.low_,this.high_^e.high_)},_.math.Long.prototype.shiftLeft=function(e){if(e&=63,0==e)return this;var t=this.low_;if(e<32){var n=this.high_;return _.math.Long.fromBits(t<<e,n<<e|t>>>32-e)}return _.math.Long.fromBits(0,t<<e-32)},_.math.Long.prototype.shiftRight=function(e){if(e&=63,0==e)return this;var t=this.high_;if(e<32){var n=this.low_;return _.math.Long.fromBits(n>>>e|t<<32-e,t>>e)}return _.math.Long.fromBits(t>>e-32,t>=0?0:-1)},_.math.Long.prototype.shiftRightUnsigned=function(e){if(e&=63,0==e)return this;var t=this.high_;if(e<32){var n=this.low_;return _.math.Long.fromBits(n>>>e|t<<32-e,t>>>e)}return 32==e?_.math.Long.fromBits(t,0):_.math.Long.fromBits(t>>>e-32,0)},"undefined"==typeof A)var A={};"undefined"==typeof A.Math&&(A.Math={}),A.Math.to64BitNumber=function(e,t){var n,i,r;return n=new _.math.Long(0,t),i=new _.math.Long(e,0),r=n.add(i),r.toNumber()},function(e){y=e()}(function(){"use strict";function e(e){var t=Function.call;return function(){return t.apply(e,arguments)}}function t(e){return"[object StopIteration]"===se(e)||e instanceof $}function n(e,t){t.stack&&"object"==typeof e&&null!==e&&e.stack&&e.stack.indexOf(ae)===-1&&(e.stack=i(e.stack)+"\n"+ae+"\n"+i(t.stack))}function i(e){for(var t=e.split("\n"),n=[],i=0;i<t.length;++i){var s=t[i];o(s)||r(s)||n.push(s)}return n.join("\n")}function r(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function o(e){var t=/at .+ \((.*):(\d+):\d+\)/.exec(e);if(!t)return!1;var n=t[1],i=t[2];return n===G&&i>=Q&&i<=ce}function s(){if(Error.captureStackTrace){var e,t,n=Error.prepareStackTrace;return Error.prepareStackTrace=function(n,i){e=i[1].getFileName(),t=i[1].getLineNumber()},(new Error).stack,Error.prepareStackTrace=n,G=e,t}}function a(e){return E(e)}function l(){function e(e){n&&(t=E(e),ee(n,function(e,n){X(function(){t.promiseDispatch.apply(t,n)})},void 0),n=void 0,i=void 0)}var t,n=[],i=[],r=ie(l.prototype),o=ie(u.prototype);return o.promiseDispatch=function(e,r,o){var s=Z(arguments);n?(n.push(s),"when"===r&&o[1]&&i.push(o[1])):X(function(){t.promiseDispatch.apply(t,s)})},o.valueOf=function(){return n?o:t=c(t)},Error.captureStackTrace&&a.longStackJumpLimit>0&&(Error.captureStackTrace(o,l),o.stack=o.stack.substring(o.stack.indexOf("\n")+1)),r.promise=o,r.resolve=e,r.fulfill=function(t){e(_(t))},r.reject=function(t){e(y(t))},r.notify=function(e){n&&ee(i,function(t,n){X(function(){n(e)})},void 0)},r}function d(e){var t=l();return P(e,t.resolve,t.reject,t.notify).fail(t.reject),t.promise}function u(e,t,n,i,r){void 0===t&&(t=function(e){return y(new Error("Promise does not support operation: "+e))});var o=ie(u.prototype);return o.promiseDispatch=function(n,i,r){var s;try{s=e[i]?e[i].apply(o,r):t.call(o,i,r)}catch(a){s=y(a)}n&&n(s)},n&&(o.valueOf=n),r&&(o.exception=i),o}function c(e){return h(e)?e.valueOf():e}function h(e){return e&&"function"==typeof e.promiseDispatch}function p(e){return e&&"function"==typeof e.then}function f(e){return!m(e)&&!g(e)}function m(e){return!p(c(e))}function g(e){return e=c(e),h(e)&&"exception"in e}function y(e){var t=u({when:function(t){if(t){var n=te(le,this);n!==-1&&(de.splice(n,1),le.splice(n,1))}return t?t(e):this}},function(){return y(e)},function(){return this},e,!0);return le.push(t),de.push(e),t}function _(e){return u({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return null==t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return oe(e)}},void 0,function(){return e})}function E(e){return h(e)?e:(e=c(e),p(e)?b(e):_(e))}function b(e){var t=l();return X(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function v(e){return u({isDef:function(){}},function(t,n){return L(e,t,n)},function(){return c(e)})}function x(e,t,i,r){function o(e){try{return"function"==typeof t?t(e):e}catch(n){return y(n)}}function s(e){if("function"==typeof i){n(e,h);try{return i(e)}catch(t){return y(t)}}return y(e)}function d(e){return"function"==typeof r?r(e):e}var u=l(),c=!1,h=E(e);return X(function(){h.promiseDispatch(function(e){c||(c=!0,u.resolve(o(e)))},"when",[function(e){c||(c=!0,u.resolve(s(e)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=d(e)}catch(i){if(n=!0,!a.onerror)throw i;a.onerror(i)}n||u.notify(t)}]),u.promise}function T(e,t,n){return x(e,function(e){return B(e).then(function(e){return t.apply(void 0,e)},n)},n)}function S(e){return function(){function n(e,n){var s;try{s=i[e](n)}catch(a){return t(a)?a.value:y(a)}return x(s,r,o)}var i=e.apply(this,arguments),r=n.bind(n,"send"),o=n.bind(n,"throw");return r()}}function D(e){throw new $(e)}function I(e){return function(){return T([this,B(arguments)],function(t,n){return e.apply(t,n)})}}function L(e,t,n){var i=l();return X(function(){E(e).promiseDispatch(i.resolve,t,n)}),i.promise}function M(e){return function(t){var n=Z(arguments,1);return L(t,e,n)}}function R(e,t){var n=Z(arguments,2);return ue(e,t,n)}function A(e,t){return L(e,"apply",[void 0,t])}function P(e){var t=Z(arguments,1);return A(e,t)}function w(e){var t=Z(arguments,1);return function(){var n=t.concat(Z(arguments));return L(e,"apply",[this,n])}}function B(e){return x(e,function(e){var t=e.length;if(0===t)return E(e);var n=l();return ee(e,function(i,r,o){m(r)?(e[o]=c(r),0===--t&&n.resolve(e)):x(r,function(i){e[o]=i,0===--t&&n.resolve(e)}).fail(n.reject)},void 0),n.promise})}function F(e){return x(e,function(e){return e=ne(e,E),x(B(ne(e,function(e){return x(e,J,J)})),function(){return e})})}function N(e,t){return x(e,void 0,t)}function C(e,t){return x(e,void 0,void 0,t)}function O(e,t){return x(e,function(e){return x(t(),function(){return e})},function(e){return x(t(),function(){return y(e)})})}function U(e,t,i,r){var o=function(t){X(function(){if(n(t,e),!a.onerror)throw t;a.onerror(t)})},s=t||i||r?x(e,t,i,r):e;"object"==typeof process&&process&&process.domain&&(o=process.domain.bind(o)),N(s,o)}function k(e,t){var n=l(),i=setTimeout(function(){n.reject(new Error("Timed out after "+t+" ms"))},t);return x(e,function(e){clearTimeout(i),n.resolve(e)},function(e){clearTimeout(i),n.reject(e)}),n.promise}function H(e,t){void 0===t&&(t=e,e=void 0);var n=l();return setTimeout(function(){n.resolve(e)},t),n.promise}function K(e,t){var n=Z(t),i=l();return n.push(i.makeNodeResolver()),A(e,n).fail(i.reject),i.promise}function V(e){var t=Z(arguments,1),n=l();return t.push(n.makeNodeResolver()),A(e,t).fail(n.reject),n.promise}function q(e){var t=Z(arguments,1);return function(){var n=t.concat(Z(arguments)),i=l();return n.push(i.makeNodeResolver()),A(e,n).fail(i.reject),i.promise}}function z(e){var t=Z(arguments,1);return function(){function n(){return e.apply(o,arguments)}var i=t.concat(Z(arguments)),r=l();i.push(r.makeNodeResolver());var o=this;return A(n,i).fail(r.reject),r.promise}}function Y(e,t,n){var i=Z(n||[]),r=l();return i.push(r.makeNodeResolver()),ue(e,t,i).fail(r.reject),r.promise}function j(e,t){var n=Z(arguments,2),i=l();return n.push(i.makeNodeResolver()),ue(e,t,n).fail(i.reject),i.promise}function W(e,t){return t?void e.then(function(e){X(function(){t(null,e)})},function(e){X(function(){t(e)})}):e}var G,X,Q=s(),J=function(){};"undefined"!=typeof process?X=process.nextTick:"function"==typeof setImmediate?X="undefined"!=typeof window?setImmediate.bind(window):setImmediate:!function(){function e(){if(--o,++a>=r){a=0,r*=4;for(var e=s&&Math.min(s-1,r);o<e;)++o,t()}for(;s;){--s,n=n.next;var i=n.task;n.task=void 0,i()}a=0}var t,n={task:void 0,next:null},i=n,r=2,o=0,s=0,a=0;if(X=function(e){i=i.next={task:e,next:null},o<++s&&o<r&&(++o,t())},"undefined"!=typeof MessageChannel){var l=new MessageChannel;l.port1.onmessage=e,t=function(){l.port2.postMessage(0)}}else t=function(){setTimeout(e,0)}}();var $,Z=e(Array.prototype.slice),ee=e(Array.prototype.reduce||function(e,t){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=i)throw new TypeError}for(;n<i;n++)n in this&&(t=e(t,this[n],n));return t}),te=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),ne=e(Array.prototype.map||function(e,t){var n=this,i=[];return ee(n,function(r,o,s){i.push(e.call(t,o,s,n))},void 0),i}),ie=Object.create||function(e){function t(){}return t.prototype=e,new t},re=e(Object.prototype.hasOwnProperty),oe=Object.keys||function(e){var t=[];for(var n in e)re(e,n)&&t.push(n);return t},se=e(Object.prototype.toString);$="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e},a.longStackJumpLimit=1;var ae="From previous event:";a.nextTick=X,a.defer=l,l.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):arguments.length>2?e.resolve(Z(arguments,1)):e.resolve(n)}},a.promise=d,a.makePromise=u,u.prototype.then=function(e,t,n){return x(this,e,t,n)},u.prototype.thenResolve=function(e){return x(this,function(){return e})},ee(["isFulfilled","isRejected","isPending","dispatch","when","spread","get","put","set","del","delete","post","send","invoke","keys","fapply","fcall","fbind","all","allResolved","timeout","delay","catch","finally","fail","fin","progress","done","nfcall","nfapply","nfbind","denodeify","nbind","ncall","napply","nbind","npost","nsend","ninvoke","nodeify"],function(e,t){u.prototype[t]=function(){return a[t].apply(a,[this].concat(Z(arguments)))}},void 0),u.prototype.toSource=function(){return this.toString()},u.prototype.toString=function(){return"[object Promise]"},a.nearer=c,a.isPromise=h,a.isPromiseAlike=p,a.isPending=f,a.isFulfilled=m,a.isRejected=g;var le=[],de=[];"undefined"!=typeof process&&process.on&&process.on("exit",function(){for(var e=0;e<de.length;e++){var t=de[e];t&&"undefined"!=typeof t.stack?console.warn("Unhandled rejected promise:",t.stack):console.warn("Unhandled rejected promise (no stack):",t)}}),a.reject=y,a.fulfill=_,a.resolve=E,a.master=v,a.when=x,a.spread=T,a.async=S,a["return"]=D,a.promised=I,a.dispatch=L,a.dispatcher=M,a.get=M("get"),a.set=M("set"),a["delete"]=a.del=M("delete");var ue=a.post=M("post");a.send=R,a.invoke=R,a.fapply=A,a["try"]=P,a.fcall=P,a.fbind=w,a.keys=M("keys"),a.all=B,a.allResolved=F,a["catch"]=a.fail=N,a.progress=C,a["finally"]=a.fin=O,a.done=U,a.timeout=k,a.delay=H,a.nfapply=K,a.nfcall=V,a.nfbind=q,a.denodeify=a.nfbind,a.nbind=z,a.npost=Y,a.nsend=j,a.ninvoke=a.nsend,a.nodeify=W;var ce=s();return a});var P=function(){var e={boxes:{},fields:{},debug:!1,warningHandler:function(e){}},t={};return e.registerTypeBoxes=function(){t.moov=e.boxes.MovieBox,t.moof=e.boxes.MovieFragmentBox,t.ftyp=e.boxes.FileTypeBox,t.mfhd=e.boxes.MovieFragmentHeaderBox,t.mfra=e.boxes.MovieFragmentRandomAccessBox,t.udta=e.boxes.UserDataBox,t.trak=e.boxes.TrackBox,t.edts=e.boxes.EditBox,t.mdia=e.boxes.MediaBox,t.minf=e.boxes.MediaInformationBox,t.dinf=e.boxes.DataInformationBox,t.stbl=e.boxes.SampleTableBox,t.mvex=e.boxes.MovieExtendsBox,t.traf=e.boxes.TrackFragmentBox,t.meta=e.boxes.MetaBox,t.mvhd=e.boxes.MovieHeaderBox,t.mdat=e.boxes.MediaDataBox,t.free=e.boxes.FreeSpaceBox,t.sidx=e.boxes.SegmentIndexBox,t.tkhd=e.boxes.TrackHeaderBox,t.mdhd=e.boxes.MediaHeaderBox,t.mehd=e.boxes.MovieExtendsHeaderBox,t.hdlr=e.boxes.HandlerBox,t.stts=e.boxes.TimeToSampleBox,t.stsc=e.boxes.SampleToChunkBox,t.stco=e.boxes.ChunkOffsetBox,t.trex=e.boxes.TrackExtendsBox,t.vmhd=e.boxes.VideoMediaHeaderBox,t.smhd=e.boxes.SoundMediaHeaderBox,t.dref=e.boxes.DataReferenceBox,t["url "]=e.boxes.DataEntryUrlBox,t["urn "]=e.boxes.DataEntryUrnBox,t.tfhd=e.boxes.TrackFragmentHeaderBox,t.tfdt=e.boxes.TrackFragmentBaseMediaDecodeTimeBox,t.trun=e.boxes.TrackFragmentRunBox,t.stsd=e.boxes.SampleDescriptionBox,t.sdtp=e.boxes.SampleDependencyTableBox,t.avc1=e.boxes.AVC1VisualSampleEntryBox,t.encv=e.boxes.EncryptedVideoBox,t.avcC=e.boxes.AVCConfigurationBox,t.pasp=e.boxes.PixelAspectRatioBox,t.mp4a=e.boxes.MP4AudioSampleEntryBox,t.enca=e.boxes.EncryptedAudioBox,t.esds=e.boxes.ESDBox,t.stsz=e.boxes.SampleSizeBox,t.pssh=e.boxes.ProtectionSystemSpecificHeaderBox,t.senc=e.boxes.SampleEncryptionBox,t.saiz=e.boxes.SampleAuxiliaryInformationSizesBox,t.saio=e.boxes.SampleAuxiliaryInformationOffsetsBox,t.sinf=e.boxes.ProtectionSchemeInformationBox,t.schi=e.boxes.SchemeInformationBox,t.tenc=e.boxes.TrackEncryptionBox,t.schm=e.boxes.SchemeTypeBox,t.elst=e.boxes.EditListBox,t.hmhd=e.boxes.HintMediaHeaderBox,t.nmhd=e.boxes.NullMediaHeaderBox,t.ctts=e.boxes.CompositionOffsetBox,t.cslg=e.boxes.CompositionToDecodeBox,t.stss=e.boxes.SyncSampleBox,t.tref=e.boxes.TrackReferenceBox,t.frma=e.boxes.OriginalFormatBox,t[JSON.stringify([109,29,155,5,66,213,68,230,128,226,20,29,175,247,87,178])]=e.boxes.TfxdBox,t[JSON.stringify([212,128,126,242,202,57,70,149,142,84,38,203,158,70,167,159])]=e.boxes.TfrfBox,t[JSON.stringify([208,138,79,24,16,243,74,130,182,200,50,216,171,161,131,211])]=e.boxes.PiffProtectionSystemSpecificHeaderBox,
t[JSON.stringify([137,116,219,206,123,231,76,81,132,249,113,72,249,136,37,84])]=e.boxes.PiffTrackEncryptionBox,t[JSON.stringify([162,57,79,82,90,155,79,20,162,68,108,66,124,100,141,244])]=e.boxes.PiffSampleEncryptionBox},e.constructorTypeBox=function(e){var t,n;return t=Object.create(e.prototype),n=Array.prototype.slice.call(arguments,1),e.apply(t,n),t},e.searchBox=function(n,i){var r;return r=i?t[i]:t[n],r||(r=e.boxes.UnknownBox),r},e.createBox=function(t,n,i){return e.constructorTypeBox.apply(null,[e.searchBox(t,i),n])},e.deserialize=function(t){var n=new e.boxes.File;try{n.read(t)}catch(i){return e.warningHandler(i.message),null}return n},e.serialize=function(e){var t=e.getLength(),n=new Uint8Array(t);return e.write(n),n},e.ParseException=function(e){this.message=e,this.name="ParseException"},e.DataIntegrityException=function(e){this.message=e,this.name="DataIntegrityException"},e}();"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=P:window.mp4lib=P,P.fields.readBytes=function(e,t,n){var i=0,r=0;for(r=0;r<n;r++)i<<=8,i+=e[t],t++;return i},P.fields.writeBytes=function(e,t,n,i){var r=0;for(r=0;r<n;r++)e[t+n-r-1]=255&i,i>>=8},P.fields.readString=function(e,t,n){var i,r="";for(i=t;i<t+n;i++)r+=String.fromCharCode(e[i]);return r},P.fields.NumberField=function(e,t){this.bits=e,this.signed=t},P.fields.NumberField.prototype.read=function(e,t){return P.fields.readBytes(e,t,this.bits/8)},P.fields.NumberField.prototype.write=function(e,t,n){P.fields.writeBytes(e,t,this.bits/8,n)},P.fields.NumberField.prototype.getLength=function(){return this.bits/8},P.fields.LongNumberField=function(){},P.fields.LongNumberField.prototype.read=function(e,t){var n=P.fields.readBytes(e,t,4),i=P.fields.readBytes(e,t+4,4);return _.math.Long.fromBits(i,n).toNumber()},P.fields.LongNumberField.prototype.write=function(e,t,n){var i=_.math.Long.fromNumber(n),r=i.getLowBits(),o=i.getHighBits();P.fields.writeBytes(e,t,4,o),P.fields.writeBytes(e,t+4,4,r)},P.fields.LongNumberField.prototype.getLength=function(){return 8},P.fields.FixedLenStringField=function(e){this.size=e},P.fields.FixedLenStringField.prototype.read=function(e,t){var n="",i=0;for(i=0;i<this.size;i++)n+=String.fromCharCode(e[t+i]);return n},P.fields.FixedLenStringField.prototype.write=function(e,t,n){var i=0;for(i=0;i<this.size;i++)e[t+i]=n.charCodeAt(i)},P.fields.FixedLenStringField.prototype.getLength=function(){return this.size},P.fields.BoxTypeField=function(){},P.fields.BoxTypeField.prototype.read=function(e,t){var n="",i=0;for(i=0;i<4;i++)n+=String.fromCharCode(e[t+i]);return n},P.fields.BoxTypeField.prototype.write=function(e,t,n){var i=0;for(i=0;i<4;i++)e[t+i]=n.charCodeAt(i)},P.fields.BoxTypeField.prototype.getLength=function(){return 4},P.fields.StringField=function(){},P.fields.StringField.prototype.read=function(e,t,n){var i="",r=0;for(r=t;r<n;r++)if(i+=String.fromCharCode(e[r]),0===e[r])return i;if(n-t<255&&e[0]==String.fromCharCode(n-t))return i=i.substr(1,n-t),P.warningHandler('null-terminated string expected, but found a string "'+i+'", which seems to be length-prefixed instead. Conversion done.'),i;throw new P.ParseException('expected null-terminated string, but end of field reached without termination. Read so far:"'+i+'"')},P.fields.StringField.prototype.write=function(e,t,n){var i=0;for(i=0;i<n.length;i++)e[t+i]=n.charCodeAt(i);e[t+n.length]=0},P.fields.StringField.prototype.getLength=function(e){return e.length},P.fields.ArrayField=function(e,t){this.innerField=e,this.size=t},P.fields.ArrayField.prototype.read=function(e,t){var n=-1,i=[],r=0;for(r=0;r<this.size;r++)i.push(this.innerField.read(e,t)),n==-1&&(n=this.innerField.getLength(i[r])),t+=n;return i},P.fields.FIELD_INT8=new P.fields.NumberField(8,(!0)),P.fields.FIELD_INT16=new P.fields.NumberField(16,(!0)),P.fields.FIELD_INT32=new P.fields.NumberField(32,(!0)),P.fields.FIELD_INT64=new P.fields.LongNumberField,P.fields.FIELD_UINT8=new P.fields.NumberField(8,(!1)),P.fields.FIELD_UINT16=new P.fields.NumberField(16,(!1)),P.fields.FIELD_UINT32=new P.fields.NumberField(32,(!1)),P.fields.FIELD_UINT64=new P.fields.LongNumberField,P.fields.FIELD_BIT8=new P.fields.NumberField(8,(!1)),P.fields.FIELD_BIT16=new P.fields.NumberField(16,(!1)),P.fields.FIELD_BIT24=new P.fields.NumberField(24,(!1)),P.fields.FIELD_BIT32=new P.fields.NumberField(32,(!1)),P.fields.FIELD_ID=new P.fields.BoxTypeField(4),P.fields.FIELD_STRING=new P.fields.StringField,P.boxes.File=function(){this.boxes=[]},P.boxes.File.prototype.getBoxByType=function(e){var t=0;for(t=0;t<this.boxes.length;t++)if(this.boxes[t].boxtype===e)return this.boxes[t];return null},P.boxes.File.prototype.getLength=function(){var e=0,t=0;for(t=0;t<this.boxes.length;t++)this.boxes[t].computeLength(),e+=this.boxes[t].size;return e},P.boxes.File.prototype.write=function(e){var t=0,n=0;for(n=0;n<this.boxes.length;n++)t=this.boxes[n].write(e,t)},P.boxes.File.prototype.read=function(e){for(var t,n=0,i=null,r=0,o=null,s=0,a=e.length;s<a;)if(n=P.fields.FIELD_UINT32.read(e,s),i=P.fields.readString(e,s+4,4),"uuid"==i&&(r=1==n?16:8,o=new P.fields.ArrayField(P.fields.FIELD_INT8,16).read(e,s+r,s+r+16),o=JSON.stringify(o)),t=P.createBox(i,n,o),"uuid"===i?(s=t.read(e,s+16*P.fields.FIELD_INT8.getLength()+8,s+n),o=null):s=t.read(e,s+8,s+n),P.debug&&(t.__sourceBuffer=e.subarray(s-t.size,s)),t.boxtype&&this.boxes.push(t),t.size<=0||null===t.size)throw new P.ParseException("Problem on size of box "+t.boxtype+", parsing stopped to avoid infinite loop")},P.boxes.File.prototype.getBoxOffsetByType=function(e){var t=0,n=0;for(n=0;n<this.boxes.length;n++){if(this.boxes[n].boxtype===e)return t;t+=this.boxes[n].size}return-1},P.boxes.File.prototype.getBoxIndexByType=function(e){var t=0,n=0;for(n=0;n<this.boxes.length;n++){if(this.boxes[n].boxtype===e)return t;t++}return-1},P.boxes.Box=function(e,t,n,i){this.size=t||null,this.boxtype=e,1===this.size&&i&&(this.largesize=i),n&&(this.extended_type=n),this.localPos=0,this.localEnd=0},P.boxes.Box.prototype.write=function(e,t){this.localPos=t;var n=0;if(this._writeData(e,P.fields.FIELD_UINT32,this.size),this.extended_type?this._writeData(e,P.fields.FIELD_ID,"uuid"):this._writeData(e,P.fields.FIELD_ID,this.boxtype),1===this.size&&this._writeData(e,P.fields.FIELD_INT64,this.largesize),this.extended_type)for(n=0;n<16;n++)this._writeData(e,P.fields.FIELD_INT8,this.extended_type[n])},P.boxes.Box.prototype.getBoxByType=function(e){var t=0;if(this.hasOwnProperty("boxes"))for(t=0;t<this.boxes.length;t++)if(this.boxes[t].boxtype===e)return this.boxes[t];return null},P.boxes.Box.prototype.getBoxesByType=function(e){var t=[],n=0;if(this.hasOwnProperty("boxes"))for(n=0;n<this.boxes.length;n++)this.boxes[n].boxtype===e&&t.push(this.boxes[n]);return t},P.boxes.Box.prototype.removeBoxByType=function(e){var t=0;if(this.hasOwnProperty("boxes"))for(t=0;t<this.boxes.length;t++)this.boxes[t].boxtype===e&&this.boxes.splice(t,1);else P.warningHandler(""+this.boxtype+"does not have "+e+" box, impossible to remove it")},P.boxes.Box.prototype.getBoxOffsetByType=function(e){var t=8,n=0;if(this.hasOwnProperty("boxes"))for(n=0;n<this.boxes.length;n++){if(this.boxes[n].boxtype===e)return t;t+=this.boxes[n].size}return null},P.boxes.Box.prototype.getBoxIndexByType=function(e){var t=0,n=0;if(this.hasOwnProperty("boxes"))for(n=0;n<this.boxes.length;n++){if(this.boxes[n].boxtype===e)return t;t++}return null},P.boxes.Box.prototype.computeLength=function(){this.size=P.fields.FIELD_UINT32.getLength()+P.fields.FIELD_ID.getLength(),this.extended_type&&(this.size+=16*P.fields.FIELD_INT8.getLength())},P.boxes.Box.prototype._readData=function(e,t){var n=t.read(e,this.localPos,this.localEnd);return this.localPos+=t.getLength(n),n},P.boxes.Box.prototype._writeData=function(e,t,n){if(void 0===n||null===n)throw new P.ParseException("a field to write is null or undefined for box : "+this.boxtype);t.write(e,this.localPos,n),this.localPos+=t.getLength(n)},P.boxes.Box.prototype._writeBuffer=function(e,t,n){e.set(t,this.localPos),this.localPos+=n},P.boxes.Box.prototype._writeArrayData=function(e,t,n){var i=0;if(void 0===n||null===n||0===n.length)throw new P.ParseException("an array to write is null, undefined or length = 0 for box : "+this.boxtype);for(i=0;i<n.length;i++)this._writeData(e,t,n[i])},P.boxes.Box.prototype._readArrayData=function(e,t){var n=[],i=t.getLength(),r=(this.localEnd-this.localPos)/i,o=0;for(o=0;o<r;o++)n.push(t.read(e,this.localPos)),this.localPos+=i;return n},P.boxes.Box.prototype._readArrayFieldData=function(e,t,n){var i=-1,r=[],o=0;for(o=0;o<n;o++)r.push(t.read(e,this.localPos)),i===-1&&(i=t.getLength(r[o])),this.localPos+=i;return r},P.boxes.ContainerBox=function(e,t){P.boxes.Box.call(this,e,t),this.boxes=[]},P.boxes.ContainerBox.prototype=Object.create(P.boxes.Box.prototype),P.boxes.ContainerBox.prototype.constructor=P.boxes.ContainerBox,P.boxes.ContainerBox.prototype.computeLength=function(){P.boxes.Box.prototype.computeLength.call(this);var e=0;for(e=0;e<this.boxes.length;e++)this.boxes[e].computeLength(),this.size+=this.boxes[e].size},P.boxes.ContainerBox.prototype.write=function(e,t){P.boxes.Box.prototype.write.call(this,e,t);var n=0;for(n=0;n<this.boxes.length;n++)this.localPos=this.boxes[n].write(e,this.localPos);return this.localPos},P.boxes.ContainerBox.prototype.read=function(e,t,n){for(var i,r,o=0,s=0,a=null;t<n;)if(o=P.fields.FIELD_UINT32.read(e,t),i=P.fields.readString(e,t+4,4),"uuid"===i&&(s=1==o?16:8,a=new P.fields.ArrayField(P.fields.FIELD_INT8,16).read(e,t+s,t+s+16),a=JSON.stringify(a)),r=P.createBox(i,o,a),"uuid"===i?(t=r.read(e,t+16*P.fields.FIELD_INT8.getLength()+8,t+o),a=null):t=r.read(e,t+8,t+o),P.debug&&(r.__sourceBuffer=e.subarray(t-r.size,t)),r.boxtype&&this.boxes.push(r),r.size<=0||null===r.size)throw new P.ParseException("Problem on size of box "+r.boxtype+", parsing stopped to avoid infinite loop");return t},P.boxes.FullBox=function(e,t,n){P.boxes.Box.call(this,e,t,n),this.version=null,this.flags=null},P.boxes.FullBox.prototype=Object.create(P.boxes.Box.prototype),P.boxes.FullBox.prototype.constructor=P.boxes.FullBox,P.boxes.FullBox.prototype.read=function(e,t,n){this.localPos=t,this.localEnd=n,this.version=this._readData(e,P.fields.FIELD_INT8),this.flags=this._readData(e,P.fields.FIELD_BIT24)},P.boxes.FullBox.prototype.write=function(e,t){P.boxes.Box.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_INT8,this.version),this._writeData(e,P.fields.FIELD_BIT24,this.flags)},P.boxes.FullBox.prototype.getFullBoxAttributesLength=function(){this.size+=P.fields.FIELD_INT8.getLength()+P.fields.FIELD_BIT24.getLength()},P.boxes.FullBox.prototype.computeLength=function(){P.boxes.Box.prototype.computeLength.call(this),P.boxes.FullBox.prototype.getFullBoxAttributesLength.call(this)},P.boxes.ContainerFullBox=function(e,t){P.boxes.FullBox.call(this,e,t),this.boxes=[]},P.boxes.ContainerFullBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.ContainerFullBox.prototype.constructor=P.boxes.ContainerFullBox,P.boxes.ContainerFullBox.prototype.computeLength=function(e){P.boxes.FullBox.prototype.computeLength.call(this);var t=0;for(e&&(this.size+=P.fields.FIELD_UINT32.getLength()),t=0;t<this.boxes.length;t++)this.boxes[t].computeLength(),this.size+=this.boxes[t].size},P.boxes.ContainerFullBox.prototype.read=function(e,t,n,i){P.boxes.FullBox.prototype.read.call(this,e,t,n);var r,o,s=0,a=0,l=null;for(i&&(this.entry_count=this._readData(e,P.fields.FIELD_UINT32));this.localPos<this.localEnd;)if(s=P.fields.FIELD_UINT32.read(e,this.localPos),r=P.fields.readString(e,this.localPos+4,4),"uuid"==r&&(a=1==s?16:8,l=new P.fields.ArrayField(P.fields.FIELD_INT8,16).read(e,this.localPos+a,this.localPos+a+16),l=JSON.stringify(l)),o=P.createBox(r,s,l),"uuid"===r?(this.localPos=o.read(e,this.localPos+16*P.fields.FIELD_INT8.getLength()+8,this.localPos+s),l=null):this.localPos=o.read(e,this.localPos+8,this.localPos+s),P.debug&&(o.__sourceBuffer=e.subarray(this.localPos-o.size,this.localPos)),o.boxtype&&this.boxes.push(o),o.size<=0||null===o.size)throw new P.ParseException("Problem on size of box "+o.boxtype+", parsing stopped to avoid infinite loop");return this.localPos},P.boxes.ContainerFullBox.prototype.write=function(e,t,n){P.boxes.FullBox.prototype.write.call(this,e,t);var i=0;for(n===!0&&this._writeData(e,P.fields.FIELD_UINT32,this.entry_count),i=0;i<this.boxes.length;i++)this.localPos=this.boxes[i].write(e,this.localPos);return this.localPos},P.boxes.UnknownBox=function(e){P.boxes.Box.call(this,null,e)},P.boxes.UnknownBox.prototype=Object.create(P.boxes.Box.prototype),P.boxes.UnknownBox.prototype.constructor=P.boxes.UnknownBox,P.boxes.UnknownBox.prototype.read=function(e,t,n){return this.localPos=t,this.localEnd=n,this.unrecognized_data=e.subarray(this.localPos,this.localEnd),this.localEnd},P.boxes.UnknownBox.prototype.write=function(e,t){return P.boxes.Box.prototype.write.call(this,e,t),this._writeBuffer(e,this.unrecognized_data,this.unrecognized_data.length),this.localPos},P.boxes.UnknownBox.prototype.computeLength=function(){P.boxes.Box.prototype.computeLength.call(this),this.size+=this.unrecognized_data.length},P.boxes.FileTypeBox=function(e){P.boxes.Box.call(this,"ftyp",e)},P.boxes.FileTypeBox.prototype=Object.create(P.boxes.Box.prototype),P.boxes.FileTypeBox.prototype.constructor=P.boxes.FileTypeBox,P.boxes.FileTypeBox.prototype.computeLength=function(){P.boxes.Box.prototype.computeLength.call(this),this.size+=2*P.fields.FIELD_INT32.getLength()+P.fields.FIELD_INT32.getLength()*this.compatible_brands.length},P.boxes.FileTypeBox.prototype.read=function(e,t,n){return this.localPos=t,this.localEnd=n,this.major_brand=this._readData(e,P.fields.FIELD_INT32),this.minor_brand=this._readData(e,P.fields.FIELD_INT32),this.compatible_brands=this._readArrayData(e,P.fields.FIELD_INT32),this.localPos},P.boxes.FileTypeBox.prototype.write=function(e,t){return P.boxes.Box.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_INT32,this.major_brand),this._writeData(e,P.fields.FIELD_INT32,this.minor_brand),this._writeArrayData(e,P.fields.FIELD_INT32,this.compatible_brands),this.localPos},P.boxes.MovieBox=function(e){P.boxes.ContainerBox.call(this,"moov",e)},P.boxes.MovieBox.prototype=Object.create(P.boxes.ContainerBox.prototype),P.boxes.MovieBox.prototype.constructor=P.boxes.MovieBox,P.boxes.MovieFragmentBox=function(e){P.boxes.ContainerBox.call(this,"moof",e)},P.boxes.MovieFragmentBox.prototype=Object.create(P.boxes.ContainerBox.prototype),P.boxes.MovieFragmentBox.prototype.constructor=P.boxes.MovieFragmentBox,P.boxes.MovieFragmentRandomAccessBox=function(e){P.boxes.ContainerBox.call(this,"mfra",e)},P.boxes.MovieFragmentRandomAccessBox.prototype=Object.create(P.boxes.ContainerBox.prototype),P.boxes.MovieFragmentRandomAccessBox.prototype.constructor=P.boxes.MovieFragmentRandomAccessBox,P.boxes.UserDataBox=function(e){P.boxes.ContainerBox.call(this,"udta",e)},P.boxes.UserDataBox.prototype=Object.create(P.boxes.ContainerBox.prototype),P.boxes.UserDataBox.prototype.constructor=P.boxes.UserDataBox,P.boxes.TrackBox=function(e){P.boxes.ContainerBox.call(this,"trak",e)},P.boxes.TrackBox.prototype=Object.create(P.boxes.ContainerBox.prototype),P.boxes.TrackBox.prototype.constructor=P.boxes.TrackBox,P.boxes.EditBox=function(e){P.boxes.ContainerBox.call(this,"edts",e)},P.boxes.EditBox.prototype=Object.create(P.boxes.ContainerBox.prototype),P.boxes.EditBox.prototype.constructor=P.boxes.EditBox,P.boxes.MediaBox=function(e){P.boxes.ContainerBox.call(this,"mdia",e)},P.boxes.MediaBox.prototype=Object.create(P.boxes.ContainerBox.prototype),P.boxes.MediaBox.prototype.constructor=P.boxes.MediaBox,P.boxes.MediaInformationBox=function(e){P.boxes.ContainerBox.call(this,"minf",e)},P.boxes.MediaInformationBox.prototype=Object.create(P.boxes.ContainerBox.prototype),P.boxes.MediaInformationBox.prototype.constructor=P.boxes.MediaInformationBox,P.boxes.DataInformationBox=function(e){P.boxes.ContainerBox.call(this,"dinf",e)},P.boxes.DataInformationBox.prototype=Object.create(P.boxes.ContainerBox.prototype),P.boxes.DataInformationBox.prototype.constructor=P.boxes.DataInformationBox,P.boxes.SampleTableBox=function(e){P.boxes.ContainerBox.call(this,"stbl",e)},P.boxes.SampleTableBox.prototype=Object.create(P.boxes.ContainerBox.prototype),P.boxes.SampleTableBox.prototype.constructor=P.boxes.SampleTableBox,P.boxes.MovieExtendsBox=function(e){P.boxes.ContainerBox.call(this,"mvex",e)},P.boxes.MovieExtendsBox.prototype=Object.create(P.boxes.ContainerBox.prototype),P.boxes.MovieExtendsBox.prototype.constructor=P.boxes.MovieExtendsBox,P.boxes.TrackFragmentBox=function(e){P.boxes.ContainerBox.call(this,"traf",e)},P.boxes.TrackFragmentBox.prototype=Object.create(P.boxes.ContainerBox.prototype),P.boxes.TrackFragmentBox.prototype.constructor=P.boxes.TrackFragmentBox,P.boxes.MetaBox=function(e){P.boxes.ContainerFullBox.call(this,"meta",e)},P.boxes.MetaBox.prototype=Object.create(P.boxes.ContainerFullBox.prototype),P.boxes.MetaBox.prototype.constructor=P.boxes.MetaBox,P.boxes.MetaBox.prototype.computeLength=function(){P.boxes.ContainerFullBox.prototype.computeLength.call(this,!1)},P.boxes.MetaBox.prototype.read=function(e,t,n){return P.boxes.ContainerFullBox.prototype.read.call(this,e,t,n,!1)},P.boxes.MetaBox.prototype.write=function(e,t){return P.boxes.ContainerFullBox.prototype.write.call(this,e,t,!1)},P.boxes.MovieHeaderBox=function(e){P.boxes.FullBox.call(this,"mvhd",e)},P.boxes.MovieHeaderBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.MovieHeaderBox.prototype.constructor=P.boxes.MovieHeaderBox,P.boxes.MovieHeaderBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_INT32.getLength()+2*P.fields.FIELD_INT16.getLength(),this.size+=2*P.fields.FIELD_INT32.getLength()+9*P.fields.FIELD_INT32.getLength(),this.size+=6*P.fields.FIELD_BIT32.getLength()+P.fields.FIELD_UINT32.getLength(),1===this.version?this.size+=3*P.fields.FIELD_UINT64.getLength()+P.fields.FIELD_UINT32.getLength():this.size+=4*P.fields.FIELD_UINT32.getLength()},P.boxes.MovieHeaderBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),1===this.version?(this._writeData(e,P.fields.FIELD_UINT64,this.creation_time),this._writeData(e,P.fields.FIELD_UINT64,this.modification_time),this._writeData(e,P.fields.FIELD_UINT32,this.timescale),this._writeData(e,P.fields.FIELD_UINT64,this.duration)):(this._writeData(e,P.fields.FIELD_UINT32,this.creation_time),this._writeData(e,P.fields.FIELD_UINT32,this.modification_time),this._writeData(e,P.fields.FIELD_UINT32,this.timescale),this._writeData(e,P.fields.FIELD_UINT32,this.duration)),this._writeData(e,P.fields.FIELD_INT32,this.rate),this._writeData(e,P.fields.FIELD_INT16,this.volume),this._writeData(e,P.fields.FIELD_INT16,this.reserved),this._writeArrayData(e,P.fields.FIELD_INT32,this.reserved_2),this._writeArrayData(e,P.fields.FIELD_INT32,this.matrix),this._writeArrayData(e,P.fields.FIELD_BIT32,this.pre_defined),this._writeData(e,P.fields.FIELD_UINT32,this.next_track_ID),this.localPos},P.boxes.MovieHeaderBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),1==this.version?(this.creation_time=this._readData(e,P.fields.FIELD_UINT64),this.modification_time=this._readData(e,P.fields.FIELD_UINT64),this.timescale=this._readData(e,P.fields.FIELD_UINT32),this.duration=this._readData(e,P.fields.FIELD_UINT64)):(this.creation_time=this._readData(e,P.fields.FIELD_UINT32),this.modification_time=this._readData(e,P.fields.FIELD_UINT32),this.timescale=this._readData(e,P.fields.FIELD_UINT32),this.duration=this._readData(e,P.fields.FIELD_UINT32)),this.rate=this._readData(e,P.fields.FIELD_INT32),this.volume=this._readData(e,P.fields.FIELD_INT16),this.reserved=this._readData(e,P.fields.FIELD_INT16),this.reserved_2=this._readArrayFieldData(e,P.fields.FIELD_INT32,2),this.matrix=this._readArrayFieldData(e,P.fields.FIELD_INT32,9),this.pre_defined=this._readArrayFieldData(e,P.fields.FIELD_BIT32,6),this.next_track_ID=this._readData(e,P.fields.FIELD_UINT32),this.localPos},P.boxes.MediaDataBox=function(e){P.boxes.Box.call(this,"mdat",e)},P.boxes.MediaDataBox.prototype=Object.create(P.boxes.Box.prototype),P.boxes.MediaDataBox.prototype.constructor=P.boxes.MediaDataBox,P.boxes.MediaDataBox.prototype.computeLength=function(){P.boxes.Box.prototype.computeLength.call(this),this.size+=this.data.length},P.boxes.MediaDataBox.prototype.read=function(e,t,n){return this.data=e.subarray(t,n),n},P.boxes.MediaDataBox.prototype.write=function(e,t){return P.boxes.Box.prototype.write.call(this,e,t),this._writeBuffer(e,this.data,this.data.length),this.localPos},P.boxes.FreeSpaceBox=function(e){P.boxes.Box.call(this,"free",e)},P.boxes.FreeSpaceBox.prototype=Object.create(P.boxes.Box.prototype),P.boxes.FreeSpaceBox.prototype.constructor=P.boxes.FreeSpaceBox,P.boxes.FreeSpaceBox.prototype.computeLength=function(){P.boxes.Box.prototype.computeLength.call(this),this.size+=this.data.length},P.boxes.FreeSpaceBox.prototype.read=function(e,t,n){return this.localPos=t,this.localEnd=n,this.data=e.subarray(this.localPos,this.localEnd),this.localEnd},P.boxes.FreeSpaceBox.prototype.write=function(e,t){return P.boxes.Box.prototype.write.call(this,e,t),this._writeBuffer(e,this.data,this.data.length),this.localPos},P.boxes.SegmentIndexBox=function(e){P.boxes.FullBox.call(this,"sidx",e)},P.boxes.SegmentIndexBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.SegmentIndexBox.prototype.constructor=P.boxes.SegmentIndexBox,P.boxes.SegmentIndexBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=2*P.fields.FIELD_UINT32.getLength(),1===this.version?this.size+=2*P.fields.FIELD_UINT64.getLength():this.size+=2*P.fields.FIELD_UINT32.getLength(),this.size+=P.fields.FIELD_UINT16.getLength(),this.size+=P.fields.FIELD_UINT16.getLength(),this.size+=(P.fields.FIELD_UINT64.getLength()+P.fields.FIELD_UINT32.getLength())*this.reference_count},P.boxes.SegmentIndexBox.prototype.read=function(e,t,n){P.boxes.FullBox.prototype.read.call(this,e,t,n);var i=0,r={};for(this.reference_ID=this._readData(e,P.fields.FIELD_UINT32),this.timescale=this._readData(e,P.fields.FIELD_UINT32),1===this.version?(this.earliest_presentation_time=this._readData(e,P.fields.FIELD_UINT64),this.first_offset=this._readData(e,P.fields.FIELD_UINT64)):(this.earliest_presentation_time=this._readData(e,P.fields.FIELD_UINT32),this.first_offset=this._readData(e,P.fields.FIELD_UINT32)),this.reserved=this._readData(e,P.fields.FIELD_UINT16),this.reference_count=this._readData(e,P.fields.FIELD_UINT16),this.references=[],i=0;i<this.reference_count;i++)r={},r.reference_info=this._readData(e,P.fields.FIELD_UINT64),r.SAP=this._readData(e,P.fields.FIELD_UINT32),this.references.push(r);return this.localPos},P.boxes.SegmentIndexBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0;for(this._writeData(e,P.fields.FIELD_UINT32,this.reference_ID),this._writeData(e,P.fields.FIELD_UINT32,this.timescale),1===this.version?(this._writeData(e,P.fields.FIELD_UINT64,this.earliest_presentation_time),this._writeData(e,P.fields.FIELD_UINT64,this.first_offset)):(this._writeData(e,P.fields.FIELD_UINT32,this.earliest_presentation_time),this._writeData(e,P.fields.FIELD_UINT32,this.first_offset)),this._writeData(e,P.fields.FIELD_UINT16,this.reserved),this._writeData(e,P.fields.FIELD_UINT16,this.reference_count),n=0;n<this.reference_count;n++)this._writeData(e,P.fields.FIELD_UINT64,this.references[n].reference_info),this._writeData(e,P.fields.FIELD_UINT32,this.references[n].SAP);return this.localPos},P.boxes.TrackHeaderBox=function(e){P.boxes.FullBox.call(this,"tkhd",e)},P.boxes.TrackHeaderBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.TrackHeaderBox.prototype.constructor=P.boxes.TrackHeaderBox,P.boxes.TrackHeaderBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=4*P.fields.FIELD_INT16.getLength()+2*P.fields.FIELD_INT32.getLength()+2*P.fields.FIELD_UINT32.getLength()+9*P.fields.FIELD_INT32.getLength(),1==this.version?this.size+=3*P.fields.FIELD_UINT64.getLength()+2*P.fields.FIELD_UINT32.getLength():this.size+=5*P.fields.FIELD_UINT32.getLength()},P.boxes.TrackHeaderBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),1===this.version?(this.creation_time=this._readData(e,P.fields.FIELD_UINT64),this.modification_time=this._readData(e,P.fields.FIELD_UINT64),this.track_id=this._readData(e,P.fields.FIELD_UINT32),this.reserved=this._readData(e,P.fields.FIELD_UINT32),this.duration=this._readData(e,P.fields.FIELD_UINT64)):(this.creation_time=this._readData(e,P.fields.FIELD_UINT32),this.modification_time=this._readData(e,P.fields.FIELD_UINT32),this.track_id=this._readData(e,P.fields.FIELD_UINT32),this.reserved=this._readData(e,P.fields.FIELD_UINT32),this.duration=this._readData(e,P.fields.FIELD_UINT32)),this.reserved_2=this._readArrayFieldData(e,P.fields.FIELD_UINT32,2),this.layer=this._readData(e,P.fields.FIELD_INT16),this.alternate_group=this._readData(e,P.fields.FIELD_INT16),this.volume=this._readData(e,P.fields.FIELD_INT16),this.reserved_3=this._readData(e,P.fields.FIELD_INT16),this.matrix=this._readArrayFieldData(e,P.fields.FIELD_INT32,9),this.width=this._readData(e,P.fields.FIELD_INT32),this.height=this._readData(e,P.fields.FIELD_INT32),this.localPos},P.boxes.TrackHeaderBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),1===this.version?(this._writeData(e,P.fields.FIELD_UINT64,this.creation_time),this._writeData(e,P.fields.FIELD_UINT64,this.modification_time),this._writeData(e,P.fields.FIELD_UINT32,this.track_id),this._writeData(e,P.fields.FIELD_UINT32,this.reserved),this._writeData(e,P.fields.FIELD_UINT64,this.duration)):(this._writeData(e,P.fields.FIELD_UINT32,this.creation_time),this._writeData(e,P.fields.FIELD_UINT32,this.modification_time),this._writeData(e,P.fields.FIELD_UINT32,this.track_id),this._writeData(e,P.fields.FIELD_UINT32,this.reserved),this._writeData(e,P.fields.FIELD_UINT32,this.duration)),this._writeArrayData(e,P.fields.FIELD_UINT32,this.reserved_2),this._writeData(e,P.fields.FIELD_INT16,this.layer),this._writeData(e,P.fields.FIELD_INT16,this.alternate_group),this._writeData(e,P.fields.FIELD_INT16,this.volume),this._writeData(e,P.fields.FIELD_INT16,this.reserved_3),this._writeArrayData(e,P.fields.FIELD_INT32,this.matrix),this._writeData(e,P.fields.FIELD_INT32,this.width),this._writeData(e,P.fields.FIELD_INT32,this.height),this.localPos},P.boxes.MediaHeaderBox=function(e){P.boxes.FullBox.call(this,"mdhd",e)},P.boxes.MediaHeaderBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.MediaHeaderBox.prototype.constructor=P.boxes.MediaHeaderBox,P.boxes.MediaHeaderBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=2*P.fields.FIELD_UINT16.getLength(),1==this.version?this.size+=3*P.fields.FIELD_UINT64.getLength()+P.fields.FIELD_UINT32.getLength():this.size+=4*P.fields.FIELD_UINT32.getLength()},P.boxes.MediaHeaderBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),1===this.version?(this.creation_time=this._readData(e,P.fields.FIELD_UINT64),this.modification_time=this._readData(e,P.fields.FIELD_UINT64),this.timescale=this._readData(e,P.fields.FIELD_UINT32),this.duration=this._readData(e,P.fields.FIELD_UINT64)):(this.creation_time=this._readData(e,P.fields.FIELD_UINT32),this.modification_time=this._readData(e,P.fields.FIELD_UINT32),this.timescale=this._readData(e,P.fields.FIELD_UINT32),this.duration=this._readData(e,P.fields.FIELD_UINT32)),this.language=this._readData(e,P.fields.FIELD_UINT16),this.pre_defined=this._readData(e,P.fields.FIELD_UINT16),this.localPos},P.boxes.MediaHeaderBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),1===this.version?(this._writeData(e,P.fields.FIELD_UINT64,this.creation_time),this._writeData(e,P.fields.FIELD_UINT64,this.modification_time),this._writeData(e,P.fields.FIELD_UINT32,this.timescale),this._writeData(e,P.fields.FIELD_UINT64,this.duration)):(this._writeData(e,P.fields.FIELD_UINT32,this.creation_time),this._writeData(e,P.fields.FIELD_UINT32,this.modification_time),this._writeData(e,P.fields.FIELD_UINT32,this.timescale),this._writeData(e,P.fields.FIELD_UINT32,this.duration)),this._writeData(e,P.fields.FIELD_UINT16,this.language),this._writeData(e,P.fields.FIELD_UINT16,this.pre_defined),this.localPos},P.boxes.MovieExtendsHeaderBox=function(e){P.boxes.FullBox.call(this,"mehd",e)},P.boxes.MovieExtendsHeaderBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.MovieExtendsHeaderBox.prototype.constructor=P.boxes.MovieExtendsHeaderBox,P.boxes.MovieExtendsHeaderBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),1==this.version?this.size+=P.fields.FIELD_UINT64.getLength():this.size+=P.fields.FIELD_UINT32.getLength()},P.boxes.MovieExtendsHeaderBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),1===this.version?this.fragment_duration=this._readData(e,P.fields.FIELD_UINT64):this.fragment_duration=this._readData(e,P.fields.FIELD_UINT32),this.localPos},P.boxes.MovieExtendsHeaderBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),1===this.version?this._writeData(e,P.fields.FIELD_UINT64,this.fragment_duration):this._writeData(e,P.fields.FIELD_UINT32,this.fragment_duration),this.localPos},P.boxes.HandlerBox=function(e){P.boxes.FullBox.call(this,"hdlr",e)},P.boxes.HandlerBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.HandlerBox.prototype.constructor=P.boxes.HandlerBox,P.boxes.HandlerBox.prototype.HANDLERTYPEVIDEO="vide",P.boxes.HandlerBox.prototype.HANDLERTYPEAUDIO="soun",P.boxes.HandlerBox.prototype.HANDLERTYPETEXT="meta",P.boxes.HandlerBox.prototype.HANDLERVIDEONAME="Video Track",P.boxes.HandlerBox.prototype.HANDLERAUDIONAME="Audio Track",P.boxes.HandlerBox.prototype.HANDLERTEXTNAME="Text Track",P.boxes.HandlerBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=2*P.fields.FIELD_UINT32.getLength()+3*P.fields.FIELD_UINT32.getLength()+P.fields.FIELD_STRING.getLength(this.name)},P.boxes.HandlerBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.pre_defined=this._readData(e,P.fields.FIELD_UINT32),this.handler_type=this._readData(e,P.fields.FIELD_UINT32),this.reserved=this._readArrayFieldData(e,P.fields.FIELD_UINT32,3),this.name=this._readData(e,P.fields.FIELD_STRING),this.localPos},P.boxes.HandlerBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_UINT32,this.pre_defined),this._writeData(e,P.fields.FIELD_UINT32,this.handler_type),this._writeArrayData(e,P.fields.FIELD_UINT32,this.reserved),this._writeData(e,P.fields.FIELD_STRING,this.name),this.localPos},P.boxes.TimeToSampleBox=function(e){P.boxes.FullBox.call(this,"stts",e)},P.boxes.TimeToSampleBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.TimeToSampleBox.prototype.constructor=P.boxes.TimeToSampleBox,P.boxes.TimeToSampleBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_UINT32.getLength(),this.size+=this.entry_count*(2*P.fields.FIELD_UINT32.getLength())},P.boxes.TimeToSampleBox.prototype.read=function(e,t,n){P.boxes.FullBox.prototype.read.call(this,e,t,n);var i=0,r={};for(this.entry_count=this._readData(e,P.fields.FIELD_UINT32),this.entry=[],i=0;i<this.entry_count;i++)r={},r.sample_count=this._readData(e,P.fields.FIELD_UINT32),r.sample_delta=this._readData(e,P.fields.FIELD_UINT32),this.entry.push(r);return this.localPos},P.boxes.TimeToSampleBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0;for(this._writeData(e,P.fields.FIELD_UINT32,this.entry_count),
n=0;n<this.entry_count;n++)this._writeData(e,P.fields.FIELD_UINT32,this.entry[n].sample_count),this._writeData(e,P.fields.FIELD_UINT32,this.entry[n].sample_delta);return this.localPos},P.boxes.SampleToChunkBox=function(e){P.boxes.FullBox.call(this,"stsc",e)},P.boxes.SampleToChunkBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.SampleToChunkBox.prototype.constructor=P.boxes.SampleToChunkBox,P.boxes.SampleToChunkBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_UINT32.getLength(),this.size+=this.entry_count*(3*P.fields.FIELD_UINT32.getLength())},P.boxes.SampleToChunkBox.prototype.read=function(e,t,n){P.boxes.FullBox.prototype.read.call(this,e,t,n);var i=0,r={};for(this.entry_count=this._readData(e,P.fields.FIELD_UINT32),this.entry=[],i=0;i<this.entry_count;i++)r={},r.first_chunk=this._readData(e,P.fields.FIELD_UINT32),r.samples_per_chunk=this._readData(e,P.fields.FIELD_UINT32),r.samples_description_index=this._readData(e,P.fields.FIELD_UINT32),this.entry.push(r);return this.localPos},P.boxes.SampleToChunkBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0;for(this._writeData(e,P.fields.FIELD_UINT32,this.entry_count),n=0;n<this.entry_count;n++)this._writeData(e,P.fields.FIELD_UINT32,this.entry[n].first_chunk),this._writeData(e,P.fields.FIELD_UINT32,this.entry[n].samples_per_chunk),this._writeData(e,P.fields.FIELD_UINT32,this.entry[n].samples_description_index);return this.localPos},P.boxes.ChunkOffsetBox=function(e){P.boxes.FullBox.call(this,"stco",e)},P.boxes.ChunkOffsetBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.ChunkOffsetBox.prototype.constructor=P.boxes.ChunkOffsetBox,P.boxes.ChunkOffsetBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_UINT32.getLength()+this.entry_count*P.fields.FIELD_UINT32.getLength()},P.boxes.ChunkOffsetBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.entry_count=this._readData(e,P.fields.FIELD_UINT32),this.chunk_offset=this._readArrayFieldData(e,P.fields.FIELD_UINT32,this.entry_count),this.localPos},P.boxes.ChunkOffsetBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0;for(this._writeData(e,P.fields.FIELD_UINT32,this.entry_count),n=0;n<this.entry_count;n++)this._writeData(e,P.fields.FIELD_UINT32,this.chunk_offset[n]);return this.localPos},P.boxes.TrackExtendsBox=function(e){P.boxes.FullBox.call(this,"trex",e)},P.boxes.TrackExtendsBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.TrackExtendsBox.prototype.constructor=P.boxes.TrackExtendsBox,P.boxes.TrackExtendsBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=5*P.fields.FIELD_UINT32.getLength()},P.boxes.TrackExtendsBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.track_ID=this._readData(e,P.fields.FIELD_UINT32),this.default_sample_description_index=this._readData(e,P.fields.FIELD_UINT32),this.default_sample_duration=this._readData(e,P.fields.FIELD_UINT32),this.default_sample_size=this._readData(e,P.fields.FIELD_UINT32),this.default_sample_flags=this._readData(e,P.fields.FIELD_UINT32),this.localPos},P.boxes.TrackExtendsBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_UINT32,this.track_ID),this._writeData(e,P.fields.FIELD_UINT32,this.default_sample_description_index),this._writeData(e,P.fields.FIELD_UINT32,this.default_sample_duration),this._writeData(e,P.fields.FIELD_UINT32,this.default_sample_size),this._writeData(e,P.fields.FIELD_UINT32,this.default_sample_flags),this.localPos},P.boxes.VideoMediaHeaderBox=function(e){P.boxes.FullBox.call(this,"vmhd",e)},P.boxes.VideoMediaHeaderBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.VideoMediaHeaderBox.prototype.constructor=P.boxes.VideoMediaHeaderBox,P.boxes.VideoMediaHeaderBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_INT16.getLength()+3*P.fields.FIELD_UINT16.getLength()},P.boxes.VideoMediaHeaderBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.graphicsmode=this._readData(e,P.fields.FIELD_INT16),this.opcolor=this._readArrayFieldData(e,P.fields.FIELD_UINT16,3),this.localPos},P.boxes.VideoMediaHeaderBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_INT16,this.graphicsmode),this._writeArrayData(e,P.fields.FIELD_UINT16,this.opcolor),this.localPos},P.boxes.SoundMediaHeaderBox=function(e){P.boxes.FullBox.call(this,"smhd",e)},P.boxes.SoundMediaHeaderBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.SoundMediaHeaderBox.prototype.constructor=P.boxes.SoundMediaHeaderBox,P.boxes.SoundMediaHeaderBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_INT16.getLength()+P.fields.FIELD_UINT16.getLength()},P.boxes.SoundMediaHeaderBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.balance=this._readData(e,P.fields.FIELD_INT16),this.reserved=this._readData(e,P.fields.FIELD_UINT16),this.localPos},P.boxes.SoundMediaHeaderBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_INT16,this.balance),this._writeData(e,P.fields.FIELD_UINT16,this.reserved),this.localPos},P.boxes.DataReferenceBox=function(e){P.boxes.ContainerFullBox.call(this,"dref",e)},P.boxes.DataReferenceBox.prototype=Object.create(P.boxes.ContainerFullBox.prototype),P.boxes.DataReferenceBox.prototype.constructor=P.boxes.DataReferenceBox,P.boxes.DataReferenceBox.prototype.computeLength=function(){P.boxes.ContainerFullBox.prototype.computeLength.call(this,!0)},P.boxes.DataReferenceBox.prototype.read=function(e,t,n){return P.boxes.ContainerFullBox.prototype.read.call(this,e,t,n,!0)},P.boxes.DataReferenceBox.prototype.write=function(e,t){return this.entry_count||(this.entry_count=this.boxes.length),P.boxes.ContainerFullBox.prototype.write.call(this,e,t,!0)},P.boxes.DataEntryUrlBox=function(e){P.boxes.FullBox.call(this,"url ",e)},P.boxes.DataEntryUrlBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.DataEntryUrlBox.prototype.constructor=P.boxes.DataEntryUrlBox,P.boxes.DataEntryUrlBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),void 0!==this.location&&(this.size+=P.fields.FIELD_STRING.getLength(this.location))},P.boxes.DataEntryUrlBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.flags&!1&&(this.location=this._readData(e,P.fields.FIELD_STRING)),this.localPos},P.boxes.DataEntryUrlBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),void 0!==this.location&&this._writeData(e,P.fields.FIELD_STRING,this.location),this.localPos},P.boxes.DataEntryUrnBox=function(e){P.boxes.FullBox.call(this,"urn ",e)},P.boxes.DataEntryUrnBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.DataEntryUrnBox.prototype.constructor=P.boxes.DataEntryUrnBox,P.boxes.DataEntryUrnBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.flags&!1&&(this.size+=P.fields.FIELD_STRING.getLength(this.name)+P.fields.FIELD_STRING.getLength(this.location))},P.boxes.DataEntryUrnBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.flags&!1&&(this.name=this._readData(e,P.fields.FIELD_STRING),this.location=this._readData(e,P.fields.FIELD_STRING)),this.localPos},P.boxes.DataEntryUrnBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),this.flags&!1&&(this._writeData(e,P.fields.FIELD_STRING,this.name),this._writeData(e,P.fields.FIELD_STRING,this.location)),this.localPos},P.boxes.MovieFragmentHeaderBox=function(e){P.boxes.FullBox.call(this,"mfhd",e)},P.boxes.MovieFragmentHeaderBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.MovieFragmentHeaderBox.prototype.constructor=P.boxes.MovieFragmentHeaderBox,P.boxes.MovieFragmentHeaderBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_UINT32.getLength()},P.boxes.MovieFragmentHeaderBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.sequence_number=this._readData(e,P.fields.FIELD_UINT32),this.localPos},P.boxes.MovieFragmentHeaderBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_UINT32,this.sequence_number),this.localPos},P.boxes.TrackFragmentHeaderBox=function(e){P.boxes.FullBox.call(this,"tfhd",e)},P.boxes.TrackFragmentHeaderBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.TrackFragmentHeaderBox.prototype.constructor=P.boxes.TrackFragmentHeaderBox,P.boxes.TrackFragmentHeaderBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_UINT32.getLength(),0!==(1&this.flags)&&void 0!==this.base_data_offset&&(this.size+=P.fields.FIELD_UINT64.getLength()),0!==(2&this.flags)&&void 0!==this.sample_description_index&&(this.size+=P.fields.FIELD_UINT32.getLength()),0!==(8&this.flags)&&void 0!==this.default_sample_duration&&(this.size+=P.fields.FIELD_UINT32.getLength()),0!==(16&this.flags)&&void 0!==this.default_sample_size&&(this.size+=P.fields.FIELD_UINT32.getLength()),0!==(32&this.flags)&&void 0!==this.default_sample_flags&&(this.size+=P.fields.FIELD_UINT32.getLength())},P.boxes.TrackFragmentHeaderBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.track_ID=this._readData(e,P.fields.FIELD_UINT32),0!==(1&this.flags)&&(this.base_data_offset=this._readData(e,P.fields.FIELD_UINT64)),0!==(2&this.flags)&&(this.sample_description_index=this._readData(e,P.fields.FIELD_UINT32)),0!==(8&this.flags)&&(this.default_sample_duration=this._readData(e,P.fields.FIELD_UINT32)),0!==(16&this.flags)&&(this.default_sample_size=this._readData(e,P.fields.FIELD_UINT32)),0!==(32&this.flags)&&(this.default_sample_flags=this._readData(e,P.fields.FIELD_UINT32)),this.localPos},P.boxes.TrackFragmentHeaderBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_UINT32,this.track_ID),0!==(1&this.flags)&&this._writeData(e,P.fields.FIELD_UINT64,this.base_data_offset),0!==(2&this.flags)&&this._writeData(e,P.fields.FIELD_UINT32,this.sample_description_index),0!==(8&this.flags)&&this._writeData(e,P.fields.FIELD_UINT32,this.default_sample_duration),0!==(16&this.flags)&&this._writeData(e,P.fields.FIELD_UINT32,this.default_sample_size),0!==(32&this.flags)&&this._writeData(e,P.fields.FIELD_UINT32,this.default_sample_flags),this.localPos},P.boxes.TrackFragmentBaseMediaDecodeTimeBox=function(e){P.boxes.FullBox.call(this,"tfdt",e)},P.boxes.TrackFragmentBaseMediaDecodeTimeBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.TrackFragmentBaseMediaDecodeTimeBox.prototype.constructor=P.boxes.TrackFragmentBaseMediaDecodeTimeBox,P.boxes.TrackFragmentBaseMediaDecodeTimeBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),1===this.version?this.size+=P.fields.FIELD_UINT64.getLength():this.size+=P.fields.FIELD_UINT32.getLength()},P.boxes.TrackFragmentBaseMediaDecodeTimeBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),1===this.version?this.baseMediaDecodeTime=this._readData(e,P.fields.FIELD_UINT64):this.baseMediaDecodeTime=this._readData(e,P.fields.FIELD_UINT32),this.localPos},P.boxes.TrackFragmentBaseMediaDecodeTimeBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),1===this.version?this._writeData(e,P.fields.FIELD_UINT64,this.baseMediaDecodeTime):this._writeData(e,P.fields.FIELD_UINT32,this.baseMediaDecodeTime),this.localPos},P.boxes.TrackFragmentRunBox=function(e){P.boxes.FullBox.call(this,"trun",e)},P.boxes.TrackFragmentRunBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.TrackFragmentRunBox.prototype.constructor=P.boxes.TrackFragmentRunBox,P.boxes.TrackFragmentRunBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this);var e=0;for(this.size+=P.fields.FIELD_UINT32.getLength(),0!==(1&this.flags)&&void 0!==this.data_offset&&(this.size+=P.fields.FIELD_INT32.getLength()),0!==(4&this.flags)&&void 0!==this.first_sample_flags&&(this.size+=P.fields.FIELD_UINT32.getLength()),e=0;e<this.sample_count;e++)0!==(256&this.flags)&&void 0!==this.samples_table[e].sample_duration&&(this.size+=P.fields.FIELD_UINT32.getLength()),0!==(512&this.flags)&&void 0!==this.samples_table[e].sample_size&&(this.size+=P.fields.FIELD_UINT32.getLength()),0!==(1024&this.flags)&&void 0!==this.samples_table[e].sample_flags&&(this.size+=P.fields.FIELD_UINT32.getLength()),1===this.version?0!==(2048&this.flags)&&void 0!==this.samples_table[e].sample_composition_time_offset&&(this.size+=P.fields.FIELD_INT32.getLength()):0!==(2048&this.flags)&&void 0!==this.samples_table[e].sample_composition_time_offset&&(this.size+=P.fields.FIELD_UINT32.getLength())},P.boxes.TrackFragmentRunBox.prototype.read=function(e,t,n){P.boxes.FullBox.prototype.read.call(this,e,t,n);var i=0,r={};for(this.sample_count=this._readData(e,P.fields.FIELD_UINT32),0!==(1&this.flags)&&(this.data_offset=this._readData(e,P.fields.FIELD_INT32)),0!==(4&this.flags)&&(this.first_sample_flags=this._readData(e,P.fields.FIELD_UINT32)),this.samples_table=[],i=0;i<this.sample_count;i++)r={},0!==(256&this.flags)&&(r.sample_duration=this._readData(e,P.fields.FIELD_UINT32)),0!==(512&this.flags)&&(r.sample_size=this._readData(e,P.fields.FIELD_UINT32)),0!==(1024&this.flags)&&(r.sample_flags=this._readData(e,P.fields.FIELD_UINT32)),1===this.version?0!==(2048&this.flags)&&(r.sample_composition_time_offset=this._readData(e,P.fields.FIELD_INT32)):0!==(2048&this.flags)&&(r.sample_composition_time_offset=this._readData(e,P.fields.FIELD_UINT32)),this.samples_table.push(r);return this.localPos},P.boxes.TrackFragmentRunBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0;for(this._writeData(e,P.fields.FIELD_UINT32,this.sample_count),0!==(1&this.flags)&&this._writeData(e,P.fields.FIELD_INT32,this.data_offset),0!==(4&this.flags)&&this._writeData(e,P.fields.FIELD_UINT32,this.first_sample_flags),n=0;n<this.sample_count;n++)0!==(256&this.flags)&&this._writeData(e,P.fields.FIELD_UINT32,this.samples_table[n].sample_duration),0!==(512&this.flags)&&this._writeData(e,P.fields.FIELD_UINT32,this.samples_table[n].sample_size),0!==(1024&this.flags)&&this._writeData(e,P.fields.FIELD_UINT32,this.samples_table[n].sample_flags),1===this.version?0!==(2048&this.flags)&&this._writeData(e,P.fields.FIELD_INT32,this.samples_table[n].sample_composition_time_offset):0!==(2048&this.flags)&&this._writeData(e,P.fields.FIELD_UINT32,this.samples_table[n].sample_composition_time_offset);return this.localPos},P.boxes.SampleDescriptionBox=function(e){P.boxes.ContainerFullBox.call(this,"stsd",e)},P.boxes.SampleDescriptionBox.prototype=Object.create(P.boxes.ContainerFullBox.prototype),P.boxes.SampleDescriptionBox.prototype.constructor=P.boxes.SampleDescriptionBox,P.boxes.SampleDescriptionBox.prototype.computeLength=function(){P.boxes.ContainerFullBox.prototype.computeLength.call(this,!0)},P.boxes.SampleDescriptionBox.prototype.read=function(e,t,n){return P.boxes.ContainerFullBox.prototype.read.call(this,e,t,n,!0)},P.boxes.SampleDescriptionBox.prototype.write=function(e,t){return this.entry_count=this.boxes.length,P.boxes.ContainerFullBox.prototype.write.call(this,e,t,!0)},P.boxes.SampleDependencyTableBox=function(e){P.boxes.FullBox.call(this,"sdtp",e)},P.boxes.SampleDependencyTableBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.SampleDependencyTableBox.prototype.constructor=P.boxes.SampleDependencyTableBox,P.boxes.SampleDependencyTableBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_UINT8.getLength()*this.sample_dependency_table.length},P.boxes.SampleDependencyTableBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.sample_dependency_table=this._readArrayData(e,P.fields.FIELD_UINT8),this.localPos},P.boxes.SampleDependencyTableBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),this._writeArrayData(e,P.fields.FIELD_UINT8,this.sample_dependency_table),this.localPos},P.boxes.SampleEntryBox=function(e,t){P.boxes.Box.call(this,e,t)},P.boxes.SampleEntryBox.prototype=Object.create(P.boxes.Box.prototype),P.boxes.SampleEntryBox.prototype.constructor=P.boxes.SampleEntryBox,P.boxes.SampleEntryBox.prototype.computeLength=function(){P.boxes.Box.prototype.computeLength.call(this),this.size+=P.fields.FIELD_UINT16.getLength()+6*P.fields.FIELD_UINT8.getLength()},P.boxes.SampleEntryBox.prototype.read=function(e,t,n){return this.localPos=t,this.localEnd=n,this.reserved=this._readArrayFieldData(e,P.fields.FIELD_UINT8,6),this.data_reference_index=this._readData(e,P.fields.FIELD_UINT16),this.localPos},P.boxes.SampleEntryBox.prototype.write=function(e,t){return P.boxes.Box.prototype.write.call(this,e,t),this._writeArrayData(e,P.fields.FIELD_UINT8,this.reserved),this._writeData(e,P.fields.FIELD_UINT16,this.data_reference_index),this.localPos},P.boxes.VisualSampleEntryBox=function(e,t){P.boxes.SampleEntryBox.call(this,e,t)},P.boxes.VisualSampleEntryBox.prototype=Object.create(P.boxes.SampleEntryBox.prototype),P.boxes.VisualSampleEntryBox.prototype.constructor=P.boxes.VisualSampleEntryBox,P.boxes.VisualSampleEntryBox.prototype.computeLength=function(){P.boxes.SampleEntryBox.prototype.computeLength.call(this),this.size+=7*P.fields.FIELD_UINT16.getLength()+3*P.fields.FIELD_UINT32.getLength(),this.size+=3*P.fields.FIELD_UINT32.getLength(),this.size+=32},P.boxes.VisualSampleEntryBox.prototype.read=function(e,t,n){return P.boxes.SampleEntryBox.prototype.read.call(this,e,t,n),this.pre_defined=this._readData(e,P.fields.FIELD_UINT16),this.reserved_2=this._readData(e,P.fields.FIELD_UINT16),this.pre_defined_2=this._readArrayFieldData(e,P.fields.FIELD_UINT32,3),this.width=this._readData(e,P.fields.FIELD_UINT16),this.height=this._readData(e,P.fields.FIELD_UINT16),this.horizresolution=this._readData(e,P.fields.FIELD_UINT32),this.vertresolution=this._readData(e,P.fields.FIELD_UINT32),this.reserved_3=this._readData(e,P.fields.FIELD_UINT32),this.frame_count=this._readData(e,P.fields.FIELD_UINT16),this.compressorname=this._readArrayFieldData(e,P.fields.FIELD_UINT8,32),this.depth=this._readData(e,P.fields.FIELD_UINT16),this.pre_defined_3=this._readData(e,P.fields.FIELD_INT16),this.localPos},P.boxes.VisualSampleEntryBox.prototype.write=function(e,t){return P.boxes.SampleEntryBox.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_UINT16,this.pre_defined),this._writeData(e,P.fields.FIELD_UINT16,this.reserved_2),this._writeArrayData(e,P.fields.FIELD_UINT32,this.pre_defined_2),this._writeData(e,P.fields.FIELD_UINT16,this.width),this._writeData(e,P.fields.FIELD_UINT16,this.height),this._writeData(e,P.fields.FIELD_UINT32,this.horizresolution),this._writeData(e,P.fields.FIELD_UINT32,this.vertresolution),this._writeData(e,P.fields.FIELD_UINT32,this.reserved_3),this._writeData(e,P.fields.FIELD_UINT16,this.frame_count),this._writeArrayData(e,P.fields.FIELD_UINT8,this.compressorname),this._writeData(e,P.fields.FIELD_UINT16,this.depth),this._writeData(e,P.fields.FIELD_INT16,this.pre_defined_3),this.localPos},P.boxes.VisualSampleEntryContainerBox=function(e,t){P.boxes.VisualSampleEntryBox.call(this,e,t),this.boxes=[]},P.boxes.VisualSampleEntryContainerBox.prototype=Object.create(P.boxes.VisualSampleEntryBox.prototype),P.boxes.VisualSampleEntryContainerBox.prototype.constructor=P.boxes.VisualSampleEntryContainerBox,P.boxes.VisualSampleEntryContainerBox.prototype.computeLength=function(){P.boxes.VisualSampleEntryBox.prototype.computeLength.call(this);var e=0;for(e=0;e<this.boxes.length;e++)this.boxes[e].computeLength(),this.size+=this.boxes[e].size},P.boxes.VisualSampleEntryContainerBox.prototype.read=function(e,t,n){P.boxes.VisualSampleEntryBox.prototype.read.call(this,e,t,n);for(var i,r,o=0,s=0,a=null;this.localPos<this.localEnd;){if(o=P.fields.FIELD_UINT32.read(e,this.localPos),i=P.fields.readString(e,this.localPos+4,4),"uuid"==i&&(s=1==o?16:8,a=new P.fields.ArrayField(P.fields.FIELD_INT8,16).read(e,this.localPos+s,this.localPos+s+16),a=JSON.stringify(a)),r=P.createBox(i,o,a),"uuid"===i?this.localPos=r.read(e,this.localPos+16*P.fields.FIELD_INT8.getLength()+8,this.localPos+o):this.localPos=r.read(e,this.localPos+8,this.localPos+o),P.debug&&(r.__sourceBuffer=e.subarray(this.localPos-r.size,this.localPos)),this.boxes.push(r),r.size<=0||null===r.size)throw new P.ParseException("Problem on size of box "+r.boxtype+", parsing stopped to avoid infinite loop");if(!r.boxtype)throw new P.ParseException("Problem on unknown box, parsing stopped to avoid infinite loop")}return this.localPos},P.boxes.VisualSampleEntryContainerBox.prototype.write=function(e,t){P.boxes.VisualSampleEntryBox.prototype.write.call(this,e,t);var n=0;for(n=0;n<this.boxes.length;n++)this.localPos=this.boxes[n].write(e,this.localPos);return this.localPos},P.boxes.AVC1VisualSampleEntryBox=function(e){P.boxes.VisualSampleEntryContainerBox.call(this,"avc1",e)},P.boxes.AVC1VisualSampleEntryBox.prototype=Object.create(P.boxes.VisualSampleEntryContainerBox.prototype),P.boxes.AVC1VisualSampleEntryBox.prototype.constructor=P.boxes.AVC1VisualSampleEntryBox,P.boxes.EncryptedVideoBox=function(e){P.boxes.VisualSampleEntryContainerBox.call(this,"encv",e)},P.boxes.EncryptedVideoBox.prototype=Object.create(P.boxes.VisualSampleEntryContainerBox.prototype),P.boxes.EncryptedVideoBox.prototype.constructor=P.boxes.EncryptedVideoBox,P.boxes.AVCConfigurationBox=function(e){P.boxes.Box.call(this,"avcC",e)},P.boxes.AVCConfigurationBox.prototype=Object.create(P.boxes.Box.prototype),P.boxes.AVCConfigurationBox.prototype.constructor=P.boxes.AVCConfigurationBox,P.boxes.AVCConfigurationBox.prototype.computeLength=function(){P.boxes.Box.prototype.computeLength.call(this),this.size+=4*P.fields.FIELD_UINT8.getLength()+3*P.fields.FIELD_UINT8.getLength(),this.size+=this._getNALLength(this.numOfSequenceParameterSets,this.SPS_NAL),this.size+=this._getNALLength(this.numOfPictureParameterSets,this.PPS_NAL)},P.boxes.AVCConfigurationBox.prototype._getNALLength=function(e,t){var n=0,i=0;for(i=0;i<e;i++)n+=P.fields.FIELD_UINT16.getLength()+t[i].NAL_length;return n},P.boxes.AVCConfigurationBox.prototype.read=function(e,t,n){return this.localPos=t,this.localEnd=n,this.configurationVersion=this._readData(e,P.fields.FIELD_UINT8),this.AVCProfileIndication=this._readData(e,P.fields.FIELD_UINT8),this.profile_compatibility=this._readData(e,P.fields.FIELD_UINT8),this.AVCLevelIndication=this._readData(e,P.fields.FIELD_UINT8),this.temp=this._readData(e,P.fields.FIELD_UINT8),this.lengthSizeMinusOne=3&this.temp,this.numOfSequenceParameterSets_tmp=this._readData(e,P.fields.FIELD_UINT8),this.numOfSequenceParameterSets=31&this.numOfSequenceParameterSets_tmp,this.SPS_NAL=this._readNAL(e,this.numOfSequenceParameterSets),this.numOfPictureParameterSets=this._readData(e,P.fields.FIELD_UINT8),this.PPS_NAL=this._readNAL(e,this.numOfPictureParameterSets),this.localPos},P.boxes.AVCConfigurationBox.prototype._readNAL=function(e,t){var n=[],i=0,r={};for(i=0;i<t;i++)r={},r.NAL_length=this._readData(e,P.fields.FIELD_UINT16),r.NAL=e.subarray(this.localPos,this.localPos+r.NAL_length),this.localPos+=r.NAL_length,n.push(r);return n},P.boxes.AVCConfigurationBox.prototype.write=function(e,t){return P.boxes.Box.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_UINT8,this.configurationVersion),this._writeData(e,P.fields.FIELD_UINT8,this.AVCProfileIndication),this._writeData(e,P.fields.FIELD_UINT8,this.profile_compatibility),this._writeData(e,P.fields.FIELD_UINT8,this.AVCLevelIndication),this.temp=252|this.lengthSizeMinusOne,this._writeData(e,P.fields.FIELD_UINT8,this.temp),this.numOfSequenceParameterSets=this.SPS_NAL.length,this.numOfSequenceParameterSets_tmp=224|this.numOfSequenceParameterSets,this._writeData(e,P.fields.FIELD_UINT8,this.numOfSequenceParameterSets_tmp),this._writeNAL(e,this.numOfSequenceParameterSets,this.SPS_NAL),this._writeData(e,P.fields.FIELD_UINT8,this.numOfPictureParameterSets),this._writeNAL(e,this.numOfPictureParameterSets,this.PPS_NAL),this.localPos},P.boxes.AVCConfigurationBox.prototype._writeNAL=function(e,t,n){var i=0;for(i=0;i<t;i++)this._writeData(e,P.fields.FIELD_UINT16,n[i].NAL_length),this._writeBuffer(e,n[i].NAL,n[i].NAL_length)},P.boxes.PixelAspectRatioBox=function(e){P.boxes.Box.call(this,"pasp",e)},P.boxes.PixelAspectRatioBox.prototype=Object.create(P.boxes.Box.prototype),P.boxes.PixelAspectRatioBox.prototype.constructor=P.boxes.PixelAspectRatioBox,P.boxes.PixelAspectRatioBox.prototype.computeLength=function(){P.boxes.Box.prototype.computeLength.call(this),this.size+=2*P.fields.FIELD_INT32.getLength()},P.boxes.PixelAspectRatioBox.prototype.read=function(e,t,n){return this.localPos=t,this.localEnd=n,this.hSpacing=this._readData(e,P.fields.FIELD_INT32),this.vSpacing=this._readData(e,P.fields.FIELD_INT32),this.localPos},P.boxes.PixelAspectRatioBox.prototype.write=function(e,t){return P.boxes.Box.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_INT32,this.hSpacing),this._writeData(e,P.fields.FIELD_INT32,this.vSpacing),this.localPos},P.boxes.AudioSampleEntryBox=function(e,t){P.boxes.SampleEntryBox.call(this,e,t)},P.boxes.AudioSampleEntryBox.prototype=Object.create(P.boxes.SampleEntryBox.prototype),P.boxes.AudioSampleEntryBox.prototype.constructor=P.boxes.AudioSampleEntryBox,P.boxes.AudioSampleEntryBox.prototype.computeLength=function(){P.boxes.SampleEntryBox.prototype.computeLength.call(this),this.size+=4*P.fields.FIELD_UINT16.getLength()+3*P.fields.FIELD_UINT32.getLength()},P.boxes.AudioSampleEntryBox.prototype.read=function(e,t,n){return P.boxes.SampleEntryBox.prototype.read.call(this,e,t,n),this.reserved_2=this._readArrayFieldData(e,P.fields.FIELD_UINT32,2),this.channelcount=this._readData(e,P.fields.FIELD_UINT16),this.samplesize=this._readData(e,P.fields.FIELD_UINT16),this.pre_defined=this._readData(e,P.fields.FIELD_UINT16),this.reserved_3=this._readData(e,P.fields.FIELD_UINT16),this.samplerate=this._readData(e,P.fields.FIELD_UINT32),this.localPos},P.boxes.AudioSampleEntryBox.prototype.write=function(e,t){return P.boxes.SampleEntryBox.prototype.write.call(this,e,t),this._writeArrayData(e,P.fields.FIELD_UINT32,this.reserved_2),this._writeData(e,P.fields.FIELD_UINT16,this.channelcount),this._writeData(e,P.fields.FIELD_UINT16,this.samplesize),this._writeData(e,P.fields.FIELD_UINT16,this.pre_defined),this._writeData(e,P.fields.FIELD_UINT16,this.reserved_3),this._writeData(e,P.fields.FIELD_UINT32,this.samplerate),this.localPos},P.boxes.AudioSampleEntryContainerBox=function(e,t){P.boxes.AudioSampleEntryBox.call(this,e,t),this.boxes=[]},P.boxes.AudioSampleEntryContainerBox.prototype=Object.create(P.boxes.AudioSampleEntryBox.prototype),P.boxes.AudioSampleEntryContainerBox.prototype.constructor=P.boxes.AudioSampleEntryContainerBox,P.boxes.AudioSampleEntryContainerBox.prototype.computeLength=function(){P.boxes.AudioSampleEntryBox.prototype.computeLength.call(this);var e=0;for(e=0;e<this.boxes.length;e++)this.boxes[e].computeLength(),this.size+=this.boxes[e].size},P.boxes.AudioSampleEntryContainerBox.prototype.read=function(e,t,n){P.boxes.AudioSampleEntryBox.prototype.read.call(this,e,t,n);for(var i,r,o=0,s=0,a=null;this.localPos<this.localEnd;){if(o=P.fields.FIELD_UINT32.read(e,this.localPos),i=P.fields.readString(e,this.localPos+4,4),"uuid"==i&&(s=1==o?16:8,a=new P.fields.ArrayField(P.fields.FIELD_INT8,16).read(e,this.localPos+s,this.localPos+s+16),a=JSON.stringify(a)),r=P.createBox(i,o,a),"uuid"===i?this.localPos=r.read(e,this.localPos+16*P.fields.FIELD_INT8.getLength()+8,this.localPos+o):this.localPos=r.read(e,this.localPos+8,this.localPos+o),P.debug&&(r.__sourceBuffer=e.subarray(this.localPos-r.size,this.localPos)),this.boxes.push(r),r.size<=0||null===r.size)throw new P.ParseException("Problem on size of box "+r.boxtype+", parsing stopped to avoid infinite loop");if(!r.boxtype)throw new P.ParseException("Problem on unknown box, parsing stopped to avoid infinite loop")}return this.localPos},P.boxes.AudioSampleEntryContainerBox.prototype.write=function(e,t){P.boxes.AudioSampleEntryBox.prototype.write.call(this,e,t);var n=0;for(n=0;n<this.boxes.length;n++)this.localPos=this.boxes[n].write(e,this.localPos);return this.localPos},P.boxes.MP4AudioSampleEntryBox=function(e){P.boxes.AudioSampleEntryContainerBox.call(this,"mp4a",e)},P.boxes.MP4AudioSampleEntryBox.prototype=Object.create(P.boxes.AudioSampleEntryContainerBox.prototype),P.boxes.MP4AudioSampleEntryBox.prototype.constructor=P.boxes.MP4AudioSampleEntryBox,P.boxes.EncryptedAudioBox=function(e){P.boxes.AudioSampleEntryContainerBox.call(this,"enca",e)},P.boxes.EncryptedAudioBox.prototype=Object.create(P.boxes.AudioSampleEntryContainerBox.prototype),P.boxes.EncryptedAudioBox.prototype.constructor=P.boxes.EncryptedAudioBox,P.boxes.ESDBox=function(e){P.boxes.FullBox.call(this,"esds",e)},P.boxes.ESDBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.ESDBox.prototype.constructor=P.boxes.ESDBox,P.boxes.ESDBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=2*P.fields.FIELD_UINT8.getLength()+this.ES_length},P.boxes.ESDBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.ES_tag=this._readData(e,P.fields.FIELD_UINT8),this.ES_length=this._readData(e,P.fields.FIELD_UINT8),this.ES_data=e.subarray(this.localPos,this.localPos+this.ES_length),this.localPos+=this.ES_length,this.localPos},P.boxes.ESDBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_UINT8,this.ES_tag),this._writeData(e,P.fields.FIELD_UINT8,this.ES_length),this._writeBuffer(e,this.ES_data,this.ES_length),this.localPos},P.boxes.SampleSizeBox=function(e){P.boxes.FullBox.call(this,"stsz",e)},P.boxes.SampleSizeBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.SampleSizeBox.prototype.constructor=P.boxes.SampleSizeBox,P.boxes.SampleSizeBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=2*P.fields.FIELD_UINT32.getLength()+P.fields.FIELD_UINT32.getLength()*this.sample_count},P.boxes.SampleSizeBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.sample_size=this._readData(e,P.fields.FIELD_UINT32),this.sample_count=this._readData(e,P.fields.FIELD_UINT32),this.entries=this._readArrayFieldData(e,P.fields.FIELD_UINT32,this.sample_count),this.localPos},P.boxes.SampleSizeBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0;for(this._writeData(e,P.fields.FIELD_UINT32,this.sample_size),this._writeData(e,P.fields.FIELD_UINT32,this.sample_count),n=0;n<this.sample_count;n++)this._writeData(e,P.fields.FIELD_UINT32,this.entries[n]);return this.localPos},P.boxes.ProtectionSystemSpecificHeaderBox=function(e){P.boxes.FullBox.call(this,"pssh",e)},P.boxes.ProtectionSystemSpecificHeaderBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.ProtectionSystemSpecificHeaderBox.prototype.constructor=P.boxes.ProtectionSystemSpecificHeaderBox,P.boxes.ProtectionSystemSpecificHeaderBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=16*P.fields.FIELD_UINT8.getLength(),this.size+=P.fields.FIELD_UINT32.getLength(),
this.size+=P.fields.FIELD_UINT8.getLength()*this.DataSize},P.boxes.ProtectionSystemSpecificHeaderBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.SystemID=this._readArrayFieldData(e,P.fields.FIELD_UINT8,16),this.DataSize=this._readData(e,P.fields.FIELD_UINT32),this.Data=this._readArrayFieldData(e,P.fields.FIELD_UINT8,this.DataSize),this.localPos},P.boxes.ProtectionSystemSpecificHeaderBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0;for(n=0;n<16;n++)this._writeData(e,P.fields.FIELD_UINT8,this.SystemID[n]);for(this._writeData(e,P.fields.FIELD_UINT32,this.DataSize),n=0;n<this.DataSize;n++)this._writeData(e,P.fields.FIELD_UINT8,this.Data[n]);return this.localPos},P.boxes.SampleEncryptionBox=function(e){P.boxes.FullBox.call(this,"senc",e)},P.boxes.SampleEncryptionBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.SampleEncryptionBox.prototype.constructor=P.boxes.SampleEncryptionBox,P.boxes.SampleEncryptionBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this);var e=0,t=0;for(this.size+=P.fields.FIELD_UINT32.getLength(),1&this.flags&&(this.size+=P.fields.FIELD_UINT8.getLength()),e=0;e<this.sample_count;e++)if(this.size+=8,2&this.flags)for(this.size+=P.fields.FIELD_UINT16.getLength(),t=0;t<this.entry[e].NumberOfEntries;t++)this.size+=P.fields.FIELD_UINT16.getLength(),this.size+=P.fields.FIELD_UINT32.getLength()},P.boxes.SampleEncryptionBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0,i=0;for(this._writeData(e,P.fields.FIELD_UINT32,this.sample_count),1&this.flags&&this._writeData(e,P.fields.FIELD_UINT8,this.IV_size),n=0;n<this.sample_count;n++)if(this._writeBuffer(e,this.entry[n].InitializationVector,8),2&this.flags)for(this._writeData(e,P.fields.FIELD_UINT16,this.entry[n].NumberOfEntries),i=0;i<this.entry[n].NumberOfEntries;i++)this._writeData(e,P.fields.FIELD_UINT16,this.entry[n].clearAndCryptedData[i].BytesOfClearData),this._writeData(e,P.fields.FIELD_UINT32,this.entry[n].clearAndCryptedData[i].BytesOfEncryptedData);return this.localPos},P.boxes.SampleEncryptionBox.prototype.read=function(e,t,n){P.boxes.FullBox.prototype.read.call(this,e,t,n);var i=0,r=0,o={},s={};for(this.sample_count=this._readData(e,P.fields.FIELD_UINT32),1&this.flags&&(this.IV_size=this._readData(e,P.fields.FIELD_UINT8)),this.entry=[],i=0;i<this.sample_count;i++){if(s={},s.InitializationVector=e.subarray(this.localPos,this.localPos+8),this.localPos+=8,2&this.flags)for(s.NumberOfEntries=this._readData(e,P.fields.FIELD_UINT16),s.clearAndCryptedData=[],r=0;r<s.NumberOfEntries;r++)o={},o.BytesOfClearData=this._readData(e,P.fields.FIELD_UINT16),o.BytesOfEncryptedData=this._readData(e,P.fields.FIELD_UINT32),s.clearAndCryptedData.push(o);this.entry.push(s)}return this.localPos},P.boxes.SampleAuxiliaryInformationSizesBox=function(e){P.boxes.FullBox.call(this,"saiz",e)},P.boxes.SampleAuxiliaryInformationSizesBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.SampleAuxiliaryInformationSizesBox.prototype.constructor=P.boxes.SampleAuxiliaryInformationSizesBox,P.boxes.SampleAuxiliaryInformationSizesBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),1&this.flags&&(this.size+=2*P.fields.FIELD_UINT32.getLength()),this.size+=P.fields.FIELD_UINT8.getLength()+P.fields.FIELD_UINT32.getLength(),0===this.default_sample_info_size&&(this.size+=P.fields.FIELD_UINT8.getLength()*this.sample_count)},P.boxes.SampleAuxiliaryInformationSizesBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),1&this.flags&&(this.aux_info_type=this._readData(e,P.fields.FIELD_UINT32),this.aux_info_type_parameter=this._readData(e,P.fields.FIELD_UINT32)),this.default_sample_info_size=this._readData(e,P.fields.FIELD_UINT8),this.sample_count=this._readData(e,P.fields.FIELD_UINT32),0===this.default_sample_info_size&&(this.sample_info_size=this._readArrayFieldData(e,P.fields.FIELD_UINT8,this.sample_count)),this.localPos},P.boxes.SampleAuxiliaryInformationSizesBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0;if(1&this.flags&&(this._writeData(e,P.fields.FIELD_UINT32,this.aux_info_type),this._writeData(e,P.fields.FIELD_UINT32,this.aux_info_type_parameter)),this._writeData(e,P.fields.FIELD_UINT8,this.default_sample_info_size),this._writeData(e,P.fields.FIELD_UINT32,this.sample_count),0===this.default_sample_info_size)for(n=0;n<this.sample_count;n++)this._writeData(e,P.fields.FIELD_UINT8,this.sample_info_size[n]);return this.localPos},P.boxes.SampleAuxiliaryInformationOffsetsBox=function(e){P.boxes.FullBox.call(this,"saio",e)},P.boxes.SampleAuxiliaryInformationOffsetsBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.SampleAuxiliaryInformationOffsetsBox.prototype.constructor=P.boxes.SampleAuxiliaryInformationOffsetsBox,P.boxes.SampleAuxiliaryInformationOffsetsBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),1&this.flags&&(this.size+=2*P.fields.FIELD_UINT32.getLength()),this.size+=P.fields.FIELD_UINT32.getLength(),0===this.version?this.size+=P.fields.FIELD_UINT32.getLength()*this.entry_count:this.size+=P.fields.FIELD_UINT64.getLength()*this.entry_count},P.boxes.SampleAuxiliaryInformationOffsetsBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),1&this.flags&&(this.aux_info_type=this._readData(e,P.fields.FIELD_UINT32),this.aux_info_type_parameter=this._readData(e,P.fields.FIELD_UINT32)),this.entry_count=this._readData(e,P.fields.FIELD_UINT32),0===this.version?this.offset=this._readArrayFieldData(e,P.fields.FIELD_UINT32,this.entry_count):this.offset=this._readArrayFieldData(e,P.fields.FIELD_UINT64,this.entry_count),this.localPos},P.boxes.SampleAuxiliaryInformationOffsetsBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0;if(1&this.flags&&(this._writeData(e,P.fields.FIELD_UINT32,this.aux_info_type),this._writeData(e,P.fields.FIELD_UINT32,this.aux_info_type_parameter)),this._writeData(e,P.fields.FIELD_UINT32,this.entry_count),0===this.version)for(n=0;n<this.entry_count;n++)this._writeData(e,P.fields.FIELD_UINT32,this.offset[n]);else for(n=0;n<this.entry_count;n++)this._writeData(e,P.fields.FIELD_UINT64,this.offset[n]);return this.localPos},P.boxes.ProtectionSchemeInformationBox=function(e){P.boxes.ContainerBox.call(this,"sinf",e)},P.boxes.ProtectionSchemeInformationBox.prototype=Object.create(P.boxes.ContainerBox.prototype),P.boxes.ProtectionSchemeInformationBox.prototype.constructor=P.boxes.ProtectionSchemeInformationBox,P.boxes.SchemeInformationBox=function(e){P.boxes.ContainerBox.call(this,"schi",e)},P.boxes.SchemeInformationBox.prototype=Object.create(P.boxes.ContainerBox.prototype),P.boxes.SchemeInformationBox.prototype.constructor=P.boxes.SchemeInformationBox,P.boxes.TrackEncryptionBox=function(e){P.boxes.FullBox.call(this,"tenc",e)},P.boxes.TrackEncryptionBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.TrackEncryptionBox.prototype.constructor=P.boxes.TrackEncryptionBox,P.boxes.TrackEncryptionBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_BIT24.getLength(),this.size+=P.fields.FIELD_UINT8.getLength(),this.size+=16*P.fields.FIELD_UINT8.getLength()},P.boxes.TrackEncryptionBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.default_IsEncrypted=this._readData(e,P.fields.FIELD_BIT24),this.default_IV_size=this._readData(e,P.fields.FIELD_UINT8),this.default_KID=this._readArrayFieldData(e,P.fields.FIELD_UINT8,16),this.localPos},P.boxes.TrackEncryptionBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_BIT24,this.default_IsEncrypted),this._writeData(e,P.fields.FIELD_UINT8,this.default_IV_size),this._writeArrayData(e,P.fields.FIELD_UINT8,this.default_KID),this.localPos},P.boxes.SchemeTypeBox=function(e){P.boxes.FullBox.call(this,"schm",e)},P.boxes.SchemeTypeBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.SchemeTypeBox.prototype.constructor=P.boxes.SchemeTypeBox,P.boxes.SchemeTypeBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=2*P.fields.FIELD_UINT32.getLength(),1&this.flags&&(this.size+=P.fields.FIELD_STRING.getLength(this.scheme_uri))},P.boxes.SchemeTypeBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.scheme_type=this._readData(e,P.fields.FIELD_UINT32),this.scheme_version=this._readData(e,P.fields.FIELD_UINT32),1&this.flags&&(this.scheme_uri=this._readData(e,P.fields.FIELD_STRING)),this.localPos},P.boxes.SchemeTypeBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_UINT32,this.scheme_type),this._writeData(e,P.fields.FIELD_UINT32,this.scheme_version),1&this.flags&&this._writeData(e,P.fields.FIELD_STRING,this.scheme_uri),this.localPos},P.boxes.EditListBox=function(e){P.boxes.FullBox.call(this,"elst",e),this.entries=[]},P.boxes.EditListBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.EditListBox.prototype.constructor=P.boxes.EditListBox,P.boxes.EditListBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_UINT32.getLength(),1===this.version?this.size+=(2*P.fields.FIELD_UINT64.getLength()+2*P.fields.FIELD_UINT16.getLength())*this.entry_count:this.size+=(2*P.fields.FIELD_UINT32.getLength()+2*P.fields.FIELD_UINT16.getLength())*this.entry_count},P.boxes.EditListBox.prototype.read=function(e,t,n){P.boxes.FullBox.prototype.read.call(this,e,t,n);var i=0,r={};for(this.entry_count=this._readData(e,P.fields.FIELD_UINT32),i=0;i<this.entry_count;i++)r={},1===this.version?(r.segment_duration=this._readData(e,P.fields.FIELD_UINT64),r.media_time=this._readData(e,P.fields.FIELD_UINT64)):(r.segment_duration=this._readData(e,P.fields.FIELD_UINT32),r.media_time=this._readData(e,P.fields.FIELD_UINT32)),r.media_rate_integer=this._readData(e,P.fields.FIELD_UINT16),r.media_rate_fraction=this._readData(e,P.fields.FIELD_UINT16),this.entries.push(r);return this.localPos},P.boxes.EditListBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0;for(this._writeData(e,P.fields.FIELD_UINT32,this.entry_count),n=0;n<this.entry_count;n++)1===this.version?(this._writeData(e,P.fields.FIELD_UINT64,this.entries[n].segment_duration),this._writeData(e,P.fields.FIELD_UINT64,this.entries[n].media_time)):(this._writeData(e,P.fields.FIELD_UINT32,this.entries[n].segment_duration),this._writeData(e,P.fields.FIELD_UINT32,this.entries[n].media_time)),this._writeData(e,P.fields.FIELD_UINT16,this.entries[n].media_rate_integer),this._writeData(e,P.fields.FIELD_UINT16,this.entries[n].media_rate_fraction);return this.localPos},P.boxes.HintMediaHeaderBox=function(e){P.boxes.FullBox.call(this,"hmhd",e)},P.boxes.HintMediaHeaderBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.HintMediaHeaderBox.prototype.constructor=P.boxes.HintMediaHeaderBox,P.boxes.HintMediaHeaderBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=2*P.fields.FIELD_UINT16.getLength(),this.size+=3*P.fields.FIELD_UINT32.getLength()},P.boxes.HintMediaHeaderBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.maxPDUsize=this._readData(e,P.fields.FIELD_UINT16),this.avgPDUsize=this._readData(e,P.fields.FIELD_UINT16),this.maxbitrate=this._readData(e,P.fields.FIELD_UINT32),this.avgbitrate=this._readData(e,P.fields.FIELD_UINT32),this.reserved=this._readData(e,P.fields.FIELD_UINT32),this.localPos},P.boxes.HintMediaHeaderBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_UINT16,this.maxPDUsize),this._writeData(e,P.fields.FIELD_UINT16,this.avgPDUsize),this._writeData(e,P.fields.FIELD_UINT32,this.maxbitrate),this._writeData(e,P.fields.FIELD_UINT32,this.avgbitrate),this._writeData(e,P.fields.FIELD_UINT32,this.reserved),this.localPos},P.boxes.NullMediaHeaderBox=function(e){P.boxes.FullBox.call(this,"nmhd",e)},P.boxes.NullMediaHeaderBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.NullMediaHeaderBox.prototype.constructor=P.boxes.NullMediaHeaderBox,P.boxes.CompositionOffsetBox=function(e){P.boxes.FullBox.call(this,"ctts",e),this.entries=[]},P.boxes.CompositionOffsetBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.CompositionOffsetBox.prototype.constructor=P.boxes.CompositionOffsetBox,P.boxes.CompositionOffsetBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_UINT32.getLength(),0===this.version?this.size+=2*P.fields.FIELD_UINT32.getLength()*this.entry_count:this.size+=(P.fields.FIELD_UINT32.getLength()+P.fields.FIELD_INT32.getLength())*this.entry_count},P.boxes.CompositionOffsetBox.prototype.read=function(e,t,n){P.boxes.FullBox.prototype.read.call(this,e,t,n);var i=0,r={};for(this.entry_count=this._readData(e,P.fields.FIELD_UINT32),i=0;i<this.entry_count;i++)r={},0===this.version?(r.sample_count=this._readData(e,P.fields.FIELD_UINT32),r.sample_offset=this._readData(e,P.fields.FIELD_UINT32)):(r.sample_count=this._readData(e,P.fields.FIELD_UINT32),r.sample_offset=this._readData(e,P.fields.FIELD_INT32)),this.entries.push(r);return this.localPos},P.boxes.CompositionOffsetBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0;for(this._writeData(e,P.fields.FIELD_UINT32,this.entry_count),n=0;n<this.entry_count;n++)0===this.version?(this._writeData(e,P.fields.FIELD_UINT32,this.entries[n].sample_count),this._writeData(e,P.fields.FIELD_UINT32,this.entries[n].sample_offset)):(this._writeData(e,P.fields.FIELD_UINT32,this.entries[n].sample_count),this._writeData(e,P.fields.FIELD_INT32,this.entries[n].sample_offset));return this.localPos},P.boxes.CompositionToDecodeBox=function(e){P.boxes.FullBox.call(this,"cslg",e)},P.boxes.CompositionToDecodeBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.CompositionToDecodeBox.prototype.constructor=P.boxes.CompositionToDecodeBox,P.boxes.CompositionToDecodeBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=5*P.fields.FIELD_INT32.getLength()},P.boxes.CompositionToDecodeBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.compositionToDTSShift=this._readData(e,P.fields.FIELD_INT32),this.leastDecodeToDisplayDelta=this._readData(e,P.fields.FIELD_INT32),this.greatestDecodeToDisplayDelta=this._readData(e,P.fields.FIELD_INT32),this.compositionStartTime=this._readData(e,P.fields.FIELD_INT32),this.compositionEndTime=this._readData(e,P.fields.FIELD_INT32),this.localPos},P.boxes.CompositionToDecodeBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_INT32,this.compositionToDTSShift),this._writeData(e,P.fields.FIELD_INT32,this.leastDecodeToDisplayDelta),this._writeData(e,P.fields.FIELD_INT32,this.greatestDecodeToDisplayDelta),this._writeData(e,P.fields.FIELD_INT32,this.compositionStartTime),this._writeData(e,P.fields.FIELD_INT32,this.compositionEndTime),this.localPos},P.boxes.SyncSampleBox=function(e){P.boxes.FullBox.call(this,"stss",e),this.entries=[]},P.boxes.SyncSampleBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.SyncSampleBox.prototype.constructor=P.boxes.SyncSampleBox,P.boxes.SyncSampleBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_UINT32.getLength(),this.size+=P.fields.FIELD_UINT32.getLength()*this.entry_count},P.boxes.SyncSampleBox.prototype.read=function(e,t,n){P.boxes.FullBox.prototype.read.call(this,e,t,n);var i=0,r={};for(this.entry_count=this._readData(e,P.fields.FIELD_UINT32),i=0;i<this.entry_count;i++)r={},r.sample_number=this._readData(e,P.fields.FIELD_UINT32),this.entries.push(r);return this.localPos},P.boxes.SyncSampleBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0;for(this._writeData(e,P.fields.FIELD_UINT32,this.entry_count),n=0;n<this.entry_count;n++)this._writeData(e,P.fields.FIELD_UINT32,this.entries[n].sample_number);return this.localPos},P.boxes.TrackReferenceBox=function(e){P.boxes.FullBox.call(this,"tref",e)},P.boxes.TrackReferenceBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.TrackReferenceBox.prototype.constructor=P.boxes.TrackReferenceBox,P.boxes.TrackReferenceBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_UINT32.getLength()*this.track_IDs.length},P.boxes.TrackReferenceBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),this.track_IDs=this._readArrayData(e,P.fields.FIELD_UINT32),this.localPos},P.boxes.TrackReferenceBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),this._writeArrayData(e,P.fields.FIELD_UINT32,this.track_IDs),this.localPos},P.boxes.OriginalFormatBox=function(e){P.boxes.Box.call(this,"frma",e)},P.boxes.OriginalFormatBox.prototype=Object.create(P.boxes.Box.prototype),P.boxes.OriginalFormatBox.prototype.constructor=P.boxes.OriginalFormatBox,P.boxes.OriginalFormatBox.prototype.computeLength=function(){P.boxes.Box.prototype.computeLength.call(this),this.size+=P.fields.FIELD_UINT32.getLength()},P.boxes.OriginalFormatBox.prototype.read=function(e,t,n){return this.localPos=t,this.localEnd=n,this.data_format=this._readData(e,P.fields.FIELD_UINT32),this.localPos},P.boxes.OriginalFormatBox.prototype.write=function(e,t){return P.boxes.Box.prototype.write.call(this,e,t),this._writeData(e,P.fields.FIELD_UINT32,this.data_format),this.localPos},P.boxes.PiffSampleEncryptionBox=function(e){P.boxes.FullBox.call(this,"sepiff",e,[162,57,79,82,90,155,79,20,162,68,108,66,124,100,141,244])},P.boxes.PiffSampleEncryptionBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.PiffSampleEncryptionBox.prototype.constructor=P.boxes.PiffSampleEncryptionBox,P.boxes.PiffSampleEncryptionBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this);var e=0,t=0;for(this.size+=P.fields.FIELD_UINT32.getLength(),1&this.flags&&(this.size+=P.fields.FIELD_UINT8.getLength()),e=0;e<this.sample_count;e++)if(this.size+=8,2&this.flags)for(this.size+=P.fields.FIELD_UINT16.getLength(),t=0;t<this.entry[e].NumberOfEntries;t++)this.size+=P.fields.FIELD_UINT16.getLength(),this.size+=P.fields.FIELD_UINT32.getLength()},P.boxes.PiffSampleEncryptionBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0,i=0;for(this._writeData(e,P.fields.FIELD_UINT32,this.sample_count),1&this.flags&&this._writeData(e,P.fields.FIELD_UINT8,this.IV_size),n=0;n<this.sample_count;n++)if(this._writeBuffer(e,this.entry[n].InitializationVector,8),2&this.flags)for(this._writeData(e,P.fields.FIELD_UINT16,this.entry[n].NumberOfEntries),i=0;i<this.entry[n].NumberOfEntries;i++)this._writeData(e,P.fields.FIELD_UINT16,this.entry[n].clearAndCryptedData[i].BytesOfClearData),this._writeData(e,P.fields.FIELD_UINT32,this.entry[n].clearAndCryptedData[i].BytesOfEncryptedData);return this.localPos},P.boxes.PiffSampleEncryptionBox.prototype.read=function(e,t,n){P.boxes.FullBox.prototype.read.call(this,e,t,n);var i=0,r=0,o={},s={};for(this.sample_count=this._readData(e,P.fields.FIELD_UINT32),1&this.flags&&(this.IV_size=this._readData(e,P.fields.FIELD_UINT8)),this.entry=[],i=0;i<this.sample_count;i++){if(s={},s.InitializationVector=e.subarray(this.localPos,this.localPos+8),this.localPos+=8,2&this.flags)for(s.NumberOfEntries=this._readData(e,P.fields.FIELD_UINT16),s.clearAndCryptedData=[],r=0;r<s.NumberOfEntries;r++)o={},o.BytesOfClearData=this._readData(e,P.fields.FIELD_UINT16),o.BytesOfEncryptedData=this._readData(e,P.fields.FIELD_UINT32),s.clearAndCryptedData.push(o);this.entry.push(s)}return this.localPos},P.boxes.PiffTrackEncryptionBox=function(e){P.boxes.FullBox.call(this,"tepiff",e,[137,116,219,206,123,231,76,81,132,249,113,72,249,136,37,84])},P.boxes.PiffTrackEncryptionBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.PiffTrackEncryptionBox.prototype.constructor=P.boxes.PiffTrackEncryptionBox,P.boxes.PiffProtectionSystemSpecificHeaderBox=function(e){P.boxes.FullBox.call(this,"psshpiff",e,[208,138,79,24,16,243,74,130,182,200,50,216,171,161,131,211])},P.boxes.PiffProtectionSystemSpecificHeaderBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.PiffProtectionSystemSpecificHeaderBox.prototype.constructor=P.boxes.PiffProtectionSystemSpecificHeaderBox,P.boxes.TfxdBox=function(e){P.boxes.FullBox.call(this,"tfxd",e,[109,29,155,5,66,213,68,230,128,226,20,29,175,247,87,178])},P.boxes.TfxdBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.TfxdBox.prototype.constructor=P.boxes.TfxdBox,P.boxes.TfxdBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),1===this.version?this.size+=2*P.fields.FIELD_UINT64.getLength():this.size+=2*P.fields.FIELD_UINT32.getLength()},P.boxes.TfxdBox.prototype.write=function(e,t){return P.boxes.FullBox.prototype.write.call(this,e,t),1===this.version?(this._writeData(e,P.fields.FIELD_UINT64,this.fragment_absolute_time),this._writeData(e,P.fields.FIELD_UINT64,this.fragment_duration)):(this._writeData(e,P.fields.FIELD_UINT32,this.fragment_absolute_time),this._writeData(e,P.fields.FIELD_UINT32,this.fragment_duration)),this.localPos},P.boxes.TfxdBox.prototype.read=function(e,t,n){return P.boxes.FullBox.prototype.read.call(this,e,t,n),1===this.version?(this.fragment_absolute_time=this._readData(e,P.fields.FIELD_UINT64),this.fragment_duration=this._readData(e,P.fields.FIELD_UINT64)):(this.fragment_absolute_time=this._readData(e,P.fields.FIELD_UINT32),this.fragment_duration=this._readData(e,P.fields.FIELD_UINT32)),this.localPos},P.boxes.TfrfBox=function(e){P.boxes.FullBox.call(this,"tfrf",e,[212,128,126,242,202,57,70,149,142,84,38,203,158,70,167,159])},P.boxes.TfrfBox.prototype=Object.create(P.boxes.FullBox.prototype),P.boxes.TfrfBox.prototype.constructor=P.boxes.TfrfBox,P.boxes.TfrfBox.prototype.computeLength=function(){P.boxes.FullBox.prototype.computeLength.call(this),this.size+=P.fields.FIELD_UINT8.getLength(),1===this.version?this.size+=2*P.fields.FIELD_UINT64.getLength()*this.fragment_count:this.size+=2*P.fields.FIELD_UINT32.getLength()*this.fragment_count},P.boxes.TfrfBox.prototype.write=function(e,t){P.boxes.FullBox.prototype.write.call(this,e,t);var n=0;for(this._writeData(e,P.fields.FIELD_UINT8,this.fragment_count),n=0;n<this.fragment_count;n++)1===this.version?(this._writeData(e,P.fields.FIELD_UINT64,this.entry[n].fragment_absolute_time),this._writeData(e,P.fields.FIELD_UINT64,this.entry[n].fragment_duration)):(this._writeData(e,P.fields.FIELD_UINT32,this.entry[n].fragment_absolute_time),this._writeData(e,P.fields.FIELD_UINT32,this.entry[n].fragment_duration));return this.localPos},P.boxes.TfrfBox.prototype.read=function(e,t,n){P.boxes.FullBox.prototype.read.call(this,e,t,n);var i=0,r={};for(this.fragment_count=this._readData(e,P.fields.FIELD_UINT8),this.entry=[],i=0;i<this.fragment_count;i++)r={},1===this.version?(r.fragment_absolute_time=this._readData(e,P.fields.FIELD_UINT64),r.fragment_duration=this._readData(e,P.fields.FIELD_UINT64)):(r.fragment_absolute_time=this._readData(e,P.fields.FIELD_UINT32),r.fragment_duration=this._readData(e,P.fields.FIELD_UINT32)),this.entry.push(r);return this.localPos},P.registerTypeBoxes();var w=function(){return{pes:{},si:{},binary:{},ts:{},Pts:{},aac:{},h264:{}}}();return"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=w:window.mpegts=w,w.si.PSISection=function(e){this.m_table_id=e,this.m_section_syntax_indicator=1,this.m_section_length=w.si.PSISection.prototype.SECTION_LENGTH,this.m_transport_stream_id=0,this.m_version_number=0,this.m_current_next_indicator=!0,this.m_section_number=0,this.m_last_section_number=0,this.m_bValid=null},w.si.PSISection.prototype.parse=function(e){this.m_bValid=!1;var t=0,n=e[t];return t=0===n?t+1:t+n,this.m_table_id=e[t],t++,this.m_section_syntax_indicator=w.binary.getBitFromByte(e[t],0),this.m_section_length=w.binary.getValueFrom2Bytes(e.subarray(t,t+2),4),t+=2,this.m_transport_stream_id=w.binary.getValueFrom2Bytes(e.subarray(t,t+2)),t+=2,this.m_version_number=w.binary.getValueFromByte(e[t],2,5),this.m_current_next_indicator=w.binary.getBitFromByte(e[t],7),t++,this.m_section_number=e[t],t++,this.m_last_section_number=e[t],this.m_bValid=!0,t},w.si.PSISection.prototype.getSectionLength=function(){return this.m_section_length},w.si.PSISection.prototype.SECTION_LENGTH=9,w.si.PSISection.prototype.HEADER_LENGTH=8,w.aac.SAMPLING_FREQUENCY=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],w.aac.getAudioSpecificConfig=function(e){var t=w.binary.getValueFromByte(e[2],0,2),n=w.binary.getValueFromByte(e[2],2,4),i=w.binary.getValueFrom2Bytes(e.subarray(2,5),7,3),r=new Uint8Array(2);return r[0]=t+1<<3,r[0]|=(14&n)>>1,r[1]|=(1&n)<<7,r[1]|=i<<3,r},w.aac.parseADTS=function(e,t){for(var n,i,r=[],o={},s=0;s<e.length;)i=s,o.syncword=(e[s]<<4)+((240&e[s+1])>>4),o.protection_absent=1&e[s+1],o.sampling_frequency_index=(60&e[s+2])>>2,o.channel_configuration=((1&e[s+2])<<1)+((192&e[s+3])>>6),o.aac_frame_length=((3&e[s+3])<<11)+(e[s+4]<<3)+((224&e[s+5])>>5),o.number_of_raw_data_blocks_in_frame=(3&e[s+6])>>2,s+=7,0===o.number_of_raw_data_blocks_in_frame&&(0===o.protection_absent&&(s+=2),n={},n.offset=s,n.length=o.aac_frame_length-(s-i),t&&t[i]&&(n.cts=t[i]),r.push(n),s+=n.length);return r},w.ts.AdaptationField=function(){this.m_cAFLength=null,this.m_bDiscontinuityInd=null,this.m_bRAI=null,this.m_bESPriority=null,this.m_bPCRFlag=null,this.m_bOPCRFlag=null,this.m_bSplicingPointFlag=null,this.m_bPrivateDataFlag=null,this.m_bAdaptationFieldExtFlag=null},w.ts.AdaptationField.prototype.getLength=function(){return this.m_cAFLength+1},w.ts.AdaptationField.prototype.parse=function(e){if(this.m_cAFLength=e[0],0!==this.m_cAFLength){var t=1;this.m_bDiscontinuityInd=w.binary.getBitFromByte(e[t],0),this.m_bRAI=w.binary.getBitFromByte(e[t],1),this.m_bESPriority=w.binary.getBitFromByte(e[t],2),this.m_bPCRFlag=w.binary.getBitFromByte(e[t],3),this.m_bOPCRFlag=w.binary.getBitFromByte(e[t],4),this.m_bSplicingPointFlag=w.binary.getBitFromByte(e[t],5),this.m_bPrivateDataFlag=w.binary.getBitFromByte(e[t],6),this.m_bAdaptationFieldExtFlag=w.binary.getBitFromByte(e[t],7)}},w.binary.readBytes=function(e,t,n){for(var i=0,r=0;r<n;r++)i<<=8,i+=e[t],t++;return i},w.binary.getBitFromByte=function(e,t){var n=0;return n+=1<<7-t,0!==(e&n)},w.binary.getValueFrom3Bytes=function(e,t,n){"undefined"==typeof n&&(n=-1),"undefined"==typeof t&&(t=0);var i=n==-1?-1:n-(16-t),r=n==-1?0:8-i,o=w.binary.getValueFromByte(e[0],t),s=w.binary.getValueFromByte(e[1]),a=w.binary.getValueFromByte(e[2],0,i,!1);return(o<<16&16711680|s<<8&65280|255&a)>>r},w.binary.getValueFrom2Bytes=function(e,t,n){"undefined"==typeof n&&(n=-1),"undefined"==typeof t&&(t=0);var i=n==-1?-1:n-(8-t),r=n==-1?0:8-i,o=w.binary.getValueFromByte(e[0],t),s=w.binary.getValueFromByte(e[1],0,i,!1);return(o<<8&65280|255&s)>>r},w.binary.getValueFromByte=function(e,t,n,i){var r=0,o=0;"undefined"==typeof n&&(n=-1),"undefined"==typeof t&&(t=0);var s=n==-1?7:t+n-1;for(o=t;o<=s;o++)r+=1<<7-o;var a=e&r;return(i||"undefined"==typeof i)&&(a>>=7-s),a},w.h264.getSequenceHeader=function(e){for(var t,n=-1,i=-1,r=0,o=null,s=0,a=0;r<e.length;)if(0===e[r]&&0===e[r+1]&&0===e[r+2]&&1===e[r+3]){if(t=31&e[r+4],t>=w.h264.NALUTYPE_SPS&&t<=w.h264.NALUTYPE_PPS){if(n===-1&&(n=r),t===w.h264.NALUTYPE_SPS){var l=w.h264.parseSPS(e.subarray(r+5));s=l.pic_width_in_mbs_minus1+1<<4,a=l.pic_height_in_map_units_minus1+1<<4}}else n>0&&(i=r-n);if(t===w.h264.NALUTYPE_IDR||t===w.h264.NALUTYPE_NONIDR)break;r+=4}else{if(0===e[r]&&0===e[r+1]&&1===e[r+2]){n>0&&(i=r-n);break}r++}return n===-1||i===-1?null:(o=new Uint8Array(i),o.set(e.subarray(n,n+i)),{bytes:o,width:s,height:a})},w.h264.read_ue=function(e,t){var n=1,i=0,r=0;for(t._bit=t._byte>>t._bitPos&1,t._bitPos--,t._bitPos<0&&(t._byte=e[t._bytePos],t._bytePos++,t._bitPos=7);0===t._bit;)r++,n<<=1,t._bit=t._byte>>t._bitPos&1,t._bitPos--,t._bitPos<0&&(t._byte=e[t._bytePos],t._bytePos++,t._bitPos=7);if(n-=1,i=0,r)for(;r>0;)t._bit=t._byte>>t._bitPos&1,t._bitPos--,i=(i<<1)+t._bit,r--,t._bitPos<0&&(t._byte=e[t._bytePos],t._bytePos++,t._bitPos=7);return n+=i},w.h264.read_flag=function(e,t){var n=0;return t._bit=t._byte>>t._bitPos&1,t._bitPos--,t._bitPos<0&&(t._byte=e[t._bytePos],t._bytePos++,t._bitPos=7),n=t._bit},w.h264.parseSPS=function(e){var t={profile_idc:0,constraint_set0_flag:0,constraint_set1_flag:0,constraint_set2_flag:0,constraint_set3_flag:0,level_idc:0,seq_parameter_set_id:0,chroma_format_idc:0,separate_colour_plane_flag:0,bit_depth_luma_minus8:0,bit_depth_chroma_minus8:0,qpprime_y_zero_transform_bypass_flag:0,seq_scaling_matrix_present_flag:0,log2_max_frame_num_minus4:0,pic_order_cnt_type:0,log2_max_pic_order_cnt_lsb_minus4:0,num_ref_frames:0,gaps_in_frame_num_value_allowed_flag:0,pic_width_in_mbs_minus1:0,pic_height_in_map_units_minus1:0},n={_byte:0,_bit:0,_bytePos:0,_bitPos:0};return n._bytePos=n._bitPos=0,n._byte=e[n._bytePos],n._bytePos++,t.profile_idc=n._byte,n._byte=e[n._bytePos],n._bytePos++,t.constraint_set0_flag=(128&n._byte)>>7,t.constraint_set1_flag=(64&n._byte)>>6,t.constraint_set2_flag=(32&n._byte)>>5,t.constraint_set3_flag=(16&n._byte)>>4,n._byte=e[n._bytePos],n._bytePos++,t.level_idc=n._byte,n._byte=e[n._bytePos],n._bytePos++,n._bitPos=7,t.seq_parameter_set_id=w.h264.read_ue(e,n),100!==t.profile_idc&&110!==t.profile_idc&&122!==t.profile_idc&&244!==t.profile_idc&&44!==t.profile_idc&&83!==t.profile_idc&&86!==t.profile_idc||(t.chroma_format_idc=w.h264.read_ue(e,n),3===t.chroma_format_idc&&(t.separate_colour_plane_flag=w.h264.read_flag(e,n)),t.bit_depth_luma_minus8=w.h264.read_ue(e,n),t.bit_depth_chroma_minus8=w.h264.read_ue(e,n),t.qpprime_y_zero_transform_bypass_flag=w.h264.read_flag(e,n),t.seq_scaling_matrix_present_flag=w.h264.read_flag(e,n),1===t.seq_scaling_matrix_present_flag),t.log2_max_frame_num_minus4=w.h264.read_ue(e,n),t.pic_order_cnt_type=w.h264.read_ue(e,n),0===t.pic_order_cnt_type?t.log2_max_pic_order_cnt_lsb_minus4=w.h264.read_ue(e,n):1===t.pic_order_cnt_type,t.num_ref_frames=w.h264.read_ue(e,n),t.gaps_in_frame_num_value_allowed_flag=w.h264.read_flag(e,n),t.pic_width_in_mbs_minus1=w.h264.read_ue(e,n),t.pic_height_in_map_units_minus1=w.h264.read_ue(e,n),t},w.h264.bytestreamToMp4=function(e){for(var t=0,n=e.length,i=-1,r=0;t<n;)0===e[t]&&0===e[t+1]&&0===e[t+2]&&1===e[t+3]?(i>=0&&(r=t-i-4,e[i]=(4278190080&r)>>24,e[i+1]=(16711680&r)>>16,e[i+2]=(65280&r)>>8,e[i+3]=255&r),i=t,t+=4):t++;r=t-i-4,e[i]=(4278190080&r)>>24,e[i+1]=(16711680&r)>>16,e[i+2]=(65280&r)>>8,e[i+3]=255&r},w.h264.isIDR=function(e){for(var t,n=0;n<e.length;)if(0===e[n]&&0===e[n+1]&&0===e[n+2]&&1===e[n+3]){if(t=31&e[n+4],t===w.h264.NALUTYPE_IDR)return!0;n+=4}else n++;return!1},w.h264.NALUTYPE_NONIDR=1,w.h264.NALUTYPE_IDR=5,w.h264.NALUTYPE_SEI=6,w.h264.NALUTYPE_SPS=7,w.h264.NALUTYPE_PPS=8,w.h264.NALUTYPE_AU_DELIMITER=9,w.si.PAT=function(){w.si.PSISection.call(this,w.si.PAT.prototype.TABLE_ID),this.m_listOfProgramAssociation=[],this.m_network_pid=null},w.si.PAT.prototype=Object.create(w.si.PSISection.prototype),w.si.PAT.prototype.constructor=w.si.PAT,w.si.PAT.prototype.parse=function(e){var t=w.si.PSISection.prototype.parse.call(this,e);if(t++,this.m_bValid&&(this.m_bValid=!1,this.m_table_id===this.TABLE_ID)){for(var n=this.getSectionLength()-this.SECTION_LENGTH;n>=4;){var i=new w.si.ProgramAssociation(e.subarray(t,t+4));0===i.getProgramNumber()?this.m_network_pid=i.getProgramMapPid():this.m_listOfProgramAssociation.push(i),n-=4,
t+=4}this.m_bValid=!0}},w.si.PAT.prototype.getPmtPid=function(){var e=w.ts.TsPacket.prototype.UNDEFINED_PID;if(this.m_listOfProgramAssociation.length>=1){var t=this.m_listOfProgramAssociation[0];e=t.getProgramMapPid()}return e},w.si.PAT.prototype.TABLE_ID=0,w.si.PAT.prototype.PID=0,w.si.ProgramAssociation=function(e){this.m_program_number=0,this.m_program_map_pid=0,this.parse(e)},w.si.ProgramAssociation.prototype.getProgramNumber=function(){return this.m_program_number},w.si.ProgramAssociation.prototype.getProgramMapPid=function(){return this.m_program_map_pid},w.si.ProgramAssociation.prototype.getLength=function(){return 4},w.si.ProgramAssociation.prototype.parse=function(e){this.m_program_number=w.binary.getValueFrom2Bytes(e.subarray(0,2)),this.m_program_map_pid=w.binary.getValueFrom2Bytes(e.subarray(2,4),3,13)},w.pes.PesPacket=function(){this.m_cStreamID=null,this.m_nPESPacketLength=null,this.m_cPESScramblingCtrl=null,this.m_bPESpriority=null,this.m_bDataAlignement=null,this.m_bCopyright=null,this.m_bOriginalOrCopy=null,this.m_cPES_header_data_length=null,this.m_cPTS_DTS_flags=null,this.m_bESCR_flag=null,this.m_bES_rate_flag=null,this.m_bDSM_trick_mode_flag=null,this.m_bAdditional_copy_info_flag=null,this.m_bPES_CRC_flag=null,this.m_bPES_extension_flag=null,this.m_pPTS=null,this.m_pDTS=null,this.m_pESCR=null,this.m_ES_rate=null,this.m_DSM_trick_mode=null,this.m_Additional_copy_info=null,this.m_PES_CRC=null,this.m_cNbStuffingBytes=null,this.m_pPESExtension=null,this.m_pPrivateData=null,this.m_payloadArray=null,this.m_nPayloadLength=null,this.m_bDirty=null,this.m_bValid=!1},w.pes.PesPacket.prototype.parse=function(e){var t=0;this.m_nLength=e.length;var n=w.binary.getValueFrom3Bytes(e.subarray(t,t+3));if(n===this.START_CODE_PREFIX){if(t=3,this.m_cStreamID=e[t],t++,this.m_nPESPacketLength=w.binary.getValueFrom2Bytes(e.subarray(t,t+2)),t+=2,this.m_cStreamID===w.ts.TsPacket.prototype.STREAM_ID_PADDING_STREAM)return void(this.m_bValid=!0);if(!this.hasOptionalPESHeader())return this.m_payloadArray=e.subarray(t+w.pes.PesPacket.prototype.FIXED_HEADER_LENGTH),this.m_nPayloadLength=this.m_nLength-w.pes.PesPacket.prototype.FIXED_HEADER_LENGTH,void(this.m_bValid=!0);var i=w.binary.getValueFromByte(e[t],0,2);if(2===i){this.m_cPESScramblingCtrl=w.binary.getValueFromByte(e[t],2,2),this.m_bPESpriority=w.binary.getBitFromByte(e[t],4),this.m_bDataAlignement=w.binary.getBitFromByte(e[t],5),this.m_bCopyright=w.binary.getBitFromByte(e[t],6),this.m_bOriginalOrCopy=w.binary.getBitFromByte(e[t],7),t++,this.m_cPTS_DTS_flags=w.binary.getValueFromByte(e[t],0,2),this.m_bESCR_flag=w.binary.getBitFromByte(e[t],2),this.m_bES_rate_flag=w.binary.getBitFromByte(e[t],3),this.m_bDSM_trick_mode_flag=w.binary.getBitFromByte(e[t],4),this.m_bAdditional_copy_info_flag=w.binary.getBitFromByte(e[t],5),this.m_bPES_CRC_flag=w.binary.getBitFromByte(e[t],6),this.m_bPES_extension_flag=w.binary.getBitFromByte(e[t],7),t++,this.m_cPES_header_data_length=255&e[t],t++,(this.m_cPTS_DTS_flags&w.pes.PesPacket.prototype.FLAG_PTS)==w.pes.PesPacket.prototype.FLAG_PTS&&(this.m_pPTS=new w.Pts(e.subarray(t,t+5)),t+=5),(this.m_cPTS_DTS_flags&w.pes.PesPacket.prototype.FLAG_DTS)==w.pes.PesPacket.prototype.FLAG_DTS&&(this.m_pDTS=new w.Pts(e.subarray(t,t+5)),t+=5),this.m_bESCR_flag&&(t+=6),this.m_bES_rate_flag&&(this.m_ES_rate=w.binary.getValueFrom3Bytes(e.subarray(t,t+3),1,22),t+=3),this.m_bDSM_trick_mode_flag&&(this.m_DSM_trick_mode=e[t],t++),this.m_bAdditional_copy_info_flag&&(this.m_Additional_copy_info=e[t],t++),this.m_bPES_CRC_flag&&(this.m_PES_CRC=w.binary.getValueFrom2Bytes(e.subarray(t,t+2)),t+=2),this.m_bPES_extension_flag;var r=w.pes.PesPacket.prototype.FIXED_HEADER_LENGTH+w.pes.PesPacket.prototype.FIXED_OPTIONAL_HEADER_LENGTH+this.m_cPES_header_data_length;this.m_cNbStuffingBytes=r-t,t+=this.m_cNbStuffingBytes,this.m_nPayloadLength=this.m_nLength-r,this.m_payloadArray=e.subarray(r,r+this.m_nPayloadLength),this.m_bValid=!0}}},w.pes.PesPacket.prototype.hasOptionalPESHeader=function(){return this.m_cStreamID!==w.ts.TsPacket.prototype.STREAM_ID_PROGRAM_STREAM_MAP&&this.m_cStreamID!==w.ts.TsPacket.prototype.STREAM_ID_PADDING_STREAM&&this.m_cStreamID!==w.ts.TsPacket.prototype.STREAM_ID_PRIVATE_STREAM_2&&this.m_cStreamID!==w.ts.TsPacket.prototype.STREAM_ID_ECM_STREAM&&this.m_cStreamID!==w.ts.TsPacket.prototype.STREAM_ID_EMM_STREAM&&this.m_cStreamID!==w.ts.TsPacket.prototype.STREAM_ID_PROGRAM_STREAM_DIRECTORY&&this.m_cStreamID!==w.ts.TsPacket.prototype.STREAM_ID_DSMCC_STREAM&&this.m_cStreamID!==w.ts.TsPacket.prototype.STREAM_ID_H2221_TYPE_E_STREAM},w.pes.PesPacket.prototype.getHeaderLength=function(){return w.pes.PesPacket.prototype.FIXED_HEADER_LENGTH+w.pes.PesPacket.prototype.FIXED_OPTIONAL_HEADER_LENGTH+this.m_cPES_header_data_length},w.pes.PesPacket.prototype.getPayload=function(){return this.m_payloadArray},w.pes.PesPacket.prototype.getPts=function(){return this.m_pPTS},w.pes.PesPacket.prototype.getDts=function(){return this.m_pDTS},w.pes.PesPacket.prototype.START_CODE_PREFIX=1,w.pes.PesPacket.prototype.FIXED_HEADER_LENGTH=6,w.pes.PesPacket.prototype.FIXED_OPTIONAL_HEADER_LENGTH=3,w.pes.PesPacket.prototype.FLAG_DTS=1,w.pes.PesPacket.prototype.FLAG_PTS=2,w.si.PMT=function(){w.si.PSISection.call(this,w.si.PMT.prototype.TABLE_ID),this.m_listOfComponents=[],this.m_PCR_PID=null,this.m_program_info_length=null},w.si.PMT.prototype=Object.create(w.si.PSISection.prototype),w.si.PMT.prototype.constructor=w.si.PMT,w.si.PMT.prototype.parse=function(e){var t=w.si.PSISection.prototype.parse.call(this,e);if(t++,this.m_bValid&&(this.m_bValid=!1,this.m_table_id===this.TABLE_ID)){var n=this.getSectionLength()-this.SECTION_LENGTH;if(!(n<4)){this.m_PCR_PID=w.binary.getValueFrom2Bytes(e.subarray(t,t+2),3),t+=2,this.m_program_info_length=w.binary.getValueFrom2Bytes(e.subarray(t,t+2),4),t+=2,t+=this.m_program_info_length,n=this.m_section_length-this.SECTION_LENGTH-4-this.m_program_info_length;for(var i=null;n>0;)i=new w.si.ESDescription(e.subarray(t,t+n)),this.m_listOfComponents.push(i),n-=i.getLength(),t+=i.getLength();this.m_bValid=!0}}},w.si.PMT.prototype.TABLE_ID=2,w.si.PMT.prototype.gStreamTypes=[{name:"Reserved",value:0,desc:"ITU-T | ISO/IEC Reserved"},{name:"MPEG1-Video",value:224,desc:"ISO/IEC 11172-2 Video"},{name:"MPEG2-Video",value:224,desc:"ITU-T Rec. H.262 | ISO/IEC 13818-2 Video or ISO/IEC 11172-2 constrained parameter video stream"},{name:"MPEG1-Audio",value:192,desc:"ISO/IEC 11172-3 Audio"},{name:"MPEG2-Audio",value:192,desc:"ISO/IEC 13818-3 Audio"},{name:"PRIVATE_SECTIONS",value:189,desc:"ITU-T Rec. H.222.0 | ISO/IEC 13818-1 private_sections"},{name:"PRIVATE",value:189,desc:"ITU-T Rec. H.222.0 | ISO/IEC 13818-1 PES packets containing private data"},{name:"MHEG",value:243,desc:"ISO/IEC 13522 MHEG"},{name:"MPEG1-DSM-CC",value:242,desc:"ITU-T Rec. H.222.0 | ISO/IEC 13818-1 Annex A DSM-CC"},{name:"H.222.1",value:244,desc:"ITU-T Rec. H.222.1"},{name:"DSM-CC_A",value:244,desc:"ISO/IEC 13818-6 type A"},{name:"DSM-CC_B",value:245,desc:"ISO/IEC 13818-6 type B"},{name:"DSM-CC_C",value:246,desc:"ISO/IEC 13818-6 type C"},{name:"DSM-CC_D",value:247,desc:"ISO/IEC 13818-6 type D"},{name:"Auxiliary",value:0,desc:"ITU-T Rec. H.222.0 | ISO/IEC 13818-1 auxiliary"},{name:"MPEG2-AAC-ADTS",value:192,desc:"ISO/IEC 13818-7 Audio with ADTS transport syntax"},{name:"MPEG4-Video",value:224,desc:"ISO/IEC 14496-2 Visual"},{name:"MPEG4-AAC-LATM",value:192,desc:"ISO/IEC 14496-3 Audio with the LATM transport syntax as defined in ISO/IEC 14496-3/AMD-1"},{name:"MPEG4-SL",value:250,desc:"ISO/IEC 14496-1 SL-packetized stream or FlexMux stream carried in PES packets"},{name:"MPEG4-SL",value:250,desc:"ISO/IEC 14496-1 SL-packetized stream or FlexMux stream carried in ISO/IEC14496_sections"},{name:"DSM-CC_SDP",value:0,desc:"ISO/IEC 13818-6 Synchronized Download Protocol"},{name:"META_PES",value:252,desc:"Metadata carried in PES packets"},{name:"META_SECTIONS",value:252,desc:"Metadata carried in metadata_sections"},{name:"META_DSM-CC",value:252,desc:"Metadata carried in ISO/IEC 13818-6 Data Carousel"},{name:"META_DSM-CC",value:252,desc:"Metadata carried in ISO/IEC 13818-6 Object Carousel"},{name:"META_DSM-CC",value:252,desc:"Metadata carried in ISO/IEC 13818-6 Synchronized Download Protocol"},{name:"MPEG2-IPMP",value:0,desc:"IPMP stream (defined in ISO/IEC 13818-11, MPEG-2 IPMP)"},{name:"H.264",value:224,desc:"AVC video stream as defined in ITU-T Rec. H.264 | ISO/IEC 14496-10 Video"},{name:"MPEG4AAC",value:192,desc:"ISO/IEC 14496-3 Audio, without using any additional transport syntax, such as DST, ALS and SLS"},{name:"MPEG4Text",value:0,desc:"ISO/IEC 14496-17 Text"},{name:"Aux. Video (23002-3)",value:30,desc:"Auxiliary video stream as defined in ISO/IEC 23002-3"},{name:"H.264-SVC",value:224,desc:"SVC video sub-bitstream of a video stream as defined in the Annex G of ITU-T Rec. H.264 | ISO/IEC 14496-10 Video"},{name:"H.264-MVC",value:224,desc:"MVC video sub-bitstream of a video stream as defined in the Annex H of ITU-T Rec. H.264 | ISO/IEC 14496-10 Video"},{name:"Reserved1",value:0,desc:"TBC Reserved"},{name:"Reserved2",value:0,desc:"TBC Reserved"},{name:"Reserved3",value:0,desc:"TBC Reserved"},{name:"HEVC",value:224,desc:"ITU.-T Rec H.26x | ISO/IEC 23008-2 video stream"}],w.si.PMT.prototype.MPEG2_VIDEO_STREAM_TYPE=2,w.si.PMT.prototype.AVC_VIDEO_STREAM_TYPE=27,w.si.PMT.prototype.MPEG1_AUDIO_STREAM_TYPE=3,w.si.PMT.prototype.MPEG2_AUDIO_STREAM_TYPE=4,w.si.PMT.prototype.AAC_AUDIO_STREAM_TYPE=17,w.si.PMT.prototype.AC3_AUDIO_STREAM_TYPE=6,w.si.PMT.prototype.SUB_STREAM_TYPE=6,w.si.PMT.prototype.STREAM_TYPE_MP1V=1,w.si.PMT.prototype.STREAM_TYPE_MP2V=2,w.si.PMT.prototype.STREAM_TYPE_MP1A=3,w.si.PMT.prototype.STREAM_TYPE_MP2A=4,w.si.PMT.prototype.STREAM_TYPE_PRIVATE=6,w.si.PMT.prototype.STREAM_TYPE_TELETEXT=6,w.si.PMT.prototype.STREAM_TYPE_DVBSUBTITLE=6,w.si.PMT.prototype.STREAM_TYPE_AC3=6,w.si.PMT.prototype.STREAM_TYPE_MP2AAC_ADTS=15,w.si.PMT.prototype.STREAM_TYPE_MP4AAC_LATM=17,w.si.PMT.prototype.STREAM_TYPE_H264=27,w.si.PMT.prototype.STREAM_TYPE_MP4AAC=28,w.si.PMT.prototype.STREAM_TYPE_AUX_23002_3=30,w.si.PMT.prototype.STREAM_TYPE_SVC=31,w.si.PMT.prototype.STREAM_TYPE_MVC=32,w.si.PMT.prototype.STREAM_TYPE_HEVC=36,w.si.ESDescription=function(e){this.m_stream_type=null,this.m_elementary_PID=null,this.m_ES_info_length=null,this.parse(e)},w.si.ESDescription.prototype.getStreamType=function(){return this.m_stream_type},w.si.ESDescription.prototype.getPID=function(){return this.m_elementary_PID},w.si.ESDescription.prototype.getLength=function(){return 5+this.m_ES_info_length},w.si.ESDescription.prototype.parse=function(e){this.m_stream_type=e[0],this.m_elementary_PID=w.binary.getValueFrom2Bytes(e.subarray(1,3),3),this.m_ES_info_length=w.binary.getValueFrom2Bytes(e.subarray(3,5),4)},w.Pts=function(e){var t,n,i=e[0]>>1&7;n=i>>2,t=(3&i)<<30>>>0;var r=e[1];t=(t|r<<22)>>>0;var o=e[2]>>1;t=(t|o<<15)>>>0;var s=e[3];t=(t|s<<7)>>>0;var a=e[4]>>1;t=(t|a)>>>0,this.m_lPTS=_.math.Long.fromBits(t,n).toNumber(),this.m_fPTS=this.m_lPTS/w.Pts.prototype.SYSTEM_CLOCK_FREQUENCY},w.Pts.prototype.getValue=function(){return this.m_lPTS},w.Pts.prototype.getValueInSeconds=function(){return this.m_fPTS},w.Pts.prototype.SYSTEM_CLOCK_FREQUENCY=9e4,w.ts.TsPacket=function(){this.m_cSync=null,this.m_bTransportError=null,this.m_bPUSI=null,this.m_bTransportPriority=null,this.m_nPID=null,this.m_cTransportScramblingCtrl=null,this.m_cAdaptationFieldCtrl=null,this.m_cContinuityCounter=null,this.m_pAdaptationField=null,this.m_payloadArray=null,this.m_cPayloadLength=null,this.m_bDirty=null,this.m_time=null,this.m_arrivalTime=null,this.m_bIgnored=null},w.ts.TsPacket.prototype.parse=function(e){var t=0;if(this.m_cSync=e[t],this.m_cSync===this.SYNC_WORD){if(t++,this.m_bTransportError=w.binary.getBitFromByte(e[t],0),this.m_bPUSI=w.binary.getBitFromByte(e[t],1),this.m_bTransportPriority=w.binary.getBitFromByte(e[t],2),this.m_nPID=w.binary.getValueFrom2Bytes(e.subarray(t,t+2),3,13),t+=2,this.m_cTransportScramblingCtrl=w.binary.getValueFromByte(e[t],0,2),this.m_cAdaptationFieldCtrl=w.binary.getValueFromByte(e[t],2,2),this.m_cContinuityCounter=w.binary.getValueFromByte(e[t],4,4),t++,2&this.m_cAdaptationFieldCtrl){var n=e[t];if(n+t>=this.TS_PACKET_SIZE)return;this.m_pAdaptationField=new w.ts.AdaptationField,this.m_pAdaptationField.parse(e.subarray(t)),t+=this.m_pAdaptationField.getLength()}0!==this.m_cAdaptationFieldCtrl&&1&this.m_cAdaptationFieldCtrl&&(this.m_cPayloadLength=this.TS_PACKET_SIZE-t,this.m_payloadArray=e.subarray(t,t+this.m_cPayloadLength))}},w.ts.TsPacket.prototype.getPid=function(){return this.m_nPID},w.ts.TsPacket.prototype.getPayload=function(){return this.m_payloadArray},w.ts.TsPacket.prototype.getPayloadLength=function(){return this.m_cPayloadLength},w.ts.TsPacket.prototype.getPusi=function(){return this.m_bPUSI},w.ts.TsPacket.prototype.hasAdaptationFieldOnly=function(){return 2===this.m_cAdaptationFieldCtrl},w.ts.TsPacket.prototype.SYNC_WORD=71,w.ts.TsPacket.prototype.TS_PACKET_SIZE=188,w.ts.TsPacket.prototype.UNDEFINED_PID=65535,w.ts.TsPacket.prototype.PAT_PID=0,w.ts.TsPacket.prototype.STREAM_ID_PROGRAM_STREAM_MAP=188,w.ts.TsPacket.prototype.STREAM_ID_PADDING_STREAM=190,w.ts.TsPacket.prototype.STREAM_ID_PADDING_STREAM=190,w.ts.TsPacket.prototype.STREAM_ID_PRIVATE_STREAM_2=191,w.ts.TsPacket.prototype.STREAM_ID_ECM_STREAM=240,w.ts.TsPacket.prototype.STREAM_ID_EMM_STREAM=241,w.ts.TsPacket.prototype.STREAM_ID_DSMCC_STREAM=242,w.ts.TsPacket.prototype.STREAM_ID_H2221_TYPE_E_STREAM=248,w.ts.TsPacket.prototype.STREAM_ID_PROGRAM_STREAM_DIRECTORY=255,E=this.dijon,T});
/* jshint ignore:end */